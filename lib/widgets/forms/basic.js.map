{"version":3,"file":"basic.js","names":["_rdflib","require","_solidLogic","ns","_interopRequireWildcard","_style","_utils","_error","_fieldFunction","_fieldParams","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","store","solidLogicSingleton","renderNameValuePair","dom","kb","box","form","label","style","display","flexDirection","lhs","appendChild","createElement","width","formFieldNameBoxWidth","rhs","setAttribute","formFieldNameBoxStyle","createTextNode","any","ui","fieldLabel","errorMessageBlock","property","fieldInQuestion","lab","undefined","anchor","uri","textContent","fieldStore","subject","predicate","def","sts","statementsMatching","length","updater","Error","why","value","editable","sym","basicField","container","already","doc","callbackFunction","formDoc","suppressEmptyUneditable","anyJS","mostSpecificClassURI","params","fieldParams","paramStyle","textInputStyle","field","type","size","textInputSize","maxLength","uriPrefix","decodeURIComponent","replace","readOnly","textInputStyleUneditable","addEventListener","_e","pattern","match","disabled","ds","result","namedNode","encodeURIComponent","dt","Literal","trim","xsd","is","map","statement","st","updateMany","callback","docs","forEach","includes","push","update","pop","is1","filter","is2","ds1","ds2","ok","body"],"sources":["../../../src/widgets/forms/basic.ts"],"sourcesContent":["import { BlankNode, Literal, NamedNode, Node, st, Store, Variable } from 'rdflib'\nimport { solidLogicSingleton } from 'solid-logic'\nimport * as ns from '../../ns'\nimport { formFieldNameBoxStyle, formFieldNameBoxWidth, textInputSize, textInputStyle, textInputStyleUneditable } from '../../style'\nimport { label } from '../../utils'\nimport { errorMessageBlock } from '../error'\nimport { mostSpecificClassURI } from './fieldFunction'\nimport { fieldParams } from './fieldParams'\n\nconst store = solidLogicSingleton.store\n\n/*  Style and create a name, value pair\n*/\nexport function renderNameValuePair (dom: HTMLDocument, kb: Store, box: HTMLElement, form: NamedNode, label?: string):HTMLElement {\n  // const property = kb.any(form, ns.ui('property'))\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const lhs = box.appendChild(dom.createElement('div'))\n  lhs.style.width = formFieldNameBoxWidth\n  const rhs = box.appendChild(dom.createElement('div'))\n\n  lhs.setAttribute('class', 'formFieldName')\n  lhs.setAttribute('style', formFieldNameBoxStyle)\n  rhs.setAttribute('class', 'formFieldValue')\n  if (label) {\n    lhs.appendChild(dom.createTextNode(label))\n  } else if (kb.any(form, ns.ui('property'))) { // Assume more space for error on right\n    lhs.appendChild(fieldLabel(dom, kb.any(form, ns.ui('property')) as NamedNode, form))\n  } else {\n    rhs.appendChild(errorMessageBlock(dom, 'No property or label given for form field: ' + form))\n    lhs.appendChild(dom.createTextNode('???'))\n  }\n  return rhs\n}\n\n/**\n * Create an anchor element with a label as the anchor text.\n *\n * @param dom The DOM\n * @param property href for the anchor element\n * @param fieldInQuestion field to produce a label for\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldLabel (dom: HTMLDocument, property: NamedNode | undefined, fieldInQuestion: Node): HTMLElement | Text {\n  let lab = store.any(fieldInQuestion as any, ns.ui('label'))\n  if (!lab) lab = label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  /* istanbul ignore next */\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', 'color: #3B5998; text-decoration: none;') // Not too blue and no underline\n  anchor.textContent = lab as any\n  return anchor\n}\n\n/**\n * Returns the document for the first quad that matches\n * the subject and predicate provided, or default if that\n * store is not editable.\n *\n * @param subject Subject about which we want to find an editable RDF document\n * @param predicate Predicate about which we want to find an editable RDF document\n * @param def default RDF document to return if none found\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldStore (subject: NamedNode | BlankNode | Variable, predicate: NamedNode | Variable, def: NamedNode | undefined): NamedNode | undefined {\n  const sts = store.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (!store.updater) {\n    throw new Error('Store has no updater')\n  }\n  if (\n    sts.length > 0 &&\n    sts[0].why.value &&\n    store.updater.editable(sts[0].why.value, store)\n  ) {\n    return store.sym(sts[0].why.value)\n  }\n  return def\n}\n\n/**\n * Render a basic form field\n *\n * The same function is used for many similar one-value fields, with different\n * regexps used to validate.\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param container  If present, the created widget will be appended to this\n * @param already A hash table of (form, subject) kept to prevent recursive forms looping\n * @param subject The thing about which the form displays/edits data\n * @param form The form or field to be rendered\n * @param doc The web document in which the data is\n * @param callbackFunction Called when data is changed?\n *\n * @returns The HTML widget created\n */\n// eslint-disable-next-line complexity\nexport function basicField (\n  dom: HTMLDocument,\n  container: HTMLElement | undefined,\n  already,\n  subject: NamedNode | BlankNode | Variable,\n  form: NamedNode,\n  doc: NamedNode | undefined,\n  callbackFunction: (_ok: boolean, _errorMessage: string) => void\n): HTMLElement {\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = dom.createElement('div')\n\n  const property = kb.any(form, ns.ui('property'))\n  if (container) container.appendChild(box)\n  if (!property) {\n    return box.appendChild(\n      errorMessageBlock(dom, 'Error: No property given for text field: ' + form)\n    )\n  }\n  const rhs = renderNameValuePair(dom, kb, box, form)\n\n  // It can be cleaner to just remove empty fields if you can't edit them anyway\n  const suppressEmptyUneditable = kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  const uri = mostSpecificClassURI(form)\n  let params = fieldParams[uri]\n  if (params === undefined) params = { style: '' } // non-bottom field types can do this\n  const paramStyle = params.style || ''\n  const style = textInputStyle + paramStyle\n  const field = dom.createElement('input')\n  ;(field as any).style = style\n  rhs.appendChild(field)\n  field.setAttribute('type', params.type ? params.type : 'text')\n\n  const size = kb.anyJS(form, ns.ui('size')) || textInputSize || 20\n  field.setAttribute('size', size)\n\n  const maxLength = kb.any(form, ns.ui('maxLength'))\n  field.setAttribute('maxLength', maxLength ? '' + maxLength : '4096')\n\n  doc = doc || fieldStore(subject, property as any, doc)\n\n  let obj = kb.any(subject, property as any, undefined, doc)\n  if (!obj) {\n    obj = kb.any(form, ns.ui('default'))\n  }\n  if (obj && obj.value && params.uriPrefix) {\n    // eg tel: or mailto:\n    field.value = decodeURIComponent(obj.value.replace(params.uriPrefix, '')) // should have no spaces but in case\n      .replace(/ /g, '')\n  } else if (obj) {\n    /* istanbul ignore next */\n    field.value = obj.value || obj.value || ''\n  }\n  field.setAttribute('style', style)\n  if (!kb.updater) {\n    throw new Error('kb has no updater')\n  }\n  if (!kb.updater.editable((doc as NamedNode).uri)) {\n    field.readOnly = true // was: disabled. readOnly is better\n    ;(field as any).style = textInputStyleUneditable + paramStyle\n    // backgroundColor = textInputBackgroundColorUneditable\n    if (suppressEmptyUneditable && field.value === '') {\n      box.style.display = 'none' // clutter\n    }\n    return box\n  }\n\n  // read-write:\n  field.addEventListener(\n    'keyup',\n    function (_e) {\n      if (params.pattern) {\n        field.setAttribute(\n          'style',\n          style +\n            (field.value.match(params.pattern)\n              ? 'color: green;'\n              : 'color: red;')\n        )\n      }\n    },\n    true\n  )\n  field.addEventListener(\n    'change',\n    function (_e) {\n      // i.e. lose focus with changed data\n      if (params.pattern && !field.value.match(params.pattern)) return\n      field.disabled = true // See if this stops getting two dates from fumbling e.g the chrome datepicker.\n      field.setAttribute('style', style + 'color: gray;') // pending\n      const ds = kb.statementsMatching(subject, property as any) // remove any multiple values\n      let result\n      if (params.namedNode) {\n        result = kb.sym(field.value)\n      } else if (params.uriPrefix) {\n        result = encodeURIComponent(field.value.replace(/ /g, ''))\n        result = kb.sym(params.uriPrefix + field.value)\n      } else {\n        if (params.dt) {\n          result = new Literal(\n            field.value.trim(),\n            undefined,\n            ns.xsd(params.dt)\n          )\n        } else {\n          result = new Literal(field.value)\n        }\n      }\n      let is = ds.map(statement => st(statement.subject, statement.predicate, result, statement.why)) // can include >1 doc\n      if (is.length === 0) {\n        // or none\n        is = [st(subject, property as any, result, doc)]\n      }\n\n      function updateMany (ds, is: { why: { uri: string } }[], callback) {\n        const docs: any[] = []\n        is.forEach(st => {\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        ds.forEach(st => {\n          /* istanbul ignore next */\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        /* istanbul ignore next */\n        if (docs.length === 0) {\n          throw new Error('updateMany has no docs to patch')\n        }\n        if (!kb.updater) {\n          throw new Error('kb has no updater')\n        }\n        if (docs.length === 1) {\n          return kb.updater.update(ds, is as any, callback)\n        }\n        // return kb.updater.update(ds, is, callback)\n\n        const doc = docs.pop()\n        const is1 = is.filter(st => st.why.uri === doc)\n        const is2 = is.filter(st => st.why.uri !== doc)\n        const ds1 = ds.filter(st => st.why.uri === doc)\n        const ds2 = ds.filter(st => st.why.uri !== doc)\n        kb.updater.update(ds1, is1 as any, function (uri, ok, body) {\n          if (ok) {\n            updateMany(ds2, is2, callback)\n          } else {\n            callback(uri, ok, body)\n          }\n        })\n      }\n\n      updateMany(ds, is as any, function (uri, ok, body) {\n        // kb.updater.update(ds, is, function (uri, ok, body) {\n        if (ok) {\n          field.disabled = false\n          field.setAttribute('style', style)\n        } else {\n          box.appendChild(errorMessageBlock(dom, body))\n        }\n        callbackFunction(ok, body)\n      })\n    },\n    true\n  )\n  return box\n}\n"],"mappings":"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"}