{"version":3,"sources":["../../../src/widgets/forms/basic.ts"],"names":["fieldLabel","dom","property","fieldInQuestion","lab","store","any","ns","ui","undefined","createTextNode","anchor","createElement","uri","setAttribute","textContent","fieldStore","subject","predicate","def","sts","statementsMatching","length","why","updater","editable","sym","basicField","container","already","form","doc","callbackFunction","kb","box","appendChild","lhs","rhs","params","fieldParams","style","textInputStyle","field","type","size","maxLength","obj","uriPrefix","value","decodeURIComponent","replace","readOnly","addEventListener","_e","pattern","match","disabled","ds","result","namedNode","encodeURIComponent","dt","Literal","trim","xsd","is","map","statement","updateMany","callback","docs","forEach","st","includes","push","Error","update","pop","is1","filter","is2","ds1","ds2","ok","body"],"mappings":"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","sourcesContent":["import { st, BlankNode, Literal, Node, NamedNode, Variable } from 'rdflib'\nimport store from '../../store'\nimport ns from '../../ns'\nimport { textInputStyle } from '../../style'\nimport { label } from '../../utils'\n\nimport { errorMessageBlock } from '../error'\nimport { mostSpecificClassURI } from './fieldFunction'\nimport { fieldParams } from './fieldParams'\n\n/**\n * Create an anchor element with a label as the anchor text.\n *\n * @param dom The DOM\n * @param property href for the anchor element\n * @param fieldInQuestion field to produce a label for\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldLabel (dom: HTMLDocument, property: NamedNode | undefined, fieldInQuestion: Node): HTMLElement | Text {\n  let lab = store.any(fieldInQuestion, ns.ui('label'))\n  if (!lab) lab = label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  /* istanbul ignore next */\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', 'color: #3B5998; text-decoration: none;') // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\n/**\n * Returns the document for the first quad that matches\n * the subject and predicate provided, or default if that\n * store is not editable.\n *\n * @param subject Subject about which we want to find an editable RDF document\n * @param predicate Predicate about which we want to find an editable RDF document\n * @param def default RDF document to return if none found\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldStore (subject: NamedNode | BlankNode | Variable, predicate: NamedNode | Variable, def: NamedNode | undefined): NamedNode | undefined {\n  const sts = store.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    store.updater.editable(sts[0].why.uri, store)\n  ) {\n    return store.sym(sts[0].why.uri)\n  }\n  return def\n}\n\n/**\n * Render a basic form field\n *\n * The same function is used for many similar one-value fields, with different\n * regexps used to validate.\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param container  If present, the created widget will be appended to this\n * @param already A hash table of (form, subject) kept to prevent recursive forms looping\n * @param subject The thing about which the form displays/edits data\n * @param form The form or field to be rendered\n * @param doc The web document in which the data is\n * @param callbackFunction Called when data is changed?\n *\n * @returns The HTML widget created\n */\n// eslint-disable-next-line complexity\nexport function basicField (\n  dom: HTMLDocument,\n  container: HTMLElement | undefined,\n  already,\n  subject: NamedNode | BlankNode | Variable,\n  form: NamedNode,\n  doc: NamedNode | undefined,\n  callbackFunction: (ok: boolean, errorMessage: string) => void\n): HTMLElement {\n  const kb = store\n\n  const box = dom.createElement('tr')\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('td')\n  lhs.setAttribute('class', 'formFieldName')\n  lhs.setAttribute('style', '  vertical-align: middle;')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('td')\n  rhs.setAttribute('class', 'formFieldValue')\n  box.appendChild(rhs)\n\n  const property = kb.any(form, ns.ui('property'))\n  if (!property) {\n    box.appendChild(\n      dom.createTextNode('Error: No property given for text field: ' + form)\n    )\n    return box\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uri = mostSpecificClassURI(form)\n  let params = fieldParams[uri]\n  if (params === undefined) params = {} // non-bottom field types can do this\n  const style = params.style || textInputStyle\n  // box.appendChild(dom.createTextNode(' uri='+uri+', pattern='+ params.pattern))\n  const field = dom.createElement('input')\n  ;(field as any).style = textInputStyle // Do we have to override length etc?\n  rhs.appendChild(field)\n  field.setAttribute('type', params.type ? params.type : 'text')\n\n  const size = kb.any(form, ns.ui('size')) // Form has precedence\n  field.setAttribute(\n    'size',\n    size ? '' + size : params.size ? '' + params.size : '20'\n  )\n  const maxLength = kb.any(form, ns.ui('maxLength'))\n  field.setAttribute('maxLength', maxLength ? '' + maxLength : '4096')\n\n  doc = doc || fieldStore(subject, property, doc)\n\n  let obj = kb.any(subject, property, undefined, doc)\n  if (!obj) {\n    obj = kb.any(form, ns.ui('default'))\n  }\n  if (obj && obj.uri && params.uriPrefix) {\n    // eg tel: or mailto:\n    field.value = decodeURIComponent(obj.uri.replace(params.uriPrefix, '')) // should have no spaces but in case\n      .replace(/ /g, '')\n  } else if (obj) {\n    /* istanbul ignore next */\n    field.value = obj.value || obj.uri || ''\n  }\n  field.setAttribute('style', style)\n  if (!kb.updater.editable((doc as NamedNode).uri)) {\n    field.readOnly = true // was: disabled. readOnly is better\n    return box\n  }\n\n  // read-write:\n  field.addEventListener(\n    'keyup',\n    function (_e) {\n      if (params.pattern) {\n        field.setAttribute(\n          'style',\n          style +\n            (field.value.match(params.pattern)\n              ? 'color: green;'\n              : 'color: red;')\n        )\n      }\n    },\n    true\n  )\n  field.addEventListener(\n    'change',\n    function (_e) {\n      // i.e. lose focus with changed data\n      if (params.pattern && !field.value.match(params.pattern)) return\n      field.disabled = true // See if this stops getting two dates from fumbling e.g the chrome datepicker.\n      field.setAttribute('style', style + 'color: gray;') // pending\n      const ds = kb.statementsMatching(subject, property) // remove any multiple values\n      let result\n      if (params.namedNode) {\n        result = kb.sym(field.value)\n      } else if (params.uriPrefix) {\n        result = encodeURIComponent(field.value.replace(/ /g, ''))\n        result = kb.sym(params.uriPrefix + field.value)\n      } else {\n        if (params.dt) {\n          result = new Literal(\n            field.value.trim(),\n            undefined,\n            ns.xsd(params.dt)\n          )\n        } else {\n          result = new Literal(field.value)\n        }\n      }\n      let is = ds.map(statement => st(statement.subject, statement.predicate, result, statement.why)) // can include >1 doc\n      if (is.length === 0) {\n        // or none\n        is = [st(subject, property, result, doc)]\n      }\n\n      function updateMany (ds, is: { why: { uri: string } }[], callback) {\n        const docs: any[] = []\n        is.forEach(st => {\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        ds.forEach(st => {\n          /* istanbul ignore next */\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        /* istanbul ignore next */\n        if (docs.length === 0) {\n          throw new Error('updateMany has no docs to patch')\n        }\n        if (docs.length === 1) {\n          return kb.updater.update(ds, is, callback)\n        }\n        // return kb.updater.update(ds, is, callback)\n\n        const doc = docs.pop()\n        const is1 = is.filter(st => st.why.uri === doc)\n        const is2 = is.filter(st => st.why.uri !== doc)\n        const ds1 = ds.filter(st => st.why.uri === doc)\n        const ds2 = ds.filter(st => st.why.uri !== doc)\n        kb.updater.update(ds1, is1, function (uri, ok, body) {\n          if (ok) {\n            updateMany(ds2, is2, callback)\n          } else {\n            callback(uri, ok, body)\n          }\n        })\n      }\n\n      updateMany(ds, is, function (uri, ok, body) {\n        // kb.updater.update(ds, is, function (uri, ok, body) {\n        if (ok) {\n          field.disabled = false\n          field.setAttribute('style', style)\n        } else {\n          box.appendChild(errorMessageBlock(dom, body))\n        }\n        callbackFunction(ok, body)\n      })\n    },\n    true\n  )\n  return box\n}\n"],"file":"basic.js"}