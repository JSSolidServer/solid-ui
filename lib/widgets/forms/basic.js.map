{"version":3,"file":"basic.js","names":["store","solidLogicSingleton","renderNameValuePair","dom","kb","box","form","label","style","display","flexDirection","lhs","appendChild","createElement","width","formFieldNameBoxWidth","rhs","setAttribute","formFieldNameBoxStyle","createTextNode","any","ns","ui","fieldLabel","errorMessageBlock","property","fieldInQuestion","lab","undefined","anchor","uri","textContent","fieldStore","subject","predicate","def","sts","statementsMatching","length","updater","Error","why","value","editable","sym","basicField","container","already","doc","callbackFunction","formDoc","suppressEmptyUneditable","anyJS","mostSpecificClassURI","params","fieldParams","paramStyle","textInputStyle","field","type","size","textInputSize","maxLength","obj","uriPrefix","decodeURIComponent","replace","readOnly","textInputStyleUneditable","addEventListener","_e","pattern","match","disabled","ds","result","namedNode","encodeURIComponent","dt","Literal","trim","xsd","is","map","statement","st","updateMany","callback","docs","forEach","includes","push","update","pop","is1","filter","is2","ds1","ds2","ok","body"],"sources":["../../../src/widgets/forms/basic.ts"],"sourcesContent":["import { BlankNode, Literal, NamedNode, Node, st, Store, Variable } from 'rdflib'\nimport { solidLogicSingleton } from 'solid-logic'\nimport * as ns from '../../ns'\nimport { formFieldNameBoxStyle, formFieldNameBoxWidth, textInputSize, textInputStyle, textInputStyleUneditable } from '../../style'\nimport { label } from '../../utils'\nimport { errorMessageBlock } from '../error'\nimport { mostSpecificClassURI } from './fieldFunction'\nimport { fieldParams } from './fieldParams'\n\nconst store = solidLogicSingleton.store\n\n/*  Style and create a name, value pair\n*/\nexport function renderNameValuePair (dom: HTMLDocument, kb: Store, box: HTMLElement, form: NamedNode, label?: string):HTMLElement {\n  // const property = kb.any(form, ns.ui('property'))\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const lhs = box.appendChild(dom.createElement('div'))\n  lhs.style.width = formFieldNameBoxWidth\n  const rhs = box.appendChild(dom.createElement('div'))\n\n  lhs.setAttribute('class', 'formFieldName')\n  lhs.setAttribute('style', formFieldNameBoxStyle)\n  rhs.setAttribute('class', 'formFieldValue')\n  if (label) {\n    lhs.appendChild(dom.createTextNode(label))\n  } else if (kb.any(form, ns.ui('property'))) { // Assume more space for error on right\n    lhs.appendChild(fieldLabel(dom, kb.any(form, ns.ui('property')) as NamedNode, form))\n  } else {\n    rhs.appendChild(errorMessageBlock(dom, 'No property or label given for form field: ' + form))\n    lhs.appendChild(dom.createTextNode('???'))\n  }\n  return rhs\n}\n\n/**\n * Create an anchor element with a label as the anchor text.\n *\n * @param dom The DOM\n * @param property href for the anchor element\n * @param fieldInQuestion field to produce a label for\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldLabel (dom: HTMLDocument, property: NamedNode | undefined, fieldInQuestion: Node): HTMLElement | Text {\n  let lab = store.any(fieldInQuestion as any, ns.ui('label'))\n  if (!lab) lab = label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  /* istanbul ignore next */\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', 'color: #3B5998; text-decoration: none;') // Not too blue and no underline\n  anchor.textContent = lab as any\n  return anchor\n}\n\n/**\n * Returns the document for the first quad that matches\n * the subject and predicate provided, or default if that\n * store is not editable.\n *\n * @param subject Subject about which we want to find an editable RDF document\n * @param predicate Predicate about which we want to find an editable RDF document\n * @param def default RDF document to return if none found\n *\n * @internal exporting this only for unit tests\n */\nexport function fieldStore (subject: NamedNode | BlankNode | Variable, predicate: NamedNode | Variable, def: NamedNode | undefined): NamedNode | undefined {\n  const sts = store.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (!store.updater) {\n    throw new Error('Store has no updater')\n  }\n  if (\n    sts.length > 0 &&\n    sts[0].why.value &&\n    store.updater.editable(sts[0].why.value, store)\n  ) {\n    return store.sym(sts[0].why.value)\n  }\n  return def\n}\n\n/**\n * Render a basic form field\n *\n * The same function is used for many similar one-value fields, with different\n * regexps used to validate.\n *\n * @param dom The HTML Document object aka Document Object Model\n * @param container  If present, the created widget will be appended to this\n * @param already A hash table of (form, subject) kept to prevent recursive forms looping\n * @param subject The thing about which the form displays/edits data\n * @param form The form or field to be rendered\n * @param doc The web document in which the data is\n * @param callbackFunction Called when data is changed?\n *\n * @returns The HTML widget created\n */\n// eslint-disable-next-line complexity\nexport function basicField (\n  dom: HTMLDocument,\n  container: HTMLElement | undefined,\n  already,\n  subject: NamedNode | BlankNode | Variable,\n  form: NamedNode,\n  doc: NamedNode | undefined,\n  callbackFunction: (_ok: boolean, _errorMessage: string) => void\n): HTMLElement {\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = dom.createElement('div')\n\n  const property = kb.any(form, ns.ui('property'))\n  if (container) container.appendChild(box)\n  if (!property) {\n    return box.appendChild(\n      errorMessageBlock(dom, 'Error: No property given for text field: ' + form)\n    )\n  }\n  const rhs = renderNameValuePair(dom, kb, box, form)\n\n  // It can be cleaner to just remove empty fields if you can't edit them anyway\n  const suppressEmptyUneditable = kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  const uri = mostSpecificClassURI(form)\n  let params = fieldParams[uri]\n  if (params === undefined) params = { style: '' } // non-bottom field types can do this\n  const paramStyle = params.style || ''\n  const style = textInputStyle + paramStyle\n  const field = dom.createElement('input')\n  ;(field as any).style = style\n  rhs.appendChild(field)\n  field.setAttribute('type', params.type ? params.type : 'text')\n\n  const size = kb.anyJS(form, ns.ui('size')) || textInputSize || 20\n  field.setAttribute('size', size)\n\n  const maxLength = kb.any(form, ns.ui('maxLength'))\n  field.setAttribute('maxLength', maxLength ? '' + maxLength : '4096')\n\n  doc = doc || fieldStore(subject, property as any, doc)\n\n  let obj = kb.any(subject, property as any, undefined, doc)\n  if (!obj) {\n    obj = kb.any(form, ns.ui('default'))\n  }\n  if (obj && obj.value && params.uriPrefix) {\n    // eg tel: or mailto:\n    field.value = decodeURIComponent(obj.value.replace(params.uriPrefix, '')) // should have no spaces but in case\n      .replace(/ /g, '')\n  } else if (obj) {\n    /* istanbul ignore next */\n    field.value = obj.value || obj.value || ''\n  }\n  field.setAttribute('style', style)\n  if (!kb.updater) {\n    throw new Error('kb has no updater')\n  }\n  if (!kb.updater.editable((doc as NamedNode).uri)) {\n    field.readOnly = true // was: disabled. readOnly is better\n    ;(field as any).style = textInputStyleUneditable + paramStyle\n    // backgroundColor = textInputBackgroundColorUneditable\n    if (suppressEmptyUneditable && field.value === '') {\n      box.style.display = 'none' // clutter\n    }\n    return box\n  }\n\n  // read-write:\n  field.addEventListener(\n    'keyup',\n    function (_e) {\n      if (params.pattern) {\n        field.setAttribute(\n          'style',\n          style +\n            (field.value.match(params.pattern)\n              ? 'color: green;'\n              : 'color: red;')\n        )\n      }\n    },\n    true\n  )\n  field.addEventListener(\n    'change',\n    function (_e) {\n      // i.e. lose focus with changed data\n      if (params.pattern && !field.value.match(params.pattern)) return\n      field.disabled = true // See if this stops getting two dates from fumbling e.g the chrome datepicker.\n      field.setAttribute('style', style + 'color: gray;') // pending\n      const ds = kb.statementsMatching(subject, property as any) // remove any multiple values\n      let result\n      if (params.namedNode) {\n        result = kb.sym(field.value)\n      } else if (params.uriPrefix) {\n        result = encodeURIComponent(field.value.replace(/ /g, ''))\n        result = kb.sym(params.uriPrefix + field.value)\n      } else {\n        if (params.dt) {\n          result = new Literal(\n            field.value.trim(),\n            undefined,\n            ns.xsd(params.dt)\n          )\n        } else {\n          result = new Literal(field.value)\n        }\n      }\n      let is = ds.map(statement => st(statement.subject, statement.predicate, result, statement.why)) // can include >1 doc\n      if (is.length === 0) {\n        // or none\n        is = [st(subject, property as any, result, doc)]\n      }\n\n      function updateMany (ds, is: { why: { uri: string } }[], callback) {\n        const docs: any[] = []\n        is.forEach(st => {\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        ds.forEach(st => {\n          /* istanbul ignore next */\n          if (!docs.includes(st.why.uri)) docs.push(st.why.uri)\n        })\n        /* istanbul ignore next */\n        if (docs.length === 0) {\n          throw new Error('updateMany has no docs to patch')\n        }\n        if (!kb.updater) {\n          throw new Error('kb has no updater')\n        }\n        if (docs.length === 1) {\n          return kb.updater.update(ds, is as any, callback)\n        }\n        // return kb.updater.update(ds, is, callback)\n\n        const doc = docs.pop()\n        const is1 = is.filter(st => st.why.uri === doc)\n        const is2 = is.filter(st => st.why.uri !== doc)\n        const ds1 = ds.filter(st => st.why.uri === doc)\n        const ds2 = ds.filter(st => st.why.uri !== doc)\n        kb.updater.update(ds1, is1 as any, function (uri, ok, body) {\n          if (ok) {\n            updateMany(ds2, is2, callback)\n          } else {\n            callback(uri, ok, body)\n          }\n        })\n      }\n\n      updateMany(ds, is as any, function (uri, ok, body) {\n        // kb.updater.update(ds, is, function (uri, ok, body) {\n        if (ok) {\n          field.disabled = false\n          field.setAttribute('style', style)\n        } else {\n          box.appendChild(errorMessageBlock(dom, body))\n        }\n        callbackFunction(ok, body)\n      })\n    },\n    true\n  )\n  return box\n}\n"],"mappings":"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"}