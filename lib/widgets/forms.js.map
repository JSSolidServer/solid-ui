{"version":3,"file":"forms.js","names":["checkMarkCharacter","cancelCharacter","dashCharacter","kb","store","field","ns","ui","uri","autocompleteField","refreshOpionsSubfieldinGroup","dom","already","subject","dataDoc","callbackFunction","groupDiv","subfields","eles","children","j","length","t","mostSpecificClassURI","optionsRender","fieldFunction","newOne","debug","log","insertBefore","removeChild","container","form","box","createElement","appendChild","key","toNT","createTextNode","already2","x","formDoc","doc","weight0","any","weight","Number","value","errorMessageBlock","setAttribute","style","formGroupStyle","display","flexDirection","parts","elements","each","sortBySequence","i","subFieldFunction","itemChanged","ok","body","widget","change","dependingOn","rdf","cases","values","sameTerm","Object","keys","findTypeURIs","map","$rdf","sym","c","tests","match","test","termType","the","appendForm","debugString","toString","slice","join","addItem","object","newThing","ordered","createListIfNecessary","list","push","saveListThenRefresh","toBeInserted","reverse","st","property","updater","update","msg","error","refresh","renderItem","deleteThisItem","splice","holds","del","message","subField","moveThisItem","event","upwards","alert","itemDone","fn","element","editable","buttons","deleteButtonWithCheck","multipleUIlabel","frame","gridTemplateColumns","gridTemplateRows","moveUpButton","button","icons","iconBase","moveDownButton","shim","gridColumn","gridRow","padding","gridRowStart","plusIconURI","orderedNode","Node","toJS","anyJS","utils","label","min","tail","img","title","prompt","textContent","addEventListener","_eventNotUsed","Collection","add","fetcher","putBack","vals","li","sort","syncTableToArrayReOrdered","asyncStuff","extra","then","err","basicField","left","width","formFieldNameBoxWidth","right","fieldLabel","fieldStore","text","suppressEmptyUneditable","makeDescription","booleanField","tristate","errorBlock","lab","state","undefined","ins","buildCheckboxForm","category","checkOptions","makeSelectForNestedCategory","p","lhs","rhs","uiFrom","subForm","opts","disambiguate","getSelectorOptions","possible","possibleProperties","findMembersNT","fromNT","rdfs","allClassURIs","propertyTriage","op","dp","owl","mint","multiSelect","selector","selectedOptions","possibleOptions","sortByLabel","makeSelectForChoice","innerHTML","multiSelectDiv","IconicMultiSelect","placeholder","selected","select","textField","valueField","init","subscribe","action","filter","stringValue","includes","newObject","is","addSubFormChoice","success","errorBody","selectDiv","_callbackFunction","contents","params","fieldParams","setFieldStyle","suppressIfUneditable","editFormButton","b","_e","ff","parentNode","propertiesForClass","explicit","dc","foaf","forEach","members","used","statementsMatching","predicate","result","findClosest","cla","prop","agenda","shift","lists","supers","formsFor","t1","bottom","bottomTypeURIs","candidates","concat","k","a","pair","toLowerCase","newButton","theClass","promptForNew","outlineManager","GotoSubject","formBorderColor","formFunction","gotButton","insertMe","linkDone","linkButton","info","f","rb","removeButton","AJAR_subject","group","desc","rows","split","cols","multilineTextInputStyle","v","saveChange","submit","disabled","color","textInputColorPending","ds","textInputColor","widgets","continueButton","visibility","backgroundColor","textInputBackgroundColorUneditable","makeSelectForClassifierOptions","options","n","uris","sub","warn","actual","getActual","onChange","removeValue","opt","AJAR_mint","mintClass","thisForm","mintStatementsFun","AJAR_uri","currentURI","sel","subSelect","superSelect","doneNew","_body","formSelectSTyle","multiple","option","labelWithOntology","firstChild","nullLabel","makeSelectForOptions","makeSelectForCategory","du","subs","child","renderNameValuePair","input","colorCarrier","checkboxInputStyle","fix","why","Array","Error","holdsAll","missing","displayState","negation","defa","boxHandler","toDelete","newState","toInsert","hmmm","now","Date","getTime","inputPossibleOptions","optionsFromClassUIfrom","isEmpty","createDefaultSelectOptionText","firstSelectOptionText","createDefaultSelectOption","hidden","lastChild","createOption","newSelectedOptions","addValue","existingValues","containsObject","removeAttribute","obj","thisClass","quad","len2","len4","m","pred","ref1","ref2","ref3","ref4","ref5","u","seeds","ref","transitiveClosure","rdfFactory","namedNode","len","l","len1","q","len3"],"sources":["../../src/widgets/forms.js"],"sourcesContent":["/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n/* eslint-disable multiline-ternary */\n\n/* global alert */\n\nimport * as buttons from './buttons'\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport { setFieldStyle } from './forms/formStyle'\nimport * as debug from '../debug'\nimport { errorMessageBlock } from './error'\nimport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic'\nimport { autocompleteField } from './forms/autocomplete/autocompleteField'\nimport * as style from '../style'\n\nimport { icons } from '../iconBase'\nimport * as log from '../log'\nimport * as ns from '../ns'\nimport * as $rdf from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { IconicMultiSelect } from './multiSelect'\nimport * as widgets from '../widgets'\nexport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic' // Note default export\n\nexport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nexport { fieldParams } from './forms/fieldParams'\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\nconst kb = store\n\nfield[ns.ui('AutocompleteField').uri] = autocompleteField\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nfunction refreshOpionsSubfieldinGroup (dom, already, subject, dataDoc, callbackFunction, groupDiv, subfields) {\n  const eles = groupDiv.children\n  for (let j = 0; j < subfields.length; j++) {\n    // This is really messy.\n    const field = subfields[j]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ns.ui('Options').uri) {\n      const optionsRender = fieldFunction(dom, field)\n      const newOne = optionsRender(\n        dom,\n        null,\n        already,\n        subject,\n        field,\n        dataDoc,\n        callbackFunction\n      )\n      debug.log('Refreshing Options field by replacing it.') // better to support actual refresh\n      groupDiv.insertBefore(newOne, eles[j])\n      groupDiv.removeChild(eles[j + 1]) // Remove the old one\n    }\n  }\n}\n\nfield[ns.ui('Form').uri] = field[ns.ui('Group').uri] =\n    function (dom, container, already, subject, form, dataDoc, callbackFunction) {\n      const box = dom.createElement('div')\n      const ui = ns.ui\n      if (container) container.appendChild(box)\n\n      // Prevent loops\n      if (!form) return\n      const key = subject.toNT() + '|' + form.toNT()\n      if (already[key]) {\n        // been there done that\n        box.appendChild(dom.createTextNode('Group: see above ' + key))\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        // const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n        // dom.outlineManager.appendPropertyTRs(box, plist)\n        // dom.appendChild(plist)\n        return box\n      }\n      const already2 = {}\n      for (const x in already) already2[x] = 1\n      already2[key] = 1\n      const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n      const weight0 = kb.any(form, ui('weight'), null, formDoc) // Say 0-3\n      const weight = weight0 ? Number(weight0.value) : 1\n      if (weight > 3 || weight < 0) return box.appendChild(errorMessageBlock(dom, `Form Group weight ${weight} should be 0-3`))\n\n      box.setAttribute('style', style.formGroupStyle[weight]) // Indent a group\n      box.style.display = 'flex'\n      box.style.flexDirection = 'column'\n      box.class = 'form-weight-' + weight\n\n      let parts = kb.any(form, ui('parts'), null, formDoc)\n      let subfields\n      if (parts) {\n        subfields = parts.elements\n      } else {\n        parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n        subfields = sortBySequence(parts)\n      }\n      if (!parts) {\n        return box.appendChild(errorMessageBlock(dom, 'No parts to form! '))\n      }\n\n      for (let i = 0; i < subfields.length; i++) {\n        const field = subfields[i]\n        const subFieldFunction = fieldFunction(dom, field) //\n\n        const itemChanged = function (ok, body) {\n          if (ok && body && body.widget && body.widget === 'select') {\n            refreshOpionsSubfieldinGroup(dom, already, subject, dataDoc, callbackFunction, box, subfields)\n          }\n          callbackFunction(ok, { widget: 'group', change: body })\n        }\n        box.appendChild(subFieldFunction(dom, null, already2, subject, field, dataDoc, itemChanged))\n      }\n      return box\n    }\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nfield[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = Object.keys(kb.findTypeURIs(subject)).map(uri => $rdf.sym(uri)) // Use RDF-S inference\n  } else {\n    values = kb.each(subject, dependingOn)\n  }\n\n  for (let i = 0; i < cases.length; i++) {\n    const c = cases[i]\n    const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n    let match = false\n    for (let j = 0; j < tests.length; j++) {\n      for (const value of values) {\n        const test = tests[j]\n        if (value.sameTerm(tests) ||\n          (value.termType === test.termType && value.value === test.value)) {\n          match = true\n        }\n      }\n    }\n    if (match) {\n      const field = kb.the(c, ui('use'))\n      if (!field) {\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            'No \"use\" part for case in form ' + form\n          )\n        )\n        return box\n      } else {\n        appendForm(\n          dom,\n          box,\n          already,\n          subject,\n          field,\n          dataDoc,\n          callbackFunction\n        )\n      }\n      break\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n **\n ** Form properties:\n **      @param {Boolean} reverse Make e reverse arc in the data OPS not SPO\n **      @param {NamedNode} property The property to be written in the data\n **      @param {Boolean} ordered Is the list an ordered one where the user defined the order\n */\nfield[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem () {\n    const object = newThing(dataDoc) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      // eslint-disable-next-line multiline-ternary\n      const toBeInserted = reverse ? [$rdf.st(object, property, subject, dataDoc)] : [$rdf.st(subject, property, object, dataDoc)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh()\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, dataDoc)) {\n          const del = [$rdf.st(subject, property, object, dataDoc)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (ok, message) {\n      debug.log(`Item done callback for item ${object.toString()}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      }\n      callbackFunction(ok, message)\n    }\n\n    log.debug('Multiple: render object: ' + object)\n\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, dataDoc, itemDone) // subfields was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(dataDoc.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, multipleUIlabel, deleteThisItem)\n      if (ordered) { // Add controsl in a frame\n        const frame = dom.createElement('div')\n        frame.style.display = 'grid'\n        frame.style.gridTemplateColumns = 'auto 3em'\n        frame.style.gridTemplateRows = '50% 50%'\n        const moveUpButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369237.svg', 'Move Up',\n          async event => moveThisItem(event, true))\n        const moveDownButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369241.svg', 'Move Down',\n          async event => moveThisItem(event, false))\n        const shim = dom.createElement('div')\n        shim.appendChild(subField) // Subfield has its own layout\n        frame.appendChild(shim)\n\n        frame.appendChild(moveUpButton)\n        frame.appendChild(moveDownButton)\n        moveUpButton.style.gridColumn = 2\n        moveDownButton.style.gridColumn = 2\n        moveUpButton.style.gridRow = 1\n        moveDownButton.style.padding = '0em' // don't take too much space\n        moveUpButton.style.padding = '0em'\n\n        moveDownButton.style.gridRow = 2\n        shim.style.gridColumn = 1\n        shim.style.gridRowStart = 'span 2' // Cover both rows\n        // shim.style.gridRowEnd = 2 // Cover both rows\n        return frame\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of Multiple form field implementation\n\n  const plusIconURI = icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = (dom.createElement('div'))\n  const shim = box // no  shim\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return shim\n  }\n  let multipleUIlabel = kb.any(form, ui('label'))\n  if (!multipleUIlabel) multipleUIlabel = utils.label(property)\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n\n  const element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return shim\n  }\n\n  const body = box.appendChild(dom.createElement('div'))\n  body.style.display = 'flex'\n\n  body.style.flexDirection = 'column'\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(dataDoc.uri)) {\n    const tail = box.appendChild(dom.createElement('div'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add another ' + multipleUIlabel\n    const prompt = dom.createElement('span')\n    prompt.textContent =\n      (values.length === 0 ? 'Add another ' : 'Add ') +\n      multipleUIlabel\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n    tail.appendChild(prompt)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, dataDoc)\n      } else {\n        kb.add(subject, property, list, dataDoc)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(dataDoc)\n    } catch (err) {\n      box.appendChild(\n        errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, dataDoc) : kb.the(subject, property, null, dataDoc)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return shim\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nfield[ns.ui('PhoneField').uri] = basicField\nfield[ns.ui('EmailField').uri] = basicField\nfield[ns.ui('ColorField').uri] = basicField\nfield[ns.ui('DateField').uri] = basicField\nfield[ns.ui('DateTimeField').uri] = basicField\nfield[ns.ui('TimeField').uri] = basicField\nfield[ns.ui('NumericField').uri] = basicField\nfield[ns.ui('IntegerField').uri] = basicField\nfield[ns.ui('DecimalField').uri] = basicField\nfield[ns.ui('FloatField').uri] = basicField\nfield[ns.ui('TextField').uri] = basicField\nfield[ns.ui('SingleLineTextField').uri] = basicField\nfield[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nfield[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const left = box.appendChild(dom.createElement('div'))\n  left.style.width = style.formFieldNameBoxWidth\n  const right = box.appendChild(dom.createElement('div'))\n\n  left.appendChild(fieldLabel(dom, property, form))\n  dataDoc = fieldStore(subject, property, dataDoc)\n\n  const text = kb.anyJS(subject, property, null, dataDoc) || ''\n  const editable = kb.updater.editable(dataDoc.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    dataDoc,\n    callbackFunction\n  )\n  right.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction,\n  tristate\n) {\n  const ui = ns.ui\n  const kb = store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  dataDoc = fieldStore(subject, property, dataDoc)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  const ins = $rdf.st(subject, property, true, dataDoc)\n  const del = $rdf.st(subject, property, false, dataDoc)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, dataDoc, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nfield[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    false\n  )\n}\n\nfield[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nfield[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const ui = ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  log.debug('Classifier: dataDoc=' + dataDoc)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    return callbackFunction(ok, body)\n  }\n  const box = makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Generates a subForm based on a ui:use form\n **  Will look like:\n ** <div id=dropDownDiv>\n **   <div id=labelOfDropDown>\n **   <div id=selectDiv>\n **     <select id=dropDownSelect>\n **       <option> ....\n **     <subForm>\n **  Alternative implementatons caould be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** TODO: according to ontology ui:choice can also have ns.ui('default') - this is not implemented yet\n */\n\nfield[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  let p\n  const box = dom.createElement('div')\n  box.setAttribute('class', 'choiceBox')\n  // Set flexDirection column?\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName choiceBox-label')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue choiceBox-selectBox')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return box.appendChild(errorMessageBlock(dom, 'No property for Choice: ' + form))\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uiFrom = kb.any(form, ui('from'))\n  if (!uiFrom) {\n    return errorMessageBlock(dom, \"No 'from' for Choice: \" + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  // const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n\n  const opts = { form, subForm, disambiguate: false }\n\n  function getSelectorOptions () {\n    let possible = []\n    let possibleProperties\n    possible = kb.each(undefined, ns.rdf('type'), uiFrom, formDoc)\n    for (const x in findMembersNT(kb, uiFrom, dataDoc)) {\n      possible.push(kb.fromNT(x))\n    } // Use rdfs\n\n    if (uiFrom.sameTerm(ns.rdfs('Class'))) {\n      for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n      // log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n    } else if (uiFrom.sameTerm(ns.rdf('Property'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true // This is a big class, and the labels won't be enough.\n    } else if (uiFrom.sameTerm(ns.owl('ObjectProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    } else if (uiFrom.sameTerm(ns.owl('DatatypeProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    }\n\n    return possible\n    // return sortByLabel(possible)\n  }\n\n  // TODO: this checks for any occurrence, regardless of true or false setting\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* Create new *' // @@ could be better\n  }\n\n  const multiSelect = kb.any(form, ui('multiselect')) // Optional\n  if (multiSelect) opts.multiSelect = true\n\n  let selector\n  rhs.refresh = function () {\n    // from ui:property\n    let selectedOptions = kb.each(subject, property, null, dataDoc).map(object => object.value)\n    // from ui:from + ui:property\n    let possibleOptions = getSelectorOptions()\n    possibleOptions.push(selectedOptions)\n    possibleOptions = sortByLabel(possibleOptions)\n\n    selector = makeSelectForChoice(\n      dom,\n      rhs,\n      kb,\n      subject,\n      property,\n      possibleOptions,\n      selectedOptions,\n      uiFrom,\n      opts,\n      dataDoc,\n      callbackFunction\n    )\n    rhs.innerHTML = ''\n    rhs.appendChild(selector)\n    if (multiSelect) {\n      const multiSelectDiv = new IconicMultiSelect({\n        placeholder: selector.selected,\n        select: selector,\n        container: rhs,\n        textField: 'textField',\n        valueField: 'valueField'\n      })\n      multiSelectDiv.init()\n      multiSelectDiv.subscribe(function (event) {\n        if (event.action === 'REMOVE_OPTION') {\n          selectedOptions = selectedOptions.filter(function (value) {\n            return value !== event.value\n          })\n        }\n        if (event.action === 'CLEAR_ALL_OPTIONS') {\n          selectedOptions = []\n        }\n        if (event.action === 'ADD_OPTION') {\n          const stringValue = event.value + ''\n          if (stringValue.includes('Create new')) {\n            const newObject = newThing(dataDoc)\n            const is = []\n            is.push($rdf.st(subject, property, kb.sym(newObject), dataDoc))\n            if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n            if (subForm) {\n              addSubFormChoice(dom, rhs, {}, $rdf.sym(newObject), subForm, dataDoc, function (ok, body) {\n                if (ok) {\n                  kb.updater.update([], is, function (uri, success, errorBody) {\n                    if (!success) rhs.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n                  })\n                  selectedOptions.push(newObject)\n                  if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n                } else {\n                  rhs.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n                }\n              })\n            }\n          } else selectedOptions.push(event.value)\n        }\n        selector.update(selectedOptions)\n      })\n    }\n  }\n\n  rhs.refresh()\n  if (selector && selector.refresh) selector.refresh()\n\n  return box\n}\n\nfunction addSubFormChoice (dom, selectDiv, already, subject, subForm, dataDoc, callbackFunction) {\n  fieldFunction(dom, subForm)(\n    dom,\n    selectDiv,\n    already,\n    subject,\n    subForm,\n    dataDoc,\n    callbackFunction\n  )\n}\n\n//          Documentation - non-interactive fields\n//\n\nfield[ns.ui('Comment').uri] = field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  _callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  const params = fieldParams[uri] || {}\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  setFieldStyle(p, form)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = kb.updater.editable(dataDoc.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nexport function editFormButton (\n  dom,\n  container,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        dataDoc,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nexport function appendForm (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nexport function propertiesForClass (kb, c) {\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The quad store\n* @param cla - the URI of the class\n* @param prop\n*/\nexport function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    const lists = kb.each(c, prop)\n    log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nexport function formsFor (subject) {\n  const kb = store\n\n  log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nexport function sortBySequence (list) {\n  const subfields = list.map(function (p) {\n    const k = kb.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  subfields.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\nexport function sortByLabel (list) {\n  const subfields = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  subfields.sort()\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param dataDoc - optional dataDoc else will prompt for one (unimplemented)\n*/\nexport function newButton (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          dataDoc,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nexport function promptForNew (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = findClosest(kb, theClass.uri, ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        \" but I don't know enough information about those to ask you.\"\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${style.formBorderColor}; color: ${style.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = newThing(dataDoc)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, dataDoc)) {\n      insertMe.push($rdf.st(subject, predicate, object, dataDoc))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, dataDoc)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, dataDoc))\n    }\n    if (insertMe.length) {\n      kb.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(buttons.linkButton(dom, object))\n    }\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, dataDoc, itemDone)\n  const rb = buttons.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nexport function makeDescription (\n  dom,\n  kb,\n  subject,\n  predicate,\n  dataDoc,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, dataDoc) || ''\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\" @@ possibly: add prompt which disappears\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, dataDoc)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.style.color = style.textInputColorPending // setAttribute('style', style + 'color: gray;') // pending\n    const ds = kb.statementsMatching(subject, predicate, null, dataDoc)\n    const is = $rdf.st(subject, predicate, field.value, dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.style.color = style.textInputColor\n        field.disabled = false\n      } else {\n        group.appendChild(\n          errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + dataDoc.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const editable = kb.updater.editable(dataDoc.uri)\n  let submit\n  if (editable) {\n    submit = widgets.continueButton(dom, saveChange)\n    submit.disabled = true // until the filled has been modified\n    submit.style.visibility = 'hidden'\n    submit.style.float = 'right'\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.style.color = 'green' // setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.style.visibility = '' // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = style.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiple - Boolean - Whether more than one at a time is allowed\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForClassifierOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForClassifierOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForClassifierOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        actual[x.uri] = true\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, newObject, dataDoc))\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    function doneNew (ok, _body) {\n      callbackFunction(ok, { widget: 'select', event: 'new' })\n    }\n    log.info('makeSelectForClassifierOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n        if (newObject) {\n          const fn = fieldFunction(dom, options.subForm)\n          fn(\n            dom,\n            select.parentNode,\n            {},\n            newObject,\n            options.subForm,\n            dataDoc,\n            doneNew\n          )\n        }\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  if (options.multiple) select.setAttribute('multiple', 'true')\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n  if (select.currentURI == null && !options.multiple) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForClassifierOptions\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        if (x.uri) {\n          actual[x.uri] = true\n        }\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (!select.currentURI) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nexport function makeSelectForCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  let multiple = false\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n    multiple = true\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n  if (subs.length === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with no subclasses of category: ' +\n        category\n    )\n  }\n  if (subs.length === 1) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with only 1 subclass of category: ' +\n        category +\n        ':' +\n        subs[1]\n    )\n  }\n  return makeSelectForClassifierOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { multiple, nullLabel: '* Select type *' },\n    dataDoc,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForNestedCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  function update () {\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        dataDoc,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n\n  const container = dom.createElement('span') // Container\n  let child = null\n\n  function onChange (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  const select = makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    onChange\n  )\n  container.appendChild(select)\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nexport function buildCheckboxForm (dom, kb, lab, del, ins, form, dataDoc, tristate) {\n  const box = dom.createElement('div')\n  const rhs = renderNameValuePair(dom, kb, box, form, lab)\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  const input = dom.createElement('button')\n  const colorCarrier = input\n  input.style = style.checkboxInputStyle\n  rhs.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = dataDoc // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in dataDoc!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    colorCarrier.style.color = '#bbb' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    kb.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        colorCarrier.style.color = '#000'\n        colorCarrier.style.backgroundColor = '#fee'\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            `Checkbox: Error updating dataDoc from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        colorCarrier.style.color = '#000'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\n/*\nexport function fieldLabel (dom, property, form) {\n  let lab = kb.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', style.fieldLabelStyle) // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nexport function fieldStore (subject, predicate, def) {\n  const sts = kb.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    kb.updater.editable(sts[0].why.uri)\n  ) {\n    return kb.sym(sts[0].why.uri)\n  }\n  return def\n}\n*/\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nexport function newThing (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForChoice (\n  dom,\n  container,\n  kb,\n  subject,\n  predicate,\n  inputPossibleOptions,\n  selectedOptions,\n  uiFrom,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  const optionsFromClassUIfrom = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < inputPossibleOptions.length; i++) {\n    const sub = inputPossibleOptions[i] // @@ Maybe; make this so it works with blank nodes too\n    // if (!sub.uri) debug.warn(`makeSelectForChoice: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in optionsFromClassUIfrom) continue\n    optionsFromClassUIfrom[sub.uri] = true\n  }\n  const isEmpty = Object.keys(optionsFromClassUIfrom).length === 0\n  if (isEmpty && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForChoice: dataDoc=' + dataDoc)\n\n  function createDefaultSelectOptionText () {\n    let firstSelectOptionText = '--- choice ---'\n\n    if (predicate && !(predicate.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for property: ' + utils.label(predicate) + ' *'\n    }\n\n    if (subject && !(subject.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for ' + utils.label(subject, true) + ' *'\n    }\n    return firstSelectOptionText\n  }\n\n  function createDefaultSelectOption () {\n    const option = dom.createElement('option')\n    option.appendChild(dom.createTextNode(createDefaultSelectOptionText()))\n    option.disabled = true\n    option.value = true\n    option.hidden = true\n    option.selected = true\n\n    return option\n  }\n\n  const onChange = function (_e) {\n    container.removeChild(container.lastChild)\n    select.refresh()\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  select.setAttribute('id', 'formSelect')\n  select.currentURI = null\n\n  for (const uri in optionsFromClassUIfrom) {\n    select.appendChild(createOption(uri))\n  }\n\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n\n  if (select.children.length === 0) select.insertBefore(createDefaultSelectOption(), select.firstChild)\n\n  select.update = function (newSelectedOptions) {\n    selectedOptions = newSelectedOptions\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n\n    const addValue = function (t) {\n      if (!kb.holds(subject, predicate, t, dataDoc)) {\n        is.push($rdf.st(subject, predicate, t, dataDoc))\n        // console.log(\"----value added \" + t)\n      }\n      if (uiFrom && (!kb.holds(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))) {\n        is.push($rdf.st(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n        // console.log(\"----added type to value \" + uiFrom)\n      }\n    }\n\n    const existingValues = kb.each(subject, predicate, null, dataDoc).map(object => object.value)\n    for (const value of existingValues) {\n      if (!containsObject(value, selectedOptions)) removeValue($rdf.sym(value))\n    }\n    for (const value of selectedOptions) {\n      if (!(value in existingValues)) addValue($rdf.sym(value))\n    }\n\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (!ok) return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      select.refresh()\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  select.refresh = function () {\n    select.disabled = true // unlocked any conflict we had got into\n    let is = []\n\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            uiFrom,\n            options.subForm,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, kb.sym(newObject), dataDoc))\n        if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n        select.currentURI = newObject\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && containsObject(opt.AJAR_uri, selectedOptions)) {\n        select.currentURI = opt.AJAR_uri\n      }\n      if (!containsObject(opt.AJAR_uri, selectedOptions)) opt.removeAttribute('selected')\n      if (containsObject(opt.AJAR_uri, selectedOptions)) opt.setAttribute('selected', 'true')\n    }\n\n    log.info('selectForOptions: data doc = ' + dataDoc)\n\n    if (select.currentURI && options.subForm && !options.multiSelect) {\n      addSubFormChoice(dom, container, {}, $rdf.sym(select.currentURI), options.subForm, dataDoc, function (ok, body) {\n        if (ok) {\n          kb.updater.update([], is, function (uri, success, errorBody) {\n            if (!success) container.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n          })\n          if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n        } else {\n          container.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n        }\n      })\n    }\n    select.disabled = false\n  }\n\n  function createOption (uri) {\n    const option = dom.createElement('option')\n    const c = kb.sym(uri)\n    let label\n    if (options.disambiguate) {\n      label = utils.labelWithOntology(c, true) // Init. cap\n    } else {\n      label = utils.label(c, true)\n    }\n    option.appendChild(dom.createTextNode(label)) // Init.\n    option.setAttribute('value', uri)\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (containsObject(c.value, selectedOptions)) {\n      option.setAttribute('selected', 'true')\n    }\n    return option\n  }\n\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n\n  return select\n} // makeSelectForChoice\n\nfunction containsObject (obj, list) {\n  let i\n  for (i = 0; i < list.length; i++) {\n    if (list[i] === obj) {\n      return true\n    }\n  }\n\n  return false\n}\n\n// This functions replaces the findMembersNT (thisClass) from rdflib until we fix: https://github.com/linkeddata/rdflib.js/issues/565\n/**\n * For anything which has thisClass (or any subclass) as its type,\n * or is the object of something which has thisClass (or any subclass) as its range,\n * or subject of something which has thisClass (or any subclass) as its domain\n * We don't bother doing subproperty (yet?) as it doesn't seem to be used\n * much.\n * Get all the Classes of which we can RDFS-infer the subject is a member\n * @return a hash of URIs\n */\nfunction findMembersNT (store, thisClass, quad) {\n  let len2\n  let len4\n  let m\n  let pred\n  let ref1\n  let ref2\n  let ref3\n  let ref4\n  let ref5\n  let st\n  let u\n  const seeds = {}\n  seeds[thisClass.toNT()] = true\n  const members = {}\n  const ref = store.transitiveClosure(seeds, store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#subClassOf'), true)\n  for (const t in ref) {\n    ref1 = store.statementsMatching(null,\n      store.rdfFactory.namedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#type'),\n      store.fromNT(t),\n      quad)\n    for (let i = 0, len = ref1.length; i < len; i++) {\n      st = ref1[i]\n      members[st.subject.toNT()] = st\n    }\n    ref2 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#domain'),\n      store.fromNT(t),\n      quad)\n    for (let l = 0, len1 = ref2.length; l < len1; l++) {\n      pred = ref2[l]\n      ref3 = store.statementsMatching(null, pred, null, quad)\n      for (m = 0, len2 = ref3.length; m < len2; m++) {\n        st = ref3[m]\n        members[st.subject.toNT()] = st\n      }\n    }\n    ref4 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#range'),\n      store.fromNT(t),\n      quad)\n    for (let q = 0, len3 = ref4.length; q < len3; q++) {\n      pred = ref4[q]\n      ref5 = store.statementsMatching(null, pred, null, quad)\n      for (u = 0, len4 = ref5.length; u < len4; u++) {\n        st = ref5[u]\n        members[st.object.toNT()] = st\n      }\n    }\n  }\n\n  return members\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAqC;AAAA;AAAA;AAAA;AAAA;AAMrC,IAAMA,kBAAkB,GAAG,QAAQ;AACnC,IAAMC,eAAe,GAAG,QAAQ;AAChC,IAAMC,aAAa,GAAG,GAAG;AACzB,IAAMC,EAAE,GAAGC,iBAAK;AAEhBC,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,mBAAmB,CAAC,CAACC,GAAG,CAAC,GAAGC,oCAAiB;;AAEzD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASC,4BAA4B,CAAEC,GAAG,EAAEC,OAAO,EAAEC,OAAO,EAAEC,OAAO,EAAEC,gBAAgB,EAAEC,QAAQ,EAAEC,SAAS,EAAE;EAC5G,IAAMC,IAAI,GAAGF,QAAQ,CAACG,QAAQ;EAC9B,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGH,SAAS,CAACI,MAAM,EAAED,CAAC,EAAE,EAAE;IACzC;IACA,IAAMf,MAAK,GAAGY,SAAS,CAACG,CAAC,CAAC;IAC1B,IAAME,CAAC,GAAG,IAAAC,mCAAoB,EAAClB,MAAK,CAAC,EAAC;IACtC,IAAIiB,CAAC,KAAKhB,EAAE,CAACC,EAAE,CAAC,SAAS,CAAC,CAACC,GAAG,EAAE;MAC9B,IAAMgB,aAAa,GAAG,IAAAC,4BAAa,EAACd,GAAG,EAAEN,MAAK,CAAC;MAC/C,IAAMqB,MAAM,GAAGF,aAAa,CAC1Bb,GAAG,EACH,IAAI,EACJC,OAAO,EACPC,OAAO,EACPR,MAAK,EACLS,OAAO,EACPC,gBAAgB,CACjB;MACDY,KAAK,CAACC,GAAG,CAAC,2CAA2C,CAAC,EAAC;MACvDZ,QAAQ,CAACa,YAAY,CAACH,MAAM,EAAER,IAAI,CAACE,CAAC,CAAC,CAAC;MACtCJ,QAAQ,CAACc,WAAW,CAACZ,IAAI,CAACE,CAAC,GAAG,CAAC,CAAC,CAAC,EAAC;IACpC;EACF;AACF;;AAEAf,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,MAAM,CAAC,CAACC,GAAG,CAAC,GAAGH,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,OAAO,CAAC,CAACC,GAAG,CAAC,GAChD,UAAUG,GAAG,EAAEoB,SAAS,EAAEnB,OAAO,EAAEC,OAAO,EAAEmB,IAAI,EAAElB,OAAO,EAAEC,gBAAgB,EAAE;EAC3E,IAAMkB,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpC,IAAM3B,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAIwB,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;;EAEzC;EACA,IAAI,CAACD,IAAI,EAAE;EACX,IAAMI,GAAG,GAAGvB,OAAO,CAACwB,IAAI,EAAE,GAAG,GAAG,GAAGL,IAAI,CAACK,IAAI,EAAE;EAC9C,IAAIzB,OAAO,CAACwB,GAAG,CAAC,EAAE;IAChB;IACAH,GAAG,CAACE,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAAC,mBAAmB,GAAGF,GAAG,CAAC,CAAC;IAC9D;IACA;IACA;IACA;IACA,OAAOH,GAAG;EACZ;EACA,IAAMM,QAAQ,GAAG,CAAC,CAAC;EACnB,KAAK,IAAMC,CAAC,IAAI5B,OAAO;IAAE2B,QAAQ,CAACC,CAAC,CAAC,GAAG,CAAC;EAAA;EACxCD,QAAQ,CAACH,GAAG,CAAC,GAAG,CAAC;EACjB,IAAMK,OAAO,GAAGT,IAAI,CAACU,GAAG,GAAGV,IAAI,CAACU,GAAG,EAAE,GAAG,IAAI,EAAC;EAC7C,IAAMC,OAAO,GAAGxC,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,QAAQ,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC,EAAC;EAC1D,IAAMI,MAAM,GAAGF,OAAO,GAAGG,MAAM,CAACH,OAAO,CAACI,KAAK,CAAC,GAAG,CAAC;EAClD,IAAIF,MAAM,GAAG,CAAC,IAAIA,MAAM,GAAG,CAAC,EAAE,OAAOZ,GAAG,CAACE,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,8BAAuBkC,MAAM,oBAAiB,CAAC;EAEzHZ,GAAG,CAACgB,YAAY,CAAC,OAAO,EAAEC,KAAK,CAACC,cAAc,CAACN,MAAM,CAAC,CAAC,EAAC;EACxDZ,GAAG,CAACiB,KAAK,CAACE,OAAO,GAAG,MAAM;EAC1BnB,GAAG,CAACiB,KAAK,CAACG,aAAa,GAAG,QAAQ;EAClCpB,GAAG,SAAM,GAAG,cAAc,GAAGY,MAAM;EAEnC,IAAIS,KAAK,GAAGnD,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,OAAO,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC;EACpD,IAAIxB,SAAS;EACb,IAAIqC,KAAK,EAAE;IACTrC,SAAS,GAAGqC,KAAK,CAACC,QAAQ;EAC5B,CAAC,MAAM;IACLD,KAAK,GAAGnD,EAAE,CAACqD,IAAI,CAACxB,IAAI,EAAEzB,EAAE,CAAC,MAAM,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC,EAAC;IACjDxB,SAAS,GAAGwC,cAAc,CAACH,KAAK,CAAC;EACnC;EACA,IAAI,CAACA,KAAK,EAAE;IACV,OAAOrB,GAAG,CAACE,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,oBAAoB,CAAC,CAAC;EACtE;EAEA,KAAK,IAAI+C,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGzC,SAAS,CAACI,MAAM,EAAEqC,CAAC,EAAE,EAAE;IACzC,IAAMrD,OAAK,GAAGY,SAAS,CAACyC,CAAC,CAAC;IAC1B,IAAMC,gBAAgB,GAAG,IAAAlC,4BAAa,EAACd,GAAG,EAAEN,OAAK,CAAC,EAAC;;IAEnD,IAAMuD,WAAW,GAAG,SAAdA,WAAW,CAAaC,EAAE,EAAEC,IAAI,EAAE;MACtC,IAAID,EAAE,IAAIC,IAAI,IAAIA,IAAI,CAACC,MAAM,IAAID,IAAI,CAACC,MAAM,KAAK,QAAQ,EAAE;QACzDrD,4BAA4B,CAACC,GAAG,EAAEC,OAAO,EAAEC,OAAO,EAAEC,OAAO,EAAEC,gBAAgB,EAAEkB,GAAG,EAAEhB,SAAS,CAAC;MAChG;MACAF,gBAAgB,CAAC8C,EAAE,EAAE;QAAEE,MAAM,EAAE,OAAO;QAAEC,MAAM,EAAEF;MAAK,CAAC,CAAC;IACzD,CAAC;IACD7B,GAAG,CAACE,WAAW,CAACwB,gBAAgB,CAAChD,GAAG,EAAE,IAAI,EAAE4B,QAAQ,EAAE1B,OAAO,EAAER,OAAK,EAAES,OAAO,EAAE8C,WAAW,CAAC,CAAC;EAC9F;EACA,OAAO3B,GAAG;AACZ,CAAC;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA5B,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,SAAS,CAAC,CAACC,GAAG,CAAC,GAAG,UAC5BG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAMZ,EAAE,GAAGC,iBAAK;EAChB,IAAM6B,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpC,IAAMO,OAAO,GAAGT,IAAI,CAACU,GAAG,GAAGV,IAAI,CAACU,GAAG,EAAE,GAAG,IAAI,EAAC;;EAE7C,IAAMnC,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAIwB,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EAEzC,IAAIgC,WAAW,GAAG9D,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,aAAa,CAAC,CAAC;EACjD,IAAI,CAAC0D,WAAW,EAAE;IAChBA,WAAW,GAAG3D,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC;EAC9B,CAAC,CAAC;EACF,IAAMC,KAAK,GAAGhE,EAAE,CAACqD,IAAI,CAACxB,IAAI,EAAEzB,EAAE,CAAC,MAAM,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC;EACtD,IAAI,CAAC0B,KAAK,EAAE;IACVlC,GAAG,CAACE,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,4BAA4B,CAAC,CAAC;EACvE;EACA,IAAIyD,MAAM;EACV,IAAIH,WAAW,CAACI,QAAQ,CAAC/D,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE;IACxCE,MAAM,GAAGE,MAAM,CAACC,IAAI,CAACpE,EAAE,CAACqE,YAAY,CAAC3D,OAAO,CAAC,CAAC,CAAC4D,GAAG,CAAC,UAAAjE,GAAG;MAAA,OAAIkE,IAAI,CAACC,GAAG,CAACnE,GAAG,CAAC;IAAA,EAAC,EAAC;EAC3E,CAAC,MAAM;IACL4D,MAAM,GAAGjE,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAEoD,WAAW,CAAC;EACxC;EAEA,KAAK,IAAIP,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGS,KAAK,CAAC9C,MAAM,EAAEqC,CAAC,EAAE,EAAE;IACrC,IAAMkB,CAAC,GAAGT,KAAK,CAACT,CAAC,CAAC;IAClB,IAAMmB,KAAK,GAAG1E,EAAE,CAACqD,IAAI,CAACoB,CAAC,EAAErE,EAAE,CAAC,KAAK,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC,EAAC;IACnD,IAAIqC,KAAK,GAAG,KAAK;IACjB,KAAK,IAAI1D,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyD,KAAK,CAACxD,MAAM,EAAED,CAAC,EAAE,EAAE;MAAA,2CACjBgD,MAAM;QAAA;MAAA;QAA1B,oDAA4B;UAAA,IAAjBrB,KAAK;UACd,IAAMgC,IAAI,GAAGF,KAAK,CAACzD,CAAC,CAAC;UACrB,IAAI2B,KAAK,CAACsB,QAAQ,CAACQ,KAAK,CAAC,IACtB9B,KAAK,CAACiC,QAAQ,KAAKD,IAAI,CAACC,QAAQ,IAAIjC,KAAK,CAACA,KAAK,KAAKgC,IAAI,CAAChC,KAAM,EAAE;YAClE+B,KAAK,GAAG,IAAI;UACd;QACF;MAAC;QAAA;MAAA;QAAA;MAAA;IACH;IACA,IAAIA,KAAK,EAAE;MACT,IAAMzE,OAAK,GAAGF,EAAE,CAAC8E,GAAG,CAACL,CAAC,EAAErE,EAAE,CAAC,KAAK,CAAC,CAAC;MAClC,IAAI,CAACF,OAAK,EAAE;QACV4B,GAAG,CAACE,WAAW,CACb,IAAAa,wBAAiB,EACfrC,GAAG,EACH,iCAAiC,GAAGqB,IAAI,CACzC,CACF;QACD,OAAOC,GAAG;MACZ,CAAC,MAAM;QACLiD,UAAU,CACRvE,GAAG,EACHsB,GAAG,EACHrB,OAAO,EACPC,OAAO,EACPR,OAAK,EACLS,OAAO,EACPC,gBAAgB,CACjB;MACH;MACA;IACF;EACF;EACA;EACA,OAAOkB,GAAG;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA5B,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,UAAU,CAAC,CAACC,GAAG,CAAC,GAAG,UAC7BG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA;AACF;EACE,SAASoE,WAAW,CAAEf,MAAM,EAAE;IAC5B,OAAOA,MAAM,CAACK,GAAG,CAAC,UAAAjC,CAAC;MAAA,OAAIA,CAAC,CAAC4C,QAAQ,EAAE,CAACC,KAAK,CAAC,CAAC,CAAC,CAAC;IAAA,EAAC,CAACC,IAAI,CAAC,IAAI,CAAC;EAC3D;;EAEA;AACF;AACA;AACA;EAHE,SAIeC,OAAO;IAAA;EAAA;EAoBtB;AACF;AACA;AACA;EAHE;IAAA,yFApBA;MAAA;MAAA;QAAA;UAAA;YAAA;cACQC,MAAM,GAAGC,QAAQ,CAAC3E,OAAO,CAAC,EAAC;cAAA,KAC7B4E,OAAO;gBAAA;gBAAA;cAAA;cACTC,qBAAqB,EAAE,EAAC;cACxBC,IAAI,CAACrC,QAAQ,CAACsC,IAAI,CAACL,MAAM,CAAC;cAAA;cAAA,OACpBM,mBAAmB,EAAE;YAAA;cAAA;cAAA;YAAA;cAE3B;cACMC,YAAY,GAAGC,OAAO,GAAG,CAACtB,IAAI,CAACuB,EAAE,CAACT,MAAM,EAAEU,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC,CAAC,GAAG,CAAC4D,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAEqF,QAAQ,EAAEV,MAAM,EAAE1E,OAAO,CAAC,CAAC;cAAA;cAAA;cAAA,OAEpHX,EAAE,CAACgG,OAAO,CAACC,MAAM,CAAC,EAAE,EAAEL,YAAY,CAAC;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAEnCM,GAAG,GAAG,sCAAsC,eAAM;cACxDpE,GAAG,CAACE,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE0F,GAAG,CAAC,CAAC;cAC5C1E,KAAK,CAAC2E,KAAK,CAACD,GAAG,CAAC;YAAA;cAElBE,OAAO,EAAE;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAEZ;IAAA;EAAA;EAMD,SAASC,UAAU,CAAEhB,MAAM,EAAE;IAAA,SACZiB,cAAc;MAAA;IAAA;IA8B7B;AACJ;AACA;AACA;IAHI;MAAA,gGA9BA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,KACMf,OAAO;kBAAA;kBAAA;gBAAA;gBACT/D,KAAK,CAACC,GAAG,CAAC,cAAc,GAAGuD,WAAW,CAACS,IAAI,CAACrC,QAAQ,CAAC,CAAC;gBAC7CG,CAAC,GAAG,CAAC;cAAA;gBAAA,MAAEA,CAAC,GAAGkC,IAAI,CAACrC,QAAQ,CAAClC,MAAM;kBAAA;kBAAA;gBAAA;gBAAA,KAClCuE,IAAI,CAACrC,QAAQ,CAACG,CAAC,CAAC,CAACW,QAAQ,CAACmB,MAAM,CAAC;kBAAA;kBAAA;gBAAA;gBACnCI,IAAI,CAACrC,QAAQ,CAACmD,MAAM,CAAChD,CAAC,EAAE,CAAC,CAAC;gBAAA;gBAAA,OACpBoC,mBAAmB,EAAE;cAAA;gBAAA;cAAA;gBAHWpC,CAAC,EAAE;gBAAA;gBAAA;cAAA;gBAAA;gBAAA;cAAA;gBAQ7C;gBACA,IAAIvD,EAAE,CAACwG,KAAK,CAAC9F,OAAO,EAAEqF,QAAQ,EAAEV,MAAM,EAAE1E,OAAO,CAAC,EAAE;kBAC1C8F,GAAG,GAAG,CAAClC,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAEqF,QAAQ,EAAEV,MAAM,EAAE1E,OAAO,CAAC,CAAC;kBACzDX,EAAE,CAACgG,OAAO,CAACC,MAAM,CAACQ,GAAG,EAAE,EAAE,EAAE,UAAUpG,GAAG,EAAEqD,EAAE,EAAEgD,OAAO,EAAE;oBACrD,IAAIhD,EAAE,EAAE;sBACNC,IAAI,CAAChC,WAAW,CAACgF,QAAQ,CAAC;oBAC5B,CAAC,MAAM;sBACLhD,IAAI,CAAC3B,WAAW,CACd,IAAAa,wBAAiB,EACfrC,GAAG,EACH,2BAA2B,GAAGkG,OAAO,CACtC,CACF;oBACH;kBACF,CAAC,CAAC;gBACJ;cAAC;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAEJ;MAAA;IAAA;IAAA,SAMcE,YAAY;MAAA;IAAA;IA6B3B;AACJ;AACA;AACA;AACA;IAJI;MAAA,8FA7BA,kBAA6BC,KAAK,EAAEC,OAAO;QAAA;QAAA;UAAA;YAAA;cAAA;gBACzC;gBACAtF,KAAK,CAACC,GAAG,CAAC,YAAY,GAAGuD,WAAW,CAACS,IAAI,CAACrC,QAAQ,CAAC,CAAC;gBAE/CG,CAAC,GAAG,CAAC;cAAA;gBAAA,MAAEA,CAAC,GAAGkC,IAAI,CAACrC,QAAQ,CAAClC,MAAM;kBAAA;kBAAA;gBAAA;gBAAA,KAE9BuE,IAAI,CAACrC,QAAQ,CAACG,CAAC,CAAC,CAACW,QAAQ,CAACmB,MAAM,CAAC;kBAAA;kBAAA;gBAAA;gBAAA;cAAA;gBAFD9B,CAAC,EAAE;gBAAA;gBAAA;cAAA;gBAMzC,IAAIA,CAAC,KAAKkC,IAAI,CAACrC,QAAQ,CAAClC,MAAM,EAAE;kBAC9B6F,KAAK,CAAC,mCAAmC,GAAG1B,MAAM,CAAC;gBACrD;gBAAC,KACGyB,OAAO;kBAAA;kBAAA;gBAAA;gBAAA,MACLvD,CAAC,KAAK,CAAC;kBAAA;kBAAA;gBAAA;gBACTwD,KAAK,CAAC,0CAA0C,CAAC,EAAC;gBAAA;cAAA;gBAGpDtB,IAAI,CAACrC,QAAQ,CAACmD,MAAM,CAAChD,CAAC,GAAG,CAAC,EAAE,CAAC,EAAEkC,IAAI,CAACrC,QAAQ,CAACG,CAAC,CAAC,EAAEkC,IAAI,CAACrC,QAAQ,CAACG,CAAC,GAAG,CAAC,CAAC,CAAC;gBAAA;gBAAA;cAAA;gBAAA,MAGlEA,CAAC,KAAKkC,IAAI,CAACrC,QAAQ,CAAClC,MAAM,GAAG,CAAC;kBAAA;kBAAA;gBAAA;gBAChC6F,KAAK,CAAC,6CAA6C,CAAC,EAAC;gBAAA;cAAA;gBAGvDtB,IAAI,CAACrC,QAAQ,CAACmD,MAAM,CAAChD,CAAC,EAAE,CAAC,EAAEkC,IAAI,CAACrC,QAAQ,CAACG,CAAC,GAAG,CAAC,CAAC,EAAEkC,IAAI,CAACrC,QAAQ,CAACG,CAAC,CAAC,CAAC;cAAA;gBAAA;gBAAA,OAE9DoC,mBAAmB,EAAE;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAC5B;MAAA;IAAA;IAMD,SAASqB,QAAQ,CAAEtD,EAAE,EAAEgD,OAAO,EAAE;MAC9BlF,KAAK,CAACC,GAAG,uCAAgC4D,MAAM,CAACJ,QAAQ,EAAE,EAAG;MAC7D,IAAI,CAACvB,EAAE,EAAE;QAAE;QACTlC,KAAK,CAAC2E,KAAK,CAAC,+BAA+B,GAAGO,OAAO,CAAC;MACxD;MACA9F,gBAAgB,CAAC8C,EAAE,EAAEgD,OAAO,CAAC;IAC/B;IAEAjF,GAAG,CAACD,KAAK,CAAC,2BAA2B,GAAG6D,MAAM,CAAC;IAE/C,IAAM4B,EAAE,GAAG,IAAA3F,4BAAa,EAACd,GAAG,EAAE0G,OAAO,CAAC;IACtC,IAAMP,QAAQ,GAAGM,EAAE,CAACzG,GAAG,EAAE,IAAI,EAAEC,OAAO,EAAE4E,MAAM,EAAE6B,OAAO,EAAEvG,OAAO,EAAEqG,QAAQ,CAAC,EAAC;IAC5EL,QAAQ,CAACjG,OAAO,GAAG2E,MAAM,EAAC;;IAE1B;IACA,IAAIrF,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC,EAAE;MACpC+G,OAAO,CAACC,qBAAqB,CAAC7G,GAAG,EAAEmG,QAAQ,EAAEW,eAAe,EAAEhB,cAAc,CAAC;MAC7E,IAAIf,OAAO,EAAE;QAAE;QACb,IAAMgC,KAAK,GAAG/G,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;QACtCwF,KAAK,CAACxE,KAAK,CAACE,OAAO,GAAG,MAAM;QAC5BsE,KAAK,CAACxE,KAAK,CAACyE,mBAAmB,GAAG,UAAU;QAC5CD,KAAK,CAACxE,KAAK,CAAC0E,gBAAgB,GAAG,SAAS;QACxC,IAAMC,YAAY,GAAGN,OAAO,CAACO,MAAM,CACjCnH,GAAG,EAAEoH,eAAK,CAACC,QAAQ,GAAG,kBAAkB,EAAE,SAAS;UAAA,yFACnD,iBAAMhB,KAAK;YAAA;cAAA;gBAAA;kBAAA;oBAAA,iCAAID,YAAY,CAACC,KAAK,EAAE,IAAI,CAAC;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA;UAAA;YAAA;UAAA;QAAA,IAAC;QAC3C,IAAMiB,cAAc,GAAGV,OAAO,CAACO,MAAM,CACnCnH,GAAG,EAAEoH,eAAK,CAACC,QAAQ,GAAG,kBAAkB,EAAE,WAAW;UAAA,0FACrD,kBAAMhB,KAAK;YAAA;cAAA;gBAAA;kBAAA;oBAAA,kCAAID,YAAY,CAACC,KAAK,EAAE,KAAK,CAAC;kBAAA;kBAAA;oBAAA;gBAAA;cAAA;YAAA;UAAA;UAAA;YAAA;UAAA;QAAA,IAAC;QAC5C,IAAMkB,KAAI,GAAGvH,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;QACrCgG,KAAI,CAAC/F,WAAW,CAAC2E,QAAQ,CAAC,EAAC;QAC3BY,KAAK,CAACvF,WAAW,CAAC+F,KAAI,CAAC;QAEvBR,KAAK,CAACvF,WAAW,CAAC0F,YAAY,CAAC;QAC/BH,KAAK,CAACvF,WAAW,CAAC8F,cAAc,CAAC;QACjCJ,YAAY,CAAC3E,KAAK,CAACiF,UAAU,GAAG,CAAC;QACjCF,cAAc,CAAC/E,KAAK,CAACiF,UAAU,GAAG,CAAC;QACnCN,YAAY,CAAC3E,KAAK,CAACkF,OAAO,GAAG,CAAC;QAC9BH,cAAc,CAAC/E,KAAK,CAACmF,OAAO,GAAG,KAAK,EAAC;QACrCR,YAAY,CAAC3E,KAAK,CAACmF,OAAO,GAAG,KAAK;QAElCJ,cAAc,CAAC/E,KAAK,CAACkF,OAAO,GAAG,CAAC;QAChCF,KAAI,CAAChF,KAAK,CAACiF,UAAU,GAAG,CAAC;QACzBD,KAAI,CAAChF,KAAK,CAACoF,YAAY,GAAG,QAAQ,EAAC;QACnC;QACA,OAAOZ,KAAK;MACd;IACF;IACA,OAAOZ,QAAQ,EAAC;EAClB,CAAC,CAAC;;EAEF;;EAEA,IAAMyB,WAAW,GAAGR,eAAK,CAACC,QAAQ,GAAG,sBAAsB,EAAC;;EAE5D,IAAM7H,EAAE,GAAGC,iBAAK;EAChB,IAAMqC,OAAO,GAAGT,IAAI,CAACU,GAAG,GAAGV,IAAI,CAACU,GAAG,EAAE,GAAG,IAAI,EAAC;;EAE7C,IAAMT,GAAG,GAAItB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAE;EACtC,IAAMgG,IAAI,GAAGjG,GAAG,EAAC;EACjB;EACA;EACA,IAAM1B,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAIwB,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EAEzC,IAAMuG,WAAW,GAAGrI,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,SAAS,CAAC,CAAC;EAC/C,IAAMmF,OAAO,GAAG8C,WAAW,GAAG9D,IAAI,CAAC+D,IAAI,CAACC,IAAI,CAACF,WAAW,CAAC,GAAG,KAAK;EAEjE,IAAMtC,QAAQ,GAAG/F,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,UAAU,CAAC,CAAC;EAC7C,IAAMyF,OAAO,GAAG7F,EAAE,CAACwI,KAAK,CAAC3G,IAAI,EAAEzB,EAAE,CAAC,SAAS,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC;EAC5D,IAAI,CAACyD,QAAQ,EAAE;IACbjE,GAAG,CAACE,WAAW,CACb,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,2BAA2B,GAAGqB,IAAI,CAAC,CAC3D,EAAC;IACF,OAAOkG,IAAI;EACb;EACA,IAAIT,eAAe,GAAGtH,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,OAAO,CAAC,CAAC;EAC/C,IAAI,CAACkH,eAAe,EAAEA,eAAe,GAAGmB,KAAK,CAACC,KAAK,CAAC3C,QAAQ,CAAC;EAC7D,IAAI4C,GAAG,GAAG3I,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,KAAK,CAAC,CAAC,EAAC;EAClCuI,GAAG,GAAGA,GAAG,GAAG,CAAC,GAAGA,GAAG,CAAC/F,KAAK,GAAG,CAAC;EAE7B,IAAMsE,OAAO,GAAGlH,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,MAAM,CAAC,CAAC,EAAC;EACzC,IAAI,CAAC8G,OAAO,EAAE;IACZpF,GAAG,CAACE,WAAW,CACb,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,uBAAuB,GAAGqB,IAAI,CAAC,CACvD;IACD,OAAOkG,IAAI;EACb;EAEA,IAAMpE,IAAI,GAAG7B,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC,CAAC;EACtD4B,IAAI,CAACZ,KAAK,CAACE,OAAO,GAAG,MAAM;EAE3BU,IAAI,CAACZ,KAAK,CAACG,aAAa,GAAG,QAAQ;EACnC,IAAIuC,IAAI,EAAC;EACT,IAAIxB,MAAM,EAAC;EACXA,MAAM,GAAG4B,OAAO,GAAG7F,EAAE,CAACyC,GAAG,CAAC,IAAI,EAAEsD,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC,GAAGX,EAAE,CAACyC,GAAG,CAAC/B,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC;EACtG,IAAI4E,OAAO,EAAE;IACXE,IAAI,GAAGI,OAAO,GAAG7F,EAAE,CAACyC,GAAG,CAAC,IAAI,EAAEsD,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC,GAAGX,EAAE,CAACyC,GAAG,CAAC/B,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC;IACpG,IAAI8E,IAAI,EAAE;MACRxB,MAAM,GAAGwB,IAAI,CAACrC,QAAQ;IACxB,CAAC,MAAM;MACLa,MAAM,GAAG,EAAE;IACb;EACF,CAAC,MAAM;IACLA,MAAM,GAAG4B,OAAO,GAAG7F,EAAE,CAACqD,IAAI,CAAC,IAAI,EAAE0C,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC,GAAGX,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC;IACxG8E,IAAI,GAAG,IAAI;EACb;EACA;EACA,IAAIzF,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC,EAAE;IACpC,IAAMuI,IAAI,GAAG9G,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC,CAAC;IACtD6G,IAAI,CAAC7F,KAAK,CAACmF,OAAO,GAAG,OAAO;IAC5B,IAAMW,GAAG,GAAGD,IAAI,CAAC5G,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC,CAAC;IACtD8G,GAAG,CAAC/F,YAAY,CAAC,KAAK,EAAEsF,WAAW,CAAC,EAAC;IACrCS,GAAG,CAAC/F,YAAY,CAAC,OAAO,EAAE,2CAA2C,CAAC;IACtE+F,GAAG,CAACC,KAAK,GAAG,uBAAuB,GAAGxB,eAAe;IACrD,IAAMyB,MAAM,GAAGvI,GAAG,CAACuB,aAAa,CAAC,MAAM,CAAC;IACxCgH,MAAM,CAACC,WAAW,GAChB,CAAC/E,MAAM,CAAC/C,MAAM,KAAK,CAAC,GAAG,cAAc,GAAG,MAAM,IAC9CoG,eAAe;IACjBsB,IAAI,CAACK,gBAAgB,CAAC,OAAO;MAAA,0FAAE,kBAAMC,aAAa;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OAC1C9D,OAAO,EAAE;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA,CAChB;MAAA;QAAA;MAAA;IAAA,KAAE,IAAI,CAAC;IACRwD,IAAI,CAAC5G,WAAW,CAAC+G,MAAM,CAAC;EAC1B;EAEA,SAASvD,qBAAqB,GAAI;IAChC,IAAI,CAACC,IAAI,EAAE;MACTA,IAAI,GAAG,IAAIlB,IAAI,CAAC4E,UAAU,EAAE;MAC5B,IAAItD,OAAO,EAAE;QACX7F,EAAE,CAACoJ,GAAG,CAAC3D,IAAI,EAAEM,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC;MAC1C,CAAC,MAAM;QACLX,EAAE,CAACoJ,GAAG,CAAC1I,OAAO,EAAEqF,QAAQ,EAAEN,IAAI,EAAE9E,OAAO,CAAC;MAC1C;IACF;EACF;EAAC,SAEcgF,mBAAmB;IAAA;EAAA;EAAA;IAAA,qGAAlC;MAAA;QAAA;UAAA;YAAA;cACEnE,KAAK,CAACC,GAAG,CAAC,aAAa,GAAGuD,WAAW,CAACS,IAAI,CAACrC,QAAQ,CAAC,CAAC,EAAC;;cAEtDoC,qBAAqB,EAAE;cAAA;cAAA;cAAA,OAEfxF,EAAE,CAACqJ,OAAO,CAACC,OAAO,CAAC3I,OAAO,CAAC;YAAA;cAAA;cAAA;YAAA;cAAA;cAAA;cAEjCmB,GAAG,CAACE,WAAW,CACb,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,mCAAmC,eAAM,CAAC,CAClE;cAAA;YAAA;cAGH4F,OAAO,EAAE;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CACV;IAAA;EAAA;EAED,SAASA,OAAO,GAAI;IAClB,IAAImD,IAAI;IACR,IAAIhE,OAAO,EAAE;MACX,IAAMiE,EAAE,GAAG3D,OAAO,GAAG7F,EAAE,CAAC8E,GAAG,CAAC,IAAI,EAAEiB,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC,GAAGX,EAAE,CAAC8E,GAAG,CAACpE,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC;MACxG4I,IAAI,GAAGC,EAAE,GAAGA,EAAE,CAACpG,QAAQ,GAAG,EAAE;IAC9B,CAAC,MAAM;MACLmG,IAAI,GAAG1D,OAAO,GAAG7F,EAAE,CAACqD,IAAI,CAAC,IAAI,EAAE0C,QAAQ,EAAErF,OAAO,EAAEC,OAAO,CAAC,GAAGX,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC;MACtG4I,IAAI,CAACE,IAAI,EAAE,EAAC;IACd;;IACAhB,KAAK,CAACiB,yBAAyB,CAAC/F,IAAI,EAAE4F,IAAI,EAAElD,UAAU,CAAC;EACzD;EACA1C,IAAI,CAACyC,OAAO,GAAGA,OAAO,EAAC;EACvBA,OAAO,EAAE;EAAA,SAEMuD,UAAU;IAAA;EAAA;EAAA;IAAA,4FAAzB;MAAA;MAAA;QAAA;UAAA;YAAA;cACQC,KAAK,GAAGjB,GAAG,GAAG1E,MAAM,CAAC/C,MAAM;cAAA,MAC7B0I,KAAK,GAAG,CAAC;gBAAA;gBAAA;cAAA;cACF3I,CAAC,GAAG,CAAC;YAAA;cAAA,MAAEA,CAAC,GAAG2I,KAAK;gBAAA;gBAAA;cAAA;cACvBpI,KAAK,CAACC,GAAG,CAAC,oBAAoB,GAAGkH,GAAG,CAAC;cAAA;cAAA,OAC/BvD,OAAO,EAAE;YAAA;cAFUnE,CAAC,EAAE;cAAA;cAAA;YAAA;cAAA;cAAA,OAIxB0E,mBAAmB,EAAE;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAE9B;IAAA;EAAA;EACDgE,UAAU,EAAE,CAACE,IAAI,CACf,YAAM;IAAErI,KAAK,CAACC,GAAG,CAAC,kCAAkC,CAAC;EAAC,CAAC,EACvD,UAACqI,GAAG,EAAK;IAAEtI,KAAK,CAAC2E,KAAK,CAAC,4CAA4C,EAAE2D,GAAG,CAAC;EAAC,CAAC,CAC5E,EAAC;;EAEF,OAAO/B,IAAI;AACb,CAAC,EAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;;AAEA7H,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,YAAY,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC3C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,YAAY,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC3C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,YAAY,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC3C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,WAAW,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC1C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,eAAe,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC9C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,WAAW,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC1C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,cAAc,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC7C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,cAAc,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC7C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,cAAc,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC7C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,YAAY,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC3C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,WAAW,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AAC1C7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,qBAAqB,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;AACpD7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,mBAAmB,CAAC,CAACC,GAAG,CAAC,GAAG0J,iBAAU;;AAElD;AACA;AACA;;AAEA7J,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,oBAAoB,CAAC,CAACC,GAAG,CAAC,GAAG,UACvCG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAMR,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAMJ,EAAE,GAAGC,iBAAK;EAChB,IAAMqC,OAAO,GAAGT,IAAI,CAACU,GAAG,GAAGV,IAAI,CAACU,GAAG,EAAE,GAAG,IAAI,EAAC;;EAE7C,IAAMwD,QAAQ,GAAG/F,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,UAAU,CAAC,CAAC;EAC7C,IAAI,CAAC2F,QAAQ,EAAE;IACb,OAAO,IAAAlD,wBAAiB,EAACrC,GAAG,EAAE,6BAA6B,GAAGqB,IAAI,CAAC;EACrE;EACA,IAAMC,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpCD,GAAG,CAACiB,KAAK,CAACE,OAAO,GAAG,MAAM;EAC1BnB,GAAG,CAACiB,KAAK,CAACG,aAAa,GAAG,KAAK;EAC/B,IAAM8G,IAAI,GAAGlI,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC,CAAC;EACtDiI,IAAI,CAACjH,KAAK,CAACkH,KAAK,GAAGlH,KAAK,CAACmH,qBAAqB;EAC9C,IAAMC,KAAK,GAAGrI,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC,CAAC;EAEvDiI,IAAI,CAAChI,WAAW,CAAC,IAAAoI,iBAAU,EAAC5J,GAAG,EAAEuF,QAAQ,EAAElE,IAAI,CAAC,CAAC;EACjDlB,OAAO,GAAG,IAAA0J,iBAAU,EAAC3J,OAAO,EAAEqF,QAAQ,EAAEpF,OAAO,CAAC;EAEhD,IAAM2J,IAAI,GAAGtK,EAAE,CAACwI,KAAK,CAAC9H,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC,IAAI,EAAE;EAC7D,IAAMwG,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EACjD,IAAMkK,uBAAuB,GAAG1I,IAAI,IAAI7B,EAAE,CAACwI,KAAK,CAAC3G,IAAI,EAAE1B,EAAE,CAACC,EAAE,CAAC,yBAAyB,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC;EAEvG,IAAI,CAAC6E,QAAQ,IAAIoD,uBAAuB,IAAID,IAAI,KAAK,EAAE,EAAE;IACvDxI,GAAG,CAACiB,KAAK,CAACE,OAAO,GAAG,MAAM;EAC5B;EACA,IAAM/C,KAAK,GAAGsK,eAAe,CAC3BhK,GAAG,EACHR,EAAE,EACFU,OAAO,EACPqF,QAAQ,EACRpF,OAAO,EACPC,gBAAgB,CACjB;EACDuJ,KAAK,CAACnI,WAAW,CAAC9B,KAAK,CAAC;EACxB,IAAI0B,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EACzC,OAAOA,GAAG;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA,SAAS2I,YAAY,CACnBjK,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB8J,QAAQ,EACR;EACA,IAAMtK,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAMJ,EAAE,GAAGC,iBAAK;EAChB,IAAM8F,QAAQ,GAAG/F,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,UAAU,CAAC,CAAC;EAC7C,IAAI,CAAC2F,QAAQ,EAAE;IACb,IAAM4E,UAAU,GAAG,IAAA9H,wBAAiB,EAClCrC,GAAG,EACH,gCAAgC,GAAGqB,IAAI,CACxC;IACD,IAAID,SAAS,EAAEA,SAAS,CAACI,WAAW,CAAC2I,UAAU,CAAC;IAChD,OAAOA,UAAU;EACnB;EACA,IAAIC,GAAG,GAAG5K,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,OAAO,CAAC,CAAC;EACnC,IAAI,CAACwK,GAAG,EAAEA,GAAG,GAAGnC,KAAK,CAACC,KAAK,CAAC3C,QAAQ,EAAE,IAAI,CAAC,EAAC;EAC5CpF,OAAO,GAAG,IAAA0J,iBAAU,EAAC3J,OAAO,EAAEqF,QAAQ,EAAEpF,OAAO,CAAC;EAChD,IAAIkK,KAAK,GAAG7K,EAAE,CAACyC,GAAG,CAAC/B,OAAO,EAAEqF,QAAQ,CAAC;EACrC,IAAI8E,KAAK,KAAKC,SAAS,EAAE;IACvBD,KAAK,GAAG,KAAK;EACf,CAAC,CAAC;EACF,IAAME,GAAG,GAAGxG,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC;EACrD,IAAM8F,GAAG,GAAGlC,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAEqF,QAAQ,EAAE,KAAK,EAAEpF,OAAO,CAAC;EACtD,IAAMmB,GAAG,GAAGkJ,iBAAiB,CAACxK,GAAG,EAAER,EAAE,EAAE4K,GAAG,EAAEnE,GAAG,EAAEsE,GAAG,EAAElJ,IAAI,EAAElB,OAAO,EAAE+J,QAAQ,CAAC;EAC9E,IAAI9I,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EACzC,OAAOA,GAAG;AACZ;AACA5B,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,cAAc,CAAC,CAACC,GAAG,CAAC,GAAG,UACjCG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,OAAO6J,YAAY,CACjBjK,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB,KAAK,CACN;AACH,CAAC;AAEDV,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,eAAe,CAAC,CAACC,GAAG,CAAC,GAAG,UAClCG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,OAAO6J,YAAY,CACjBjK,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB,IAAI,CACL;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;;AAEAV,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,YAAY,CAAC,CAACC,GAAG,CAAC,GAAG,UAC/BG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAMZ,EAAE,GAAGC,iBAAK;EAChB,IAAMG,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAM6K,QAAQ,GAAGjL,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,UAAU,CAAC,CAAC;EAC7C,IAAI,CAAC6K,QAAQ,EAAE;IACb,OAAO,IAAApI,wBAAiB,EAACrC,GAAG,EAAE,8BAA8B,GAAGqB,IAAI,CAAC;EACtE;EACAJ,GAAG,CAACD,KAAK,CAAC,sBAAsB,GAAGb,OAAO,CAAC;EAC3C,IAAMuK,YAAY,GAAG,SAAfA,YAAY,CAAaxH,EAAE,EAAEC,IAAI,EAAE;IACvC,IAAI,CAACD,EAAE,EAAE,OAAO9C,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,CAAC;IAC1C,OAAO/C,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,CAAC;EACnC,CAAC;EACD,IAAM7B,GAAG,GAAGqJ,2BAA2B,CACrC3K,GAAG,EACHR,EAAE,EACFU,OAAO,EACPuK,QAAQ,EACRtK,OAAO,EACPuK,YAAY,CACb;EACD,IAAItJ,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EACzC,OAAOA,GAAG;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA5B,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,QAAQ,CAAC,CAACC,GAAG,CAAC,GAAG,UAC3BG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAMR,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAMJ,EAAE,GAAGC,iBAAK;EAChB,IAAMqC,OAAO,GAAGT,IAAI,CAACU,GAAG,GAAGV,IAAI,CAACU,GAAG,EAAE,GAAG,IAAI,EAAC;;EAE7C,IAAI6I,CAAC;EACL,IAAMtJ,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpCD,GAAG,CAACgB,YAAY,CAAC,OAAO,EAAE,WAAW,CAAC;EACtC;EACA,IAAIlB,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EACzC,IAAMuJ,GAAG,GAAG7K,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpCsJ,GAAG,CAACvI,YAAY,CAAC,OAAO,EAAE,+BAA+B,CAAC;EAC1DhB,GAAG,CAACE,WAAW,CAACqJ,GAAG,CAAC;EACpB,IAAMC,GAAG,GAAG9K,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpCuJ,GAAG,CAACxI,YAAY,CAAC,OAAO,EAAE,oCAAoC,CAAC;EAC/DhB,GAAG,CAACE,WAAW,CAACsJ,GAAG,CAAC;EACpB,IAAMvF,QAAQ,GAAG/F,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,UAAU,CAAC,CAAC;EAC7C,IAAI,CAAC2F,QAAQ,EAAE;IACb,OAAOjE,GAAG,CAACE,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,0BAA0B,GAAGqB,IAAI,CAAC,CAAC;EACnF;EACAwJ,GAAG,CAACrJ,WAAW,CAAC,IAAAoI,iBAAU,EAAC5J,GAAG,EAAEuF,QAAQ,EAAElE,IAAI,CAAC,CAAC;EAChD,IAAM0J,MAAM,GAAGvL,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,MAAM,CAAC,CAAC;EACvC,IAAI,CAACmL,MAAM,EAAE;IACX,OAAO,IAAA1I,wBAAiB,EAACrC,GAAG,EAAE,wBAAwB,GAAGqB,IAAI,CAAC;EAChE;EACA,IAAM2J,OAAO,GAAGxL,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,KAAK,CAAC,CAAC,EAAC;EACxC;;EAEA,IAAMqL,IAAI,GAAG;IAAE5J,IAAI,EAAJA,IAAI;IAAE2J,OAAO,EAAPA,OAAO;IAAEE,YAAY,EAAE;EAAM,CAAC;EAEnD,SAASC,kBAAkB,GAAI;IAC7B,IAAIC,QAAQ,GAAG,EAAE;IACjB,IAAIC,kBAAkB;IACtBD,QAAQ,GAAG5L,EAAE,CAACqD,IAAI,CAACyH,SAAS,EAAE3K,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAEwH,MAAM,EAAEjJ,OAAO,CAAC;IAC9D,KAAK,IAAMD,CAAC,IAAIyJ,aAAa,CAAC9L,EAAE,EAAEuL,MAAM,EAAE5K,OAAO,CAAC,EAAE;MAClDiL,QAAQ,CAAClG,IAAI,CAAC1F,EAAE,CAAC+L,MAAM,CAAC1J,CAAC,CAAC,CAAC;IAC7B,CAAC,CAAC;;IAEF,IAAIkJ,MAAM,CAACrH,QAAQ,CAAC/D,EAAE,CAAC6L,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE;MACrC,KAAKZ,CAAC,IAAIhE,OAAO,CAAC6E,YAAY,EAAE;QAAEL,QAAQ,CAAClG,IAAI,CAAC1F,EAAE,CAACwE,GAAG,CAAC4G,CAAC,CAAC,CAAC;MAAA;MAC1D;IACF,CAAC,MAAM,IAAIG,MAAM,CAACrH,QAAQ,CAAC/D,EAAE,CAAC4D,GAAG,CAAC,UAAU,CAAC,CAAC,EAAE;MAC9C8H,kBAAkB,GAAGzE,OAAO,CAAC8E,cAAc,CAAClM,EAAE,CAAC;MAC/C,KAAKoL,CAAC,IAAIS,kBAAkB,CAACM,EAAE;QAAEP,QAAQ,CAAClG,IAAI,CAAC1F,EAAE,CAAC+L,MAAM,CAACX,CAAC,CAAC,CAAC;MAAA;MAC5D,KAAKA,CAAC,IAAIS,kBAAkB,CAACO,EAAE;QAAER,QAAQ,CAAClG,IAAI,CAAC1F,EAAE,CAAC+L,MAAM,CAACX,CAAC,CAAC,CAAC;MAAA;MAC5DK,IAAI,CAACC,YAAY,GAAG,IAAI,EAAC;IAC3B,CAAC,MAAM,IAAIH,MAAM,CAACrH,QAAQ,CAAC/D,EAAE,CAACkM,GAAG,CAAC,gBAAgB,CAAC,CAAC,EAAE;MACpDR,kBAAkB,GAAGzE,OAAO,CAAC8E,cAAc,CAAClM,EAAE,CAAC;MAC/C,KAAKoL,CAAC,IAAIS,kBAAkB,CAACM,EAAE;QAAEP,QAAQ,CAAClG,IAAI,CAAC1F,EAAE,CAAC+L,MAAM,CAACX,CAAC,CAAC,CAAC;MAAA;MAC5DK,IAAI,CAACC,YAAY,GAAG,IAAI;IAC1B,CAAC,MAAM,IAAIH,MAAM,CAACrH,QAAQ,CAAC/D,EAAE,CAACkM,GAAG,CAAC,kBAAkB,CAAC,CAAC,EAAE;MACtDR,kBAAkB,GAAGzE,OAAO,CAAC8E,cAAc,CAAClM,EAAE,CAAC;MAC/C,KAAKoL,CAAC,IAAIS,kBAAkB,CAACO,EAAE;QAAER,QAAQ,CAAClG,IAAI,CAAC1F,EAAE,CAAC+L,MAAM,CAACX,CAAC,CAAC,CAAC;MAAA;MAC5DK,IAAI,CAACC,YAAY,GAAG,IAAI;IAC1B;IAEA,OAAOE,QAAQ;IACf;EACF;;EAEA;EACA,IAAI5L,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,YAAY,CAAC,CAAC,EAAE;IAClCqL,IAAI,CAACa,IAAI,GAAG,gBAAgB,EAAC;EAC/B;;EAEA,IAAMC,WAAW,GAAGvM,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,aAAa,CAAC,CAAC,EAAC;EACpD,IAAImM,WAAW,EAAEd,IAAI,CAACc,WAAW,GAAG,IAAI;EAExC,IAAIC,QAAQ;EACZlB,GAAG,CAAClF,OAAO,GAAG,YAAY;IACxB;IACA,IAAIqG,eAAe,GAAGzM,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAEqF,QAAQ,EAAE,IAAI,EAAEpF,OAAO,CAAC,CAAC2D,GAAG,CAAC,UAAAe,MAAM;MAAA,OAAIA,MAAM,CAACzC,KAAK;IAAA,EAAC;IAC3F;IACA,IAAI8J,eAAe,GAAGf,kBAAkB,EAAE;IAC1Ce,eAAe,CAAChH,IAAI,CAAC+G,eAAe,CAAC;IACrCC,eAAe,GAAGC,WAAW,CAACD,eAAe,CAAC;IAE9CF,QAAQ,GAAGI,mBAAmB,CAC5BpM,GAAG,EACH8K,GAAG,EACHtL,EAAE,EACFU,OAAO,EACPqF,QAAQ,EACR2G,eAAe,EACfD,eAAe,EACflB,MAAM,EACNE,IAAI,EACJ9K,OAAO,EACPC,gBAAgB,CACjB;IACD0K,GAAG,CAACuB,SAAS,GAAG,EAAE;IAClBvB,GAAG,CAACtJ,WAAW,CAACwK,QAAQ,CAAC;IACzB,IAAID,WAAW,EAAE;MACf,IAAMO,cAAc,GAAG,IAAIC,8BAAiB,CAAC;QAC3CC,WAAW,EAAER,QAAQ,CAACS,QAAQ;QAC9BC,MAAM,EAAEV,QAAQ;QAChB5K,SAAS,EAAE0J,GAAG;QACd6B,SAAS,EAAE,WAAW;QACtBC,UAAU,EAAE;MACd,CAAC,CAAC;MACFN,cAAc,CAACO,IAAI,EAAE;MACrBP,cAAc,CAACQ,SAAS,CAAC,UAAUzG,KAAK,EAAE;QACxC,IAAIA,KAAK,CAAC0G,MAAM,KAAK,eAAe,EAAE;UACpCd,eAAe,GAAGA,eAAe,CAACe,MAAM,CAAC,UAAU5K,KAAK,EAAE;YACxD,OAAOA,KAAK,KAAKiE,KAAK,CAACjE,KAAK;UAC9B,CAAC,CAAC;QACJ;QACA,IAAIiE,KAAK,CAAC0G,MAAM,KAAK,mBAAmB,EAAE;UACxCd,eAAe,GAAG,EAAE;QACtB;QACA,IAAI5F,KAAK,CAAC0G,MAAM,KAAK,YAAY,EAAE;UACjC,IAAME,WAAW,GAAG5G,KAAK,CAACjE,KAAK,GAAG,EAAE;UACpC,IAAI6K,WAAW,CAACC,QAAQ,CAAC,YAAY,CAAC,EAAE;YACtC,IAAMC,SAAS,GAAGrI,QAAQ,CAAC3E,OAAO,CAAC;YACnC,IAAMiN,EAAE,GAAG,EAAE;YACbA,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAEqF,QAAQ,EAAE/F,EAAE,CAACwE,GAAG,CAACmJ,SAAS,CAAC,EAAEhN,OAAO,CAAC,CAAC;YAC/D,IAAI4K,MAAM,EAAEqC,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAAC6H,SAAS,EAAExN,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAE/D,EAAE,CAACwE,GAAG,CAAC+G,MAAM,CAAC,EAAE5K,OAAO,CAAC,CAAC;YAChF,IAAI6K,OAAO,EAAE;cACXqC,gBAAgB,CAACrN,GAAG,EAAE8K,GAAG,EAAE,CAAC,CAAC,EAAE/G,IAAI,CAACC,GAAG,CAACmJ,SAAS,CAAC,EAAEnC,OAAO,EAAE7K,OAAO,EAAE,UAAU+C,EAAE,EAAEC,IAAI,EAAE;gBACxF,IAAID,EAAE,EAAE;kBACN1D,EAAE,CAACgG,OAAO,CAACC,MAAM,CAAC,EAAE,EAAE2H,EAAE,EAAE,UAAUvN,GAAG,EAAEyN,OAAO,EAAEC,SAAS,EAAE;oBAC3D,IAAI,CAACD,OAAO,EAAExC,GAAG,CAACtJ,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,yBAAyB,GAAGuN,SAAS,CAAC,CAAC;kBAC9F,CAAC,CAAC;kBACFtB,eAAe,CAAC/G,IAAI,CAACiI,SAAS,CAAC;kBAC/B,IAAI/M,gBAAgB,EAAEA,gBAAgB,CAAC8C,EAAE,EAAE;oBAAEE,MAAM,EAAE,QAAQ;oBAAEiD,KAAK,EAAE;kBAAM,CAAC,CAAC;gBAChF,CAAC,MAAM;kBACLyE,GAAG,CAACtJ,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,0CAA0C,GAAGmD,IAAI,CAAC,CAAC;gBAC5F;cACF,CAAC,CAAC;YACJ;UACF,CAAC,MAAM8I,eAAe,CAAC/G,IAAI,CAACmB,KAAK,CAACjE,KAAK,CAAC;QAC1C;QACA4J,QAAQ,CAACvG,MAAM,CAACwG,eAAe,CAAC;MAClC,CAAC,CAAC;IACJ;EACF,CAAC;EAEDnB,GAAG,CAAClF,OAAO,EAAE;EACb,IAAIoG,QAAQ,IAAIA,QAAQ,CAACpG,OAAO,EAAEoG,QAAQ,CAACpG,OAAO,EAAE;EAEpD,OAAOtE,GAAG;AACZ,CAAC;AAED,SAAS+L,gBAAgB,CAAErN,GAAG,EAAEwN,SAAS,EAAEvN,OAAO,EAAEC,OAAO,EAAE8K,OAAO,EAAE7K,OAAO,EAAEC,gBAAgB,EAAE;EAC/F,IAAAU,4BAAa,EAACd,GAAG,EAAEgL,OAAO,CAAC,CACzBhL,GAAG,EACHwN,SAAS,EACTvN,OAAO,EACPC,OAAO,EACP8K,OAAO,EACP7K,OAAO,EACPC,gBAAgB,CACjB;AACH;;AAEA;AACA;;AAEAV,oBAAK,CAACC,EAAE,CAACC,EAAE,CAAC,SAAS,CAAC,CAACC,GAAG,CAAC,GAAGH,oBAAK,CACjCC,EAAE,CAACC,EAAE,CAAC,SAAS,CAAC,CAACC,GAAG,CACrB,GAAG,UACFG,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPsN,iBAAiB,EACjB;EACA,IAAM7N,EAAE,GAAGD,EAAE,CAACC,EAAE;EAChB,IAAMJ,EAAE,GAAGC,iBAAK;EAChB,IAAIiO,QAAQ,GAAGlO,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAEzB,EAAE,CAAC,UAAU,CAAC,CAAC;EAC3C,IAAI,CAAC8N,QAAQ,EAAEA,QAAQ,GAAG,sCAAsC;EAChE,IAAM5L,OAAO,GAAGT,IAAI,CAACU,GAAG,GAAGV,IAAI,CAACU,GAAG,EAAE,GAAG,IAAI,EAAC;;EAE7C,IAAMlC,GAAG,GAAG,IAAAe,mCAAoB,EAACS,IAAI,CAAC;EACtC,IAAMsM,MAAM,GAAGC,wBAAW,CAAC/N,GAAG,CAAC,IAAI,CAAC,CAAC;EAErC,IAAMyB,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpC,IAAIH,SAAS,EAAEA,SAAS,CAACI,WAAW,CAACF,GAAG,CAAC;EACzC,IAAMsJ,CAAC,GAAGtJ,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAACoM,MAAM,CAACjH,OAAO,CAAC,CAAC;EAC5DkE,CAAC,CAACpC,WAAW,GAAGkF,QAAQ;EAExB,IAAAG,wBAAa,EAACjD,CAAC,EAAEvJ,IAAI,CAAC;;EAEtB;EACA,IAAMyM,oBAAoB,GAAGtO,EAAE,CAACwI,KAAK,CAAC3G,IAAI,EAAE1B,EAAE,CAACC,EAAE,CAAC,sBAAsB,CAAC,EAAE,IAAI,EAAEkC,OAAO,CAAC;EACzF,IAAM6E,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EACjD,IAAIiO,oBAAoB,IAAI,CAACnH,QAAQ,EAAE;IACrCrF,GAAG,CAACiB,KAAK,CAACE,OAAO,GAAG,MAAM;EAC5B;EACA,OAAOnB,GAAG;AACZ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACO,SAASyM,cAAc,CAC5B/N,GAAG,EACHoB,SAAS,EACTC,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAM4N,CAAC,GAAGhO,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;EACrCyM,CAAC,CAAC1L,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC;EAChC0L,CAAC,CAAC3B,SAAS,GAAG,OAAO,GAAGpE,KAAK,CAACC,KAAK,CAACvI,EAAE,CAACC,EAAE,CAAC,MAAM,CAAC,CAAC;EAClDoO,CAAC,CAACvF,gBAAgB,CAChB,OAAO,EACP,UAAUwF,EAAE,EAAE;IACZ,IAAMC,EAAE,GAAG3J,UAAU,CACnBvE,GAAG,EACHoB,SAAS,EACT,CAAC,CAAC,EACFC,IAAI,EACJ1B,EAAE,CAACC,EAAE,CAAC,UAAU,CAAC,EACjBO,OAAO,EACPC,gBAAgB,CACjB;IACD8N,EAAE,CAAC5L,YAAY,CACb,OAAO,EACP3C,EAAE,CAACC,EAAE,CAAC,UAAU,CAAC,CAAC8D,QAAQ,CAACrC,IAAI,CAAC,GAC5B,yBAAyB,GACzB,4BAA4B,CACjC;IACD2M,CAAC,CAACG,UAAU,CAAChN,WAAW,CAAC6M,CAAC,CAAC;EAC7B,CAAC,EACD,IAAI,CACL;EACD,OAAOA,CAAC;AACV;AAEO,SAASzJ,UAAU,CACxBvE,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPqG,QAAQ,EACR;EACA,OAAO,IAAA1F,4BAAa,EAACd,GAAG,EAAEqB,IAAI,CAAC,CAC7BrB,GAAG,EACHoB,SAAS,EACTnB,OAAO,EACPC,OAAO,EACPmB,IAAI,EACJlB,OAAO,EACPqG,QAAQ,CACT;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEO,SAAS4H,kBAAkB,CAAE5O,EAAE,EAAEyE,CAAC,EAAE;EACzC,IAAMoK,QAAQ,GAAG7O,EAAE,CAACqD,IAAI,CAACyH,SAAS,EAAE3K,EAAE,CAAC4D,GAAG,CAAC,OAAO,CAAC,EAAEU,CAAC,CAAC;EACtD,CACCtE,EAAE,CAAC6L,IAAI,CAAC,SAAS,CAAC,EAClB7L,EAAE,CAAC2O,EAAE,CAAC,OAAO,CAAC;EAAE;EAChB3O,EAAE,CAAC4O,IAAI,CAAC,MAAM,CAAC,EACf5O,EAAE,CAAC4O,IAAI,CAAC,UAAU,CAAC,CACpB,CAACC,OAAO,CAAC,UAAU3M,CAAC,EAAE;IACrBwM,QAAQ,CAACnJ,IAAI,CAACrD,CAAC,CAAC;EAClB,CAAC,CAAC;EACF,IAAI4M,OAAO,GAAGjP,EAAE,CAACqD,IAAI,CAACyH,SAAS,EAAE3K,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAEU,CAAC,CAAC;EACnD,IAAIwK,OAAO,CAAC/N,MAAM,GAAG,EAAE,EAAE+N,OAAO,GAAGA,OAAO,CAAC/J,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,EAAC;EACxD,IAAMgK,IAAI,GAAG,CAAC,CAAC;EACf,KAAK,IAAI3L,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAI0L,OAAO,CAAC/N,MAAM,GAAG,EAAE,GAAG,EAAE,GAAG+N,OAAO,CAAC/N,MAAM,CAAC,EAAEqC,CAAC,EAAE,EAAE;IACpEvD,EAAE,CAACmP,kBAAkB,CAACF,OAAO,CAAC1L,CAAC,CAAC,EAAEuH,SAAS,EAAEA,SAAS,CAAC,CAACkE,OAAO,CAAC,UAAUlJ,EAAE,EAAE;MAC5EoJ,IAAI,CAACpJ,EAAE,CAACsJ,SAAS,CAAC/O,GAAG,CAAC,GAAG,IAAI;IAC/B,CAAC,CAAC;EACJ;EACAwO,QAAQ,CAACG,OAAO,CAAC,UAAU5D,CAAC,EAAE;IAC5B8D,IAAI,CAAC9D,CAAC,CAAC/K,GAAG,CAAC,GAAG,IAAI;EACpB,CAAC,CAAC;EACF,IAAMgP,MAAM,GAAG,EAAE;EACjB,KAAK,IAAMhP,GAAG,IAAI6O,IAAI,EAAE;IACtBG,MAAM,CAAC3J,IAAI,CAAC1F,EAAE,CAACwE,GAAG,CAACnE,GAAG,CAAC,CAAC;EAC1B;EACA,OAAOgP,MAAM;AACf;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,WAAW,CAAEtP,EAAE,EAAEuP,GAAG,EAAEC,IAAI,EAAE;EAC1C,IAAMC,MAAM,GAAG,CAACzP,EAAE,CAACwE,GAAG,CAAC+K,GAAG,CAAC,CAAC,EAAC;EAC7B,OAAOE,MAAM,CAACvO,MAAM,GAAG,CAAC,EAAE;IACxB,IAAMuD,CAAC,GAAGgL,MAAM,CAACC,KAAK,EAAE,EAAC;IACzB,IAAMC,KAAK,GAAG3P,EAAE,CAACqD,IAAI,CAACoB,CAAC,EAAE+K,IAAI,CAAC;IAC9B/N,GAAG,CAACD,KAAK,CAAC,YAAY,GAAGiD,CAAC,GAAG,IAAI,GAAG+K,IAAI,GAAG,IAAI,GAAGG,KAAK,CAACzO,MAAM,CAAC;IAC/D,IAAIyO,KAAK,CAACzO,MAAM,KAAK,CAAC,EAAE,OAAOyO,KAAK;IACpC,IAAMC,MAAM,GAAG5P,EAAE,CAACqD,IAAI,CAACoB,CAAC,EAAEtE,EAAE,CAAC6L,IAAI,CAAC,YAAY,CAAC,CAAC;IAChD,KAAK,IAAIzI,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGqM,MAAM,CAAC1O,MAAM,EAAEqC,CAAC,EAAE,EAAE;MACtCkM,MAAM,CAAC/J,IAAI,CAACkK,MAAM,CAACrM,CAAC,CAAC,CAAC;MACtB9B,GAAG,CAACD,KAAK,CAAC,0BAA0B,GAAGoO,MAAM,CAACrM,CAAC,CAAC,CAAC;IACnD;EACF;EACA,OAAO,EAAE;AACX;;AAEA;;AAEO,SAASsM,QAAQ,CAAEnP,OAAO,EAAE;EACjC,IAAMV,EAAE,GAAGC,iBAAK;EAEhBwB,GAAG,CAACD,KAAK,CAAC,oBAAoB,GAAGd,OAAO,CAAC;EACzC,IAAMS,CAAC,GAAGnB,EAAE,CAACqE,YAAY,CAAC3D,OAAO,CAAC;EAClC,IAAIoP,EAAE;EACN,KAAKA,EAAE,IAAI3O,CAAC,EAAE;IACZM,GAAG,CAACD,KAAK,CAAC,WAAW,GAAGsO,EAAE,CAAC;EAC7B;EACA,IAAMC,MAAM,GAAG/P,EAAE,CAACgQ,cAAc,CAAC7O,CAAC,CAAC,EAAC;EACpC,IAAI8O,UAAU,GAAG,EAAE;EACnB,KAAK,IAAMzB,CAAC,IAAIuB,MAAM,EAAE;IACtB;IACAtO,GAAG,CAACD,KAAK,CAAC,qCAAqC,GAAGgN,CAAC,CAAC;IACpDyB,UAAU,GAAGA,UAAU,CAACC,MAAM,CAC5BZ,WAAW,CAACtP,EAAE,EAAEwO,CAAC,EAAErO,EAAE,CAACC,EAAE,CAAC,cAAc,CAAC,CAAC,CAC1C;IACD6P,UAAU,GAAGA,UAAU,CAACC,MAAM,CAC5BZ,WAAW,CAACtP,EAAE,EAAEwO,CAAC,EAAErO,EAAE,CAACC,EAAE,CAAC,gBAAgB,CAAC,CAAC,CAC5C;EACH;EACA,OAAO6P,UAAU;AACnB;AAEO,SAAS3M,cAAc,CAAEmC,IAAI,EAAE;EACpC,IAAM3E,SAAS,GAAG2E,IAAI,CAACnB,GAAG,CAAC,UAAU8G,CAAC,EAAE;IACtC,IAAM+E,CAAC,GAAGnQ,EAAE,CAACyC,GAAG,CAAC2I,CAAC,EAAEjL,EAAE,CAACC,EAAE,CAAC,UAAU,CAAC,CAAC;IACtC,OAAO,CAAC+P,CAAC,IAAI,IAAI,EAAE/E,CAAC,CAAC;EACvB,CAAC,CAAC;EACFtK,SAAS,CAAC2I,IAAI,CAAC,UAAU2G,CAAC,EAAE5B,CAAC,EAAE;IAC7B,OAAO4B,CAAC,CAAC,CAAC,CAAC,GAAG5B,CAAC,CAAC,CAAC,CAAC;EACpB,CAAC,CAAC;EACF,OAAO1N,SAAS,CAACwD,GAAG,CAAC,UAAU+L,IAAI,EAAE;IACnC,OAAOA,IAAI,CAAC,CAAC,CAAC;EAChB,CAAC,CAAC;AACJ;AAEO,SAAS1D,WAAW,CAAElH,IAAI,EAAE;EACjC,IAAM3E,SAAS,GAAG2E,IAAI,CAACnB,GAAG,CAAC,UAAU8G,CAAC,EAAE;IACtC,OAAO,CAAC3C,KAAK,CAACC,KAAK,CAAC0C,CAAC,CAAC,CAACkF,WAAW,EAAE,EAAElF,CAAC,CAAC;EAC1C,CAAC,CAAC;EACFtK,SAAS,CAAC2I,IAAI,EAAE;EAChB,OAAO3I,SAAS,CAACwD,GAAG,CAAC,UAAU+L,IAAI,EAAE;IACnC,OAAOA,IAAI,CAAC,CAAC,CAAC;EAChB,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASE,SAAS,CACvB/P,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACToB,QAAQ,EACR3O,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAM4N,CAAC,GAAGhO,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;EACrCyM,CAAC,CAAC1L,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC;EAChC0L,CAAC,CAAC3B,SAAS,GAAG,MAAM,GAAGpE,KAAK,CAACC,KAAK,CAAC8H,QAAQ,CAAC;EAC5ChC,CAAC,CAACvF,gBAAgB,CAChB,OAAO,EACP,UAAUwF,EAAE,EAAE;IACZD,CAAC,CAACG,UAAU,CAAC3M,WAAW,CACtByO,YAAY,CACVjQ,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACToB,QAAQ,EACR3O,IAAI,EACJlB,OAAO,EACPC,gBAAgB,CACjB,CACF;EACH,CAAC,EACD,KAAK,CACN;EACD,OAAO4N,CAAC;AACV;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASiC,YAAY,CAC1BjQ,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACToB,QAAQ,EACR3O,IAAI,EACJlB,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAMkB,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,MAAM,CAAC;EAErC,IAAI,CAACF,IAAI,EAAE;IACT,IAAM8N,KAAK,GAAGL,WAAW,CAACtP,EAAE,EAAEwQ,QAAQ,CAACnQ,GAAG,EAAEF,EAAE,CAACC,EAAE,CAAC,cAAc,CAAC,CAAC;IAClE,IAAIuP,KAAK,CAACzO,MAAM,KAAK,CAAC,EAAE;MACtB,IAAMkK,CAAC,GAAGtJ,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,GAAG,CAAC,CAAC;MACjDqJ,CAAC,CAACpC,WAAW,GACX,sDAAsD,GACtDP,KAAK,CAACC,KAAK,CAAC8H,QAAQ,CAAC,GACrB,8DAA8D;MAChE,IAAMhC,CAAC,GAAG1M,GAAG,CAACE,WAAW,CAACxB,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC,CAAC;MACtDyM,CAAC,CAAC1L,YAAY,CAAC,MAAM,EAAE,QAAQ,CAAC;MAChC0L,CAAC,CAAC1L,YAAY,CAAC,OAAO,EAAE,eAAe,CAAC;MACxC0L,CAAC,CAAC3B,SAAS,GAAG,OAAO,GAAGpE,KAAK,CAACC,KAAK,CAAC8H,QAAQ,CAAC;MAC7ChC,CAAC,CAACvF,gBAAgB,CAChB,OAAO;MACP;MACA,UAAUwF,EAAE,EAAE;QACZjO,GAAG,CAACkQ,cAAc,CAACC,WAAW,CAC5BH,QAAQ,EACR,IAAI,EACJ1F,SAAS,EACT,IAAI,EACJA,SAAS,CACV;MACH,CAAC,EACD,KAAK,CACN;MACD,OAAOhJ,GAAG;IACZ;IACAL,GAAG,CAACD,KAAK,CAAC,cAAc,GAAGmO,KAAK,CAAC,CAAC,CAAC,CAAC;IACpC9N,IAAI,GAAG8N,KAAK,CAAC,CAAC,CAAC,EAAC;EAClB;;EACAlO,GAAG,CAACD,KAAK,CAAC,UAAU,GAAGK,IAAI,CAAC;EAC5BC,GAAG,CAACgB,YAAY,CAAC,OAAO,iCAA0BC,KAAK,CAAC6N,eAAe,sBAAY7N,KAAK,CAAC6N,eAAe,EAAG,EAAC;EAC5G9O,GAAG,CAAC+K,SAAS,GAAG,UAAU,GAAGpE,KAAK,CAACC,KAAK,CAAC8H,QAAQ,CAAC,GAAG,OAAO;EAE5D,IAAMK,YAAY,GAAG,IAAAvP,4BAAa,EAACd,GAAG,EAAEqB,IAAI,CAAC;EAC7C,IAAMwD,MAAM,GAAGC,QAAQ,CAAC3E,OAAO,CAAC;EAChC,IAAImQ,SAAS,GAAG,KAAK;EACrB,IAAM9J,QAAQ,GAAG,SAAXA,QAAQ,CAAatD,EAAE,EAAEC,IAAI,EAAE;IACnC,IAAI,CAACD,EAAE,EAAE,OAAO9C,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,CAAC;IAC1C,IAAMoN,QAAQ,GAAG,EAAE;IACnB,IAAIrQ,OAAO,IAAI,CAACV,EAAE,CAACwG,KAAK,CAAC9F,OAAO,EAAE0O,SAAS,EAAE/J,MAAM,EAAE1E,OAAO,CAAC,EAAE;MAC7DoQ,QAAQ,CAACrL,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAE/J,MAAM,EAAE1E,OAAO,CAAC,CAAC;IAC7D;IACA,IAAID,OAAO,IAAI,CAACV,EAAE,CAACwG,KAAK,CAACnB,MAAM,EAAElF,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAEyM,QAAQ,EAAE7P,OAAO,CAAC,EAAE;MACnEoQ,QAAQ,CAACrL,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACT,MAAM,EAAElF,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAEyM,QAAQ,EAAE7P,OAAO,CAAC,CAAC;IACnE;IACA,IAAIoQ,QAAQ,CAAC7P,MAAM,EAAE;MACnBlB,EAAE,CAACgG,OAAO,CAACC,MAAM,CAAC,EAAE,EAAE8K,QAAQ,EAAEC,QAAQ,CAAC;IAC3C,CAAC,MAAM;MACLpQ,gBAAgB,CAAC,IAAI,EAAE+C,IAAI,CAAC;IAC9B;IACA,IAAI,CAACmN,SAAS,EAAE;MACdA,SAAS,GAAGhP,GAAG,CAACE,WAAW,CAACoF,OAAO,CAAC6J,UAAU,CAACzQ,GAAG,EAAE6E,MAAM,CAAC,CAAC;IAC9D;EACF,CAAC;EACD,SAAS2L,QAAQ,CAAE3Q,GAAG,EAAEqD,EAAE,EAAEC,IAAI,EAAE;IAChC,OAAO/C,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,CAAC;EACnC;EACAlC,GAAG,CAACyP,IAAI,CAAC,sBAAsB,GAAG7L,MAAM,CAAC;EACzC,IAAM8L,CAAC,GAAGN,YAAY,CAACrQ,GAAG,EAAEsB,GAAG,EAAE,CAAC,CAAC,EAAEuD,MAAM,EAAExD,IAAI,EAAElB,OAAO,EAAEqG,QAAQ,CAAC;EACrE,IAAMoK,EAAE,GAAGhK,OAAO,CAACiK,YAAY,CAAC7Q,GAAG,EAAE2Q,CAAC,CAAC;EACvCC,EAAE,CAACtO,YAAY,CAAC,OAAO,EAAE,eAAe,CAAC;EACzChB,GAAG,CAACwP,YAAY,GAAGjM,MAAM;EACzB,OAAOvD,GAAG;AACZ;AAEO,SAAS0I,eAAe,CAC7BhK,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACTzO,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAM2Q,KAAK,GAAG/Q,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACtC,IAAMyP,IAAI,GAAGxR,EAAE,CAACwI,KAAK,CAAC9H,OAAO,EAAE0O,SAAS,EAAE,IAAI,EAAEzO,OAAO,CAAC,IAAI,EAAE;EAE9D,IAAMT,KAAK,GAAGM,GAAG,CAACuB,aAAa,CAAC,UAAU,CAAC;EAC3CwP,KAAK,CAACvP,WAAW,CAAC9B,KAAK,CAAC;EACxBA,KAAK,CAACuR,IAAI,GAAGD,IAAI,GAAGA,IAAI,CAACE,KAAK,CAAC,IAAI,CAAC,CAACxQ,MAAM,GAAG,CAAC,GAAG,CAAC;EACnDhB,KAAK,CAACyR,IAAI,GAAG,EAAE;EAEfzR,KAAK,CAAC4C,YAAY,CAAC,OAAO,EAAEC,KAAK,CAAC6O,uBAAuB,CAAC;EAC1D,IAAIJ,IAAI,KAAK,IAAI,EAAE;IACjBtR,KAAK,CAAC0C,KAAK,GAAG4O,IAAI;EACpB,CAAC,MAAM;IACL;IACA;IACAtR,KAAK,CAACgN,MAAM,EAAE,EAAC;EACjB;;EAEAqE,KAAK,CAACnL,OAAO,GAAG,YAAY;IAC1B,IAAMyL,CAAC,GAAG7R,EAAE,CAACyC,GAAG,CAAC/B,OAAO,EAAE0O,SAAS,EAAE,IAAI,EAAEzO,OAAO,CAAC;IACnD,IAAIkR,CAAC,IAAIA,CAAC,CAACjP,KAAK,KAAK1C,KAAK,CAAC0C,KAAK,EAAE;MAChC1C,KAAK,CAAC0C,KAAK,GAAGiP,CAAC,CAACjP,KAAK,EAAC;MACtB;IACF;EACF,CAAC;;EACD,SAASkP,UAAU,CAAErD,EAAE,EAAE;IACvBsD,MAAM,CAACC,QAAQ,GAAG,IAAI;IACtBD,MAAM,CAACjP,YAAY,CAAC,OAAO,EAAE,mCAAmC,CAAC,EAAC;IAClE5C,KAAK,CAAC8R,QAAQ,GAAG,IAAI;IACrB9R,KAAK,CAAC6C,KAAK,CAACkP,KAAK,GAAGlP,KAAK,CAACmP,qBAAqB,EAAC;IAChD,IAAMC,EAAE,GAAGnS,EAAE,CAACmP,kBAAkB,CAACzO,OAAO,EAAE0O,SAAS,EAAE,IAAI,EAAEzO,OAAO,CAAC;IACnE,IAAMiN,EAAE,GAAGrJ,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAElP,KAAK,CAAC0C,KAAK,EAAEjC,OAAO,CAAC;IAC5DX,EAAE,CAACgG,OAAO,CAACC,MAAM,CAACkM,EAAE,EAAEvE,EAAE,EAAE,UAAUvN,GAAG,EAAEqD,EAAE,EAAEC,IAAI,EAAE;MACjD,IAAID,EAAE,EAAE;QACNxD,KAAK,CAAC6C,KAAK,CAACkP,KAAK,GAAGlP,KAAK,CAACqP,cAAc;QACxClS,KAAK,CAAC8R,QAAQ,GAAG,KAAK;MACxB,CAAC,MAAM;QACLT,KAAK,CAACvP,WAAW,CACf,IAAAa,wBAAiB,EACfrC,GAAG,EACH,gCAAgC,GAAGG,OAAO,CAACN,GAAG,GAAG,KAAK,GAAGsD,IAAI,CAC9D,CACF;MACH;MACA,IAAI/C,gBAAgB,EAAE;QACpBA,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,CAAC;MAC5B;IACF,CAAC,CAAC;EACJ;EAEA,IAAMwD,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EACjD,IAAI0R,MAAM;EACV,IAAI5K,QAAQ,EAAE;IACZ4K,MAAM,GAAGM,OAAO,CAACC,cAAc,CAAC9R,GAAG,EAAEsR,UAAU,CAAC;IAChDC,MAAM,CAACC,QAAQ,GAAG,IAAI,EAAC;IACvBD,MAAM,CAAChP,KAAK,CAACwP,UAAU,GAAG,QAAQ;IAClCR,MAAM,CAAChP,KAAK,SAAM,GAAG,OAAO;IAC5BwO,KAAK,CAACvP,WAAW,CAAC+P,MAAM,CAAC;IAEzB7R,KAAK,CAAC+I,gBAAgB,CACpB,OAAO,EACP,UAAUwF,EAAE,EAAE;MACZ;MACAvO,KAAK,CAAC6C,KAAK,CAACkP,KAAK,GAAG,OAAO,EAAC;MAC5B,IAAIF,MAAM,EAAE;QACVA,MAAM,CAACC,QAAQ,GAAG,KAAK;QACvBD,MAAM,CAAChP,KAAK,CAACwP,UAAU,GAAG,EAAE,EAAC;MAC/B;IACF,CAAC,EACD,IAAI,CACL;IACDrS,KAAK,CAAC+I,gBAAgB,CAAC,QAAQ,EAAE6I,UAAU,EAAE,IAAI,CAAC;EACpD,CAAC,MAAM;IACL5R,KAAK,CAAC8R,QAAQ,GAAG,IAAI,EAAC;IACtB9R,KAAK,CAAC6C,KAAK,CAACyP,eAAe,GAAGzP,KAAK,CAAC0P,kCAAkC;EACxE;EACA,OAAOlB,KAAK;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASmB,8BAA8B,CAC5ClS,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACTxD,QAAQ,EACR+G,OAAO,EACPhS,OAAO,EACPC,gBAAgB,EAChB;EACAa,GAAG,CAACD,KAAK,CAAC,yBAAyB,GAAGoK,QAAQ,CAAC1K,MAAM,CAAC;EACtD,IAAI0R,CAAC,GAAG,CAAC;EACT,IAAMC,IAAI,GAAG,CAAC,CAAC,EAAC;EAChB,IAAM1L,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EAEjD,KAAK,IAAIkD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGqI,QAAQ,CAAC1K,MAAM,EAAEqC,CAAC,EAAE,EAAE;IACxC,IAAMuP,GAAG,GAAGlH,QAAQ,CAACrI,CAAC,CAAC,EAAC;IACxB,IAAI,CAACuP,GAAG,CAACzS,GAAG,EAAEmB,KAAK,CAACuR,IAAI,wEAAiED,GAAG,+BAAqB1D,SAAS,EAAG;IAC7H,IAAI,CAAC0D,GAAG,CAACzS,GAAG,IAAIyS,GAAG,CAACzS,GAAG,IAAIwS,IAAI,EAAE;IACjCA,IAAI,CAACC,GAAG,CAACzS,GAAG,CAAC,GAAG,IAAI;IACpBuS,CAAC,EAAE;EACL,CAAC,CAAC;EACF,IAAIA,CAAC,KAAK,CAAC,IAAI,CAACD,OAAO,CAACrG,IAAI,EAAE;IAC5B,OAAO,IAAAzJ,wBAAiB,EACtBrC,GAAG,EACH,8CAA8C,GAC5CE,OAAO,GACP,cAAc,GACd0O,SAAS,GACT,GAAG,CACN;EACH;EAEA3N,GAAG,CAACD,KAAK,CAAC,0CAA0C,GAAGb,OAAO,CAAC;EAC/D,IAAIqS,MAAM;EACV,IAAMC,SAAS,GAAG,SAAZA,SAAS,GAAe;IAC5BD,MAAM,GAAG,CAAC,CAAC;IACX,IAAI5D,SAAS,CAAClL,QAAQ,CAAC/D,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE;MACtCiP,MAAM,GAAGhT,EAAE,CAACqE,YAAY,CAAC3D,OAAO,CAAC;IACnC,CAAC,MAAM;MACLV,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAE0O,SAAS,EAAE,IAAI,EAAEzO,OAAO,CAAC,CAACqO,OAAO,CAAC,UAAU3M,CAAC,EAAE;QAC9D2Q,MAAM,CAAC3Q,CAAC,CAAChC,GAAG,CAAC,GAAG,IAAI;MACtB,CAAC,CAAC;IACJ;IACA,OAAO2S,MAAM;EACf,CAAC;EACDA,MAAM,GAAGC,SAAS,EAAE;EAEpB,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,CAAazE,EAAE,EAAE;IAC7BvB,MAAM,CAAC8E,QAAQ,GAAG,IAAI,EAAC;IACvB,IAAMG,EAAE,GAAG,EAAE;IACb,IAAIvE,EAAE,GAAG,EAAE;IACX,IAAMuF,WAAW,GAAG,SAAdA,WAAW,CAAahS,CAAC,EAAE;MAC/B,IAAInB,EAAE,CAACwG,KAAK,CAAC9F,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,EAAE;QAC5CwR,EAAE,CAACzM,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,CAAC;MAClD;IACF,CAAC;IACD,IAAIgN,SAAS;IACb,KAAK,IAAIpK,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAG2J,MAAM,CAACyF,OAAO,CAACzR,MAAM,EAAEqC,EAAC,EAAE,EAAE;MAC9C,IAAM6P,GAAG,GAAGlG,MAAM,CAACyF,OAAO,CAACpP,EAAC,CAAC;MAC7B,IAAI6P,GAAG,CAACnG,QAAQ,IAAImG,GAAG,CAACC,SAAS,EAAE;QACjC,IAAIV,OAAO,CAACW,SAAS,EAAE;UACrB,IAAMC,QAAQ,GAAG9C,YAAY,CAC3BjQ,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACTuD,OAAO,CAACW,SAAS,EACjB,IAAI,EACJ3S,OAAO,EACP,UAAU+C,EAAE,EAAEC,IAAI,EAAE;YAClB,IAAI,CAACD,EAAE,EAAE;cACP9C,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,EAAE;gBAAEE,MAAM,EAAE;cAAM,CAAC,CAAC,EAAC;YAChD;UACF,CAAC,CACF;;UACDqJ,MAAM,CAACyB,UAAU,CAAC3M,WAAW,CAACuR,QAAQ,CAAC;UACvC5F,SAAS,GAAG4F,QAAQ,CAACjC,YAAY;QACnC,CAAC,MAAM;UACL3D,SAAS,GAAGrI,QAAQ,CAAC3E,OAAO,CAAC;QAC/B;QACAiN,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEzB,SAAS,EAAEhN,OAAO,CAAC,CAAC;QACxD,IAAIgS,OAAO,CAACa,iBAAiB,EAAE;UAC7B5F,EAAE,GAAGA,EAAE,CAACsC,MAAM,CAACyC,OAAO,CAACa,iBAAiB,CAAC7F,SAAS,CAAC,CAAC;QACtD;MACF;MACA,IAAI,CAACyF,GAAG,CAACK,QAAQ,EAAE,SAAQ,CAAC;MAC5B,IAAIL,GAAG,CAACnG,QAAQ,IAAI,EAAEmG,GAAG,CAACK,QAAQ,IAAIT,MAAM,CAAC,EAAE;QAC7C;QACApF,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEpP,EAAE,CAACwE,GAAG,CAAC4O,GAAG,CAACK,QAAQ,CAAC,EAAE9S,OAAO,CAAC,CAAC;MACrE;MACA,IAAI,CAACyS,GAAG,CAACnG,QAAQ,IAAImG,GAAG,CAACK,QAAQ,IAAIT,MAAM,EAAE;QAC3C;QACAG,WAAW,CAACnT,EAAE,CAACwE,GAAG,CAAC4O,GAAG,CAACK,QAAQ,CAAC,CAAC;MACnC;MACA,IAAIL,GAAG,CAACnG,QAAQ,EAAEC,MAAM,CAACwG,UAAU,GAAGN,GAAG,CAACK,QAAQ;IACpD;IACA,IAAIE,GAAG,GAAGzG,MAAM,CAAC0G,SAAS,EAAC;IAC3B,OAAOD,GAAG,IAAIA,GAAG,CAACD,UAAU,EAAE;MAC5BP,WAAW,CAACnT,EAAE,CAACwE,GAAG,CAACmP,GAAG,CAACD,UAAU,CAAC,CAAC;MACnCC,GAAG,GAAGA,GAAG,CAACC,SAAS;IACrB;IACAD,GAAG,GAAGzG,MAAM,CAAC2G,WAAW,EAAC;IACzB,OAAOF,GAAG,IAAIA,GAAG,CAACD,UAAU,EAAE;MAC5BP,WAAW,CAACnT,EAAE,CAACwE,GAAG,CAACmP,GAAG,CAACD,UAAU,CAAC,CAAC;MACnCC,GAAG,GAAGA,GAAG,CAACE,WAAW;IACvB;IACA,SAASC,OAAO,CAAEpQ,EAAE,EAAEqQ,KAAK,EAAE;MAC3BnT,gBAAgB,CAAC8C,EAAE,EAAE;QAAEE,MAAM,EAAE,QAAQ;QAAEiD,KAAK,EAAE;MAAM,CAAC,CAAC;IAC1D;IACApF,GAAG,CAACyP,IAAI,CAAC,6CAA6C,GAAGvQ,OAAO,CAAC;IACjEX,EAAE,CAACgG,OAAO,CAACC,MAAM,CAACkM,EAAE,EAAEvE,EAAE,EAAE,UAAUvN,GAAG,EAAEqD,EAAE,EAAEC,IAAI,EAAE;MACjDqP,MAAM,GAAGC,SAAS,EAAE,EAAC;MACrB,IAAIvP,EAAE,EAAE;QACNwJ,MAAM,CAAC8E,QAAQ,GAAG,KAAK,EAAC;QACxB,IAAIrE,SAAS,EAAE;UACb,IAAM1G,EAAE,GAAG,IAAA3F,4BAAa,EAACd,GAAG,EAAEmS,OAAO,CAACnH,OAAO,CAAC;UAC9CvE,EAAE,CACAzG,GAAG,EACH0M,MAAM,CAACyB,UAAU,EACjB,CAAC,CAAC,EACFhB,SAAS,EACTgF,OAAO,CAACnH,OAAO,EACf7K,OAAO,EACPmT,OAAO,CACR;QACH;MACF,CAAC,MAAM;QACL,OAAO5G,MAAM,CAACyB,UAAU,CAAC3M,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,iCAAiC,GAAGmD,IAAI,CAAC,CAAC;MACxG;MACA,IAAI/C,gBAAgB,EAAEA,gBAAgB,CAAC8C,EAAE,EAAE;QAAEE,MAAM,EAAE,QAAQ;QAAEiD,KAAK,EAAE;MAAS,CAAC,CAAC;IACnF,CAAC,CAAC;EACJ,CAAC;EAED,IAAMqG,MAAM,GAAG1M,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;EAC1CmL,MAAM,CAACpK,YAAY,CAAC,OAAO,EAAEC,KAAK,CAACiR,eAAe,CAAC;EACnD,IAAIrB,OAAO,CAACsB,QAAQ,EAAE/G,MAAM,CAACpK,YAAY,CAAC,UAAU,EAAE,MAAM,CAAC;EAC7DoK,MAAM,CAACwG,UAAU,GAAG,IAAI;EAExBxG,MAAM,CAAC9G,OAAO,GAAG,YAAY;IAC3B4M,MAAM,GAAGC,SAAS,EAAE,EAAC;IACrB,KAAK,IAAI1P,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG2J,MAAM,CAAClM,QAAQ,CAACE,MAAM,EAAEqC,GAAC,EAAE,EAAE;MAC/C,IAAM2Q,MAAM,GAAGhH,MAAM,CAAClM,QAAQ,CAACuC,GAAC,CAAC;MACjC,IAAI2Q,MAAM,CAACT,QAAQ,EAAE;QACnBS,MAAM,CAACjH,QAAQ,GAAGiH,MAAM,CAACT,QAAQ,IAAIT,MAAM;MAC7C;IACF;IACA9F,MAAM,CAAC8E,QAAQ,GAAG,KAAK,EAAC;EAC1B,CAAC;;EAED,KAAK,IAAM3R,GAAG,IAAIwS,IAAI,EAAE;IACtB,IAAMpO,CAAC,GAAGzE,EAAE,CAACwE,GAAG,CAACnE,GAAG,CAAC;IACrB,IAAM6T,MAAM,GAAG1T,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IAC1C,IAAI4Q,OAAO,CAACjH,YAAY,EAAE;MACxBwI,MAAM,CAAClS,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACsG,KAAK,CAAC0L,iBAAiB,CAAC1P,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAC;IAC3E,CAAC,MAAM;MACLyP,MAAM,CAAClS,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACsG,KAAK,CAACC,KAAK,CAACjE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAC;IAC/D;;IACA,IAAM+N,eAAe,GAAGxS,EAAE,CAACyC,GAAG,CAC5BgC,CAAC,EACDzE,EAAE,CAACwE,GAAG,CAAC,yCAAyC,CAAC,CAClD;IACD,IAAIgO,eAAe,EAAE;MACnB0B,MAAM,CAACpR,YAAY,CACjB,OAAO,EACP,oBAAoB,GAAG0P,eAAe,CAAC5P,KAAK,GAAG,IAAI,CACpD;IACH;IACAsR,MAAM,CAACT,QAAQ,GAAGpT,GAAG;IACrB,IAAIA,GAAG,IAAI2S,MAAM,EAAE;MACjBkB,MAAM,CAACpR,YAAY,CAAC,UAAU,EAAE,MAAM,CAAC;MACvCoK,MAAM,CAACwG,UAAU,GAAGrT,GAAG;MACvB;IACF;;IACA6M,MAAM,CAAClL,WAAW,CAACkS,MAAM,CAAC;EAC5B;EACA,IAAI/M,QAAQ,IAAIwL,OAAO,CAACrG,IAAI,EAAE;IAC5B,IAAMA,IAAI,GAAG9L,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IACxCuK,IAAI,CAACtK,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACwQ,OAAO,CAACrG,IAAI,CAAC,CAAC;IAClDA,IAAI,CAAC+G,SAAS,GAAG,IAAI,EAAC;IACtBnG,MAAM,CAACxL,YAAY,CAAC4K,IAAI,EAAEY,MAAM,CAACkH,UAAU,CAAC;EAC9C;EACA,IAAIlH,MAAM,CAACwG,UAAU,IAAI,IAAI,IAAI,CAACf,OAAO,CAACsB,QAAQ,EAAE;IAClD,IAAMlL,MAAM,GAAGvI,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IAC1CgH,MAAM,CAAC/G,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACwQ,OAAO,CAAC0B,SAAS,CAAC,CAAC;IACzDnH,MAAM,CAACxL,YAAY,CAACqH,MAAM,EAAEmE,MAAM,CAACkH,UAAU,CAAC;IAC9CrL,MAAM,CAACkE,QAAQ,GAAG,IAAI;EACxB;EACA,IAAI9F,QAAQ,EAAE;IACZ+F,MAAM,CAACjE,gBAAgB,CAAC,QAAQ,EAAEiK,QAAQ,EAAE,KAAK,CAAC;EACpD;EACA,OAAOhG,MAAM;AACf,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASoH,oBAAoB,CAClC9T,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACTxD,QAAQ,EACR+G,OAAO,EACPhS,OAAO,EACPC,gBAAgB,EAChB;EACAa,GAAG,CAACD,KAAK,CAAC,yBAAyB,GAAGoK,QAAQ,CAAC1K,MAAM,CAAC;EACtD,IAAI0R,CAAC,GAAG,CAAC;EACT,IAAMC,IAAI,GAAG,CAAC,CAAC,EAAC;EAChB,IAAM1L,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EAEjD,KAAK,IAAIkD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGqI,QAAQ,CAAC1K,MAAM,EAAEqC,CAAC,EAAE,EAAE;IACxC,IAAMuP,GAAG,GAAGlH,QAAQ,CAACrI,CAAC,CAAC,EAAC;IACxB,IAAI,CAACuP,GAAG,CAACzS,GAAG,EAAEmB,KAAK,CAACuR,IAAI,8DAAuDD,GAAG,+BAAqB1D,SAAS,EAAG;IACnH,IAAI,CAAC0D,GAAG,CAACzS,GAAG,IAAIyS,GAAG,CAACzS,GAAG,IAAIwS,IAAI,EAAE;IACjCA,IAAI,CAACC,GAAG,CAACzS,GAAG,CAAC,GAAG,IAAI;IACpBuS,CAAC,EAAE;EACL,CAAC,CAAC;EACF,IAAIA,CAAC,KAAK,CAAC,EAAE;IACX,OAAO,IAAA/P,wBAAiB,EACtBrC,GAAG,EACH,8CAA8C,GAC5CE,OAAO,GACP,cAAc,GACd0O,SAAS,GACT,GAAG,CACN;EACH;EAEA3N,GAAG,CAACD,KAAK,CAAC,gCAAgC,GAAGb,OAAO,CAAC;EACrD,IAAIqS,MAAM;EACV,IAAMC,SAAS,GAAG,SAAZA,SAAS,GAAe;IAC5BD,MAAM,GAAG,CAAC,CAAC;IACX,IAAI5D,SAAS,CAAClL,QAAQ,CAAC/D,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,CAAC,EAAE;MACtCiP,MAAM,GAAGhT,EAAE,CAACqE,YAAY,CAAC3D,OAAO,CAAC;IACnC,CAAC,MAAM;MACLV,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAE0O,SAAS,EAAE,IAAI,EAAEzO,OAAO,CAAC,CAACqO,OAAO,CAAC,UAAU3M,CAAC,EAAE;QAC9D,IAAIA,CAAC,CAAChC,GAAG,EAAE;UACT2S,MAAM,CAAC3Q,CAAC,CAAChC,GAAG,CAAC,GAAG,IAAI;QACtB;MACF,CAAC,CAAC;IACJ;IACA,OAAO2S,MAAM;EACf,CAAC;EACDA,MAAM,GAAGC,SAAS,EAAE;EAEpB,IAAMC,QAAQ,GAAG,SAAXA,QAAQ,CAAazE,EAAE,EAAE;IAC7BvB,MAAM,CAAC8E,QAAQ,GAAG,IAAI,EAAC;IACvB,IAAMG,EAAE,GAAG,EAAE;IACb,IAAMvE,EAAE,GAAG,EAAE;IACb,IAAMuF,WAAW,GAAG,SAAdA,WAAW,CAAahS,CAAC,EAAE;MAC/B,IAAInB,EAAE,CAACwG,KAAK,CAAC9F,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,EAAE;QAC5CwR,EAAE,CAACzM,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,CAAC;MAClD;IACF,CAAC;IACD,KAAK,IAAI4C,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG2J,MAAM,CAACyF,OAAO,CAACzR,MAAM,EAAEqC,GAAC,EAAE,EAAE;MAC9C,IAAM6P,GAAG,GAAGlG,MAAM,CAACyF,OAAO,CAACpP,GAAC,CAAC;MAC7B,IAAI,CAAC6P,GAAG,CAACK,QAAQ,EAAE,SAAQ,CAAC;MAC5B,IAAIL,GAAG,CAACnG,QAAQ,IAAI,EAAEmG,GAAG,CAACK,QAAQ,IAAIT,MAAM,CAAC,EAAE;QAC7C;QACApF,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEpP,EAAE,CAACwE,GAAG,CAAC4O,GAAG,CAACK,QAAQ,CAAC,EAAE9S,OAAO,CAAC,CAAC;MACrE;MACA,IAAI,CAACyS,GAAG,CAACnG,QAAQ,IAAImG,GAAG,CAACK,QAAQ,IAAIT,MAAM,EAAE;QAC3C;QACAG,WAAW,CAACnT,EAAE,CAACwE,GAAG,CAAC4O,GAAG,CAACK,QAAQ,CAAC,CAAC;MACnC;MACA,IAAIL,GAAG,CAACnG,QAAQ,EAAEC,MAAM,CAACwG,UAAU,GAAGN,GAAG,CAACK,QAAQ;IACpD;IACA,IAAIE,GAAG,GAAGzG,MAAM,CAAC0G,SAAS,EAAC;IAC3B,OAAOD,GAAG,IAAIA,GAAG,CAACD,UAAU,EAAE;MAC5BP,WAAW,CAACnT,EAAE,CAACwE,GAAG,CAACmP,GAAG,CAACD,UAAU,CAAC,CAAC;MACnCC,GAAG,GAAGA,GAAG,CAACC,SAAS;IACrB;IACAD,GAAG,GAAGzG,MAAM,CAAC2G,WAAW,EAAC;IACzB,OAAOF,GAAG,IAAIA,GAAG,CAACD,UAAU,EAAE;MAC5BP,WAAW,CAACnT,EAAE,CAACwE,GAAG,CAACmP,GAAG,CAACD,UAAU,CAAC,CAAC;MACnCC,GAAG,GAAGA,GAAG,CAACE,WAAW;IACvB;IACApS,GAAG,CAACyP,IAAI,CAAC,+BAA+B,GAAGvQ,OAAO,CAAC;IACnDX,EAAE,CAACgG,OAAO,CAACC,MAAM,CAACkM,EAAE,EAAEvE,EAAE,EAAE,UAAUvN,GAAG,EAAEqD,EAAE,EAAEC,IAAI,EAAE;MACjDqP,MAAM,GAAGC,SAAS,EAAE,EAAC;MACrB,IAAIvP,EAAE,EAAE;QACNwJ,MAAM,CAAC8E,QAAQ,GAAG,KAAK,EAAC;MAC1B,CAAC,MAAM;QACL,OAAO9E,MAAM,CAACyB,UAAU,CAAC3M,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,iCAAiC,GAAGmD,IAAI,CAAC,CAAC;MACxG;MACA,IAAI/C,gBAAgB,EAAEA,gBAAgB,CAAC8C,EAAE,EAAE;QAAEE,MAAM,EAAE,QAAQ;QAAEiD,KAAK,EAAE;MAAS,CAAC,CAAC;IACnF,CAAC,CAAC;EACJ,CAAC;EAED,IAAMqG,MAAM,GAAG1M,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;EAC1CmL,MAAM,CAACpK,YAAY,CAAC,OAAO,EAAEC,KAAK,CAACiR,eAAe,CAAC;EACnD9G,MAAM,CAACwG,UAAU,GAAG,IAAI;EAExBxG,MAAM,CAAC9G,OAAO,GAAG,YAAY;IAC3B4M,MAAM,GAAGC,SAAS,EAAE,EAAC;IACrB,KAAK,IAAI1P,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG2J,MAAM,CAAClM,QAAQ,CAACE,MAAM,EAAEqC,GAAC,EAAE,EAAE;MAC/C,IAAM2Q,MAAM,GAAGhH,MAAM,CAAClM,QAAQ,CAACuC,GAAC,CAAC;MACjC,IAAI2Q,MAAM,CAACT,QAAQ,EAAE;QACnBS,MAAM,CAACjH,QAAQ,GAAGiH,MAAM,CAACT,QAAQ,IAAIT,MAAM;MAC7C;IACF;IACA9F,MAAM,CAAC8E,QAAQ,GAAG,KAAK,EAAC;EAC1B,CAAC;;EAED,KAAK,IAAM3R,GAAG,IAAIwS,IAAI,EAAE;IACtB,IAAMpO,CAAC,GAAGzE,EAAE,CAACwE,GAAG,CAACnE,GAAG,CAAC;IACrB,IAAM6T,MAAM,GAAG1T,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IAC1C,IAAI4Q,OAAO,CAACjH,YAAY,EAAE;MACxBwI,MAAM,CAAClS,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACsG,KAAK,CAAC0L,iBAAiB,CAAC1P,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAC;IAC3E,CAAC,MAAM;MACLyP,MAAM,CAAClS,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACsG,KAAK,CAACC,KAAK,CAACjE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAC;IAC/D;;IACA,IAAM+N,eAAe,GAAGxS,EAAE,CAACyC,GAAG,CAC5BgC,CAAC,EACDzE,EAAE,CAACwE,GAAG,CAAC,yCAAyC,CAAC,CAClD;IACD,IAAIgO,eAAe,EAAE;MACnB0B,MAAM,CAACpR,YAAY,CACjB,OAAO,EACP,oBAAoB,GAAG0P,eAAe,CAAC5P,KAAK,GAAG,IAAI,CACpD;IACH;IACAsR,MAAM,CAACT,QAAQ,GAAGpT,GAAG;IACrB,IAAIA,GAAG,IAAI2S,MAAM,EAAE;MACjBkB,MAAM,CAACpR,YAAY,CAAC,UAAU,EAAE,MAAM,CAAC;MACvCoK,MAAM,CAACwG,UAAU,GAAGrT,GAAG;MACvB;IACF;;IACA6M,MAAM,CAAClL,WAAW,CAACkS,MAAM,CAAC;EAC5B;EACA,IAAI,CAAChH,MAAM,CAACwG,UAAU,EAAE;IACtB,IAAM3K,MAAM,GAAGvI,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IAC1CgH,MAAM,CAAC/G,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACwQ,OAAO,CAAC0B,SAAS,CAAC,CAAC;IACzDnH,MAAM,CAACxL,YAAY,CAACqH,MAAM,EAAEmE,MAAM,CAACkH,UAAU,CAAC;IAC9CrL,MAAM,CAACkE,QAAQ,GAAG,IAAI;EACxB;EACA,IAAI9F,QAAQ,EAAE;IACZ+F,MAAM,CAACjE,gBAAgB,CAAC,QAAQ,EAAEiK,QAAQ,EAAE,KAAK,CAAC;EACpD;EACA,OAAOhG,MAAM;AACf,CAAC,CAAC;;AAEF;AACA;AACA;AACA;AACA;;AAEO,SAASqH,qBAAqB,CACnC/T,GAAG,EACHR,EAAE,EACFU,OAAO,EACPuK,QAAQ,EACRtK,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAM4T,EAAE,GAAGxU,EAAE,CAACyC,GAAG,CAACwI,QAAQ,EAAE9K,EAAE,CAACkM,GAAG,CAAC,iBAAiB,CAAC,CAAC;EACtD,IAAIoI,IAAI;EACR,IAAIR,QAAQ,GAAG,KAAK;EACpB,IAAI,CAACO,EAAE,EAAE;IACPC,IAAI,GAAGzU,EAAE,CAACqD,IAAI,CAACyH,SAAS,EAAE3K,EAAE,CAAC6L,IAAI,CAAC,YAAY,CAAC,EAAEf,QAAQ,CAAC;IAC1DgJ,QAAQ,GAAG,IAAI;EACjB,CAAC,MAAM;IACLQ,IAAI,GAAGD,EAAE,CAACpR,QAAQ;EACpB;EACA3B,GAAG,CAACD,KAAK,CAAC,qBAAqB,GAAGiT,IAAI,CAACvT,MAAM,CAAC;EAC9C,IAAIuT,IAAI,CAACvT,MAAM,KAAK,CAAC,EAAE;IACrB,OAAO,IAAA2B,wBAAiB,EACtBrC,GAAG,EACH,WAAW,IACRyT,QAAQ,GAAG,WAAW,GAAG,EAAE,CAAC,GAC7B,2CAA2C,GAC3ChJ,QAAQ,CACX;EACH;EACA,IAAIwJ,IAAI,CAACvT,MAAM,KAAK,CAAC,EAAE;IACrB,OAAO,IAAA2B,wBAAiB,EACtBrC,GAAG,EACH,WAAW,IACRyT,QAAQ,GAAG,WAAW,GAAG,EAAE,CAAC,GAC7B,6CAA6C,GAC7ChJ,QAAQ,GACR,GAAG,GACHwJ,IAAI,CAAC,CAAC,CAAC,CACV;EACH;EACA,OAAO/B,8BAA8B,CACnClS,GAAG,EACHR,EAAE,EACFU,OAAO,EACPP,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EACd0Q,IAAI,EACJ;IAAER,QAAQ,EAARA,QAAQ;IAAEI,SAAS,EAAE;EAAkB,CAAC,EAC1C1T,OAAO,EACPC,gBAAgB,CACjB;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASuK,2BAA2B,CACzC3K,GAAG,EACHR,EAAE,EACFU,OAAO,EACPuK,QAAQ,EACRtK,OAAO,EACPC,gBAAgB,EAChB;EACA,SAASqF,MAAM,GAAI;IACjB,IAAIyO,KAAK,EAAE;MACT9S,SAAS,CAACD,WAAW,CAAC+S,KAAK,CAAC;MAC5BA,KAAK,GAAG,IAAI;IACd;IACA,IACExH,MAAM,CAACwG,UAAU,IACjB1T,EAAE,CAACyC,GAAG,CAACzC,EAAE,CAACwE,GAAG,CAAC0I,MAAM,CAACwG,UAAU,CAAC,EAAEvT,EAAE,CAACkM,GAAG,CAAC,iBAAiB,CAAC,CAAC,EAC5D;MACAqI,KAAK,GAAGvJ,2BAA2B,CACjC3K,GAAG,EACHR,EAAE,EACFU,OAAO,EACPV,EAAE,CAACwE,GAAG,CAAC0I,MAAM,CAACwG,UAAU,CAAC,EACzB/S,OAAO,EACPC,gBAAgB,CACjB;MACDsM,MAAM,CAAC0G,SAAS,GAAGc,KAAK,CAACN,UAAU;MACnClH,MAAM,CAAC0G,SAAS,CAACC,WAAW,GAAG3G,MAAM;MACrCtL,SAAS,CAACI,WAAW,CAAC0S,KAAK,CAAC;IAC9B;EACF;EAEA,IAAM9S,SAAS,GAAGpB,GAAG,CAACuB,aAAa,CAAC,MAAM,CAAC,EAAC;EAC5C,IAAI2S,KAAK,GAAG,IAAI;EAEhB,SAASxB,QAAQ,CAAExP,EAAE,EAAEC,IAAI,EAAE;IAC3B,IAAID,EAAE,EAAEuC,MAAM,EAAE;IAChBrF,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,CAAC;EAC5B;EACA,IAAMuJ,MAAM,GAAGqH,qBAAqB,CAClC/T,GAAG,EACHR,EAAE,EACFU,OAAO,EACPuK,QAAQ,EACRtK,OAAO,EACPuS,QAAQ,CACT;EACDtR,SAAS,CAACI,WAAW,CAACkL,MAAM,CAAC;EAC7BjH,MAAM,EAAE;EACR,OAAOrE,SAAS;AAClB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASoJ,iBAAiB,CAAExK,GAAG,EAAER,EAAE,EAAE4K,GAAG,EAAEnE,GAAG,EAAEsE,GAAG,EAAElJ,IAAI,EAAElB,OAAO,EAAE+J,QAAQ,EAAE;EAClF,IAAM5I,GAAG,GAAGtB,GAAG,CAACuB,aAAa,CAAC,KAAK,CAAC;EACpC,IAAMuJ,GAAG,GAAG,IAAAqJ,0BAAmB,EAACnU,GAAG,EAAER,EAAE,EAAE8B,GAAG,EAAED,IAAI,EAAE+I,GAAG,CAAC;EACxD,IAAMzD,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EAEjD,IAAMuU,KAAK,GAAGpU,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;EACzC,IAAM8S,YAAY,GAAGD,KAAK;EAC1BA,KAAK,CAAC7R,KAAK,GAAGA,KAAK,CAAC+R,kBAAkB;EACtCxJ,GAAG,CAACtJ,WAAW,CAAC4S,KAAK,CAAC;EAEtB,SAASG,GAAG,CAAE1S,CAAC,EAAE;IACf,IAAI,CAACA,CAAC,EAAE,OAAO,EAAE,EAAC;IAClB,IAAIA,CAAC,CAACgD,MAAM,EAAE;MACZ,IAAI,CAAChD,CAAC,CAAC2S,GAAG,EAAE;QACV3S,CAAC,CAAC2S,GAAG,GAAGrU,OAAO,EAAC;MAClB;;MACA,OAAO,CAAC0B,CAAC,CAAC,EAAC;IACb;;IACA,IAAIA,CAAC,YAAY4S,KAAK,EAAE,OAAO5S,CAAC;IAChC,MAAM,IAAI6S,KAAK,CAAC,+BAA+B,GAAG7S,CAAC,CAAC;EACtD;EACA0I,GAAG,GAAGgK,GAAG,CAAChK,GAAG,CAAC;EACdtE,GAAG,GAAGsO,GAAG,CAACtO,GAAG,CAAC;EAEd,SAAS0O,QAAQ,CAAE/E,CAAC,EAAE;IACpB,IAAMgF,OAAO,GAAGhF,CAAC,CAAC5C,MAAM,CACtB,UAAA1H,EAAE;MAAA,OAAI,CAAC9F,EAAE,CAACwG,KAAK,CAACV,EAAE,CAACpF,OAAO,EAAEoF,EAAE,CAACsJ,SAAS,EAAEtJ,EAAE,CAACT,MAAM,EAAES,EAAE,CAACkP,GAAG,CAAC;IAAA,EAC7D;IACD,OAAOI,OAAO,CAAClU,MAAM,KAAK,CAAC;EAC7B;EACA,SAASkF,OAAO,GAAI;IAClB,IAAIyE,KAAK,GAAGsK,QAAQ,CAACpK,GAAG,CAAC;IACzB,IAAIsK,YAAY,GAAGxK,KAAK;IACxB,IAAIpE,GAAG,CAACvF,MAAM,EAAE;MACd,IAAMoU,QAAQ,GAAGH,QAAQ,CAAC1O,GAAG,CAAC;MAC9B,IAAIoE,KAAK,IAAIyK,QAAQ,EAAE;QACrBxT,GAAG,CAACE,WAAW,CACbqQ,OAAO,CAACxP,iBAAiB,CACvBrC,GAAG,EACH,iCAAiC,GAAGuK,GAAG,GAAG,QAAQ,GAAGtE,GAAG,CACzD,CACF;QACD,OAAO3E,GAAG;MACZ;MACA,IAAI,CAAC+I,KAAK,IAAI,CAACyK,QAAQ,EAAE;QACvBzK,KAAK,GAAG,IAAI;QACZ,IAAM0K,IAAI,GAAGvV,EAAE,CAACyC,GAAG,CAACZ,IAAI,EAAE1B,EAAE,CAACC,EAAE,CAAC,SAAS,CAAC,CAAC;QAC3CiV,YAAY,GAAGE,IAAI,GAAGA,IAAI,CAAC3S,KAAK,KAAK,GAAG,GAAG8H,QAAQ,GAAG,IAAI,GAAG,KAAK;MACpE;IACF;IACAkK,KAAK,CAAC/J,KAAK,GAAGA,KAAK;IACnB+J,KAAK,CAAC5L,WAAW,GAAG;MAClB,QAAMnJ,kBAAkB;MACxB,SAAO6K,QAAQ,GAAG5K,eAAe,GAAG,GAAG;MAAE;MACzC,QAAMC;IACR,CAAC,CAACsV,YAAY,CAAC;EACjB;EAEAjP,OAAO,EAAE;EACT,IAAI,CAACe,QAAQ,EAAE,OAAOrF,GAAG;EAEzB,IAAM0T,UAAU,GAAG,SAAbA,UAAU,CAAa/G,EAAE,EAAE;IAC/BoG,YAAY,CAAC9R,KAAK,CAACkP,KAAK,GAAG,MAAM,EAAC;IAClC,IAAMwD,QAAQ,GAAGb,KAAK,CAAC/J,KAAK,KAAK,IAAI,GAAGE,GAAG,GAAG6J,KAAK,CAAC/J,KAAK,KAAK,KAAK,GAAGpE,GAAG,GAAG,EAAE;IAC9EmO,KAAK,CAACc,QAAQ,GACZd,KAAK,CAAC/J,KAAK,KAAK,IAAI,GAChB,IAAI,GACJ+J,KAAK,CAAC/J,KAAK,KAAK,IAAI,GAClB,KAAK,GACLH,QAAQ,GACN,IAAI,GACJ,IAAI;IAEd,IAAMiL,QAAQ,GACZf,KAAK,CAACc,QAAQ,KAAK,IAAI,GAAG3K,GAAG,GAAG6J,KAAK,CAACc,QAAQ,KAAK,KAAK,GAAGjP,GAAG,GAAG,EAAE;IACrEjF,KAAK,CAACC,GAAG,uBAAgBgU,QAAQ,EAAG;IACpCjU,KAAK,CAACC,GAAG,uBAAgBkU,QAAQ,EAAG;IACpC3V,EAAE,CAACgG,OAAO,CAACC,MAAM,CAACwP,QAAQ,EAAEE,QAAQ,EAAE,UACpCtV,GAAG,EACHyN,OAAO,EACPC,SAAS,EACT;MACA,IAAI,CAACD,OAAO,EAAE;QACZ,IAAI2H,QAAQ,CAACT,GAAG,EAAE;UAChB,IAAMY,IAAI,GAAG5V,EAAE,CAACwG,KAAK,CACnBiP,QAAQ,CAAC/U,OAAO,EAChB+U,QAAQ,CAACrG,SAAS,EAClBqG,QAAQ,CAACpQ,MAAM,EACfoQ,QAAQ,CAACT,GAAG,CACb;UACD,IAAIY,IAAI,EAAE;YACRpU,KAAK,CAACC,GAAG,CAAC,2CAA2C,CAAC;UACxD;QACF;QACAoT,YAAY,CAAC9R,KAAK,CAACkP,KAAK,GAAG,MAAM;QACjC4C,YAAY,CAAC9R,KAAK,CAACyP,eAAe,GAAG,MAAM;QAC3C1Q,GAAG,CAACE,WAAW,CACb,IAAAa,wBAAiB,EACfrC,GAAG,kDACsCoU,KAAK,CAAC/J,KAAK,iBAClD+J,KAAK,CAACc,QAAQ,kBACR3H,SAAS,EAClB,CACF;MACH,CAAC,MAAM;QACL8G,YAAY,CAAC9R,KAAK,CAACkP,KAAK,GAAG,MAAM;QACjC2C,KAAK,CAAC/J,KAAK,GAAG+J,KAAK,CAACc,QAAQ;QAC5Bd,KAAK,CAAC5L,WAAW,GAAG;UAClB,QAAMnJ,kBAAkB;UACxB,SAAOC,eAAe;UACtB,QAAMC;QACR,CAAC,CAAC6U,KAAK,CAAC/J,KAAK,CAAC,EAAC;MACjB;IACF,CAAC,CAAC;EACJ,CAAC;;EACD+J,KAAK,CAAC3L,gBAAgB,CAAC,OAAO,EAAEuM,UAAU,EAAE,KAAK,CAAC;EAClD,OAAO1T,GAAG;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASwD,QAAQ,CAAE/C,GAAG,EAAE;EAC7B,IAAMsT,GAAG,GAAG,IAAIC,IAAI,EAAE;EACtB,OAAOvR,IAAI,CAACC,GAAG,CAACjC,GAAG,CAAClC,GAAG,GAAG,GAAG,GAAG,IAAI,IAAI,EAAE,GAAGwV,GAAG,CAACE,OAAO,EAAE,CAAC,CAAC;AAC9D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASnJ,mBAAmB,CACjCpM,GAAG,EACHoB,SAAS,EACT5B,EAAE,EACFU,OAAO,EACP0O,SAAS,EACT4G,oBAAoB,EACpBvJ,eAAe,EACflB,MAAM,EACNoH,OAAO,EACPhS,OAAO,EACPC,gBAAgB,EAChB;EACA,IAAMqV,sBAAsB,GAAG,CAAC,CAAC,EAAC;EAClC,IAAM9O,QAAQ,GAAGnH,EAAE,CAACgG,OAAO,CAACmB,QAAQ,CAACxG,OAAO,CAACN,GAAG,CAAC;EAEjD,KAAK,IAAIkD,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGyS,oBAAoB,CAAC9U,MAAM,EAAEqC,CAAC,EAAE,EAAE;IACpD,IAAMuP,GAAG,GAAGkD,oBAAoB,CAACzS,CAAC,CAAC,EAAC;IACpC;IACA,IAAI,CAACuP,GAAG,CAACzS,GAAG,IAAIyS,GAAG,CAACzS,GAAG,IAAI4V,sBAAsB,EAAE;IACnDA,sBAAsB,CAACnD,GAAG,CAACzS,GAAG,CAAC,GAAG,IAAI;EACxC;EACA,IAAM6V,OAAO,GAAG/R,MAAM,CAACC,IAAI,CAAC6R,sBAAsB,CAAC,CAAC/U,MAAM,KAAK,CAAC;EAChE,IAAIgV,OAAO,IAAI,CAACvD,OAAO,CAACrG,IAAI,EAAE;IAC5B,OAAO,IAAAzJ,wBAAiB,EACtBrC,GAAG,EACH,8CAA8C,GAC5CE,OAAO,GACP,cAAc,GACd0O,SAAS,GACT,GAAG,CACN;EACH;EAEA3N,GAAG,CAACD,KAAK,CAAC,+BAA+B,GAAGb,OAAO,CAAC;EAEpD,SAASwV,6BAA6B,GAAI;IACxC,IAAIC,qBAAqB,GAAG,gBAAgB;IAE5C,IAAIhH,SAAS,IAAI,EAAEA,SAAS,CAACvK,QAAQ,KAAK,WAAW,CAAC,EAAE;MACtDuR,qBAAqB,GAAG,yBAAyB,GAAG3N,KAAK,CAACC,KAAK,CAAC0G,SAAS,CAAC,GAAG,IAAI;IACnF;IAEA,IAAI1O,OAAO,IAAI,EAAEA,OAAO,CAACmE,QAAQ,KAAK,WAAW,CAAC,EAAE;MAClDuR,qBAAqB,GAAG,eAAe,GAAG3N,KAAK,CAACC,KAAK,CAAChI,OAAO,EAAE,IAAI,CAAC,GAAG,IAAI;IAC7E;IACA,OAAO0V,qBAAqB;EAC9B;EAEA,SAASC,yBAAyB,GAAI;IACpC,IAAMnC,MAAM,GAAG1T,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IAC1CmS,MAAM,CAAClS,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACgU,6BAA6B,EAAE,CAAC,CAAC;IACvEjC,MAAM,CAAClC,QAAQ,GAAG,IAAI;IACtBkC,MAAM,CAACtR,KAAK,GAAG,IAAI;IACnBsR,MAAM,CAACoC,MAAM,GAAG,IAAI;IACpBpC,MAAM,CAACjH,QAAQ,GAAG,IAAI;IAEtB,OAAOiH,MAAM;EACf;EAEA,IAAMhB,QAAQ,GAAG,SAAXA,QAAQ,CAAazE,EAAE,EAAE;IAC7B7M,SAAS,CAACD,WAAW,CAACC,SAAS,CAAC2U,SAAS,CAAC;IAC1CrJ,MAAM,CAAC9G,OAAO,EAAE;EAClB,CAAC;EAED,IAAM8G,MAAM,GAAG1M,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;EAC1CmL,MAAM,CAACpK,YAAY,CAAC,OAAO,EAAEC,KAAK,CAACiR,eAAe,CAAC;EACnD9G,MAAM,CAACpK,YAAY,CAAC,IAAI,EAAE,YAAY,CAAC;EACvCoK,MAAM,CAACwG,UAAU,GAAG,IAAI;EAExB,KAAK,IAAMrT,GAAG,IAAI4V,sBAAsB,EAAE;IACxC/I,MAAM,CAAClL,WAAW,CAACwU,YAAY,CAACnW,GAAG,CAAC,CAAC;EACvC;EAEA,IAAI8G,QAAQ,IAAIwL,OAAO,CAACrG,IAAI,EAAE;IAC5B,IAAMA,IAAI,GAAG9L,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IACxCuK,IAAI,CAACtK,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACwQ,OAAO,CAACrG,IAAI,CAAC,CAAC;IAClDA,IAAI,CAAC+G,SAAS,GAAG,IAAI,EAAC;IACtBnG,MAAM,CAACxL,YAAY,CAAC4K,IAAI,EAAEY,MAAM,CAACkH,UAAU,CAAC;EAC9C;EAEA,IAAIlH,MAAM,CAAClM,QAAQ,CAACE,MAAM,KAAK,CAAC,EAAEgM,MAAM,CAACxL,YAAY,CAAC2U,yBAAyB,EAAE,EAAEnJ,MAAM,CAACkH,UAAU,CAAC;EAErGlH,MAAM,CAACjH,MAAM,GAAG,UAAUwQ,kBAAkB,EAAE;IAC5ChK,eAAe,GAAGgK,kBAAkB;IACpC,IAAMtE,EAAE,GAAG,EAAE;IACb,IAAMvE,EAAE,GAAG,EAAE;IACb,IAAMuF,WAAW,GAAG,SAAdA,WAAW,CAAahS,CAAC,EAAE;MAC/B,IAAInB,EAAE,CAACwG,KAAK,CAAC9F,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,EAAE;QAC5CwR,EAAE,CAACzM,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,CAAC;MAClD;IACF,CAAC;IAED,IAAM+V,QAAQ,GAAG,SAAXA,QAAQ,CAAavV,CAAC,EAAE;MAC5B,IAAI,CAACnB,EAAE,CAACwG,KAAK,CAAC9F,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,EAAE;QAC7CiN,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEjO,CAAC,EAAER,OAAO,CAAC,CAAC;QAChD;MACF;;MACA,IAAI4K,MAAM,IAAK,CAACvL,EAAE,CAACwG,KAAK,CAACrF,CAAC,EAAEhB,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAE/D,EAAE,CAACwE,GAAG,CAAC+G,MAAM,CAAC,EAAE5K,OAAO,CAAE,EAAE;QACrEiN,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAAC3E,CAAC,EAAEhB,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAE/D,EAAE,CAACwE,GAAG,CAAC+G,MAAM,CAAC,EAAE5K,OAAO,CAAC,CAAC;QAC5D;MACF;IACF,CAAC;;IAED,IAAMgW,cAAc,GAAG3W,EAAE,CAACqD,IAAI,CAAC3C,OAAO,EAAE0O,SAAS,EAAE,IAAI,EAAEzO,OAAO,CAAC,CAAC2D,GAAG,CAAC,UAAAe,MAAM;MAAA,OAAIA,MAAM,CAACzC,KAAK;IAAA,EAAC;IAAA,4CACzE+T,cAAc;MAAA;IAAA;MAAlC,uDAAoC;QAAA,IAAzB/T,KAAK;QACd,IAAI,CAACgU,cAAc,CAAChU,KAAK,EAAE6J,eAAe,CAAC,EAAE0G,WAAW,CAAC5O,IAAI,CAACC,GAAG,CAAC5B,KAAK,CAAC,CAAC;MAC3E;IAAC;MAAA;IAAA;MAAA;IAAA;IAAA,4CACmB6J,eAAe;MAAA;IAAA;MAAnC,uDAAqC;QAAA,IAA1B7J,MAAK;QACd,IAAI,EAAEA,MAAK,IAAI+T,cAAc,CAAC,EAAED,QAAQ,CAACnS,IAAI,CAACC,GAAG,CAAC5B,MAAK,CAAC,CAAC;MAC3D;IAAC;MAAA;IAAA;MAAA;IAAA;IAED5C,EAAE,CAACgG,OAAO,CAACC,MAAM,CAACkM,EAAE,EAAEvE,EAAE,EAAE,UAAUvN,GAAG,EAAEqD,EAAE,EAAEC,IAAI,EAAE;MACjD,IAAI,CAACD,EAAE,EAAE,OAAOwJ,MAAM,CAACyB,UAAU,CAAC3M,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,iCAAiC,GAAGmD,IAAI,CAAC,CAAC;MAC/GuJ,MAAM,CAAC9G,OAAO,EAAE;MAChB,IAAIxF,gBAAgB,EAAEA,gBAAgB,CAAC8C,EAAE,EAAE;QAAEE,MAAM,EAAE,QAAQ;QAAEiD,KAAK,EAAE;MAAS,CAAC,CAAC;IACnF,CAAC,CAAC;EACJ,CAAC;EAEDqG,MAAM,CAAC9G,OAAO,GAAG,YAAY;IAC3B8G,MAAM,CAAC8E,QAAQ,GAAG,IAAI,EAAC;IACvB,IAAIpE,EAAE,GAAG,EAAE;IAEX,IAAID,SAAS;IACb,KAAK,IAAIpK,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG2J,MAAM,CAACyF,OAAO,CAACzR,MAAM,EAAEqC,GAAC,EAAE,EAAE;MAC9C,IAAM6P,GAAG,GAAGlG,MAAM,CAACyF,OAAO,CAACpP,GAAC,CAAC;MAC7B,IAAI6P,GAAG,CAACnG,QAAQ,IAAImG,GAAG,CAACC,SAAS,EAAE;QACjC;QACA,IAAIV,OAAO,CAACW,SAAS,EAAE;UACrB,IAAMC,QAAQ,GAAG9C,YAAY,CAC3BjQ,GAAG,EACHR,EAAE,EACFU,OAAO,EACP0O,SAAS,EACT7D,MAAM,EACNoH,OAAO,CAACnH,OAAO,EACf7K,OAAO,EACP,UAAU+C,EAAE,EAAEC,IAAI,EAAE;YAClB,IAAI,CAACD,EAAE,EAAE;cACP9C,gBAAgB,CAAC8C,EAAE,EAAEC,IAAI,EAAE;gBAAEE,MAAM,EAAE;cAAM,CAAC,CAAC,EAAC;YAChD;UACF,CAAC,CACF;;UACDqJ,MAAM,CAACyB,UAAU,CAAC3M,WAAW,CAACuR,QAAQ,CAAC;UACvC5F,SAAS,GAAG4F,QAAQ,CAACjC,YAAY;QACnC,CAAC,MAAM;UACL3D,SAAS,GAAGrI,QAAQ,CAAC3E,OAAO,CAAC;QAC/B;QACAiN,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAACpF,OAAO,EAAE0O,SAAS,EAAEpP,EAAE,CAACwE,GAAG,CAACmJ,SAAS,CAAC,EAAEhN,OAAO,CAAC,CAAC;QAChE,IAAI4K,MAAM,EAAEqC,EAAE,CAAClI,IAAI,CAACnB,IAAI,CAACuB,EAAE,CAAC6H,SAAS,EAAExN,EAAE,CAAC4D,GAAG,CAAC,MAAM,CAAC,EAAE/D,EAAE,CAACwE,GAAG,CAAC+G,MAAM,CAAC,EAAE5K,OAAO,CAAC,CAAC;;QAEhF;QACA,IAAIgS,OAAO,CAACa,iBAAiB,EAAE;UAC7B5F,EAAE,GAAGA,EAAE,CAACsC,MAAM,CAACyC,OAAO,CAACa,iBAAiB,CAAC7F,SAAS,CAAC,CAAC;QACtD;QACAT,MAAM,CAACwG,UAAU,GAAG/F,SAAS;MAC/B;MACA,IAAI,CAACyF,GAAG,CAACK,QAAQ,EAAE,SAAQ,CAAC;MAC5B,IAAIL,GAAG,CAACnG,QAAQ,IAAI2J,cAAc,CAACxD,GAAG,CAACK,QAAQ,EAAEhH,eAAe,CAAC,EAAE;QACjES,MAAM,CAACwG,UAAU,GAAGN,GAAG,CAACK,QAAQ;MAClC;MACA,IAAI,CAACmD,cAAc,CAACxD,GAAG,CAACK,QAAQ,EAAEhH,eAAe,CAAC,EAAE2G,GAAG,CAACyD,eAAe,CAAC,UAAU,CAAC;MACnF,IAAID,cAAc,CAACxD,GAAG,CAACK,QAAQ,EAAEhH,eAAe,CAAC,EAAE2G,GAAG,CAACtQ,YAAY,CAAC,UAAU,EAAE,MAAM,CAAC;IACzF;IAEArB,GAAG,CAACyP,IAAI,CAAC,+BAA+B,GAAGvQ,OAAO,CAAC;IAEnD,IAAIuM,MAAM,CAACwG,UAAU,IAAIf,OAAO,CAACnH,OAAO,IAAI,CAACmH,OAAO,CAACpG,WAAW,EAAE;MAChEsB,gBAAgB,CAACrN,GAAG,EAAEoB,SAAS,EAAE,CAAC,CAAC,EAAE2C,IAAI,CAACC,GAAG,CAAC0I,MAAM,CAACwG,UAAU,CAAC,EAAEf,OAAO,CAACnH,OAAO,EAAE7K,OAAO,EAAE,UAAU+C,EAAE,EAAEC,IAAI,EAAE;QAC9G,IAAID,EAAE,EAAE;UACN1D,EAAE,CAACgG,OAAO,CAACC,MAAM,CAAC,EAAE,EAAE2H,EAAE,EAAE,UAAUvN,GAAG,EAAEyN,OAAO,EAAEC,SAAS,EAAE;YAC3D,IAAI,CAACD,OAAO,EAAElM,SAAS,CAACI,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,yBAAyB,GAAGuN,SAAS,CAAC,CAAC;UACpG,CAAC,CAAC;UACF,IAAInN,gBAAgB,EAAEA,gBAAgB,CAAC8C,EAAE,EAAE;YAAEE,MAAM,EAAE,QAAQ;YAAEiD,KAAK,EAAE;UAAM,CAAC,CAAC;QAChF,CAAC,MAAM;UACLjF,SAAS,CAACI,WAAW,CAAC,IAAAa,wBAAiB,EAACrC,GAAG,EAAE,0CAA0C,GAAGmD,IAAI,CAAC,CAAC;QAClG;MACF,CAAC,CAAC;IACJ;IACAuJ,MAAM,CAAC8E,QAAQ,GAAG,KAAK;EACzB,CAAC;EAED,SAASwE,YAAY,CAAEnW,GAAG,EAAE;IAC1B,IAAM6T,MAAM,GAAG1T,GAAG,CAACuB,aAAa,CAAC,QAAQ,CAAC;IAC1C,IAAM0C,CAAC,GAAGzE,EAAE,CAACwE,GAAG,CAACnE,GAAG,CAAC;IACrB,IAAIqI,KAAK;IACT,IAAIiK,OAAO,CAACjH,YAAY,EAAE;MACxBhD,KAAK,GAAGD,KAAK,CAAC0L,iBAAiB,CAAC1P,CAAC,EAAE,IAAI,CAAC,EAAC;IAC3C,CAAC,MAAM;MACLiE,KAAK,GAAGD,KAAK,CAACC,KAAK,CAACjE,CAAC,EAAE,IAAI,CAAC;IAC9B;IACAyP,MAAM,CAAClS,WAAW,CAACxB,GAAG,CAAC2B,cAAc,CAACuG,KAAK,CAAC,CAAC,EAAC;IAC9CwL,MAAM,CAACpR,YAAY,CAAC,OAAO,EAAEzC,GAAG,CAAC;IACjC,IAAMmS,eAAe,GAAGxS,EAAE,CAACyC,GAAG,CAC5BgC,CAAC,EACDzE,EAAE,CAACwE,GAAG,CAAC,yCAAyC,CAAC,CAClD;IACD,IAAIgO,eAAe,EAAE;MACnB0B,MAAM,CAACpR,YAAY,CACjB,OAAO,EACP,oBAAoB,GAAG0P,eAAe,CAAC5P,KAAK,GAAG,IAAI,CACpD;IACH;IACAsR,MAAM,CAACT,QAAQ,GAAGpT,GAAG;IACrB,IAAIuW,cAAc,CAACnS,CAAC,CAAC7B,KAAK,EAAE6J,eAAe,CAAC,EAAE;MAC5CyH,MAAM,CAACpR,YAAY,CAAC,UAAU,EAAE,MAAM,CAAC;IACzC;IACA,OAAOoR,MAAM;EACf;EAEA,IAAI/M,QAAQ,EAAE;IACZ+F,MAAM,CAACjE,gBAAgB,CAAC,QAAQ,EAAEiK,QAAQ,EAAE,KAAK,CAAC;EACpD;EAEA,OAAOhG,MAAM;AACf,CAAC,CAAC;;AAEF,SAAS0J,cAAc,CAAEE,GAAG,EAAErR,IAAI,EAAE;EAClC,IAAIlC,CAAC;EACL,KAAKA,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGkC,IAAI,CAACvE,MAAM,EAAEqC,CAAC,EAAE,EAAE;IAChC,IAAIkC,IAAI,CAAClC,CAAC,CAAC,KAAKuT,GAAG,EAAE;MACnB,OAAO,IAAI;IACb;EACF;EAEA,OAAO,KAAK;AACd;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAShL,aAAa,CAAE7L,KAAK,EAAE8W,SAAS,EAAEC,IAAI,EAAE;EAC9C,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAIC,CAAC;EACL,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAIC,IAAI;EACR,IAAI3R,EAAE;EACN,IAAI4R,CAAC;EACL,IAAMC,KAAK,GAAG,CAAC,CAAC;EAChBA,KAAK,CAACZ,SAAS,CAAC7U,IAAI,EAAE,CAAC,GAAG,IAAI;EAC9B,IAAM+M,OAAO,GAAG,CAAC,CAAC;EAClB,IAAM2I,GAAG,GAAG3X,KAAK,CAAC4X,iBAAiB,CAACF,KAAK,EAAE1X,KAAK,CAAC6X,UAAU,CAACC,SAAS,CAAC,iDAAiD,CAAC,EAAE,IAAI,CAAC;EAC/H,KAAK,IAAM5W,CAAC,IAAIyW,GAAG,EAAE;IACnBP,IAAI,GAAGpX,KAAK,CAACkP,kBAAkB,CAAC,IAAI,EAClClP,KAAK,CAAC6X,UAAU,CAACC,SAAS,CAAC,iDAAiD,CAAC,EAC7E9X,KAAK,CAAC8L,MAAM,CAAC5K,CAAC,CAAC,EACf6V,IAAI,CAAC;IACP,KAAK,IAAIzT,CAAC,GAAG,CAAC,EAAEyU,GAAG,GAAGX,IAAI,CAACnW,MAAM,EAAEqC,CAAC,GAAGyU,GAAG,EAAEzU,CAAC,EAAE,EAAE;MAC/CuC,EAAE,GAAGuR,IAAI,CAAC9T,CAAC,CAAC;MACZ0L,OAAO,CAACnJ,EAAE,CAACpF,OAAO,CAACwB,IAAI,EAAE,CAAC,GAAG4D,EAAE;IACjC;IACAwR,IAAI,GAAGrX,KAAK,CAACoD,IAAI,CAAC,IAAI,EACpBpD,KAAK,CAAC6X,UAAU,CAACC,SAAS,CAAC,6CAA6C,CAAC,EACzE9X,KAAK,CAAC8L,MAAM,CAAC5K,CAAC,CAAC,EACf6V,IAAI,CAAC;IACP,KAAK,IAAIiB,CAAC,GAAG,CAAC,EAAEC,IAAI,GAAGZ,IAAI,CAACpW,MAAM,EAAE+W,CAAC,GAAGC,IAAI,EAAED,CAAC,EAAE,EAAE;MACjDb,IAAI,GAAGE,IAAI,CAACW,CAAC,CAAC;MACdV,IAAI,GAAGtX,KAAK,CAACkP,kBAAkB,CAAC,IAAI,EAAEiI,IAAI,EAAE,IAAI,EAAEJ,IAAI,CAAC;MACvD,KAAKG,CAAC,GAAG,CAAC,EAAEF,IAAI,GAAGM,IAAI,CAACrW,MAAM,EAAEiW,CAAC,GAAGF,IAAI,EAAEE,CAAC,EAAE,EAAE;QAC7CrR,EAAE,GAAGyR,IAAI,CAACJ,CAAC,CAAC;QACZlI,OAAO,CAACnJ,EAAE,CAACpF,OAAO,CAACwB,IAAI,EAAE,CAAC,GAAG4D,EAAE;MACjC;IACF;IACA0R,IAAI,GAAGvX,KAAK,CAACoD,IAAI,CAAC,IAAI,EACpBpD,KAAK,CAAC6X,UAAU,CAACC,SAAS,CAAC,4CAA4C,CAAC,EACxE9X,KAAK,CAAC8L,MAAM,CAAC5K,CAAC,CAAC,EACf6V,IAAI,CAAC;IACP,KAAK,IAAImB,CAAC,GAAG,CAAC,EAAEC,IAAI,GAAGZ,IAAI,CAACtW,MAAM,EAAEiX,CAAC,GAAGC,IAAI,EAAED,CAAC,EAAE,EAAE;MACjDf,IAAI,GAAGI,IAAI,CAACW,CAAC,CAAC;MACdV,IAAI,GAAGxX,KAAK,CAACkP,kBAAkB,CAAC,IAAI,EAAEiI,IAAI,EAAE,IAAI,EAAEJ,IAAI,CAAC;MACvD,KAAKU,CAAC,GAAG,CAAC,EAAER,IAAI,GAAGO,IAAI,CAACvW,MAAM,EAAEwW,CAAC,GAAGR,IAAI,EAAEQ,CAAC,EAAE,EAAE;QAC7C5R,EAAE,GAAG2R,IAAI,CAACC,CAAC,CAAC;QACZzI,OAAO,CAACnJ,EAAE,CAACT,MAAM,CAACnD,IAAI,EAAE,CAAC,GAAG4D,EAAE;MAChC;IACF;EACF;EAEA,OAAOmJ,OAAO;AAChB"}