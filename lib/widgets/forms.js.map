{"version":3,"file":"forms.js","names":["buttons","_interopRequireWildcard","require","_fieldParams","_fieldFunction","_formStyle","debug","_error","_basic","_autocompleteField","style","_styleConstants","_interopRequireDefault","_iconBase","log","ns","$rdf","_solidLogic","utils","_multiSelect","widgets","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","F","s","done","value","_e2","f","TypeError","normalCompletion","didErr","err","step","next","_e3","minLen","_arrayLikeToArray","toString","slice","constructor","name","from","test","arr","len","arr2","checkMarkCharacter","cancelCharacter","dashCharacter","kb","store","field","ui","uri","autocompleteField","refreshOpionsSubfieldinGroup","dom","already","subject","dataDoc","callbackFunction","groupDiv","subfields","eles","children","j","mostSpecificClassURI","optionsRender","fieldFunction","newOne","insertBefore","removeChild","container","form","box","createElement","appendChild","key","toNT","createTextNode","already2","x","formDoc","doc","weight0","any","weight","Number","errorMessageBlock","concat","setAttribute","formGroupStyle","display","flexDirection","parts","elements","each","sortBySequence","subFieldFunction","itemChanged","ok","body","widget","change","dependingOn","rdf","cases","values","sameTerm","keys","findTypeURIs","map","sym","c","tests","match","_iterator","_step","termType","the","appendForm","debugString","join","addItem","_addItem","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee6","object","toBeInserted","msg","wrap","_callee6$","_context6","prev","newThing","ordered","createListIfNecessary","list","push","saveListThenRefresh","reverse","st","property","updater","update","t0","error","refresh","stop","renderItem","deleteThisItem","_deleteThisItem","_callee3","del","_callee3$","_context3","splice","abrupt","holds","message","subField","moveThisItem","_x","_x2","_moveThisItem","_callee4","event","upwards","_callee4$","_context4","alert","itemDone","fn","element","editable","deleteButtonWithCheck","multipleUIlabel","frame","gridTemplateColumns","gridTemplateRows","moveUpButton","button","icons","iconBase","_ref","_callee","_callee$","_context","_x3","moveDownButton","_ref2","_callee2","_callee2$","_context2","_x4","shim","gridColumn","gridRow","padding","gridRowStart","plusIconURI","orderedNode","Node","toJS","anyJS","label","min","tail","img","title","prompt","textContent","addEventListener","_ref3","_callee5","_eventNotUsed","_callee5$","_context5","_x5","Collection","add","_saveListThenRefresh","_callee7","_callee7$","_context7","fetcher","putBack","vals","li","sort","syncTableToArrayReOrdered","asyncStuff","_asyncStuff","_callee8","extra","_callee8$","_context8","then","basicField","left","width","styleConstants","formFieldNameBoxWidth","right","fieldLabel","fieldStore","text","suppressEmptyUneditable","makeDescription","booleanField","tristate","errorBlock","lab","state","undefined","ins","buildCheckboxForm","category","checkOptions","makeSelectForNestedCategory","p","lhs","rhs","uiFrom","subForm","opts","disambiguate","getSelectorOptions","dataSource","possible","possibleProperties","findMembersNT","fromNT","rdfs","allClassURIs","propertyTriage","op","dp","owl","mint","multiSelect","selector","selectedOptions","possibleOptions","sortByLabel","makeSelectForChoice","innerHTML","multiSelectDiv","IconicMultiSelect","placeholder","selected","select","textField","valueField","init","subscribe","action","filter","stringValue","includes","newObject","is","addSubFormChoice","success","errorBody","selectDiv","_callbackFunction","contents","params","fieldParams","setFieldStyle","suppressIfUneditable","editFormButton","b","_e","ff","parentNode","propertiesForClass","explicit","dc","foaf","forEach","members","used","statementsMatching","predicate","result","findClosest","cla","prop","agenda","shift","lists","supers","formsFor","t1","bottom","bottomTypeURIs","candidates","k","pair","toLowerCase","newButton","theClass","promptForNew","outlineManager","GotoSubject","formBorderColor","formFunction","gotButton","insertMe","linkDone","linkButton","info","rb","removeButton","AJAR_subject","group","desc","rows","split","cols","multilineTextInputStyle","v","saveChange","submit","disabled","color","textInputColorPending","ds","textInputColor","continueButton","visibility","backgroundColor","textInputBackgroundColorUneditable","makeSelectForClassifierOptions","options","uris","sub","warn","actual","getActual","onChange","removeValue","opt","AJAR_mint","mintClass","thisForm","mintStatementsFun","AJAR_uri","currentURI","sel","subSelect","superSelect","doneNew","_body","formSelectStyle","multiple","option","labelWithOntology","firstChild","nullLabel","makeSelectForOptions","makeSelectForCategory","du","subs","child","renderNameValuePair","input","colorCarrier","checkboxInputStyle","fix","why","Error","holdsAll","missing","displayState","negation","defa","boxHandler","toDelete","newState","toInsert","hmmm","now","Date","getTime","inputPossibleOptions","optionsFromClassUIfrom","isEmpty","createDefaultSelectOptionText","firstSelectOptionText","createDefaultSelectOption","hidden","lastChild","createOption","newSelectedOptions","addValue","existingValues","_iterator2","_step2","containsObject","_iterator3","_step3","removeAttribute","obj","thisClass","quad","len2","len4","m","pred","ref1","ref2","ref3","ref4","ref5","seeds","ref","transitiveClosure","rdfFactory","namedNode","l","len1","q","len3"],"sources":["../../src/widgets/forms.js"],"sourcesContent":["/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n/* eslint-disable multiline-ternary */\n\n/* global alert */\n\nimport * as buttons from './buttons'\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport { setFieldStyle } from './forms/formStyle'\nimport * as debug from '../debug'\nimport { errorMessageBlock } from './error'\nimport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic'\nimport { autocompleteField } from './forms/autocomplete/autocompleteField'\nimport * as style from '../style'\nimport styleConstants from '../styleConstants'\n\nimport { icons } from '../iconBase'\nimport * as log from '../log'\nimport * as ns from '../ns'\nimport * as $rdf from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { IconicMultiSelect } from './multiSelect'\nimport * as widgets from '../widgets'\nexport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic' // Note default export\n\nexport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nexport { fieldParams } from './forms/fieldParams'\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\nconst kb = store\n\nfield[ns.ui('AutocompleteField').uri] = autocompleteField\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nfunction refreshOpionsSubfieldinGroup (dom, already, subject, dataDoc, callbackFunction, groupDiv, subfields) {\n  const eles = groupDiv.children\n  for (let j = 0; j < subfields.length; j++) {\n    // This is really messy.\n    const field = subfields[j]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ns.ui('Options').uri) {\n      const optionsRender = fieldFunction(dom, field)\n      const newOne = optionsRender(\n        dom,\n        null,\n        already,\n        subject,\n        field,\n        dataDoc,\n        callbackFunction\n      )\n      debug.log('Refreshing Options field by replacing it.') // better to support actual refresh\n      groupDiv.insertBefore(newOne, eles[j])\n      groupDiv.removeChild(eles[j + 1]) // Remove the old one\n    }\n  }\n}\n\nfield[ns.ui('Form').uri] = field[ns.ui('Group').uri] =\n    function (dom, container, already, subject, form, dataDoc, callbackFunction) {\n      const box = dom.createElement('div')\n      const ui = ns.ui\n      if (container) container.appendChild(box)\n\n      // Prevent loops\n      if (!form) return\n      const key = subject.toNT() + '|' + form.toNT()\n      if (already[key]) {\n        // been there done that\n        box.appendChild(dom.createTextNode('Group: see above ' + key))\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        // const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n        // dom.outlineManager.appendPropertyTRs(box, plist)\n        // dom.appendChild(plist)\n        return box\n      }\n      const already2 = {}\n      for (const x in already) already2[x] = 1\n      already2[key] = 1\n      const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n      const weight0 = kb.any(form, ui('weight'), null, formDoc) // Say 0-3\n      const weight = weight0 ? Number(weight0.value) : 1\n      if (weight > 3 || weight < 0) return box.appendChild(errorMessageBlock(dom, `Form Group weight ${weight} should be 0-3`))\n\n      box.setAttribute('style', style.formGroupStyle[weight]) // Indent a group\n      box.style.display = 'flex'\n      box.style.flexDirection = 'column'\n      box.class = 'form-weight-' + weight\n\n      let parts = kb.any(form, ui('parts'), null, formDoc)\n      let subfields\n      if (parts) {\n        subfields = parts.elements\n      } else {\n        parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n        subfields = sortBySequence(parts)\n      }\n      if (!parts) {\n        return box.appendChild(errorMessageBlock(dom, 'No parts to form! '))\n      }\n\n      for (let i = 0; i < subfields.length; i++) {\n        const field = subfields[i]\n        const subFieldFunction = fieldFunction(dom, field) //\n\n        const itemChanged = function (ok, body) {\n          if (ok && body && body.widget && body.widget === 'select') {\n            refreshOpionsSubfieldinGroup(dom, already, subject, dataDoc, callbackFunction, box, subfields)\n          }\n          callbackFunction(ok, { widget: 'group', change: body })\n        }\n        box.appendChild(subFieldFunction(dom, null, already2, subject, field, dataDoc, itemChanged))\n      }\n      return box\n    }\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nfield[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = Object.keys(kb.findTypeURIs(subject)).map(uri => $rdf.sym(uri)) // Use RDF-S inference\n  } else {\n    values = kb.each(subject, dependingOn)\n  }\n\n  for (let i = 0; i < cases.length; i++) {\n    const c = cases[i]\n    const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n    let match = false\n    for (let j = 0; j < tests.length; j++) {\n      for (const value of values) {\n        const test = tests[j]\n        if (value.sameTerm(tests) ||\n          (value.termType === test.termType && value.value === test.value)) {\n          match = true\n        }\n      }\n    }\n    if (match) {\n      const field = kb.the(c, ui('use'))\n      if (!field) {\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            'No \"use\" part for case in form ' + form\n          )\n        )\n        return box\n      } else {\n        appendForm(\n          dom,\n          box,\n          already,\n          subject,\n          field,\n          dataDoc,\n          callbackFunction\n        )\n      }\n      break\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n **\n ** Form properties:\n **      @param {Boolean} reverse Make e reverse arc in the data OPS not SPO\n **      @param {NamedNode} property The property to be written in the data\n **      @param {Boolean} ordered Is the list an ordered one where the user defined the order\n */\nfield[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem () {\n    const object = newThing(dataDoc) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      // eslint-disable-next-line multiline-ternary\n      const toBeInserted = reverse ? [$rdf.st(object, property, subject, dataDoc)] : [$rdf.st(subject, property, object, dataDoc)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh()\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, dataDoc)) {\n          const del = [$rdf.st(subject, property, object, dataDoc)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (ok, message) {\n      debug.log(`Item done callback for item ${object.toString()}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      }\n      callbackFunction(ok, message)\n    }\n\n    log.debug('Multiple: render object: ' + object)\n\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, dataDoc, itemDone) // subfields was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(dataDoc.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, multipleUIlabel, deleteThisItem)\n      if (ordered) { // Add controsl in a frame\n        const frame = dom.createElement('div')\n        frame.style.display = 'grid'\n        frame.style.gridTemplateColumns = 'auto 3em'\n        frame.style.gridTemplateRows = '50% 50%'\n        const moveUpButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369237.svg', 'Move Up',\n          async event => moveThisItem(event, true))\n        const moveDownButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369241.svg', 'Move Down',\n          async event => moveThisItem(event, false))\n        const shim = dom.createElement('div')\n        shim.appendChild(subField) // Subfield has its own layout\n        frame.appendChild(shim)\n\n        frame.appendChild(moveUpButton)\n        frame.appendChild(moveDownButton)\n        moveUpButton.style.gridColumn = 2\n        moveDownButton.style.gridColumn = 2\n        moveUpButton.style.gridRow = 1\n        moveDownButton.style.padding = '0em' // don't take too much space\n        moveUpButton.style.padding = '0em'\n\n        moveDownButton.style.gridRow = 2\n        shim.style.gridColumn = 1\n        shim.style.gridRowStart = 'span 2' // Cover both rows\n        // shim.style.gridRowEnd = 2 // Cover both rows\n        return frame\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of Multiple form field implementation\n\n  const plusIconURI = icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = (dom.createElement('div'))\n  const shim = box // no  shim\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return shim\n  }\n  let multipleUIlabel = kb.any(form, ui('label'))\n  if (!multipleUIlabel) multipleUIlabel = utils.label(property)\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n\n  const element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return shim\n  }\n\n  const body = box.appendChild(dom.createElement('div'))\n  body.style.display = 'flex'\n\n  body.style.flexDirection = 'column'\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(dataDoc.uri)) {\n    const tail = box.appendChild(dom.createElement('div'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add another ' + multipleUIlabel\n    const prompt = dom.createElement('span')\n    prompt.textContent =\n      (values.length === 0 ? 'Add another ' : 'Add ') +\n      multipleUIlabel\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n    tail.appendChild(prompt)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, dataDoc)\n      } else {\n        kb.add(subject, property, list, dataDoc)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(dataDoc)\n    } catch (err) {\n      box.appendChild(\n        errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, dataDoc) : kb.the(subject, property, null, dataDoc)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return shim\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nfield[ns.ui('PhoneField').uri] = basicField\nfield[ns.ui('EmailField').uri] = basicField\nfield[ns.ui('ColorField').uri] = basicField\nfield[ns.ui('DateField').uri] = basicField\nfield[ns.ui('DateTimeField').uri] = basicField\nfield[ns.ui('TimeField').uri] = basicField\nfield[ns.ui('NumericField').uri] = basicField\nfield[ns.ui('IntegerField').uri] = basicField\nfield[ns.ui('DecimalField').uri] = basicField\nfield[ns.ui('FloatField').uri] = basicField\nfield[ns.ui('TextField').uri] = basicField\nfield[ns.ui('SingleLineTextField').uri] = basicField\nfield[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nfield[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const left = box.appendChild(dom.createElement('div'))\n  left.style.width = styleConstants.formFieldNameBoxWidth\n  const right = box.appendChild(dom.createElement('div'))\n\n  left.appendChild(fieldLabel(dom, property, form))\n  dataDoc = fieldStore(subject, property, dataDoc)\n\n  const text = kb.anyJS(subject, property, null, dataDoc) || ''\n  const editable = kb.updater.editable(dataDoc.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    dataDoc,\n    callbackFunction\n  )\n  right.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction,\n  tristate\n) {\n  const ui = ns.ui\n  const kb = store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  dataDoc = fieldStore(subject, property, dataDoc)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  const ins = $rdf.st(subject, property, true, dataDoc)\n  const del = $rdf.st(subject, property, false, dataDoc)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, dataDoc, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nfield[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    false\n  )\n}\n\nfield[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nfield[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const ui = ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  log.debug('Classifier: dataDoc=' + dataDoc)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    return callbackFunction(ok, body)\n  }\n  const box = makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Generates a subForm based on a ui:use form\n **  Will look like:\n ** <div id=dropDownDiv>\n **   <div id=labelOfDropDown>\n **   <div id=selectDiv>\n **     <select id=dropDownSelect>\n **       <option> ....\n **     <subForm>\n **  Alternative implementatons could be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** TODO: according to ontology ui:choice can also have ns.ui('default') - this is not implemented yet\n */\n\nfield[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  let p\n  const box = dom.createElement('div')\n  box.setAttribute('class', 'choiceBox')\n  // Set flexDirection column?\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName choiceBox-label')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue choiceBox-selectBox')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return box.appendChild(errorMessageBlock(dom, 'No property for Choice: ' + form))\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uiFrom = kb.any(form, ui('from'))\n  if (!uiFrom) {\n    return errorMessageBlock(dom, \"No 'from' for Choice: \" + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  // const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n\n  const opts = { form, subForm, disambiguate: false }\n\n  function getSelectorOptions (dataSource) {\n    let possible = []\n    let possibleProperties\n    possible = kb.each(undefined, ns.rdf('type'), uiFrom, formDoc)\n    for (const x in findMembersNT(kb, uiFrom, dataSource)) {\n      possible.push(kb.fromNT(x))\n    } // Use rdfs\n\n    if (uiFrom.sameTerm(ns.rdfs('Class'))) {\n      for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n      // log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n    } else if (uiFrom.sameTerm(ns.rdf('Property'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true // This is a big class, and the labels won't be enough.\n    } else if (uiFrom.sameTerm(ns.owl('ObjectProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    } else if (uiFrom.sameTerm(ns.owl('DatatypeProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    }\n\n    return possible\n    // return sortByLabel(possible)\n  }\n\n  // TODO: this checks for any occurrence, regardless of true or false setting\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* Create new *' // @@ could be better\n  }\n\n  const multiSelect = kb.any(form, ui('multiselect')) // Optional\n  if (multiSelect) opts.multiSelect = true\n\n  // by default searches the dataDoc graph or optionally the full store\n  const dataSource = kb.any(form, ui('search-full-store')).length ? null : dataDoc // optional\n\n  let selector\n  rhs.refresh = function () {\n    // from ui:property\n    let selectedOptions = kb.each(subject, property, null, dataDoc).map(object => object.value)\n    // from ui:from + ui:property\n    let possibleOptions = getSelectorOptions(dataSource)\n    possibleOptions.push(selectedOptions)\n    possibleOptions = sortByLabel(possibleOptions)\n\n    selector = makeSelectForChoice(\n      dom,\n      rhs,\n      kb,\n      subject,\n      property,\n      possibleOptions,\n      selectedOptions,\n      uiFrom,\n      opts,\n      dataDoc,\n      callbackFunction\n    )\n    rhs.innerHTML = ''\n    rhs.appendChild(selector)\n    if (multiSelect) {\n      const multiSelectDiv = new IconicMultiSelect({\n        placeholder: selector.selected,\n        select: selector,\n        container: rhs,\n        textField: 'textField',\n        valueField: 'valueField'\n      })\n      multiSelectDiv.init()\n      multiSelectDiv.subscribe(function (event) {\n        if (event.action === 'REMOVE_OPTION') {\n          selectedOptions = selectedOptions.filter(function (value) {\n            return value !== event.value\n          })\n        }\n        if (event.action === 'CLEAR_ALL_OPTIONS') {\n          selectedOptions = []\n        }\n        if (event.action === 'ADD_OPTION') {\n          const stringValue = event.value + ''\n          if (stringValue.includes('Create new')) {\n            const newObject = newThing(dataDoc)\n            const is = []\n            is.push($rdf.st(subject, property, kb.sym(newObject), dataDoc))\n            if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n            if (subForm) {\n              addSubFormChoice(dom, rhs, {}, $rdf.sym(newObject), subForm, dataDoc, function (ok, body) {\n                if (ok) {\n                  kb.updater.update([], is, function (uri, success, errorBody) {\n                    if (!success) rhs.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n                  })\n                  selectedOptions.push(newObject)\n                  if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n                } else {\n                  rhs.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n                }\n              })\n            }\n          } else selectedOptions.push(event.value)\n        }\n        selector.update(selectedOptions)\n      })\n    }\n  }\n\n  rhs.refresh()\n  if (selector && selector.refresh) selector.refresh()\n\n  return box\n}\n\nfunction addSubFormChoice (dom, selectDiv, already, subject, subForm, dataDoc, callbackFunction) {\n  fieldFunction(dom, subForm)(\n    dom,\n    selectDiv,\n    already,\n    subject,\n    subForm,\n    dataDoc,\n    callbackFunction\n  )\n}\n\n//          Documentation - non-interactive fields\n//\n\nfield[ns.ui('Comment').uri] = field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  _callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  const params = fieldParams[uri] || {}\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  setFieldStyle(p, form)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = kb.updater.editable(dataDoc.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nexport function editFormButton (\n  dom,\n  container,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        dataDoc,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nexport function appendForm (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nexport function propertiesForClass (kb, c) {\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The quad store\n* @param cla - the URI of the class\n* @param prop\n*/\nexport function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    const lists = kb.each(c, prop)\n    log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nexport function formsFor (subject) {\n  const kb = store\n\n  log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nexport function sortBySequence (list) {\n  const subfields = list.map(function (p) {\n    const k = kb.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  subfields.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\nexport function sortByLabel (list) {\n  const subfields = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  subfields.sort()\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param dataDoc - optional dataDoc else will prompt for one (unimplemented)\n*/\nexport function newButton (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          dataDoc,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nexport function promptForNew (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = findClosest(kb, theClass.uri, ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        \" but I don't know enough information about those to ask you.\"\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${styleConstants.formBorderColor}; color: ${styleConstants.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = newThing(dataDoc)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, dataDoc)) {\n      insertMe.push($rdf.st(subject, predicate, object, dataDoc))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, dataDoc)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, dataDoc))\n    }\n    if (insertMe.length) {\n      kb.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(buttons.linkButton(dom, object))\n    }\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, dataDoc, itemDone)\n  const rb = buttons.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nexport function makeDescription (\n  dom,\n  kb,\n  subject,\n  predicate,\n  dataDoc,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, dataDoc) || ''\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\" @@ possibly: add prompt which disappears\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, dataDoc)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.style.color = styleConstants.textInputColorPending\n    const ds = kb.statementsMatching(subject, predicate, null, dataDoc)\n    const is = $rdf.st(subject, predicate, field.value, dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.style.color = styleConstants.textInputColor\n        field.disabled = false\n      } else {\n        group.appendChild(\n          errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + dataDoc.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const editable = kb.updater.editable(dataDoc.uri)\n  let submit\n  if (editable) {\n    submit = widgets.continueButton(dom, saveChange)\n    submit.disabled = true // until the filled has been modified\n    submit.style.visibility = 'hidden'\n    submit.style.float = 'right'\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.style.color = 'green' // setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.style.visibility = '' // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = styleConstants.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiple - Boolean - Whether more than one at a time is allowed\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForClassifierOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForClassifierOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForClassifierOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        actual[x.uri] = true\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, newObject, dataDoc))\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    function doneNew (ok, _body) {\n      callbackFunction(ok, { widget: 'select', event: 'new' })\n    }\n    log.info('makeSelectForClassifierOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n        if (newObject) {\n          const fn = fieldFunction(dom, options.subForm)\n          fn(\n            dom,\n            select.parentNode,\n            {},\n            newObject,\n            options.subForm,\n            dataDoc,\n            doneNew\n          )\n        }\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectStyle)\n  if (options.multiple) select.setAttribute('multiple', 'true')\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n  if (select.currentURI == null && !options.multiple) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForClassifierOptions\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        if (x.uri) {\n          actual[x.uri] = true\n        }\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectStyle)\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (!select.currentURI) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nexport function makeSelectForCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  let multiple = false\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n    multiple = true\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n  if (subs.length === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with no subclasses of category: ' +\n        category\n    )\n  }\n  if (subs.length === 1) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with only 1 subclass of category: ' +\n        category +\n        ':' +\n        subs[1]\n    )\n  }\n  return makeSelectForClassifierOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { multiple, nullLabel: '* Select type *' },\n    dataDoc,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForNestedCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  function update () {\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        dataDoc,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n\n  const container = dom.createElement('span') // Container\n  let child = null\n\n  function onChange (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  const select = makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    onChange\n  )\n  container.appendChild(select)\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nexport function buildCheckboxForm (dom, kb, lab, del, ins, form, dataDoc, tristate) {\n  const box = dom.createElement('div')\n  const rhs = renderNameValuePair(dom, kb, box, form, lab)\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  const input = dom.createElement('button')\n  const colorCarrier = input\n  input.style = style.checkboxInputStyle\n  rhs.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = dataDoc // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in dataDoc!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    colorCarrier.style.color = '#bbb' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    kb.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        colorCarrier.style.color = '#000'\n        colorCarrier.style.backgroundColor = '#fee'\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            `Checkbox: Error updating dataDoc from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        colorCarrier.style.color = '#000'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\n/*\nexport function fieldLabel (dom, property, form) {\n  let lab = kb.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', style.fieldLabelStyle) // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nexport function fieldStore (subject, predicate, def) {\n  const sts = kb.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    kb.updater.editable(sts[0].why.uri)\n  ) {\n    return kb.sym(sts[0].why.uri)\n  }\n  return def\n}\n*/\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nexport function newThing (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForChoice (\n  dom,\n  container,\n  kb,\n  subject,\n  predicate,\n  inputPossibleOptions,\n  selectedOptions,\n  uiFrom,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  const optionsFromClassUIfrom = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < inputPossibleOptions.length; i++) {\n    const sub = inputPossibleOptions[i] // @@ Maybe; make this so it works with blank nodes too\n    // if (!sub.uri) debug.warn(`makeSelectForChoice: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in optionsFromClassUIfrom) continue\n    optionsFromClassUIfrom[sub.uri] = true\n  }\n  const isEmpty = Object.keys(optionsFromClassUIfrom).length === 0\n  if (isEmpty && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForChoice: dataDoc=' + dataDoc)\n\n  function createDefaultSelectOptionText () {\n    let firstSelectOptionText = '--- choice ---'\n\n    if (predicate && !(predicate.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for property: ' + utils.label(predicate) + ' *'\n    }\n\n    if (subject && !(subject.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for ' + utils.label(subject, true) + ' *'\n    }\n    return firstSelectOptionText\n  }\n\n  function createDefaultSelectOption () {\n    const option = dom.createElement('option')\n    option.appendChild(dom.createTextNode(createDefaultSelectOptionText()))\n    option.disabled = true\n    option.value = true\n    option.hidden = true\n    option.selected = true\n\n    return option\n  }\n\n  const onChange = function (_e) {\n    container.removeChild(container.lastChild)\n    select.refresh()\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectStyle)\n  select.setAttribute('id', 'formSelect')\n  select.currentURI = null\n\n  for (const uri in optionsFromClassUIfrom) {\n    select.appendChild(createOption(uri))\n  }\n\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n\n  if (select.children.length === 0) select.insertBefore(createDefaultSelectOption(), select.firstChild)\n\n  select.update = function (newSelectedOptions) {\n    selectedOptions = newSelectedOptions\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n\n    const addValue = function (t) {\n      if (!kb.holds(subject, predicate, t, dataDoc)) {\n        is.push($rdf.st(subject, predicate, t, dataDoc))\n        // console.log(\"----value added \" + t)\n      }\n      if (uiFrom && (!kb.holds(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))) {\n        is.push($rdf.st(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n        // console.log(\"----added type to value \" + uiFrom)\n      }\n    }\n\n    const existingValues = kb.each(subject, predicate, null, dataDoc).map(object => object.value)\n    for (const value of existingValues) {\n      if (!containsObject(value, selectedOptions)) removeValue($rdf.sym(value))\n    }\n    for (const value of selectedOptions) {\n      if (!(value in existingValues)) addValue($rdf.sym(value))\n    }\n\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (!ok) return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      select.refresh()\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  select.refresh = function () {\n    select.disabled = true // unlocked any conflict we had got into\n    let is = []\n\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            uiFrom,\n            options.subForm,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, kb.sym(newObject), dataDoc))\n        if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n        select.currentURI = newObject\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && containsObject(opt.AJAR_uri, selectedOptions)) {\n        select.currentURI = opt.AJAR_uri\n      }\n      if (!containsObject(opt.AJAR_uri, selectedOptions)) opt.removeAttribute('selected')\n      if (containsObject(opt.AJAR_uri, selectedOptions)) opt.setAttribute('selected', 'true')\n    }\n\n    log.info('selectForOptions: data doc = ' + dataDoc)\n\n    if (select.currentURI && options.subForm && !options.multiSelect) {\n      addSubFormChoice(dom, container, {}, $rdf.sym(select.currentURI), options.subForm, dataDoc, function (ok, body) {\n        if (ok) {\n          kb.updater.update([], is, function (uri, success, errorBody) {\n            if (!success) container.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n          })\n          if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n        } else {\n          container.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n        }\n      })\n    }\n    select.disabled = false\n  }\n\n  function createOption (uri) {\n    const option = dom.createElement('option')\n    const c = kb.sym(uri)\n    let label\n    if (options.disambiguate) {\n      label = utils.labelWithOntology(c, true) // Init. cap\n    } else {\n      label = utils.label(c, true)\n    }\n    option.appendChild(dom.createTextNode(label)) // Init.\n    option.setAttribute('value', uri)\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (containsObject(c.value, selectedOptions)) {\n      option.setAttribute('selected', 'true')\n    }\n    return option\n  }\n\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n\n  return select\n} // makeSelectForChoice\n\nfunction containsObject (obj, list) {\n  let i\n  for (i = 0; i < list.length; i++) {\n    if (list[i] === obj) {\n      return true\n    }\n  }\n\n  return false\n}\n\n// This functions replaces the findMembersNT (thisClass) from rdflib until we fix: https://github.com/linkeddata/rdflib.js/issues/565\n/**\n * For anything which has thisClass (or any subclass) as its type,\n * or is the object of something which has thisClass (or any subclass) as its range,\n * or subject of something which has thisClass (or any subclass) as its domain\n * We don't bother doing subproperty (yet?) as it doesn't seem to be used\n * much.\n * Get all the Classes of which we can RDFS-infer the subject is a member\n * @return a hash of URIs\n */\nfunction findMembersNT (store, thisClass, quad) {\n  let len2\n  let len4\n  let m\n  let pred\n  let ref1\n  let ref2\n  let ref3\n  let ref4\n  let ref5\n  let st\n  let u\n  const seeds = {}\n  seeds[thisClass.toNT()] = true\n  const members = {}\n  const ref = store.transitiveClosure(seeds, store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#subClassOf'), true)\n  for (const t in ref) {\n    ref1 = store.statementsMatching(null,\n      store.rdfFactory.namedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#type'),\n      store.fromNT(t),\n      quad)\n    for (let i = 0, len = ref1.length; i < len; i++) {\n      st = ref1[i]\n      members[st.subject.toNT()] = st\n    }\n    ref2 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#domain'),\n      store.fromNT(t),\n      quad)\n    for (let l = 0, len1 = ref2.length; l < len1; l++) {\n      pred = ref2[l]\n      ref3 = store.statementsMatching(null, pred, null, quad)\n      for (m = 0, len2 = ref3.length; m < len2; m++) {\n        st = ref3[m]\n        members[st.subject.toNT()] = st\n      }\n    }\n    ref4 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#range'),\n      store.fromNT(t),\n      quad)\n    for (let q = 0, len3 = ref4.length; q < len3; q++) {\n      pred = ref4[q]\n      ref5 = store.statementsMatching(null, pred, null, quad)\n      for (u = 0, len4 = ref5.length; u < len4; u++) {\n        st = ref5[u]\n        members[st.object.toNT()] = st\n      }\n    }\n  }\n\n  return members\n}\n"],"mappings":"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"}