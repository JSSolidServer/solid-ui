{"version":3,"sources":["../../src/widgets/forms.js"],"names":["checkMarkCharacter","cancelCharacter","dashCharacter","kb","store","field","ns","ui","uri","autocompleteField","refreshOpionsSubfieldinGroup","dom","already","subject","dataDoc","callbackFunction","groupDiv","subfields","eles","children","j","length","t","optionsRender","newOne","debug","log","insertBefore","removeChild","container","form","box","createElement","appendChild","key","toNT","createTextNode","already2","x","formDoc","doc","weight0","any","weight","Number","value","setAttribute","style","formGroupStyle","display","flexDirection","parts","elements","each","sortBySequence","i","subFieldFunction","itemChanged","ok","body","widget","change","dependingOn","rdf","cases","values","sameTerm","Object","keys","findTypeURIs","map","$rdf","sym","c","tests","match","test","termType","the","appendForm","debugString","toString","slice","join","addItem","object","newThing","ordered","createListIfNecessary","list","push","saveListThenRefresh","toBeInserted","reverse","st","property","updater","update","msg","error","refresh","renderItem","deleteThisItem","splice","holds","del","message","subField","moveThisItem","event","upwards","alert","itemDone","fn","element","editable","buttons","deleteButtonWithCheck","multipleUIlabel","frame","gridTemplateColumns","gridTemplateRows","moveUpButton","button","icons","iconBase","moveDownButton","shim","gridColumn","gridRow","padding","gridRowStart","plusIconURI","orderedNode","Node","toJS","anyJS","utils","label","min","tail","img","title","prompt","textContent","addEventListener","_eventNotUsed","Collection","add","fetcher","putBack","vals","li","sort","syncTableToArrayReOrdered","asyncStuff","extra","then","err","basicField","left","width","formFieldNameBoxWidth","right","text","suppressEmptyUneditable","makeDescription","booleanField","tristate","errorBlock","lab","state","undefined","ins","buildCheckboxForm","category","checkOptions","makeSelectForNestedCategory","multiSelect","p","lhs","rhs","uiFrom","subForm","follow","opts","disambiguate","getSelectorOptions","possible","possibleProperties","findMembersNT","fromNT","rdfs","allClassURIs","propertyTriage","op","dp","owl","sortByLabel","mint","selector","selectorOptions","makeSelectForChoice","innerHTML","removeNextSiblingsAfterElement","currentElement","nextElementSibling","remove","addSubFormChoice","selectDiv","_callbackFunction","contents","params","fieldParams","suppressIfUneditable","editFormButton","b","_e","ff","parentNode","propertiesForClass","explicit","dc","foaf","forEach","members","used","statementsMatching","predicate","result","findClosest","cla","prop","agenda","shift","lists","supers","formsFor","t1","bottom","bottomTypeURIs","candidates","concat","k","a","pair","toLowerCase","newButton","theClass","promptForNew","outlineManager","GotoSubject","formBorderColor","formFunction","gotButton","insertMe","linkDone","linkButton","info","f","rb","removeButton","AJAR_subject","group","desc","rows","split","cols","multilineTextInputStyle","select","v","saveChange","submit","disabled","color","textInputColorPending","ds","is","textInputColor","widgets","continueButton","visibility","backgroundColor","textInputBackgroundColorUneditable","makeSelectForOptions","options","n","uris","sub","warn","actual","getActual","onChange","removeValue","newObject","opt","selected","AJAR_mint","mintClass","thisForm","mintStatementsFun","AJAR_uri","currentURI","sel","subSelect","superSelect","doneNew","_body","formSelectSTyle","multiple","option","labelWithOntology","firstChild","nullLabel","makeSelectForCategory","du","subs","nullPrompt","child","input","colorCarrier","checkboxInputStyle","fix","why","Array","Error","holdsAll","missing","filter","displayState","negation","errorMessageBlock","defa","boxHandler","toDelete","newState","toInsert","success","errorBody","hmmm","now","Date","getTime","determinFirstSelectOption","firstSelectOptionText","hidden","createOption"],"mappings":"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","sourcesContent":["/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n/* eslint-disable multiline-ternary */\n\n/* global alert */\n\nimport * as buttons from './buttons'\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport { setFieldStyle } from './forms/formStyle'\nimport * as debug from '../debug'\nimport { errorMessageBlock } from './error'\nimport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic'\nimport { autocompleteField } from './forms/autocomplete/autocompleteField'\nimport * as style from '../style'\n\nimport { icons } from '../iconBase'\nimport * as log from '../log'\nimport * as ns from '../ns'\nimport * as $rdf from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nexport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic' // Note default export\n\nexport { field } from './forms/fieldFunction'\nexport { fieldParams } from './forms/fieldParams'\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\nconst kb = store\n\nfield[ns.ui('AutocompleteField').uri] = autocompleteField\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nfunction refreshOpionsSubfieldinGroup (dom, already, subject, dataDoc, callbackFunction, groupDiv, subfields) {\n  const eles = groupDiv.children\n  for (let j = 0; j < subfields.length; j++) {\n    // This is really messy.\n    const field = subfields[j]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ns.ui('Options').uri) {\n      const optionsRender = fieldFunction(dom, field)\n      const newOne = optionsRender(\n        dom,\n        null,\n        already,\n        subject,\n        field,\n        dataDoc,\n        callbackFunction\n      )\n      debug.log('Refreshing Options field by replacing it.') // better to support actual refresh\n      groupDiv.insertBefore(newOne, eles[j])\n      groupDiv.removeChild(eles[j + 1]) // Remove the old one\n    }\n  }\n}\n\nfield[ns.ui('Form').uri] = field[ns.ui('Group').uri] =\n    function (dom, container, already, subject, form, dataDoc, callbackFunction) {\n      const box = dom.createElement('div')\n      const ui = ns.ui\n      if (container) container.appendChild(box)\n\n      // Prevent loops\n      if (!form) return\n      const key = subject.toNT() + '|' + form.toNT()\n      if (already[key]) {\n        // been there done that\n        box.appendChild(dom.createTextNode('Group: see above ' + key))\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        // const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n        // dom.outlineManager.appendPropertyTRs(box, plist)\n        // dom.appendChild(plist)\n        return box\n      }\n      const already2 = {}\n      for (const x in already) already2[x] = 1\n      already2[key] = 1\n      const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n      const weight0 = kb.any(form, ui('weight'), null, formDoc) // Say 0-3\n      const weight = weight0 ? Number(weight0.value) : 1\n      if (weight > 3 || weight < 0) return box.appendChild(errorMessageBlock(dom, `Form Group weight ${weight} should be 0-3`))\n\n      box.setAttribute('style', style.formGroupStyle[weight]) // Indent a group\n      box.style.display = 'flex'\n      box.style.flexDirection = 'column'\n      box.class = 'form-weight-' + weight\n\n      let parts = kb.any(form, ui('parts'), null, formDoc)\n      let subfields\n      if (parts) {\n        subfields = parts.elements\n      } else {\n        parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n        subfields = sortBySequence(parts)\n      }\n      if (!parts) {\n        return box.appendChild(errorMessageBlock(dom, 'No parts to form! '))\n      }\n\n      for (let i = 0; i < subfields.length; i++) {\n        const field = subfields[i]\n        const subFieldFunction = fieldFunction(dom, field) //\n\n        const itemChanged = function (ok, body) {\n          if (ok && body && body.widget && body.widget === 'select') {\n            refreshOpionsSubfieldinGroup(dom, already, subject, dataDoc, callbackFunction, box, subfields)\n          }\n          callbackFunction(ok, { widget: 'group', change: body })\n        }\n        box.appendChild(subFieldFunction(dom, null, already2, subject, field, dataDoc, itemChanged))\n      }\n      return box\n    }\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nfield[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = Object.keys(kb.findTypeURIs(subject)).map(uri => $rdf.sym(uri)) // Use RDF-S inference\n  } else {\n    values = kb.each(subject, dependingOn)\n  }\n  if (values.length === 0) {\n    box.appendChild(\n      errorMessageBlock(\n        dom,\n        \"Can't select subform as no value of: \" + dependingOn\n      )\n    )\n  } else {\n    for (let i = 0; i < cases.length; i++) {\n      const c = cases[i]\n      const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n      let match = false\n      for (let j = 0; j < tests.length; j++) {\n        for (const value of values) {\n          const test = tests[j]\n          if (value.sameTerm(tests) ||\n            (value.termType === test.termType && value.value === test.value)) {\n            match = true\n          }\n        }\n      }\n      if (match) {\n        const field = kb.the(c, ui('use'))\n        if (!field) {\n          box.appendChild(\n            errorMessageBlock(\n              dom,\n              'No \"use\" part for case in form ' + form\n            )\n          )\n          return box\n        } else {\n          appendForm(\n            dom,\n            box,\n            already,\n            subject,\n            field,\n            dataDoc,\n            callbackFunction\n          )\n        }\n        break\n      }\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n **\n ** Form properties:\n **      @param {Boolean} reverse Make e reverse arc in the data OPS not SPO\n **      @param {NamedNode} property The property to be written in the data\n **      @param {Boolean} ordered Is the list an ordered one where the user defined the order\n */\nfield[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem () {\n    const object = newThing(dataDoc) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      // eslint-disable-next-line multiline-ternary\n      const toBeInserted = reverse ? [$rdf.st(object, property, subject, dataDoc)] : [$rdf.st(subject, property, object, dataDoc)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh()\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, dataDoc)) {\n          const del = [$rdf.st(subject, property, object, dataDoc)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (ok, message) {\n      debug.log(`Item done callback for item ${object.toString()}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      }\n      callbackFunction(ok, message)\n    }\n\n    log.debug('Multiple: render object: ' + object)\n\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, dataDoc, itemDone) // subfields was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(dataDoc.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, multipleUIlabel, deleteThisItem)\n      if (ordered) { // Add controsl in a frame\n        const frame = dom.createElement('div')\n        frame.style.display = 'grid'\n        frame.style.gridTemplateColumns = 'auto 3em'\n        frame.style.gridTemplateRows = '50% 50%'\n        const moveUpButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369237.svg', 'Move Up',\n          async event => moveThisItem(event, true))\n        const moveDownButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369241.svg', 'Move Down',\n          async event => moveThisItem(event, false))\n        const shim = dom.createElement('div')\n        shim.appendChild(subField) // Subfield has its own layout\n        frame.appendChild(shim)\n\n        frame.appendChild(moveUpButton)\n        frame.appendChild(moveDownButton)\n        moveUpButton.style.gridColumn = 2\n        moveDownButton.style.gridColumn = 2\n        moveUpButton.style.gridRow = 1\n        moveDownButton.style.padding = '0em' // don't take too much space\n        moveUpButton.style.padding = '0em'\n\n        moveDownButton.style.gridRow = 2\n        shim.style.gridColumn = 1\n        shim.style.gridRowStart = 'span 2' // Cover both rows\n        // shim.style.gridRowEnd = 2 // Cover both rows\n        return frame\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of Multiple form field implementation\n\n  const plusIconURI = icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = (dom.createElement('div'))\n  const shim = box // no  shim\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return shim\n  }\n  let multipleUIlabel = kb.any(form, ui('label'))\n  if (!multipleUIlabel) multipleUIlabel = utils.label(property)\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n\n  const element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return shim\n  }\n\n  const body = box.appendChild(dom.createElement('div'))\n  body.style.display = 'flex'\n\n  body.style.flexDirection = 'column'\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(dataDoc.uri)) {\n    const tail = box.appendChild(dom.createElement('div'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add another ' + multipleUIlabel\n    const prompt = dom.createElement('span')\n    prompt.textContent =\n      (values.length === 0 ? 'Add another ' : 'Add ') +\n      multipleUIlabel\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n    tail.appendChild(prompt)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, dataDoc)\n      } else {\n        kb.add(subject, property, list, dataDoc)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(dataDoc)\n    } catch (err) {\n      box.appendChild(\n        errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, dataDoc) : kb.the(subject, property, null, dataDoc)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return shim\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nfield[ns.ui('PhoneField').uri] = basicField\nfield[ns.ui('EmailField').uri] = basicField\nfield[ns.ui('ColorField').uri] = basicField\nfield[ns.ui('DateField').uri] = basicField\nfield[ns.ui('DateTimeField').uri] = basicField\nfield[ns.ui('TimeField').uri] = basicField\nfield[ns.ui('NumericField').uri] = basicField\nfield[ns.ui('IntegerField').uri] = basicField\nfield[ns.ui('DecimalField').uri] = basicField\nfield[ns.ui('FloatField').uri] = basicField\nfield[ns.ui('TextField').uri] = basicField\nfield[ns.ui('SingleLineTextField').uri] = basicField\nfield[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nfield[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const left = box.appendChild(dom.createElement('div'))\n  left.style.width = style.formFieldNameBoxWidth\n  const right = box.appendChild(dom.createElement('div'))\n\n  left.appendChild(fieldLabel(dom, property, form))\n  dataDoc = fieldStore(subject, property, dataDoc)\n\n  const text = kb.anyJS(subject, property, null, dataDoc) || ''\n  const editable = kb.updater.editable(dataDoc.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    dataDoc,\n    callbackFunction\n  )\n  right.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction,\n  tristate\n) {\n  const ui = ns.ui\n  const kb = store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  dataDoc = fieldStore(subject, property, dataDoc)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  const ins = $rdf.st(subject, property, true, dataDoc)\n  const del = $rdf.st(subject, property, false, dataDoc)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, dataDoc, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nfield[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    false\n  )\n}\n\nfield[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nfield[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const ui = ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  log.debug('Classifier: dataDoc=' + dataDoc)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    return callbackFunction(ok, body)\n  }\n  const box = makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Generates a subForm based on a ui:use form\n **  Will look like:\n ** <div id=dropDownDiv>\n **   <div id=labelOfDropDown>\n **   <div id=selectDiv>\n **     <select id=dropDownSelect>\n **       <option> ....\n **     <subForm>\n **  Alternative implementatons caould be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** TODO: according to ontology ui:choice can also have ns.ui('default') - this is not implemented yet\n */\n\nfield[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n  const multiSelect = false\n\n  let p\n  const box = dom.createElement('div')\n  box.setAttribute('class', 'choiceBox')\n  // Set flexDirection column?\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName choiceBox-label')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue choiceBox-selectBox')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return box.appendChild(errorMessageBlock(dom, 'No property for Choice: ' + form))\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uiFrom = kb.any(form, ui('from'))\n  if (!uiFrom) {\n    return errorMessageBlock(dom, \"No 'from' for Choice: \" + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n\n  const opts = { form, subForm, multiSelect, disambiguate: false }\n\n  function getSelectorOptions () {\n    let possible = []\n    let possibleProperties\n    possible = kb.each(undefined, ns.rdf('type'), uiFrom, formDoc)\n    for (const x in kb.findMembersNT(uiFrom)) {\n      possible.push(kb.fromNT(x))\n    } // Use rdfs\n\n    if (uiFrom.sameTerm(ns.rdfs('Class'))) {\n      for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n      // log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n    } else if (uiFrom.sameTerm(ns.rdf('Property'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true // This is a big class, and the labels won't be enough.\n    } else if (uiFrom.sameTerm(ns.owl('ObjectProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    } else if (uiFrom.sameTerm(ns.owl('DatatypeProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    }\n    return sortByLabel(possible)\n  }\n\n  // TODO: this checks for any occurrence, regardless of true or false setting\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* Create new *' // @@ could be better\n  }\n\n  let selector\n  rhs.refresh = function () {\n    const selectorOptions = getSelectorOptions()\n    selector = makeSelectForChoice(\n      dom,\n      rhs,\n      kb,\n      subject,\n      property,\n      selectorOptions,\n      uiFrom,\n      opts,\n      dataDoc,\n      callbackFunction\n    )\n    rhs.innerHTML = ''\n    rhs.appendChild(selector)\n  }\n\n  rhs.refresh()\n  if (selector && selector.refresh) selector.refresh()\n\n  return box\n}\n\n/**\n     * Removes all sibling elements after specified\n     * @param {HTMLElement} currentElement\n     * @private\n  */\nfunction removeNextSiblingsAfterElement (currentElement) {\n  while (currentElement.nextElementSibling) {\n    currentElement.nextElementSibling.remove()\n  }\n}\n\nfunction addSubFormChoice (dom, selectDiv, already, subject, subForm, dataDoc, callbackFunction) {\n  fieldFunction(dom, subForm)(\n    dom,\n    selectDiv,\n    already,\n    subject,\n    subForm,\n    dataDoc,\n    callbackFunction\n  )\n}\n\n//          Documentation - non-interactive fields\n//\n\nfield[ns.ui('Comment').uri] = field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  _callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  const params = fieldParams[uri] || {}\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  setFieldStyle(p, form)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = kb.updater.editable(dataDoc.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nexport function editFormButton (\n  dom,\n  container,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        dataDoc,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nexport function appendForm (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nexport function propertiesForClass (kb, c) {\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The quad store\n* @param cla - the URI of the class\n* @param prop\n*/\nexport function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    const lists = kb.each(c, prop)\n    log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nexport function formsFor (subject) {\n  const kb = store\n\n  log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nexport function sortBySequence (list) {\n  const subfields = list.map(function (p) {\n    const k = kb.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  subfields.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\nexport function sortByLabel (list) {\n  const subfields = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  subfields.sort()\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param dataDoc - optional dataDoc else will prompt for one (unimplemented)\n*/\nexport function newButton (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          dataDoc,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nexport function promptForNew (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = findClosest(kb, theClass.uri, ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        \" but I don't know enough information about those to ask you.\"\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${style.formBorderColor}; color: ${style.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = newThing(dataDoc)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, dataDoc)) {\n      insertMe.push($rdf.st(subject, predicate, object, dataDoc))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, dataDoc)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, dataDoc))\n    }\n    if (insertMe.length) {\n      kb.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(buttons.linkButton(dom, object))\n    }\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, dataDoc, itemDone)\n  const rb = buttons.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nexport function makeDescription (\n  dom,\n  kb,\n  subject,\n  predicate,\n  dataDoc,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, dataDoc) || ''\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\" @@ possibly: add prompt which disappears\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, dataDoc)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.style.color = style.textInputColorPending // setAttribute('style', style + 'color: gray;') // pending\n    const ds = kb.statementsMatching(subject, predicate, null, dataDoc)\n    const is = $rdf.st(subject, predicate, field.value, dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.style.color = style.textInputColor\n        field.disabled = false\n      } else {\n        group.appendChild(\n          errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + dataDoc.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const editable = kb.updater.editable(dataDoc.uri)\n  let submit\n  if (editable) {\n    submit = widgets.continueButton(dom, saveChange)\n    submit.disabled = true // until the filled has been modified\n    submit.style.visibility = 'hidden'\n    submit.style.float = 'right'\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.style.color = 'green' // setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.style.visibility = '' // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = style.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiple - Boolean - Whether more than one at a time is allowed\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        if (x.uri) {\n          actual[x.uri] = true\n        }\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, newObject, dataDoc))\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    function doneNew (ok, _body) {\n      callbackFunction(ok, { widget: 'select', event: 'new' })\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n        if (newObject) {\n          const fn = fieldFunction(dom, options.subForm)\n          fn(\n            dom,\n            select.parentNode,\n            {},\n            newObject,\n            options.subForm,\n            dataDoc,\n            doneNew\n          )\n        }\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  if (options.multiple) select.setAttribute('multiple', 'true')\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n  if (select.currentURI == null && !options.multiple) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nexport function makeSelectForCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  let multiple = false\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n    multiple = true\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n  if (subs.length === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with no subclasses of category: ' +\n        category\n    )\n  }\n  if (subs.length === 1) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with only 1 subclass of category: ' +\n        category +\n        ':' +\n        subs[1]\n    )\n  }\n  return makeSelectForOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { multiple: multiple, nullPrompt: '--classify--' },\n    dataDoc,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForNestedCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  function update () {\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        dataDoc,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n\n  const container = dom.createElement('span') // Container\n  let child = null\n\n  function onChange (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  // eslint-disable-next-line prefer-const\n  const select = makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    onChange\n  )\n  container.appendChild(select)\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nexport function buildCheckboxForm (dom, kb, lab, del, ins, form, dataDoc, tristate) {\n  const box = dom.createElement('div')\n  const rhs = renderNameValuePair(dom, kb, box, form, lab)\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  const input = dom.createElement('button')\n  const colorCarrier = input\n  input.style = style.checkboxInputStyle\n  rhs.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = dataDoc // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in dataDoc!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    colorCarrier.style.color = '#bbb' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    kb.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        colorCarrier.style.color = '#000'\n        colorCarrier.style.backgroundColor = '#fee'\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            `Checkbox: Error updating dataDoc from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        colorCarrier.style.color = '#000'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\n/*\nexport function fieldLabel (dom, property, form) {\n  let lab = kb.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', style.fieldLabelStyle) // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nexport function fieldStore (subject, predicate, def) {\n  const sts = kb.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    kb.updater.editable(sts[0].why.uri)\n  ) {\n    return kb.sym(sts[0].why.uri)\n  }\n  return def\n}\n*/\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nexport function newThing (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiSelect - Boolean - Whether more than one at a time is allowed\n// @param options.uiMultipleInUse - signals that the ui:choise is used with a ui:multiple\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForChoice (\n  dom,\n  container,\n  kb,\n  subject,\n  predicate,\n  possible,\n  uiFrom,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n\n  function determinFirstSelectOption () {\n    let firstSelectOptionText = '--- classify ---'\n    const option = dom.createElement('option')\n\n    if (predicate && !(predicate.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for property: ' + utils.label(predicate) + ' *'\n    }\n\n    if (subject && !(subject.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for ' + utils.label(subject, true) + ' *'\n    }\n\n    option.appendChild(dom.createTextNode(firstSelectOptionText))\n    option.disabled = true\n    option.value = true\n    option.hidden = true\n    option.selected = true\n\n    return option\n  }\n\n  const onChange = function (_e) {\n    select.refresh()\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  if (options.multiSelect) select.setAttribute('multiSelect', 'true')\n  select.currentURI = null\n\n  const object = kb.any(subject, predicate)\n  if (object) select.currentURI = object\n\n  for (const uri in uris) {\n    select.appendChild(createOption(uri))\n  }\n\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n\n  if (select.children.length === 0) select.insertBefore(determinFirstSelectOption(), select.firstChild)\n\n  select.refresh = function () {\n    select.disabled = true // unlocked any conflict we had got into\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, kb.sym(newObject), dataDoc))\n        if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n        select.currentURI = newObject\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    if (select.currentURI) {\n      removeNextSiblingsAfterElement(select)\n      addSubFormChoice(dom, container, {}, $rdf.sym(select.currentURI), options.subForm, dataDoc, function (ok, body) {\n        if (ok) {\n          kb.updater.update(ds, is, function (uri, success, errorBody) {\n            if (!success) container.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n          })\n          if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n          // widgets.refreshTree(container)\n        } else {\n          container.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n        }\n      })\n    }\n    select.disabled = false\n  }\n\n  function createOption (uri) {\n    const option = dom.createElement('option')\n    const c = kb.sym(uri)\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (c.toString() === '' + select.currentURI) option.selected = true\n    return option\n  }\n\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n\n  select.refresh()\n  return select\n} // makeSelectForChoice\n"],"file":"forms.js"}