{"version":3,"file":"forms.js","names":["checkMarkCharacter","cancelCharacter","dashCharacter","kb","store","field","ns","ui","uri","autocompleteField","refreshOpionsSubfieldinGroup","dom","already","subject","dataDoc","callbackFunction","groupDiv","subfields","eles","children","j","length","t","mostSpecificClassURI","optionsRender","fieldFunction","newOne","debug","log","insertBefore","removeChild","container","form","box","createElement","appendChild","key","toNT","createTextNode","already2","x","formDoc","doc","weight0","any","weight","Number","value","errorMessageBlock","setAttribute","style","formGroupStyle","display","flexDirection","parts","elements","each","sortBySequence","i","subFieldFunction","itemChanged","ok","body","widget","change","dependingOn","rdf","cases","values","sameTerm","Object","keys","findTypeURIs","map","$rdf","sym","c","tests","match","test","termType","the","appendForm","debugString","toString","slice","join","addItem","object","newThing","ordered","createListIfNecessary","list","push","saveListThenRefresh","toBeInserted","reverse","st","property","updater","update","msg","error","refresh","renderItem","deleteThisItem","splice","holds","del","message","subField","moveThisItem","event","upwards","alert","itemDone","fn","element","editable","buttons","deleteButtonWithCheck","multipleUIlabel","frame","gridTemplateColumns","gridTemplateRows","moveUpButton","button","icons","iconBase","moveDownButton","shim","gridColumn","gridRow","padding","gridRowStart","plusIconURI","orderedNode","Node","toJS","anyJS","utils","label","min","tail","img","title","prompt","textContent","addEventListener","_eventNotUsed","Collection","add","fetcher","putBack","vals","li","sort","syncTableToArrayReOrdered","asyncStuff","extra","then","err","basicField","left","width","formFieldNameBoxWidth","right","fieldLabel","fieldStore","text","suppressEmptyUneditable","makeDescription","booleanField","tristate","errorBlock","lab","state","undefined","ins","buildCheckboxForm","category","checkOptions","makeSelectForNestedCategory","p","lhs","rhs","uiFrom","subForm","follow","opts","disambiguate","getSelectorOptions","possible","possibleProperties","findMembersNT","fromNT","rdfs","allClassURIs","propertyTriage","op","dp","owl","mint","multiSelect","selector","selectedOptions","possibleOptions","sortByLabel","makeSelectForChoice","innerHTML","multiSelectDiv","IconicMultiSelect","placeholder","selected","select","textField","valueField","init","subscribe","action","filter","stringValue","includes","newObject","is","addSubFormChoice","success","errorBody","selectDiv","_callbackFunction","contents","params","fieldParams","setFieldStyle","suppressIfUneditable","editFormButton","b","_e","ff","parentNode","propertiesForClass","explicit","dc","foaf","forEach","members","used","statementsMatching","predicate","result","findClosest","cla","prop","agenda","shift","lists","supers","formsFor","t1","bottom","bottomTypeURIs","candidates","concat","k","a","pair","toLowerCase","newButton","theClass","promptForNew","outlineManager","GotoSubject","formBorderColor","formFunction","gotButton","insertMe","linkDone","linkButton","info","f","rb","removeButton","AJAR_subject","group","desc","rows","split","cols","multilineTextInputStyle","v","saveChange","submit","disabled","color","textInputColorPending","ds","textInputColor","widgets","continueButton","visibility","backgroundColor","textInputBackgroundColorUneditable","makeSelectForOptions","options","n","uris","sub","warn","actual","getActual","onChange","removeValue","opt","AJAR_uri","currentURI","sel","subSelect","superSelect","formSelectSTyle","option","labelWithOntology","nullLabel","firstChild","makeSelectForCategory","du","subs","child","renderNameValuePair","input","colorCarrier","checkboxInputStyle","fix","why","Array","Error","holdsAll","missing","displayState","negation","defa","boxHandler","toDelete","newState","toInsert","hmmm","now","Date","getTime","inputPossibleOptions","optionsFromClassUIfrom","isEmpty","createDefaultSelectOptionText","firstSelectOptionText","createDefaultSelectOption","hidden","lastChild","createOption","AJAR_mint","newSelectedOptions","addValue","existingValues","containsObject","mintClass","thisForm","mintStatementsFun","removeAttribute","obj","thisClass","quad","len2","len4","m","pred","ref1","ref2","ref3","ref4","ref5","u","seeds","ref","transitiveClosure","rdfFactory","namedNode","len","l","len1","q","len3"],"sources":["../../src/widgets/forms.js"],"sourcesContent":["/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n/* eslint-disable multiline-ternary */\n\n/* global alert */\n\nimport * as buttons from './buttons'\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport { setFieldStyle } from './forms/formStyle'\nimport * as debug from '../debug'\nimport { errorMessageBlock } from './error'\nimport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic'\nimport { autocompleteField } from './forms/autocomplete/autocompleteField'\nimport * as style from '../style'\n\nimport { icons } from '../iconBase'\nimport * as log from '../log'\nimport * as ns from '../ns'\nimport * as $rdf from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { IconicMultiSelect } from './multiSelect'\nimport * as widgets from '../widgets'\nexport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic' // Note default export\n\nexport { field } from './forms/fieldFunction'\nexport { fieldParams } from './forms/fieldParams'\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\nconst kb = store\n\nfield[ns.ui('AutocompleteField').uri] = autocompleteField\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nfunction refreshOpionsSubfieldinGroup (dom, already, subject, dataDoc, callbackFunction, groupDiv, subfields) {\n  const eles = groupDiv.children\n  for (let j = 0; j < subfields.length; j++) {\n    // This is really messy.\n    const field = subfields[j]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ns.ui('Options').uri) {\n      const optionsRender = fieldFunction(dom, field)\n      const newOne = optionsRender(\n        dom,\n        null,\n        already,\n        subject,\n        field,\n        dataDoc,\n        callbackFunction\n      )\n      debug.log('Refreshing Options field by replacing it.') // better to support actual refresh\n      groupDiv.insertBefore(newOne, eles[j])\n      groupDiv.removeChild(eles[j + 1]) // Remove the old one\n    }\n  }\n}\n\nfield[ns.ui('Form').uri] = field[ns.ui('Group').uri] =\n    function (dom, container, already, subject, form, dataDoc, callbackFunction) {\n      const box = dom.createElement('div')\n      const ui = ns.ui\n      if (container) container.appendChild(box)\n\n      // Prevent loops\n      if (!form) return\n      const key = subject.toNT() + '|' + form.toNT()\n      if (already[key]) {\n        // been there done that\n        box.appendChild(dom.createTextNode('Group: see above ' + key))\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        // const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n        // dom.outlineManager.appendPropertyTRs(box, plist)\n        // dom.appendChild(plist)\n        return box\n      }\n      const already2 = {}\n      for (const x in already) already2[x] = 1\n      already2[key] = 1\n      const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n      const weight0 = kb.any(form, ui('weight'), null, formDoc) // Say 0-3\n      const weight = weight0 ? Number(weight0.value) : 1\n      if (weight > 3 || weight < 0) return box.appendChild(errorMessageBlock(dom, `Form Group weight ${weight} should be 0-3`))\n\n      box.setAttribute('style', style.formGroupStyle[weight]) // Indent a group\n      box.style.display = 'flex'\n      box.style.flexDirection = 'column'\n      box.class = 'form-weight-' + weight\n\n      let parts = kb.any(form, ui('parts'), null, formDoc)\n      let subfields\n      if (parts) {\n        subfields = parts.elements\n      } else {\n        parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n        subfields = sortBySequence(parts)\n      }\n      if (!parts) {\n        return box.appendChild(errorMessageBlock(dom, 'No parts to form! '))\n      }\n\n      for (let i = 0; i < subfields.length; i++) {\n        const field = subfields[i]\n        const subFieldFunction = fieldFunction(dom, field) //\n\n        const itemChanged = function (ok, body) {\n          if (ok && body && body.widget && body.widget === 'select') {\n            refreshOpionsSubfieldinGroup(dom, already, subject, dataDoc, callbackFunction, box, subfields)\n          }\n          callbackFunction(ok, { widget: 'group', change: body })\n        }\n        box.appendChild(subFieldFunction(dom, null, already2, subject, field, dataDoc, itemChanged))\n      }\n      return box\n    }\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nfield[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = Object.keys(kb.findTypeURIs(subject)).map(uri => $rdf.sym(uri)) // Use RDF-S inference\n  } else {\n    values = kb.each(subject, dependingOn)\n  }\n\n  for (let i = 0; i < cases.length; i++) {\n    const c = cases[i]\n    const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n    let match = false\n    for (let j = 0; j < tests.length; j++) {\n      for (const value of values) {\n        const test = tests[j]\n        if (value.sameTerm(tests) ||\n          (value.termType === test.termType && value.value === test.value)) {\n          match = true\n        }\n      }\n    }\n    if (match) {\n      const field = kb.the(c, ui('use'))\n      if (!field) {\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            'No \"use\" part for case in form ' + form\n          )\n        )\n        return box\n      } else {\n        appendForm(\n          dom,\n          box,\n          already,\n          subject,\n          field,\n          dataDoc,\n          callbackFunction\n        )\n      }\n      break\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n **\n ** Form properties:\n **      @param {Boolean} reverse Make e reverse arc in the data OPS not SPO\n **      @param {NamedNode} property The property to be written in the data\n **      @param {Boolean} ordered Is the list an ordered one where the user defined the order\n */\nfield[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem () {\n    const object = newThing(dataDoc) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      // eslint-disable-next-line multiline-ternary\n      const toBeInserted = reverse ? [$rdf.st(object, property, subject, dataDoc)] : [$rdf.st(subject, property, object, dataDoc)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh()\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, dataDoc)) {\n          const del = [$rdf.st(subject, property, object, dataDoc)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (ok, message) {\n      debug.log(`Item done callback for item ${object.toString()}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      }\n      callbackFunction(ok, message)\n    }\n\n    log.debug('Multiple: render object: ' + object)\n\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, dataDoc, itemDone) // subfields was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(dataDoc.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, multipleUIlabel, deleteThisItem)\n      if (ordered) { // Add controsl in a frame\n        const frame = dom.createElement('div')\n        frame.style.display = 'grid'\n        frame.style.gridTemplateColumns = 'auto 3em'\n        frame.style.gridTemplateRows = '50% 50%'\n        const moveUpButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369237.svg', 'Move Up',\n          async event => moveThisItem(event, true))\n        const moveDownButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369241.svg', 'Move Down',\n          async event => moveThisItem(event, false))\n        const shim = dom.createElement('div')\n        shim.appendChild(subField) // Subfield has its own layout\n        frame.appendChild(shim)\n\n        frame.appendChild(moveUpButton)\n        frame.appendChild(moveDownButton)\n        moveUpButton.style.gridColumn = 2\n        moveDownButton.style.gridColumn = 2\n        moveUpButton.style.gridRow = 1\n        moveDownButton.style.padding = '0em' // don't take too much space\n        moveUpButton.style.padding = '0em'\n\n        moveDownButton.style.gridRow = 2\n        shim.style.gridColumn = 1\n        shim.style.gridRowStart = 'span 2' // Cover both rows\n        // shim.style.gridRowEnd = 2 // Cover both rows\n        return frame\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of Multiple form field implementation\n\n  const plusIconURI = icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = (dom.createElement('div'))\n  const shim = box // no  shim\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return shim\n  }\n  let multipleUIlabel = kb.any(form, ui('label'))\n  if (!multipleUIlabel) multipleUIlabel = utils.label(property)\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n\n  const element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return shim\n  }\n\n  const body = box.appendChild(dom.createElement('div'))\n  body.style.display = 'flex'\n\n  body.style.flexDirection = 'column'\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(dataDoc.uri)) {\n    const tail = box.appendChild(dom.createElement('div'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add another ' + multipleUIlabel\n    const prompt = dom.createElement('span')\n    prompt.textContent =\n      (values.length === 0 ? 'Add another ' : 'Add ') +\n      multipleUIlabel\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n    tail.appendChild(prompt)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, dataDoc)\n      } else {\n        kb.add(subject, property, list, dataDoc)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(dataDoc)\n    } catch (err) {\n      box.appendChild(\n        errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, dataDoc) : kb.the(subject, property, null, dataDoc)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return shim\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nfield[ns.ui('PhoneField').uri] = basicField\nfield[ns.ui('EmailField').uri] = basicField\nfield[ns.ui('ColorField').uri] = basicField\nfield[ns.ui('DateField').uri] = basicField\nfield[ns.ui('DateTimeField').uri] = basicField\nfield[ns.ui('TimeField').uri] = basicField\nfield[ns.ui('NumericField').uri] = basicField\nfield[ns.ui('IntegerField').uri] = basicField\nfield[ns.ui('DecimalField').uri] = basicField\nfield[ns.ui('FloatField').uri] = basicField\nfield[ns.ui('TextField').uri] = basicField\nfield[ns.ui('SingleLineTextField').uri] = basicField\nfield[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nfield[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const left = box.appendChild(dom.createElement('div'))\n  left.style.width = style.formFieldNameBoxWidth\n  const right = box.appendChild(dom.createElement('div'))\n\n  left.appendChild(fieldLabel(dom, property, form))\n  dataDoc = fieldStore(subject, property, dataDoc)\n\n  const text = kb.anyJS(subject, property, null, dataDoc) || ''\n  const editable = kb.updater.editable(dataDoc.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    dataDoc,\n    callbackFunction\n  )\n  right.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction,\n  tristate\n) {\n  const ui = ns.ui\n  const kb = store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  dataDoc = fieldStore(subject, property, dataDoc)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  const ins = $rdf.st(subject, property, true, dataDoc)\n  const del = $rdf.st(subject, property, false, dataDoc)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, dataDoc, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nfield[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    false\n  )\n}\n\nfield[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nfield[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const ui = ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  log.debug('Classifier: dataDoc=' + dataDoc)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    return callbackFunction(ok, body)\n  }\n  const box = makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Generates a subForm based on a ui:use form\n **  Will look like:\n ** <div id=dropDownDiv>\n **   <div id=labelOfDropDown>\n **   <div id=selectDiv>\n **     <select id=dropDownSelect>\n **       <option> ....\n **     <subForm>\n **  Alternative implementatons caould be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** TODO: according to ontology ui:choice can also have ns.ui('default') - this is not implemented yet\n */\n\nfield[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  let p\n  const box = dom.createElement('div')\n  box.setAttribute('class', 'choiceBox')\n  // Set flexDirection column?\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName choiceBox-label')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue choiceBox-selectBox')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return box.appendChild(errorMessageBlock(dom, 'No property for Choice: ' + form))\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uiFrom = kb.any(form, ui('from'))\n  if (!uiFrom) {\n    return errorMessageBlock(dom, \"No 'from' for Choice: \" + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n\n  const opts = { form, subForm, disambiguate: false }\n\n  function getSelectorOptions () {\n    let possible = []\n    let possibleProperties\n    possible = kb.each(undefined, ns.rdf('type'), uiFrom, formDoc)\n    for (const x in findMembersNT(kb, uiFrom, dataDoc)) {\n      possible.push(kb.fromNT(x))\n    } // Use rdfs\n\n    if (uiFrom.sameTerm(ns.rdfs('Class'))) {\n      for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n      // log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n    } else if (uiFrom.sameTerm(ns.rdf('Property'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true // This is a big class, and the labels won't be enough.\n    } else if (uiFrom.sameTerm(ns.owl('ObjectProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    } else if (uiFrom.sameTerm(ns.owl('DatatypeProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    }\n\n    return possible\n    // return sortByLabel(possible)\n  }\n\n  // TODO: this checks for any occurrence, regardless of true or false setting\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* Create new *' // @@ could be better\n  }\n\n  const multiSelect = kb.any(form, ui('multiselect')) // Optional\n  if (multiSelect) opts.multiSelect = true\n\n  let selector\n  rhs.refresh = function () {\n    // from ui:property\n    let selectedOptions = kb.each(subject, property, null, dataDoc).map(object => object.value)\n    // from ui:from + ui:property\n    let possibleOptions = getSelectorOptions()\n    possibleOptions.push(selectedOptions)\n    possibleOptions = sortByLabel(possibleOptions)\n\n    selector = makeSelectForChoice(\n      dom,\n      rhs,\n      kb,\n      subject,\n      property,\n      possibleOptions,\n      selectedOptions,\n      uiFrom,\n      opts,\n      dataDoc,\n      callbackFunction\n    )\n    rhs.innerHTML = ''\n    rhs.appendChild(selector)\n    if (multiSelect) {\n      const multiSelectDiv = new IconicMultiSelect({\n        placeholder: selector.selected,\n        select: selector,\n        container: rhs,\n        textField: 'textField',\n        valueField: 'valueField'\n      })\n      multiSelectDiv.init()\n      multiSelectDiv.subscribe(function (event) {\n        if (event.action === 'REMOVE_OPTION') {\n          selectedOptions = selectedOptions.filter(function (value) {\n            return value !== event.value\n          })\n        }\n        if (event.action === 'CLEAR_ALL_OPTIONS') {\n          selectedOptions = []\n        }\n        if (event.action === 'ADD_OPTION') {\n          const stringValue = event.value + ''\n          if (stringValue.includes('Create new')) {\n            const newObject = newThing(dataDoc)\n            const is = []\n            is.push($rdf.st(subject, property, kb.sym(newObject), dataDoc))\n            if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n            if (subForm) {\n              addSubFormChoice(dom, rhs, {}, $rdf.sym(newObject), subForm, dataDoc, function (ok, body) {\n                if (ok) {\n                  kb.updater.update([], is, function (uri, success, errorBody) {\n                    if (!success) rhs.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n                  })\n                  selectedOptions.push(newObject)\n                  if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n                } else {\n                  rhs.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n                }\n              })\n            }\n          } else selectedOptions.push(event.value)\n        }\n        selector.update(selectedOptions)\n      })\n    }\n  }\n\n  rhs.refresh()\n  if (selector && selector.refresh) selector.refresh()\n\n  return box\n}\n\nfunction addSubFormChoice (dom, selectDiv, already, subject, subForm, dataDoc, callbackFunction) {\n  fieldFunction(dom, subForm)(\n    dom,\n    selectDiv,\n    already,\n    subject,\n    subForm,\n    dataDoc,\n    callbackFunction\n  )\n}\n\n//          Documentation - non-interactive fields\n//\n\nfield[ns.ui('Comment').uri] = field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  _callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  const params = fieldParams[uri] || {}\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  setFieldStyle(p, form)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = kb.updater.editable(dataDoc.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nexport function editFormButton (\n  dom,\n  container,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        dataDoc,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nexport function appendForm (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nexport function propertiesForClass (kb, c) {\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The quad store\n* @param cla - the URI of the class\n* @param prop\n*/\nexport function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    const lists = kb.each(c, prop)\n    log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nexport function formsFor (subject) {\n  const kb = store\n\n  log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nexport function sortBySequence (list) {\n  const subfields = list.map(function (p) {\n    const k = kb.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  subfields.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\nexport function sortByLabel (list) {\n  const subfields = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  subfields.sort()\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param dataDoc - optional dataDoc else will prompt for one (unimplemented)\n*/\nexport function newButton (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          dataDoc,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nexport function promptForNew (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = findClosest(kb, theClass.uri, ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        \" but I don't know enough information about those to ask you.\"\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${style.formBorderColor}; color: ${style.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = newThing(dataDoc)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, dataDoc)) {\n      insertMe.push($rdf.st(subject, predicate, object, dataDoc))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, dataDoc)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, dataDoc))\n    }\n    if (insertMe.length) {\n      kb.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(buttons.linkButton(dom, object))\n    }\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, dataDoc, itemDone)\n  const rb = buttons.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nexport function makeDescription (\n  dom,\n  kb,\n  subject,\n  predicate,\n  dataDoc,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, dataDoc) || ''\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\" @@ possibly: add prompt which disappears\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, dataDoc)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.style.color = style.textInputColorPending // setAttribute('style', style + 'color: gray;') // pending\n    const ds = kb.statementsMatching(subject, predicate, null, dataDoc)\n    const is = $rdf.st(subject, predicate, field.value, dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.style.color = style.textInputColor\n        field.disabled = false\n      } else {\n        group.appendChild(\n          errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + dataDoc.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const editable = kb.updater.editable(dataDoc.uri)\n  let submit\n  if (editable) {\n    submit = widgets.continueButton(dom, saveChange)\n    submit.disabled = true // until the filled has been modified\n    submit.style.visibility = 'hidden'\n    submit.style.float = 'right'\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.style.color = 'green' // setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.style.visibility = '' // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = style.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        if (x.uri) {\n          actual[x.uri] = true\n        }\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (!select.currentURI) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nexport function makeSelectForCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n\n  return makeSelectForOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { nullLabel: '* Select type *' },\n    dataDoc,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForNestedCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  function update () {\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        dataDoc,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n\n  const container = dom.createElement('span') // Container\n  let child = null\n\n  function onChange (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  const select = makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    onChange\n  )\n  container.appendChild(select)\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nexport function buildCheckboxForm (dom, kb, lab, del, ins, form, dataDoc, tristate) {\n  const box = dom.createElement('div')\n  const rhs = renderNameValuePair(dom, kb, box, form, lab)\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  const input = dom.createElement('button')\n  const colorCarrier = input\n  input.style = style.checkboxInputStyle\n  rhs.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = dataDoc // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in dataDoc!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    colorCarrier.style.color = '#bbb' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    kb.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        colorCarrier.style.color = '#000'\n        colorCarrier.style.backgroundColor = '#fee'\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            `Checkbox: Error updating dataDoc from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        colorCarrier.style.color = '#000'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\n/*\nexport function fieldLabel (dom, property, form) {\n  let lab = kb.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', style.fieldLabelStyle) // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nexport function fieldStore (subject, predicate, def) {\n  const sts = kb.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    kb.updater.editable(sts[0].why.uri)\n  ) {\n    return kb.sym(sts[0].why.uri)\n  }\n  return def\n}\n*/\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nexport function newThing (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForChoice (\n  dom,\n  container,\n  kb,\n  subject,\n  predicate,\n  inputPossibleOptions,\n  selectedOptions,\n  uiFrom,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  const optionsFromClassUIfrom = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < inputPossibleOptions.length; i++) {\n    const sub = inputPossibleOptions[i] // @@ Maybe; make this so it works with blank nodes too\n    // if (!sub.uri) debug.warn(`makeSelectForChoice: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in optionsFromClassUIfrom) continue\n    optionsFromClassUIfrom[sub.uri] = true\n  }\n  const isEmpty = Object.keys(optionsFromClassUIfrom).length === 0\n  if (isEmpty && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForChoice: dataDoc=' + dataDoc)\n\n  function createDefaultSelectOptionText () {\n    let firstSelectOptionText = '--- choice ---'\n\n    if (predicate && !(predicate.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for property: ' + utils.label(predicate) + ' *'\n    }\n\n    if (subject && !(subject.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for ' + utils.label(subject, true) + ' *'\n    }\n    return firstSelectOptionText\n  }\n\n  function createDefaultSelectOption () {\n    const option = dom.createElement('option')\n    option.appendChild(dom.createTextNode(createDefaultSelectOptionText()))\n    option.disabled = true\n    option.value = true\n    option.hidden = true\n    option.selected = true\n\n    return option\n  }\n\n  const onChange = function (_e) {\n    container.removeChild(container.lastChild)\n    select.refresh()\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  select.setAttribute('id', 'formSelect')\n  select.currentURI = null\n\n  for (const uri in optionsFromClassUIfrom) {\n    select.appendChild(createOption(uri))\n  }\n\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n\n  if (select.children.length === 0) select.insertBefore(createDefaultSelectOption(), select.firstChild)\n\n  select.update = function (newSelectedOptions) {\n    selectedOptions = newSelectedOptions\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n\n    const addValue = function (t) {\n      if (!kb.holds(subject, predicate, t, dataDoc)) {\n        is.push($rdf.st(subject, predicate, t, dataDoc))\n        // console.log(\"----value added \" + t)\n      }\n      if (uiFrom && (!kb.holds(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))) {\n        is.push($rdf.st(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n        // console.log(\"----added type to value \" + uiFrom)\n      }\n    }\n\n    const existingValues = kb.each(subject, predicate, null, dataDoc).map(object => object.value)\n    for (const value of existingValues) {\n      if (!containsObject(value, selectedOptions)) removeValue($rdf.sym(value))\n    }\n    for (const value of selectedOptions) {\n      if (!(value in existingValues)) addValue($rdf.sym(value))\n    }\n\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (!ok) return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      select.refresh()\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  select.refresh = function () {\n    select.disabled = true // unlocked any conflict we had got into\n    let is = []\n\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            uiFrom,\n            options.subForm,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, kb.sym(newObject), dataDoc))\n        if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n        select.currentURI = newObject\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && containsObject(opt.AJAR_uri, selectedOptions)) {\n        select.currentURI = opt.AJAR_uri\n      }\n      if (!containsObject(opt.AJAR_uri, selectedOptions)) opt.removeAttribute('selected')\n      if (containsObject(opt.AJAR_uri, selectedOptions)) opt.setAttribute('selected', 'true')\n    }\n\n    log.info('selectForOptions: data doc = ' + dataDoc)\n\n    if (select.currentURI && options.subForm && !options.multiSelect) {\n      addSubFormChoice(dom, container, {}, $rdf.sym(select.currentURI), options.subForm, dataDoc, function (ok, body) {\n        if (ok) {\n          kb.updater.update([], is, function (uri, success, errorBody) {\n            if (!success) container.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n          })\n          if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n        } else {\n          container.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n        }\n      })\n    }\n    select.disabled = false\n  }\n\n  function createOption (uri) {\n    const option = dom.createElement('option')\n    const c = kb.sym(uri)\n    let label\n    if (options.disambiguate) {\n      label = utils.labelWithOntology(c, true) // Init. cap\n    } else {\n      label = utils.label(c, true)\n    }\n    option.appendChild(dom.createTextNode(label)) // Init.\n    option.setAttribute('value', uri)\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (containsObject(c.value, selectedOptions)) {\n      option.setAttribute('selected', 'true')\n    }\n    return option\n  }\n\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n\n  return select\n} // makeSelectForChoice\n\nfunction containsObject (obj, list) {\n  let i\n  for (i = 0; i < list.length; i++) {\n    if (list[i] === obj) {\n      return true\n    }\n  }\n\n  return false\n}\n\n// This functions replaces the findMembersNT (thisClass) from rdflib until we fix: https://github.com/linkeddata/rdflib.js/issues/565\n/**\n * For thisClass or any subclass, anything which has it is its type\n * or is the object of something which has the type as its range, or subject\n * of something which has the type as its domain\n * We don't bother doing subproperty (yet?)as it doesn't seeem to be used\n * much.\n * Get all the Classes of which we can RDFS-infer the subject is a member\n * @return a hash of URIs\n */\nfunction findMembersNT (store, thisClass, quad) {\n  let len2\n  let len4\n  let m\n  let pred\n  let ref1\n  let ref2\n  let ref3\n  let ref4\n  let ref5\n  let st\n  let u\n  const seeds = {}\n  seeds[thisClass.toNT()] = true\n  const members = {}\n  const ref = store.transitiveClosure(seeds, store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#subClassOf'), true)\n  for (const t in ref) {\n    ref1 = store.statementsMatching(null,\n      store.rdfFactory.namedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#type'),\n      store.fromNT(t),\n      quad)\n    for (let i = 0, len = ref1.length; i < len; i++) {\n      st = ref1[i]\n      members[st.subject.toNT()] = st\n    }\n    ref2 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#domain'),\n      store.fromNT(t),\n      quad)\n    for (let l = 0, len1 = ref2.length; l < len1; l++) {\n      pred = ref2[l]\n      ref3 = store.statementsMatching(null, pred, null, quad)\n      for (m = 0, len2 = ref3.length; m < len2; m++) {\n        st = ref3[m]\n        members[st.subject.toNT()] = st\n      }\n    }\n    ref4 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#range'),\n      store.fromNT(t),\n      quad)\n    for (let q = 0, len3 = ref4.length; q < len3; q++) {\n      pred = ref4[q]\n      ref5 = store.statementsMatching(null, pred, null, quad)\n      for (u = 0, len4 = ref5.length; u < len4; u++) {\n        st = ref5[u]\n        members[st.object.toNT()] = st\n      }\n    }\n  }\n\n  return members\n}\n"],"mappings":"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"}