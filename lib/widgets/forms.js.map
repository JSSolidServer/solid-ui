{"version":3,"file":"forms.js","names":["buttons","_interopRequireWildcard","require","_fieldParams","_fieldFunction","_formStyle","debug","_error","_basic","_autocompleteField","style","_iconBase","log","ns","$rdf","_solidLogic","utils","_multiSelect","widgets","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e2","f","TypeError","normalCompletion","didErr","err","step","next","_e3","minLen","_arrayLikeToArray","toString","slice","constructor","name","from","test","arr","len","arr2","checkMarkCharacter","cancelCharacter","dashCharacter","kb","store","field","ui","uri","autocompleteField","refreshOpionsSubfieldinGroup","dom","already","subject","dataDoc","callbackFunction","groupDiv","subfields","eles","children","j","t","mostSpecificClassURI","optionsRender","fieldFunction","newOne","insertBefore","removeChild","container","form","box","createElement","appendChild","toNT","createTextNode","already2","x","formDoc","doc","weight0","any","weight","Number","errorMessageBlock","concat","setAttribute","formGroupStyle","display","flexDirection","parts","elements","each","sortBySequence","subFieldFunction","itemChanged","ok","body","widget","change","dependingOn","rdf","cases","values","sameTerm","keys","findTypeURIs","map","sym","c","tests","match","_iterator","_step","termType","the","appendForm","debugString","join","addItem","_addItem","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee6","object","toBeInserted","msg","wrap","_callee6$","_context6","prev","newThing","ordered","createListIfNecessary","list","push","saveListThenRefresh","reverse","st","property","updater","update","t0","error","refresh","stop","renderItem","deleteThisItem","_deleteThisItem","_callee3","del","_callee3$","_context3","splice","abrupt","holds","message","subField","moveThisItem","_x","_x2","_moveThisItem","_callee4","event","upwards","_callee4$","_context4","alert","itemDone","fn","element","editable","deleteButtonWithCheck","multipleUIlabel","frame","gridTemplateColumns","gridTemplateRows","moveUpButton","button","icons","iconBase","_ref","_callee","_callee$","_context","_x3","moveDownButton","_ref2","_callee2","_callee2$","_context2","_x4","shim","gridColumn","gridRow","padding","gridRowStart","plusIconURI","orderedNode","Node","toJS","anyJS","label","min","tail","img","title","prompt","textContent","addEventListener","_ref3","_callee5","_eventNotUsed","_callee5$","_context5","_x5","Collection","add","_saveListThenRefresh","_callee7","_callee7$","_context7","fetcher","putBack","vals","li","sort","syncTableToArrayReOrdered","asyncStuff","_asyncStuff","_callee8","extra","_callee8$","_context8","then","basicField","left","width","formFieldNameBoxWidth","right","fieldLabel","fieldStore","text","suppressEmptyUneditable","makeDescription","booleanField","tristate","errorBlock","lab","state","undefined","ins","buildCheckboxForm","category","checkOptions","makeSelectForNestedCategory","p","lhs","rhs","uiFrom","subForm","opts","disambiguate","getSelectorOptions","possible","possibleProperties","findMembersNT","fromNT","rdfs","allClassURIs","propertyTriage","op","dp","owl","mint","multiSelect","selector","selectedOptions","possibleOptions","sortByLabel","makeSelectForChoice","innerHTML","multiSelectDiv","IconicMultiSelect","placeholder","selected","select","textField","valueField","init","subscribe","action","filter","stringValue","includes","newObject","is","addSubFormChoice","success","errorBody","selectDiv","_callbackFunction","contents","params","fieldParams","setFieldStyle","suppressIfUneditable","editFormButton","b","_e","ff","parentNode","propertiesForClass","explicit","dc","foaf","forEach","members","used","statementsMatching","predicate","result","findClosest","cla","prop","agenda","shift","lists","supers","formsFor","t1","bottom","bottomTypeURIs","candidates","k","a","pair","toLowerCase","newButton","theClass","promptForNew","outlineManager","GotoSubject","formBorderColor","formFunction","gotButton","insertMe","linkDone","linkButton","info","rb","removeButton","AJAR_subject","group","rows","split","cols","multilineTextInputStyle","v","saveChange","submit","disabled","color","textInputColorPending","ds","textInputColor","continueButton","visibility","backgroundColor","textInputBackgroundColorUneditable","makeSelectForClassifierOptions","options","uris","sub","warn","actual","getActual","onChange","removeValue","opt","AJAR_mint","mintClass","thisForm","mintStatementsFun","AJAR_uri","currentURI","sel","subSelect","superSelect","doneNew","_body","formSelectSTyle","multiple","option","labelWithOntology","firstChild","nullLabel","makeSelectForOptions","makeSelectForCategory","du","subs","child","renderNameValuePair","input","colorCarrier","checkboxInputStyle","fix","why","Error","holdsAll","missing","displayState","negation","defa","boxHandler","toDelete","newState","toInsert","hmmm","now","Date","getTime","inputPossibleOptions","optionsFromClassUIfrom","isEmpty","createDefaultSelectOptionText","firstSelectOptionText","createDefaultSelectOption","hidden","lastChild","createOption","newSelectedOptions","addValue","existingValues","_iterator2","_step2","containsObject","_iterator3","_step3","removeAttribute","thisClass","quad","len2","len4","m","pred","ref1","ref2","ref3","ref4","ref5","u","seeds","ref","transitiveClosure","rdfFactory","namedNode","l","len1","q","len3"],"sources":["../../src/widgets/forms.js"],"sourcesContent":["/*       F O R M S\n *\n *      A Vanilla Dom implementation of the form language\n */\n/* eslint-disable multiline-ternary */\n\n/* global alert */\n\nimport * as buttons from './buttons'\nimport { fieldParams } from './forms/fieldParams'\nimport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nimport { setFieldStyle } from './forms/formStyle'\nimport * as debug from '../debug'\nimport { errorMessageBlock } from './error'\nimport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic'\nimport { autocompleteField } from './forms/autocomplete/autocompleteField'\nimport * as style from '../style'\n\nimport { icons } from '../iconBase'\nimport * as log from '../log'\nimport * as ns from '../ns'\nimport * as $rdf from 'rdflib'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { IconicMultiSelect } from './multiSelect'\nimport * as widgets from '../widgets'\nexport { basicField, fieldLabel, fieldStore, renderNameValuePair } from './forms/basic' // Note default export\n\nexport { field, mostSpecificClassURI, fieldFunction } from './forms/fieldFunction'\nexport { fieldParams } from './forms/fieldParams'\n\nconst checkMarkCharacter = '\\u2713'\nconst cancelCharacter = '\\u2715'\nconst dashCharacter = '-'\nconst kb = store\n\nfield[ns.ui('AutocompleteField').uri] = autocompleteField\n\n// ///////////////////////////////////////////////////////////////////////\n\n/*                                  Form Field implementations\n **\n */\n/**          Group of different fields\n **\n **  One type of form field is an ordered Group of other fields.\n **  A Form is actually just the same as a group.\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\nfunction refreshOpionsSubfieldinGroup (dom, already, subject, dataDoc, callbackFunction, groupDiv, subfields) {\n  const eles = groupDiv.children\n  for (let j = 0; j < subfields.length; j++) {\n    // This is really messy.\n    const field = subfields[j]\n    const t = mostSpecificClassURI(field) // Field type\n    if (t === ns.ui('Options').uri) {\n      const optionsRender = fieldFunction(dom, field)\n      const newOne = optionsRender(\n        dom,\n        null,\n        already,\n        subject,\n        field,\n        dataDoc,\n        callbackFunction\n      )\n      debug.log('Refreshing Options field by replacing it.') // better to support actual refresh\n      groupDiv.insertBefore(newOne, eles[j])\n      groupDiv.removeChild(eles[j + 1]) // Remove the old one\n    }\n  }\n}\n\nfield[ns.ui('Form').uri] = field[ns.ui('Group').uri] =\n    function (dom, container, already, subject, form, dataDoc, callbackFunction) {\n      const box = dom.createElement('div')\n      const ui = ns.ui\n      if (container) container.appendChild(box)\n\n      // Prevent loops\n      if (!form) return\n      const key = subject.toNT() + '|' + form.toNT()\n      if (already[key]) {\n        // been there done that\n        box.appendChild(dom.createTextNode('Group: see above ' + key))\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        // const plist = [$rdf.st(subject, ns.owl('sameAs'), subject)] // @@ need prev subject\n        // dom.outlineManager.appendPropertyTRs(box, plist)\n        // dom.appendChild(plist)\n        return box\n      }\n      const already2 = {}\n      for (const x in already) already2[x] = 1\n      already2[key] = 1\n      const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n      const weight0 = kb.any(form, ui('weight'), null, formDoc) // Say 0-3\n      const weight = weight0 ? Number(weight0.value) : 1\n      if (weight > 3 || weight < 0) return box.appendChild(errorMessageBlock(dom, `Form Group weight ${weight} should be 0-3`))\n\n      box.setAttribute('style', style.formGroupStyle[weight]) // Indent a group\n      box.style.display = 'flex'\n      box.style.flexDirection = 'column'\n      box.class = 'form-weight-' + weight\n\n      let parts = kb.any(form, ui('parts'), null, formDoc)\n      let subfields\n      if (parts) {\n        subfields = parts.elements\n      } else {\n        parts = kb.each(form, ui('part'), null, formDoc) //  Warning: unordered\n        subfields = sortBySequence(parts)\n      }\n      if (!parts) {\n        return box.appendChild(errorMessageBlock(dom, 'No parts to form! '))\n      }\n\n      for (let i = 0; i < subfields.length; i++) {\n        const field = subfields[i]\n        const subFieldFunction = fieldFunction(dom, field) //\n\n        const itemChanged = function (ok, body) {\n          if (ok && body && body.widget && body.widget === 'select') {\n            refreshOpionsSubfieldinGroup(dom, already, subject, dataDoc, callbackFunction, box, subfields)\n          }\n          callbackFunction(ok, { widget: 'group', change: body })\n        }\n        box.appendChild(subFieldFunction(dom, null, already2, subject, field, dataDoc, itemChanged))\n      }\n      return box\n    }\n\n/**          Options field: Select one or more cases\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n */\n\nfield[ns.ui('Options').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const box = dom.createElement('div')\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  let dependingOn = kb.any(form, ui('dependingOn'))\n  if (!dependingOn) {\n    dependingOn = ns.rdf('type')\n  } // @@ default to type (do we want defaults?)\n  const cases = kb.each(form, ui('case'), null, formDoc)\n  if (!cases) {\n    box.appendChild(errorMessageBlock(dom, 'No cases to Options form. '))\n  }\n  let values\n  if (dependingOn.sameTerm(ns.rdf('type'))) {\n    values = Object.keys(kb.findTypeURIs(subject)).map(uri => $rdf.sym(uri)) // Use RDF-S inference\n  } else {\n    values = kb.each(subject, dependingOn)\n  }\n\n  for (let i = 0; i < cases.length; i++) {\n    const c = cases[i]\n    const tests = kb.each(c, ui('for'), null, formDoc) // There can be multiple 'for'\n    let match = false\n    for (let j = 0; j < tests.length; j++) {\n      for (const value of values) {\n        const test = tests[j]\n        if (value.sameTerm(tests) ||\n          (value.termType === test.termType && value.value === test.value)) {\n          match = true\n        }\n      }\n    }\n    if (match) {\n      const field = kb.the(c, ui('use'))\n      if (!field) {\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            'No \"use\" part for case in form ' + form\n          )\n        )\n        return box\n      } else {\n        appendForm(\n          dom,\n          box,\n          already,\n          subject,\n          field,\n          dataDoc,\n          callbackFunction\n        )\n      }\n      break\n    }\n  }\n  // @@ Add box.refresh() to sync fields with values\n  return box\n}\n\n/**          Multiple field: zero or more similar subFields\n **\n ** @param {Document} dom The HTML Document object aka Document Object Model\n ** @param {Element?} container  If present, the created widget will be appended to this\n ** @param {Map} already A hash table of (form, subject) kept to prevent recursive forms looping\n ** @param {Node} subject The thing about which the form displays/edits data\n ** @param {Node} form The form or field to be rendered\n ** @param {Node} dataDoc The web document in which the data is\n ** @param {function(ok, errorMessage)} callbackFunction Called when data is changed?\n **\n ** @returns {Element} The HTML widget created\n **\n ** Form properties:\n **      @param {Boolean} reverse Make e reverse arc in the data OPS not SPO\n **      @param {NamedNode} property The property to be written in the data\n **      @param {Boolean} ordered Is the list an ordered one where the user defined the order\n */\nfield[ns.ui('Multiple').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  /** Diagnostic function\n  */\n  function debugString (values) {\n    return values.map(x => x.toString().slice(-7)).join(', ')\n  }\n\n  /** Add an item to the local quadstore not the UI or the web\n  *\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  async function addItem () {\n    const object = newThing(dataDoc) // by default just add new nodes\n    if (ordered) {\n      createListIfNecessary() // Sets list and unsavedList\n      list.elements.push(object)\n      await saveListThenRefresh()\n    } else {\n      // eslint-disable-next-line multiline-ternary\n      const toBeInserted = reverse ? [$rdf.st(object, property, subject, dataDoc)] : [$rdf.st(subject, property, object, dataDoc)]\n      try {\n        await kb.updater.update([], toBeInserted)\n      } catch (err) {\n        const msg = 'Error adding to unordered multiple: ' + err\n        box.appendChild(errorMessageBlock(dom, msg))\n        debug.error(msg)\n      }\n      refresh()\n    }\n  }\n\n  /** Make a dom representation for an item\n   * @param {Event} anyEvent if used as an event handler\n   * @param {Node} object The RDF object to be represented by this item.\n   */\n  function renderItem (object) {\n    async function deleteThisItem () {\n      if (ordered) {\n        debug.log('pre delete: ' + debugString(list.elements))\n        for (let i = 0; i < list.elements.length; i++) {\n          if (list.elements[i].sameTerm(object)) {\n            list.elements.splice(i, 1)\n            await saveListThenRefresh()\n            return\n          }\n        }\n      } else {\n        // unordered\n        if (kb.holds(subject, property, object, dataDoc)) {\n          const del = [$rdf.st(subject, property, object, dataDoc)]\n          kb.updater.update(del, [], function (uri, ok, message) {\n            if (ok) {\n              body.removeChild(subField)\n            } else {\n              body.appendChild(\n                errorMessageBlock(\n                  dom,\n                  'Multiple: delete failed: ' + message\n                )\n              )\n            }\n          })\n        }\n      }\n    }\n\n    /** Move the object up or down in the ordered list\n     * @param {Event} anyEvent if used as an event handler\n     * @param {Boolean} upwards Move this up (true) or down (false).\n     */\n    async function moveThisItem (event, upwards) {\n      // @@ possibly, allow shift+click to do move to top or bottom?\n      debug.log('pre move: ' + debugString(list.elements))\n      let i\n      for (i = 0; i < list.elements.length; i++) {\n        // Find object in array\n        if (list.elements[i].sameTerm(object)) {\n          break\n        }\n      }\n      if (i === list.elements.length) {\n        alert('list move: not found element for ' + object)\n      }\n      if (upwards) {\n        if (i === 0) {\n          alert('@@ boop - already at top   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i - 1, 2, list.elements[i], list.elements[i - 1])\n      } else {\n        // downwards\n        if (i === list.elements.length - 1) {\n          alert('@@ boop - already at bottom   -temp message') // @@ make boop sound\n          return\n        }\n        list.elements.splice(i, 2, list.elements[i + 1], list.elements[i])\n      }\n      await saveListThenRefresh()\n    }\n    /* A subField has been filled in\n    *\n    * One possibility is to not actually make the link to the thing until\n    * this callback happens to avoid widow links\n     */\n    function itemDone (ok, message) {\n      debug.log(`Item done callback for item ${object.toString()}`)\n      if (!ok) { // when does this happen? errors typically deal with upstream\n        debug.error('  Item done callback: Error: ' + message)\n      }\n      callbackFunction(ok, message)\n    }\n\n    log.debug('Multiple: render object: ' + object)\n\n    const fn = fieldFunction(dom, element)\n    const subField = fn(dom, null, already, object, element, dataDoc, itemDone) // subfields was: body.  moving to not passing that\n    subField.subject = object // Keep a back pointer between the DOM array and the RDF objects\n\n    // delete button and move buttons\n    if (kb.updater.editable(dataDoc.uri)) {\n      buttons.deleteButtonWithCheck(dom, subField, multipleUIlabel, deleteThisItem)\n      if (ordered) { // Add controsl in a frame\n        const frame = dom.createElement('div')\n        frame.style.display = 'grid'\n        frame.style.gridTemplateColumns = 'auto 3em'\n        frame.style.gridTemplateRows = '50% 50%'\n        const moveUpButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369237.svg', 'Move Up',\n          async event => moveThisItem(event, true))\n        const moveDownButton = buttons.button(\n          dom, icons.iconBase + 'noun_1369241.svg', 'Move Down',\n          async event => moveThisItem(event, false))\n        const shim = dom.createElement('div')\n        shim.appendChild(subField) // Subfield has its own layout\n        frame.appendChild(shim)\n\n        frame.appendChild(moveUpButton)\n        frame.appendChild(moveDownButton)\n        moveUpButton.style.gridColumn = 2\n        moveDownButton.style.gridColumn = 2\n        moveUpButton.style.gridRow = 1\n        moveDownButton.style.padding = '0em' // don't take too much space\n        moveUpButton.style.padding = '0em'\n\n        moveDownButton.style.gridRow = 2\n        shim.style.gridColumn = 1\n        shim.style.gridRowStart = 'span 2' // Cover both rows\n        // shim.style.gridRowEnd = 2 // Cover both rows\n        return frame\n      }\n    }\n    return subField // unused\n  } // renderItem\n\n  /// ///////// Body of Multiple form field implementation\n\n  const plusIconURI = icons.iconBase + 'noun_19460_green.svg' // white plus in green circle\n\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const box = (dom.createElement('div'))\n  const shim = box // no  shim\n  // We don't indent multiple as it is a sort of a prefix of the next field and has contents of one.\n  // box.setAttribute('style', 'padding-left: 2em; border: 0.05em solid green;')  // Indent a multiple\n  const ui = ns.ui\n  if (container) container.appendChild(box)\n\n  const orderedNode = kb.any(form, ui('ordered'))\n  const ordered = orderedNode ? $rdf.Node.toJS(orderedNode) : false\n\n  const property = kb.any(form, ui('property'))\n  const reverse = kb.anyJS(form, ui('reverse'), null, formDoc)\n  if (!property) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No property to multiple: ' + form)\n    ) // used for arcs in the data\n    return shim\n  }\n  let multipleUIlabel = kb.any(form, ui('label'))\n  if (!multipleUIlabel) multipleUIlabel = utils.label(property)\n  let min = kb.any(form, ui('min')) // This is the minimum number -- default 0\n  min = min ? 0 + min.value : 0\n\n  const element = kb.any(form, ui('part')) // This is the form to use for each one\n  if (!element) {\n    box.appendChild(\n      errorMessageBlock(dom, 'No part to multiple: ' + form)\n    )\n    return shim\n  }\n\n  const body = box.appendChild(dom.createElement('div'))\n  body.style.display = 'flex'\n\n  body.style.flexDirection = 'column'\n  let list // The RDF collection which keeps the ordered version or null\n  let values // Initial values - always an array.  Even when no list yet.\n  values = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n  if (ordered) {\n    list = reverse ? kb.any(null, property, subject, dataDoc) : kb.any(subject, property, null, dataDoc)\n    if (list) {\n      values = list.elements\n    } else {\n      values = []\n    }\n  } else {\n    values = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n    list = null\n  }\n  // Add control on the bottom for adding more items\n  if (kb.updater.editable(dataDoc.uri)) {\n    const tail = box.appendChild(dom.createElement('div'))\n    tail.style.padding = '0.5em'\n    const img = tail.appendChild(dom.createElement('img'))\n    img.setAttribute('src', plusIconURI) //  plus sign\n    img.setAttribute('style', 'margin: 0.2em; width: 1.5em; height:1.5em')\n    img.title = 'Click to add another ' + multipleUIlabel\n    const prompt = dom.createElement('span')\n    prompt.textContent =\n      (values.length === 0 ? 'Add another ' : 'Add ') +\n      multipleUIlabel\n    tail.addEventListener('click', async _eventNotUsed => {\n      await addItem()\n    }, true)\n    tail.appendChild(prompt)\n  }\n\n  function createListIfNecessary () {\n    if (!list) {\n      list = new $rdf.Collection()\n      if (reverse) {\n        kb.add(list, property, subject, dataDoc)\n      } else {\n        kb.add(subject, property, list, dataDoc)\n      }\n    }\n  }\n\n  async function saveListThenRefresh () {\n    debug.log('save list: ' + debugString(list.elements)) // 20191214\n\n    createListIfNecessary()\n    try {\n      await kb.fetcher.putBack(dataDoc)\n    } catch (err) {\n      box.appendChild(\n        errorMessageBlock(dom, 'Error trying to put back a list: ' + err)\n      )\n      return\n    }\n    refresh()\n  }\n\n  function refresh () {\n    let vals\n    if (ordered) {\n      const li = reverse ? kb.the(null, property, subject, dataDoc) : kb.the(subject, property, null, dataDoc)\n      vals = li ? li.elements : []\n    } else {\n      vals = reverse ? kb.each(null, property, subject, dataDoc) : kb.each(subject, property, null, dataDoc)\n      vals.sort() // achieve consistency on each refresh\n    }\n    utils.syncTableToArrayReOrdered(body, vals, renderItem)\n  }\n  body.refresh = refresh // Allow live update\n  refresh()\n\n  async function asyncStuff () {\n    const extra = min - values.length\n    if (extra > 0) {\n      for (let j = 0; j < extra; j++) {\n        debug.log('Adding extra: min ' + min)\n        await addItem() // Add blanks if less than minimum\n      }\n      await saveListThenRefresh()\n    }\n  }\n  asyncStuff().then(\n    () => { debug.log(' Multiple render: async stuff ok') },\n    (err) => { debug.error(' Multiple render: async stuff fails. #### ', err) }\n  ) // async\n\n  return shim\n} // Multiple\n\n/*          Text field\n **\n */\n// For possible date popups see e.g. http://www.dynamicdrive.com/dynamicindex7/jasoncalendar.htm\n// or use HTML5: http://www.w3.org/TR/2011/WD-html-markup-20110113/input.date.html\n//\n\nfield[ns.ui('PhoneField').uri] = basicField\nfield[ns.ui('EmailField').uri] = basicField\nfield[ns.ui('ColorField').uri] = basicField\nfield[ns.ui('DateField').uri] = basicField\nfield[ns.ui('DateTimeField').uri] = basicField\nfield[ns.ui('TimeField').uri] = basicField\nfield[ns.ui('NumericField').uri] = basicField\nfield[ns.ui('IntegerField').uri] = basicField\nfield[ns.ui('DecimalField').uri] = basicField\nfield[ns.ui('FloatField').uri] = basicField\nfield[ns.ui('TextField').uri] = basicField\nfield[ns.ui('SingleLineTextField').uri] = basicField\nfield[ns.ui('NamedNodeURIField').uri] = basicField\n\n/*          Multiline Text field\n **\n */\n\nfield[ns.ui('MultiLineTextField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return errorMessageBlock(dom, 'No property to text field: ' + form)\n  }\n  const box = dom.createElement('div')\n  box.style.display = 'flex'\n  box.style.flexDirection = 'row'\n  const left = box.appendChild(dom.createElement('div'))\n  left.style.width = style.formFieldNameBoxWidth\n  const right = box.appendChild(dom.createElement('div'))\n\n  left.appendChild(fieldLabel(dom, property, form))\n  dataDoc = fieldStore(subject, property, dataDoc)\n\n  const text = kb.anyJS(subject, property, null, dataDoc) || ''\n  const editable = kb.updater.editable(dataDoc.uri)\n  const suppressEmptyUneditable = form && kb.anyJS(form, ns.ui('suppressEmptyUneditable'), null, formDoc)\n\n  if (!editable && suppressEmptyUneditable && text === '') {\n    box.style.display = 'none'\n  }\n  const field = makeDescription(\n    dom,\n    kb,\n    subject,\n    property,\n    dataDoc,\n    callbackFunction\n  )\n  right.appendChild(field)\n  if (container) container.appendChild(box)\n  return box\n}\n\n/*          Boolean field  and Tri-state version (true/false/null)\n **\n ** @@ todo: remove tristate param\n */\nfunction booleanField (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction,\n  tristate\n) {\n  const ui = ns.ui\n  const kb = store\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    const errorBlock = errorMessageBlock(\n      dom,\n      'No property to boolean field: ' + form\n    )\n    if (container) container.appendChild(errorBlock)\n    return errorBlock\n  }\n  let lab = kb.any(form, ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  dataDoc = fieldStore(subject, property, dataDoc)\n  let state = kb.any(subject, property)\n  if (state === undefined) {\n    state = false\n  } // @@ sure we want that -- or three-state?\n  const ins = $rdf.st(subject, property, true, dataDoc)\n  const del = $rdf.st(subject, property, false, dataDoc)\n  const box = buildCheckboxForm(dom, kb, lab, del, ins, form, dataDoc, tristate)\n  if (container) container.appendChild(box)\n  return box\n}\nfield[ns.ui('BooleanField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    false\n  )\n}\n\nfield[ns.ui('TristateField').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  return booleanField(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    callbackFunction,\n    true\n  )\n}\n\n/*          Classifier field\n **\n **  Nested categories\n **\n ** @@ To do: If a classification changes, then change any dependent Options fields.\n */\n\nfield[ns.ui('Classifier').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const kb = store\n  const ui = ns.ui\n  const category = kb.any(form, ui('category'))\n  if (!category) {\n    return errorMessageBlock(dom, 'No category for classifier: ' + form)\n  }\n  log.debug('Classifier: dataDoc=' + dataDoc)\n  const checkOptions = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    return callbackFunction(ok, body)\n  }\n  const box = makeSelectForNestedCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    checkOptions\n  )\n  if (container) container.appendChild(box)\n  return box\n}\n\n/**         Choice field\n **\n **  Not nested.  Generates a link to something from a given class.\n **  Optional subform for the thing selected.\n **  Generates a subForm based on a ui:use form\n **  Will look like:\n ** <div id=dropDownDiv>\n **   <div id=labelOfDropDown>\n **   <div id=selectDiv>\n **     <select id=dropDownSelect>\n **       <option> ....\n **     <subForm>\n **  Alternative implementatons caould be:\n ** -- pop-up menu (as here)\n ** -- radio buttons\n ** -- auto-complete typing\n **\n ** TODO: according to ontology ui:choice can also have ns.ui('default') - this is not implemented yet\n */\n\nfield[ns.ui('Choice').uri] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  let p\n  const box = dom.createElement('div')\n  box.setAttribute('class', 'choiceBox')\n  // Set flexDirection column?\n  if (container) container.appendChild(box)\n  const lhs = dom.createElement('div')\n  lhs.setAttribute('class', 'formFieldName choiceBox-label')\n  box.appendChild(lhs)\n  const rhs = dom.createElement('div')\n  rhs.setAttribute('class', 'formFieldValue choiceBox-selectBox')\n  box.appendChild(rhs)\n  const property = kb.any(form, ui('property'))\n  if (!property) {\n    return box.appendChild(errorMessageBlock(dom, 'No property for Choice: ' + form))\n  }\n  lhs.appendChild(fieldLabel(dom, property, form))\n  const uiFrom = kb.any(form, ui('from'))\n  if (!uiFrom) {\n    return errorMessageBlock(dom, \"No 'from' for Choice: \" + form)\n  }\n  const subForm = kb.any(form, ui('use')) // Optional\n  // const follow = kb.anyJS(form, ui('follow'), null, formDoc) // data doc moves to new subject?\n\n  const opts = { form, subForm, disambiguate: false }\n\n  function getSelectorOptions () {\n    let possible = []\n    let possibleProperties\n    possible = kb.each(undefined, ns.rdf('type'), uiFrom, formDoc)\n    for (const x in findMembersNT(kb, uiFrom, dataDoc)) {\n      possible.push(kb.fromNT(x))\n    } // Use rdfs\n\n    if (uiFrom.sameTerm(ns.rdfs('Class'))) {\n      for (p in buttons.allClassURIs()) possible.push(kb.sym(p))\n      // log.debug(\"%%% Choice field: possible.length 2 = \"+possible.length)\n    } else if (uiFrom.sameTerm(ns.rdf('Property'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true // This is a big class, and the labels won't be enough.\n    } else if (uiFrom.sameTerm(ns.owl('ObjectProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.op) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    } else if (uiFrom.sameTerm(ns.owl('DatatypeProperty'))) {\n      possibleProperties = buttons.propertyTriage(kb)\n      for (p in possibleProperties.dp) possible.push(kb.fromNT(p))\n      opts.disambiguate = true\n    }\n\n    return possible\n    // return sortByLabel(possible)\n  }\n\n  // TODO: this checks for any occurrence, regardless of true or false setting\n  if (kb.any(form, ui('canMintNew'))) {\n    opts.mint = '* Create new *' // @@ could be better\n  }\n\n  const multiSelect = kb.any(form, ui('multiselect')) // Optional\n  if (multiSelect) opts.multiSelect = true\n\n  let selector\n  rhs.refresh = function () {\n    // from ui:property\n    let selectedOptions = kb.each(subject, property, null, dataDoc).map(object => object.value)\n    // from ui:from + ui:property\n    let possibleOptions = getSelectorOptions()\n    possibleOptions.push(selectedOptions)\n    possibleOptions = sortByLabel(possibleOptions)\n\n    selector = makeSelectForChoice(\n      dom,\n      rhs,\n      kb,\n      subject,\n      property,\n      possibleOptions,\n      selectedOptions,\n      uiFrom,\n      opts,\n      dataDoc,\n      callbackFunction\n    )\n    rhs.innerHTML = ''\n    rhs.appendChild(selector)\n    if (multiSelect) {\n      const multiSelectDiv = new IconicMultiSelect({\n        placeholder: selector.selected,\n        select: selector,\n        container: rhs,\n        textField: 'textField',\n        valueField: 'valueField'\n      })\n      multiSelectDiv.init()\n      multiSelectDiv.subscribe(function (event) {\n        if (event.action === 'REMOVE_OPTION') {\n          selectedOptions = selectedOptions.filter(function (value) {\n            return value !== event.value\n          })\n        }\n        if (event.action === 'CLEAR_ALL_OPTIONS') {\n          selectedOptions = []\n        }\n        if (event.action === 'ADD_OPTION') {\n          const stringValue = event.value + ''\n          if (stringValue.includes('Create new')) {\n            const newObject = newThing(dataDoc)\n            const is = []\n            is.push($rdf.st(subject, property, kb.sym(newObject), dataDoc))\n            if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n            if (subForm) {\n              addSubFormChoice(dom, rhs, {}, $rdf.sym(newObject), subForm, dataDoc, function (ok, body) {\n                if (ok) {\n                  kb.updater.update([], is, function (uri, success, errorBody) {\n                    if (!success) rhs.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n                  })\n                  selectedOptions.push(newObject)\n                  if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n                } else {\n                  rhs.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n                }\n              })\n            }\n          } else selectedOptions.push(event.value)\n        }\n        selector.update(selectedOptions)\n      })\n    }\n  }\n\n  rhs.refresh()\n  if (selector && selector.refresh) selector.refresh()\n\n  return box\n}\n\nfunction addSubFormChoice (dom, selectDiv, already, subject, subForm, dataDoc, callbackFunction) {\n  fieldFunction(dom, subForm)(\n    dom,\n    selectDiv,\n    already,\n    subject,\n    subForm,\n    dataDoc,\n    callbackFunction\n  )\n}\n\n//          Documentation - non-interactive fields\n//\n\nfield[ns.ui('Comment').uri] = field[\n  ns.ui('Heading').uri\n] = function (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  _callbackFunction\n) {\n  const ui = ns.ui\n  const kb = store\n  let contents = kb.any(form, ui('contents'))\n  if (!contents) contents = 'Error: No contents in comment field.'\n  const formDoc = form.doc ? form.doc() : null // @@ if blank no way to know\n\n  const uri = mostSpecificClassURI(form)\n  const params = fieldParams[uri] || {}\n\n  const box = dom.createElement('div')\n  if (container) container.appendChild(box)\n  const p = box.appendChild(dom.createElement(params.element))\n  p.textContent = contents\n\n  setFieldStyle(p, form)\n\n  // Some headings and prompts are only useful to guide user input\n  const suppressIfUneditable = kb.anyJS(form, ns.ui('suppressIfUneditable'), null, formDoc)\n  const editable = kb.updater.editable(dataDoc.uri)\n  if (suppressIfUneditable && !editable) {\n    box.style.display = 'none'\n  }\n  return box\n}\n\n// A button for editing a form (in place, at the moment)\n//\n//  When editing forms, make it yellow, when editing thr form form, pink\n// Help people understand how many levels down they are.\n//\nexport function editFormButton (\n  dom,\n  container,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'Edit ' + utils.label(ns.ui('Form'))\n  b.addEventListener(\n    'click',\n    function (_e) {\n      const ff = appendForm(\n        dom,\n        container,\n        {},\n        form,\n        ns.ui('FormForm'),\n        dataDoc,\n        callbackFunction\n      )\n      ff.setAttribute(\n        'style',\n        ns.ui('FormForm').sameTerm(form)\n          ? 'background-color: #fee;'\n          : 'background-color: #ffffe7;'\n      )\n      b.parentNode.removeChild(b)\n    },\n    true\n  )\n  return b\n}\n\nexport function appendForm (\n  dom,\n  container,\n  already,\n  subject,\n  form,\n  dataDoc,\n  itemDone\n) {\n  return fieldFunction(dom, form)(\n    dom,\n    container,\n    already,\n    subject,\n    form,\n    dataDoc,\n    itemDone\n  )\n}\n\n/**          Find list of properties for class\n//\n// Three possible sources: Those mentioned in schemas, which exludes many\n// those which occur in the data we already have, and those predicates we\n// have come across anywhere and which are not explicitly excluded from\n// being used with this class.\n*/\n\nexport function propertiesForClass (kb, c) {\n  const explicit = kb.each(undefined, ns.rdf('range'), c)\n  ;[\n    ns.rdfs('comment'),\n    ns.dc('title'), // Generic things\n    ns.foaf('name'),\n    ns.foaf('homepage')\n  ].forEach(function (x) {\n    explicit.push(x)\n  })\n  let members = kb.each(undefined, ns.rdf('type'), c)\n  if (members.length > 60) members = members.slice(0, 60) // Array supports slice?\n  const used = {}\n  for (let i = 0; i < (members.length > 60 ? 60 : members.length); i++) {\n    kb.statementsMatching(members[i], undefined, undefined).forEach(function (st) {\n      used[st.predicate.uri] = true\n    })\n  }\n  explicit.forEach(function (p) {\n    used[p.uri] = true\n  })\n  const result = []\n  for (const uri in used) {\n    result.push(kb.sym(uri))\n  }\n  return result\n}\n\n/** Find the closest class\n* @param kb The quad store\n* @param cla - the URI of the class\n* @param prop\n*/\nexport function findClosest (kb, cla, prop) {\n  const agenda = [kb.sym(cla)] // ordered - this is breadth first search\n  while (agenda.length > 0) {\n    const c = agenda.shift() // first\n    const lists = kb.each(c, prop)\n    log.debug('Lists for ' + c + ', ' + prop + ': ' + lists.length)\n    if (lists.length !== 0) return lists\n    const supers = kb.each(c, ns.rdfs('subClassOf'))\n    for (let i = 0; i < supers.length; i++) {\n      agenda.push(supers[i])\n      log.debug('findClosest: add super: ' + supers[i])\n    }\n  }\n  return []\n}\n\n// Which forms apply to a given existing subject?\n\nexport function formsFor (subject) {\n  const kb = store\n\n  log.debug('formsFor: subject=' + subject)\n  const t = kb.findTypeURIs(subject)\n  let t1\n  for (t1 in t) {\n    log.debug('   type: ' + t1)\n  }\n  const bottom = kb.bottomTypeURIs(t) // most specific\n  let candidates = []\n  for (const b in bottom) {\n    // Find the most specific\n    log.debug('candidatesFor: trying bottom type =' + b)\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('creationForm'))\n    )\n    candidates = candidates.concat(\n      findClosest(kb, b, ns.ui('annotationForm'))\n    )\n  }\n  return candidates\n}\n\nexport function sortBySequence (list) {\n  const subfields = list.map(function (p) {\n    const k = kb.any(p, ns.ui('sequence'))\n    return [k || 9999, p]\n  })\n  subfields.sort(function (a, b) {\n    return a[0] - b[0]\n  })\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\nexport function sortByLabel (list) {\n  const subfields = list.map(function (p) {\n    return [utils.label(p).toLowerCase(), p]\n  })\n  subfields.sort()\n  return subfields.map(function (pair) {\n    return pair[1]\n  })\n}\n\n/** Button to add a new whatever using a form\n//\n// @param form - optional form , else will look for one\n// @param dataDoc - optional dataDoc else will prompt for one (unimplemented)\n*/\nexport function newButton (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.innerHTML = 'New ' + utils.label(theClass)\n  b.addEventListener(\n    'click',\n    function (_e) {\n      b.parentNode.appendChild(\n        promptForNew(\n          dom,\n          kb,\n          subject,\n          predicate,\n          theClass,\n          form,\n          dataDoc,\n          callbackFunction\n        )\n      )\n    },\n    false\n  )\n  return b\n}\n\n/**      Prompt for new object of a given class\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, Thing this should be linked to when made. Optional.\n// @param predicate - a term, the relationship for the subject link. Optional.\n// @param theClass - an RDFS class containng the object about which the new information is.\n// @param form  - the form to be used when a new one. null means please find one.\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n// @returns a dom object with the form DOM\n*/\nexport function promptForNew (\n  dom,\n  kb,\n  subject,\n  predicate,\n  theClass,\n  form,\n  dataDoc,\n  callbackFunction\n) {\n  const box = dom.createElement('form')\n\n  if (!form) {\n    const lists = findClosest(kb, theClass.uri, ns.ui('creationForm'))\n    if (lists.length === 0) {\n      const p = box.appendChild(dom.createElement('p'))\n      p.textContent =\n        'I am sorry, you need to provide information about a ' +\n        utils.label(theClass) +\n        \" but I don't know enough information about those to ask you.\"\n      const b = box.appendChild(dom.createElement('button'))\n      b.setAttribute('type', 'button')\n      b.setAttribute('style', 'float: right;')\n      b.innerHTML = 'Goto ' + utils.label(theClass)\n      b.addEventListener(\n        'click',\n        // TODO fix dependency cycle to solid-panes by calling outlineManager\n        function (_e) {\n          dom.outlineManager.GotoSubject(\n            theClass,\n            true,\n            undefined,\n            true,\n            undefined\n          )\n        },\n        false\n      )\n      return box\n    }\n    log.debug('lists[0] is ' + lists[0])\n    form = lists[0] // Pick any one\n  }\n  log.debug('form is ' + form)\n  box.setAttribute('style', `border: 0.05em solid ${style.formBorderColor}; color: ${style.formBorderColor}`) // @@color?\n  box.innerHTML = '<h3>New ' + utils.label(theClass) + '</h3>'\n\n  const formFunction = fieldFunction(dom, form)\n  const object = newThing(dataDoc)\n  let gotButton = false\n  const itemDone = function (ok, body) {\n    if (!ok) return callbackFunction(ok, body)\n    const insertMe = []\n    if (subject && !kb.holds(subject, predicate, object, dataDoc)) {\n      insertMe.push($rdf.st(subject, predicate, object, dataDoc))\n    }\n    if (subject && !kb.holds(object, ns.rdf('type'), theClass, dataDoc)) {\n      insertMe.push($rdf.st(object, ns.rdf('type'), theClass, dataDoc))\n    }\n    if (insertMe.length) {\n      kb.updater.update([], insertMe, linkDone)\n    } else {\n      callbackFunction(true, body)\n    }\n    if (!gotButton) {\n      gotButton = box.appendChild(buttons.linkButton(dom, object))\n    }\n  }\n  function linkDone (uri, ok, body) {\n    return callbackFunction(ok, body)\n  }\n  log.info('paneUtils Object is ' + object)\n  const f = formFunction(dom, box, {}, object, form, dataDoc, itemDone)\n  const rb = buttons.removeButton(dom, f)\n  rb.setAttribute('style', 'float: right;')\n  box.AJAR_subject = object\n  return box\n}\n\nexport function makeDescription (\n  dom,\n  kb,\n  subject,\n  predicate,\n  dataDoc,\n  callbackFunction\n) {\n  const group = dom.createElement('div')\n  const desc = kb.anyJS(subject, predicate, null, dataDoc) || ''\n\n  const field = dom.createElement('textarea')\n  group.appendChild(field)\n  field.rows = desc ? desc.split('\\n').length + 2 : 2\n  field.cols = 80\n\n  field.setAttribute('style', style.multilineTextInputStyle)\n  if (desc !== null) {\n    field.value = desc\n  } else {\n    // Unless you can make the predicate label disappear with the first click then this is over-cute\n    // field.value = utils.label(predicate); // Was\"enter a description here\" @@ possibly: add prompt which disappears\n    field.select() // Select it ready for user input -- doesn't work\n  }\n\n  group.refresh = function () {\n    const v = kb.any(subject, predicate, null, dataDoc)\n    if (v && v.value !== field.value) {\n      field.value = v.value // don't touch widget if no change\n      // @@ this is the place to color the field from the user who chanaged it\n    }\n  }\n  function saveChange (_e) {\n    submit.disabled = true\n    submit.setAttribute('style', 'visibility: hidden; float: right;') // Keep UI clean\n    field.disabled = true\n    field.style.color = style.textInputColorPending // setAttribute('style', style + 'color: gray;') // pending\n    const ds = kb.statementsMatching(subject, predicate, null, dataDoc)\n    const is = $rdf.st(subject, predicate, field.value, dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (ok) {\n        field.style.color = style.textInputColor\n        field.disabled = false\n      } else {\n        group.appendChild(\n          errorMessageBlock(\n            dom,\n            'Error (while saving change to ' + dataDoc.uri + '): ' + body\n          )\n        )\n      }\n      if (callbackFunction) {\n        callbackFunction(ok, body)\n      }\n    })\n  }\n\n  const editable = kb.updater.editable(dataDoc.uri)\n  let submit\n  if (editable) {\n    submit = widgets.continueButton(dom, saveChange)\n    submit.disabled = true // until the filled has been modified\n    submit.style.visibility = 'hidden'\n    submit.style.float = 'right'\n    group.appendChild(submit)\n\n    field.addEventListener(\n      'keyup',\n      function (_e) {\n        // Green means has been changed, not saved yet\n        field.style.color = 'green' // setAttribute('style', style + 'color: green;')\n        if (submit) {\n          submit.disabled = false\n          submit.style.visibility = '' // Remove visibility: hidden\n        }\n      },\n      true\n    )\n    field.addEventListener('change', saveChange, true)\n  } else {\n    field.disabled = true // @@ change color too\n    field.style.backgroundColor = style.textInputBackgroundColorUneditable\n  }\n  return group\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.multiple - Boolean - Whether more than one at a time is allowed\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForClassifierOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForClassifierOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0 && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForClassifierOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        actual[x.uri] = true\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    let is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            options.mintClass,\n            null,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, newObject, dataDoc))\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    function doneNew (ok, _body) {\n      callbackFunction(ok, { widget: 'select', event: 'new' })\n    }\n    log.info('makeSelectForClassifierOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n        if (newObject) {\n          const fn = fieldFunction(dom, options.subForm)\n          fn(\n            dom,\n            select.parentNode,\n            {},\n            newObject,\n            options.subForm,\n            dataDoc,\n            doneNew\n          )\n        }\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  if (options.multiple) select.setAttribute('multiple', 'true')\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n  if (select.currentURI == null && !options.multiple) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForClassifierOptions\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.nullLabel - a string to be displayed as the\n//                        option for none selected (for non multiple)\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForOptions (\n  dom,\n  kb,\n  subject,\n  predicate,\n  possible,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  log.debug('Select list length now ' + possible.length)\n  let n = 0\n  const uris = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < possible.length; i++) {\n    const sub = possible[i] // @@ Maybe; make this so it works with blank nodes too\n    if (!sub.uri) debug.warn(`makeSelectForOptions: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in uris) continue\n    uris[sub.uri] = true\n    n++\n  } // uris is now the set of possible options\n  if (n === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForOptions: dataDoc=' + dataDoc)\n  let actual\n  const getActual = function () {\n    actual = {}\n    if (predicate.sameTerm(ns.rdf('type'))) {\n      actual = kb.findTypeURIs(subject)\n    } else {\n      kb.each(subject, predicate, null, dataDoc).forEach(function (x) {\n        if (x.uri) {\n          actual[x.uri] = true\n        }\n      })\n    }\n    return actual\n  }\n  actual = getActual()\n\n  const onChange = function (_e) {\n    select.disabled = true // until data written back - gives user feedback too\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && !(opt.AJAR_uri in actual)) {\n        // new class\n        is.push($rdf.st(subject, predicate, kb.sym(opt.AJAR_uri), dataDoc))\n      }\n      if (!opt.selected && opt.AJAR_uri in actual) {\n        // old class\n        removeValue(kb.sym(opt.AJAR_uri))\n      }\n      if (opt.selected) select.currentURI = opt.AJAR_uri\n    }\n    let sel = select.subSelect // All subclasses must also go\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.subSelect\n    }\n    sel = select.superSelect // All superclasses are redundant\n    while (sel && sel.currentURI) {\n      removeValue(kb.sym(sel.currentURI))\n      sel = sel.superSelect\n    }\n    log.info('selectForOptions: data doc = ' + dataDoc)\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      actual = getActual() // refresh\n      if (ok) {\n        select.disabled = false // data written back\n      } else {\n        return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      }\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  select.currentURI = null\n\n  select.refresh = function () {\n    actual = getActual() // refresh\n    for (let i = 0; i < select.children.length; i++) {\n      const option = select.children[i]\n      if (option.AJAR_uri) {\n        option.selected = option.AJAR_uri in actual\n      }\n    }\n    select.disabled = false // unlocked any conflict we had got into\n  }\n\n  for (const uri in uris) {\n    const c = kb.sym(uri)\n    const option = dom.createElement('option')\n    if (options.disambiguate) {\n      option.appendChild(dom.createTextNode(utils.labelWithOntology(c, true))) // Init. cap\n    } else {\n      option.appendChild(dom.createTextNode(utils.label(c, true))) // Init.\n    }\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (uri in actual) {\n      option.setAttribute('selected', 'true')\n      select.currentURI = uri\n      // dump(\"Already in class: \"+ uri+\"\\n\")\n    }\n    select.appendChild(option)\n  }\n  if (!select.currentURI) {\n    const prompt = dom.createElement('option')\n    prompt.appendChild(dom.createTextNode(options.nullLabel))\n    select.insertBefore(prompt, select.firstChild)\n    prompt.selected = true\n  }\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n  return select\n} // makeSelectForOptions\n\n// Make SELECT element to select subclasses\n//\n// If there is any disjoint union it will so a mutually exclusive dropdown\n// Failing that it will do a multiple selection of subclasses.\n// Callback takes (boolean ok, string errorBody)\n\nexport function makeSelectForCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  const du = kb.any(category, ns.owl('disjointUnionOf'))\n  let subs\n  let multiple = false\n  if (!du) {\n    subs = kb.each(undefined, ns.rdfs('subClassOf'), category)\n    multiple = true\n  } else {\n    subs = du.elements\n  }\n  log.debug('Select list length ' + subs.length)\n  if (subs.length === 0) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with no subclasses of category: ' +\n        category\n    )\n  }\n  if (subs.length === 1) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do \" +\n        (multiple ? 'multiple ' : '') +\n        'selector with only 1 subclass of category: ' +\n        category +\n        ':' +\n        subs[1]\n    )\n  }\n  return makeSelectForClassifierOptions(\n    dom,\n    kb,\n    subject,\n    ns.rdf('type'),\n    subs,\n    { multiple, nullLabel: '* Select type *' },\n    dataDoc,\n    callbackFunction\n  )\n}\n\n/** Make SELECT element to select subclasses recurively\n//\n// It will so a mutually exclusive dropdown, with another if there are nested\n// disjoint unions.\n//\n// @param  callbackFunction takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForNestedCategory (\n  dom,\n  kb,\n  subject,\n  category,\n  dataDoc,\n  callbackFunction\n) {\n  function update () {\n    if (child) {\n      container.removeChild(child)\n      child = null\n    }\n    if (\n      select.currentURI &&\n      kb.any(kb.sym(select.currentURI), ns.owl('disjointUnionOf'))\n    ) {\n      child = makeSelectForNestedCategory(\n        dom,\n        kb,\n        subject,\n        kb.sym(select.currentURI),\n        dataDoc,\n        callbackFunction\n      )\n      select.subSelect = child.firstChild\n      select.subSelect.superSelect = select\n      container.appendChild(child)\n    }\n  }\n\n  const container = dom.createElement('span') // Container\n  let child = null\n\n  function onChange (ok, body) {\n    if (ok) update()\n    callbackFunction(ok, body)\n  }\n  const select = makeSelectForCategory(\n    dom,\n    kb,\n    subject,\n    category,\n    dataDoc,\n    onChange\n  )\n  container.appendChild(select)\n  update()\n  return container\n}\n\n/*  Build a checkbox from a given statement(s)\n **\n **  If the source document is editable, make the checkbox editable\n **\n **  ins and sel are either statements *or arrays of statements* which should be\n **  made if the checkbox is checed and unchecked respectively.\n **  tristate: Allow ins, or del, or neither\n */\nexport function buildCheckboxForm (dom, kb, lab, del, ins, form, dataDoc, tristate) {\n  const box = dom.createElement('div')\n  const rhs = renderNameValuePair(dom, kb, box, form, lab)\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  const input = dom.createElement('button')\n  const colorCarrier = input\n  input.style = style.checkboxInputStyle\n  rhs.appendChild(input)\n\n  function fix (x) {\n    if (!x) return [] // no statements\n    if (x.object) {\n      if (!x.why) {\n        x.why = dataDoc // be back-compaitible  with old code\n      }\n      return [x] // one statements\n    }\n    if (x instanceof Array) return x\n    throw new Error('buildCheckboxForm: bad param ' + x)\n  }\n  ins = fix(ins)\n  del = fix(del)\n\n  function holdsAll (a) {\n    const missing = a.filter(\n      st => !kb.holds(st.subject, st.predicate, st.object, st.why)\n    )\n    return missing.length === 0\n  }\n  function refresh () {\n    let state = holdsAll(ins)\n    let displayState = state\n    if (del.length) {\n      const negation = holdsAll(del)\n      if (state && negation) {\n        box.appendChild(\n          widgets.errorMessageBlock(\n            dom,\n            'Inconsistent data in dataDoc!\\n' + ins + ' and\\n' + del\n          )\n        )\n        return box\n      }\n      if (!state && !negation) {\n        state = null\n        const defa = kb.any(form, ns.ui('default'))\n        displayState = defa ? defa.value === '1' : tristate ? null : false\n      }\n    }\n    input.state = state\n    input.textContent = {\n      true: checkMarkCharacter,\n      false: tristate ? cancelCharacter : ' ', // Just use blank when not tristate\n      null: dashCharacter\n    }[displayState]\n  }\n\n  refresh()\n  if (!editable) return box\n\n  const boxHandler = function (_e) {\n    colorCarrier.style.color = '#bbb' // grey -- not saved yet\n    const toDelete = input.state === true ? ins : input.state === false ? del : []\n    input.newState =\n      input.state === null\n        ? true\n        : input.state === true\n          ? false\n          : tristate\n            ? null\n            : true\n\n    const toInsert =\n      input.newState === true ? ins : input.newState === false ? del : []\n    debug.log(`  Deleting  ${toDelete}`)\n    debug.log(`  Inserting ${toInsert}`)\n    kb.updater.update(toDelete, toInsert, function (\n      uri,\n      success,\n      errorBody\n    ) {\n      if (!success) {\n        if (toDelete.why) {\n          const hmmm = kb.holds(\n            toDelete.subject,\n            toDelete.predicate,\n            toDelete.object,\n            toDelete.why\n          )\n          if (hmmm) {\n            debug.log(' @@@@@ weird if 409 - does hold statement')\n          }\n        }\n        colorCarrier.style.color = '#000'\n        colorCarrier.style.backgroundColor = '#fee'\n        box.appendChild(\n          errorMessageBlock(\n            dom,\n            `Checkbox: Error updating dataDoc from ${input.state} to ${\n              input.newState\n            }:\\n\\n${errorBody}`\n          )\n        )\n      } else {\n        colorCarrier.style.color = '#000'\n        input.state = input.newState\n        input.textContent = {\n          true: checkMarkCharacter,\n          false: cancelCharacter,\n          null: dashCharacter\n        }[input.state] // @@\n      }\n    })\n  }\n  input.addEventListener('click', boxHandler, false)\n  return box\n}\n/*\nexport function fieldLabel (dom, property, form) {\n  let lab = kb.any(form, ns.ui('label'))\n  if (!lab) lab = utils.label(property, true) // Init capital\n  if (property === undefined) {\n    return dom.createTextNode('@@Internal error: undefined property')\n  }\n  const anchor = dom.createElement('a')\n  if (property.uri) anchor.setAttribute('href', property.uri)\n  anchor.setAttribute('style', style.fieldLabelStyle) // Not too blue and no underline\n  anchor.textContent = lab\n  return anchor\n}\n\nexport function fieldStore (subject, predicate, def) {\n  const sts = kb.statementsMatching(subject, predicate)\n  if (sts.length === 0) return def // can used default as no data yet\n  if (\n    sts.length > 0 &&\n    sts[0].why.uri &&\n    kb.updater.editable(sts[0].why.uri)\n  ) {\n    return kb.sym(sts[0].why.uri)\n  }\n  return def\n}\n*/\n/** Mint local ID using timestamp\n * @param {NamedNode} doc - the document in which the ID is to be generated\n */\nexport function newThing (doc) {\n  const now = new Date()\n  return $rdf.sym(doc.uri + '#' + 'id' + ('' + now.getTime()))\n}\n\n/** Make SELECT element to select options\n//\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param possible - a list of terms, the possible value the object can take\n// @param options.mint - User may create thing if this sent to the prompt string eg \"New foo\"\n// @param options.subForm - If mint, then the form to be used for minting the new thing\n// @param dataDoc - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n*/\nexport function makeSelectForChoice (\n  dom,\n  container,\n  kb,\n  subject,\n  predicate,\n  inputPossibleOptions,\n  selectedOptions,\n  uiFrom,\n  options,\n  dataDoc,\n  callbackFunction\n) {\n  const optionsFromClassUIfrom = {} // Count them\n  const editable = kb.updater.editable(dataDoc.uri)\n\n  for (let i = 0; i < inputPossibleOptions.length; i++) {\n    const sub = inputPossibleOptions[i] // @@ Maybe; make this so it works with blank nodes too\n    // if (!sub.uri) debug.warn(`makeSelectForChoice: option does not have an uri: ${sub}, with predicate: ${predicate}`)\n    if (!sub.uri || sub.uri in optionsFromClassUIfrom) continue\n    optionsFromClassUIfrom[sub.uri] = true\n  }\n  const isEmpty = Object.keys(optionsFromClassUIfrom).length === 0\n  if (isEmpty && !options.mint) {\n    return errorMessageBlock(\n      dom,\n      \"Can't do selector with no options, subject= \" +\n        subject +\n        ' property = ' +\n        predicate +\n        '.'\n    )\n  }\n\n  log.debug('makeSelectForChoice: dataDoc=' + dataDoc)\n\n  function createDefaultSelectOptionText () {\n    let firstSelectOptionText = '--- choice ---'\n\n    if (predicate && !(predicate.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for property: ' + utils.label(predicate) + ' *'\n    }\n\n    if (subject && !(subject.termType === 'BlankNode')) {\n      firstSelectOptionText = '* Select for ' + utils.label(subject, true) + ' *'\n    }\n    return firstSelectOptionText\n  }\n\n  function createDefaultSelectOption () {\n    const option = dom.createElement('option')\n    option.appendChild(dom.createTextNode(createDefaultSelectOptionText()))\n    option.disabled = true\n    option.value = true\n    option.hidden = true\n    option.selected = true\n\n    return option\n  }\n\n  const onChange = function (_e) {\n    container.removeChild(container.lastChild)\n    select.refresh()\n  }\n\n  const select = dom.createElement('select')\n  select.setAttribute('style', style.formSelectSTyle)\n  select.setAttribute('id', 'formSelect')\n  select.currentURI = null\n\n  for (const uri in optionsFromClassUIfrom) {\n    select.appendChild(createOption(uri))\n  }\n\n  if (editable && options.mint) {\n    const mint = dom.createElement('option')\n    mint.appendChild(dom.createTextNode(options.mint))\n    mint.AJAR_mint = true // Flag it\n    select.insertBefore(mint, select.firstChild)\n  }\n\n  if (select.children.length === 0) select.insertBefore(createDefaultSelectOption(), select.firstChild)\n\n  select.update = function (newSelectedOptions) {\n    selectedOptions = newSelectedOptions\n    const ds = []\n    const is = []\n    const removeValue = function (t) {\n      if (kb.holds(subject, predicate, t, dataDoc)) {\n        ds.push($rdf.st(subject, predicate, t, dataDoc))\n      }\n    }\n\n    const addValue = function (t) {\n      if (!kb.holds(subject, predicate, t, dataDoc)) {\n        is.push($rdf.st(subject, predicate, t, dataDoc))\n        // console.log(\"----value added \" + t)\n      }\n      if (uiFrom && (!kb.holds(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))) {\n        is.push($rdf.st(t, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n        // console.log(\"----added type to value \" + uiFrom)\n      }\n    }\n\n    const existingValues = kb.each(subject, predicate, null, dataDoc).map(object => object.value)\n    for (const value of existingValues) {\n      if (!containsObject(value, selectedOptions)) removeValue($rdf.sym(value))\n    }\n    for (const value of selectedOptions) {\n      if (!(value in existingValues)) addValue($rdf.sym(value))\n    }\n\n    kb.updater.update(ds, is, function (uri, ok, body) {\n      if (!ok) return select.parentNode.appendChild(errorMessageBlock(dom, 'Error updating data in select: ' + body))\n      select.refresh()\n      if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'change' })\n    })\n  }\n\n  select.refresh = function () {\n    select.disabled = true // unlocked any conflict we had got into\n    let is = []\n\n    let newObject\n    for (let i = 0; i < select.options.length; i++) {\n      const opt = select.options[i]\n      if (opt.selected && opt.AJAR_mint) {\n        // not sure if this 'if' is used because I cannot find mintClass\n        if (options.mintClass) {\n          const thisForm = promptForNew(\n            dom,\n            kb,\n            subject,\n            predicate,\n            uiFrom,\n            options.subForm,\n            dataDoc,\n            function (ok, body) {\n              if (!ok) {\n                callbackFunction(ok, body, { change: 'new' }) // @@ if ok, need some form of refresh of the select for the new thing\n              }\n            }\n          )\n          select.parentNode.appendChild(thisForm)\n          newObject = thisForm.AJAR_subject\n        } else {\n          newObject = newThing(dataDoc)\n        }\n        is.push($rdf.st(subject, predicate, kb.sym(newObject), dataDoc))\n        if (uiFrom) is.push($rdf.st(newObject, ns.rdf('type'), kb.sym(uiFrom), dataDoc))\n\n        // not sure if this 'if' is used because I cannot find mintStatementsFun\n        if (options.mintStatementsFun) {\n          is = is.concat(options.mintStatementsFun(newObject))\n        }\n        select.currentURI = newObject\n      }\n      if (!opt.AJAR_uri) continue // a prompt or mint\n      if (opt.selected && containsObject(opt.AJAR_uri, selectedOptions)) {\n        select.currentURI = opt.AJAR_uri\n      }\n      if (!containsObject(opt.AJAR_uri, selectedOptions)) opt.removeAttribute('selected')\n      if (containsObject(opt.AJAR_uri, selectedOptions)) opt.setAttribute('selected', 'true')\n    }\n\n    log.info('selectForOptions: data doc = ' + dataDoc)\n\n    if (select.currentURI && options.subForm && !options.multiSelect) {\n      addSubFormChoice(dom, container, {}, $rdf.sym(select.currentURI), options.subForm, dataDoc, function (ok, body) {\n        if (ok) {\n          kb.updater.update([], is, function (uri, success, errorBody) {\n            if (!success) container.appendChild(errorMessageBlock(dom, 'Error updating select: ' + errorBody))\n          })\n          if (callbackFunction) callbackFunction(ok, { widget: 'select', event: 'new' })\n        } else {\n          container.appendChild(errorMessageBlock(dom, 'Error updating data in field of select: ' + body))\n        }\n      })\n    }\n    select.disabled = false\n  }\n\n  function createOption (uri) {\n    const option = dom.createElement('option')\n    const c = kb.sym(uri)\n    let label\n    if (options.disambiguate) {\n      label = utils.labelWithOntology(c, true) // Init. cap\n    } else {\n      label = utils.label(c, true)\n    }\n    option.appendChild(dom.createTextNode(label)) // Init.\n    option.setAttribute('value', uri)\n    const backgroundColor = kb.any(\n      c,\n      kb.sym('http://www.w3.org/ns/ui#backgroundColor')\n    )\n    if (backgroundColor) {\n      option.setAttribute(\n        'style',\n        'background-color: ' + backgroundColor.value + '; '\n      )\n    }\n    option.AJAR_uri = uri\n    if (containsObject(c.value, selectedOptions)) {\n      option.setAttribute('selected', 'true')\n    }\n    return option\n  }\n\n  if (editable) {\n    select.addEventListener('change', onChange, false)\n  }\n\n  return select\n} // makeSelectForChoice\n\nfunction containsObject (obj, list) {\n  let i\n  for (i = 0; i < list.length; i++) {\n    if (list[i] === obj) {\n      return true\n    }\n  }\n\n  return false\n}\n\n// This functions replaces the findMembersNT (thisClass) from rdflib until we fix: https://github.com/linkeddata/rdflib.js/issues/565\n/**\n * For anything which has thisClass (or any subclass) as its type,\n * or is the object of something which has thisClass (or any subclass) as its range,\n * or subject of something which has thisClass (or any subclass) as its domain\n * We don't bother doing subproperty (yet?) as it doesn't seem to be used\n * much.\n * Get all the Classes of which we can RDFS-infer the subject is a member\n * @return a hash of URIs\n */\nfunction findMembersNT (store, thisClass, quad) {\n  let len2\n  let len4\n  let m\n  let pred\n  let ref1\n  let ref2\n  let ref3\n  let ref4\n  let ref5\n  let st\n  let u\n  const seeds = {}\n  seeds[thisClass.toNT()] = true\n  const members = {}\n  const ref = store.transitiveClosure(seeds, store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#subClassOf'), true)\n  for (const t in ref) {\n    ref1 = store.statementsMatching(null,\n      store.rdfFactory.namedNode('http://www.w3.org/1999/02/22-rdf-syntax-ns#type'),\n      store.fromNT(t),\n      quad)\n    for (let i = 0, len = ref1.length; i < len; i++) {\n      st = ref1[i]\n      members[st.subject.toNT()] = st\n    }\n    ref2 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#domain'),\n      store.fromNT(t),\n      quad)\n    for (let l = 0, len1 = ref2.length; l < len1; l++) {\n      pred = ref2[l]\n      ref3 = store.statementsMatching(null, pred, null, quad)\n      for (m = 0, len2 = ref3.length; m < len2; m++) {\n        st = ref3[m]\n        members[st.subject.toNT()] = st\n      }\n    }\n    ref4 = store.each(null,\n      store.rdfFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#range'),\n      store.fromNT(t),\n      quad)\n    for (let q = 0, len3 = ref4.length; q < len3; q++) {\n      pred = ref4[q]\n      ref5 = store.statementsMatching(null, pred, null, quad)\n      for (u = 0, len4 = ref5.length; u < len4; u++) {\n        st = ref5[u]\n        members[st.object.toNT()] = st\n      }\n    }\n  }\n\n  return members\n}\n"],"mappings":"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"}