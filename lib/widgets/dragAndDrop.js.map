{"version":3,"file":"dragAndDrop.js","names":["debug","_interopRequireWildcard","require","mime","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","makeDropTarget","ele","droppedURIHandler","droppedFileHandler","dragoverListener","preventDefault","dataTransfer","dropEffect","dragenterListener","log","style","savedStyle","border","backgroundColor","borderRadius","dragleaveListener","dropListener","types","join","uris","text","length","type","getData","split","files","f","name","size","lastModifiedDate","toLocaleDateString","slice","addTargetListeners","addEventListener","makeDraggable","tr","obj","setAttribute","fontWeight","setData","uri","outerHTML","stopPropagation","uploadFiles","fetcher","fileBase","imageBase","successHandler","reader","FileReader","onload","theFile","data","target","result","suffix","byteLength","contentType","lookup","msg","alert","Error","extension","endsWith","folderName","startsWith","destURI","encodeURIComponent","webOperation","then","_response","error","readAsArrayBuffer"],"sources":["../../src/widgets/dragAndDrop.js"],"sourcesContent":["/* Drag and drop common functionality\n *\n * It is easy to make something draggable, or to make it a drag target!\n * Just call the functions below.  In a solid world, any part of the UI which\n * represent one thing which has a UR, should be made draggable using makeDraggable\n * Any list of things should typically allow you to drag new members of the list\n * onto it.\n * The file upload function uploadFiles is provided as often of someone drags a file from the computer\n * desktop, you may want to upload it into the pod.\n */\nimport * as debug from '../debug'\nimport * as mime from 'mime-types'\n\n/* global FileReader alert */\n\nexport function makeDropTarget (ele, droppedURIHandler, droppedFileHandler) {\n  const dragoverListener = function (e) {\n    e.preventDefault() // Neeed else drop does not work [sic]\n    e.dataTransfer.dropEffect = 'copy'\n  }\n\n  const dragenterListener = function (e) {\n    debug.log('dragenter event dropEffect: ' + e.dataTransfer.dropEffect)\n    if (this.style) {\n      //  necessary not sure when\n      if (!this.savedStyle) {\n        this.savedStyle = {}\n        this.savedStyle.border = this.style.border\n        this.savedStyle.backgroundColor = this.style.backgroundColor\n        this.savedStyle.borderRadius = this.style.borderRadius\n      }\n      this.style.backgroundColor = '#ccc'\n      this.style.border = '0.25em dashed black'\n      this.style.borderRadius = '0.3em'\n    }\n\n    e.dataTransfer.dropEffect = 'link'\n    debug.log('dragenter event dropEffect 2: ' + e.dataTransfer.dropEffect)\n  }\n  const dragleaveListener = function (e) {\n    debug.log('dragleave event dropEffect: ' + e.dataTransfer.dropEffect)\n    if (this.savedStyle) {\n      this.style.border = this.savedStyle.border\n      this.style.backgroundColor = this.savedStyle.backgroundColor\n      this.style.borderRadius = this.savedStyle.borderRadius\n    } else {\n      this.style.backgroundColor = 'white'\n      this.style.border = '0em solid black'\n    }\n  }\n\n  const dropListener = function (e) {\n    if (e.preventDefault) e.preventDefault() // stops the browser from redirecting off to the text.\n    debug.log('Drop event. dropEffect: ' + e.dataTransfer.dropEffect)\n    debug.log(\n      'Drop event. types: ' +\n        (e.dataTransfer.types ? e.dataTransfer.types.join(', ') : 'NOPE')\n    )\n\n    let uris = null\n    let text\n    if (e.dataTransfer.types) {\n      for (let t = 0; t < e.dataTransfer.types.length; t++) {\n        const type = e.dataTransfer.types[t]\n        if (type === 'text/uri-list') {\n          uris = e.dataTransfer.getData(type).split('\\n') // @ ignore those starting with #\n          debug.log('Dropped text/uri-list: ' + uris)\n        } else if (type === 'text/plain') {\n          text = e.dataTransfer.getData(type)\n        } else if (type === 'Files' && droppedFileHandler) {\n          const files = e.dataTransfer.files // FileList object.\n          for (let i = 0; files[i]; i++) {\n            const f = files[i]\n            debug.log(\n              'Filename: ' +\n                f.name +\n                ', type: ' +\n                (f.type || 'n/a') +\n                ' size: ' +\n                f.size +\n                ' bytes, last modified: ' +\n                (f.lastModifiedDate\n                  ? f.lastModifiedDate.toLocaleDateString()\n                  : 'n/a')\n            )\n          }\n          droppedFileHandler(files)\n        }\n      }\n      if (uris === null && text && text.slice(0, 4) === 'http') {\n        uris = text\n        debug.log(\"Waring: Poor man's drop: using text for URI\") // chrome disables text/uri-list??\n      }\n    } else {\n      // ... however, if we're IE, we don't have the .types property, so we'll just get the Text value\n      uris = [e.dataTransfer.getData('Text')]\n      debug.log('WARNING non-standard drop event: ' + uris[0])\n    }\n    debug.log('Dropped URI list (2): ' + uris)\n    if (uris) {\n      droppedURIHandler(uris)\n    }\n    this.style.backgroundColor = 'white' // restore style\n    return false\n  } // dropListener\n\n  const addTargetListeners = function (ele) {\n    if (!ele) {\n      debug.log('@@@ addTargetListeners: ele ' + ele)\n    }\n    ele.addEventListener('dragover', dragoverListener)\n    ele.addEventListener('dragenter', dragenterListener)\n    ele.addEventListener('dragleave', dragleaveListener)\n    ele.addEventListener('drop', dropListener)\n  }\n  addTargetListeners(ele, droppedURIHandler)\n} // listen for dropped URIs\n\n// Make an HTML element draggable as a URI-identified thing\n//\n// Possibly later set the drag image too?\n//\nexport function makeDraggable (tr, obj) {\n  tr.setAttribute('draggable', 'true') // Stop the image being dragged instead - just the TR\n\n  tr.addEventListener(\n    'dragstart',\n    function (e) {\n      tr.style.fontWeight = 'bold'\n      e.dataTransfer.setData('text/uri-list', obj.uri)\n      e.dataTransfer.setData('text/plain', obj.uri)\n      e.dataTransfer.setData('text/html', tr.outerHTML)\n      debug.log(\n        'Dragstart: ' + tr + ' -> ' + obj + 'de: ' + e.dataTransfer.dropEffect\n      )\n    },\n    false\n  )\n\n  tr.addEventListener(\n    'drag',\n    function (e) {\n      e.preventDefault()\n      e.stopPropagation()\n      // debug.log('Drag: dropEffect: ' + e.dataTransfer.dropEffect)\n    },\n    false\n  )\n\n  tr.addEventListener(\n    'dragend',\n    function (e) {\n      tr.style.fontWeight = 'normal'\n      debug.log('Dragend dropeffect: ' + e.dataTransfer.dropEffect)\n      debug.log('Dragend: ' + tr + ' -> ' + obj)\n    },\n    false\n  )\n}\n\n/** uploadFiles\n**\n**  Generic uploader of local files to the web\n**   typically called from dropped file handler\n**\n**  @param {Fetcher} fetcher    instance of class Fetcher as in kb.fetcher\n**  @param {Array<File>} files      Array of file objects\n**  @param {String} fileBase    URI of folder in which to put files (except images) (no trailing slash)\n**  @param {String } imageBase  URI of folder in which to put images\n**  @param successHandler function(file, uploadedURI)    Called after EACH success upload\n**                              With file object an final URI as params\n*/\n\nexport function uploadFiles (fetcher, files, fileBase, imageBase, successHandler) {\n  for (let i = 0; files[i]; i++) {\n    const f = files[i]\n    debug.log(\n      ' dropped: Filename: ' +\n        f.name +\n        ', type: ' +\n        (f.type || 'n/a') +\n        ' size: ' +\n        f.size +\n        ' bytes, last modified: ' +\n        (f.lastModifiedDate ? f.lastModifiedDate.toLocaleDateString() : 'n/a')\n    ) // See e.g. https://www.html5rocks.com/en/tutorials/file/dndfiles/\n\n    // @@ Add: progress bar(s)\n    const reader = new FileReader()\n    reader.onload = (function (theFile) {\n      return function (e) {\n        const data = e.target.result\n        let suffix = ''\n        debug.log(' File read byteLength : ' + data.byteLength)\n        let contentType = theFile.type\n        if (!theFile.type || theFile.type === '') {\n          // Not known by browser\n          contentType = mime.lookup(theFile.name)\n          if (!contentType) {\n            const msg =\n              'Filename needs to have an extension which gives a type we know: ' +\n              theFile.name\n            debug.log(msg)\n            alert(msg)\n            throw new Error(msg)\n          }\n        } else {\n          const extension = mime.extension(theFile.type)\n          // Note not simple: eg .mp3 => audio/mpeg; .mpga => audio/mpeg; audio/mp3 => .mp3\n          if (extension && extension !== 'false' && !theFile.name.endsWith('.' + extension) && // Not already has preferred extension? and ...\n            theFile.type !== mime.lookup(theFile.name)) { // the mime type of this ext is not the right one?\n            suffix = '_.' + extension\n            // console.log('MIME TYPE MISMATCH: ' + mime.lookup(theFile.name) + ': adding extension: ' + suffix)\n          }\n        }\n        const folderName = theFile.type.startsWith('image/')\n          ? imageBase || fileBase\n          : fileBase\n        const destURI =\n          folderName +\n          (folderName.endsWith('/') ? '' : '/') +\n          encodeURIComponent(theFile.name) +\n          suffix\n\n        fetcher\n          .webOperation('PUT', destURI, {\n            data,\n            contentType\n          })\n          .then(\n            _response => {\n              debug.log(' Upload: put OK: ' + destURI)\n              successHandler(theFile, destURI)\n            },\n            error => {\n              const msg = ' Upload: FAIL ' + destURI + ', Error: ' + error\n              debug.log(msg)\n              alert(msg)\n              throw new Error(msg)\n            }\n          )\n      }\n    })(f)\n    reader.readAsArrayBuffer(f)\n  }\n}\n"],"mappings":"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"}