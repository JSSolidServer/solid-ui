{"version":3,"file":"buttons.js","names":["iconBase","icons","cancelIconURI","checkIconURI","getStatusArea","context","box","statusArea","div","dom","document","body","getElementsByTagName","createElement","insertBefore","firstElementChild","complain","err","ele","debug","log","appendChild","errorMessageBlock","alert","clearElement","firstChild","removeChild","extractLogURI","fullURI","logPos","search","rulPos","substring","shortDate","str","noTime","month","nowZ","Date","toISOString","slice","parseInt","e","formatDateTime","date","format","split","map","s","k","width","Milliseconds","FullYear","d","Month","join","timestamp","shortTime","setName","element","x","kb","store","findName","name","any","ns","vcard","foaf","value","sameTerm","textContent","utils","label","uri","fetcher","Error","nowOrWhenFetched","doc","undefined","_ok","imagesOf","each","sioc","concat","iconForClass","tempSite","p","indexOf","q","findImageFromURI","iconDir","length","startsWith","findImage","thing","rdf","image","trySetImage","iconForClassMap","explitImage","setAttribute","typeIcon","style","classIconStyle","schemeIcon","types","findTypeURIs","typeURI","setImage","pref","id","theClass","happy","ok","faviconOrDefault","iconStyle","isOrigin","parts","res","renderDeleteConfirmPopup","refererenceElement","prompt","deleteFunction","removePopup","parentElement","removePopupAndDoDeletion","popup","confirmPopupStyle","position","top","display","gridTemplateColumns","affirm","gridColumn","gridRow","cancel","xButton","cancelButton","cancelPrompt","buttonStyle","affirmIcon","button","sureButtonElt","addEventListener","deleteButtonWithCheck","container","noun","createPopup","deleteButton","minusIconURI","smallButtonStyle","title","classList","add","getButtonStyle","options","color","buttonColor","backgroundColor","fontColor","borderColor","hoverBackgroundColor","hoverFontColor","needsBorder","border","cursor","padding","transition","outline","iconURI","text","handler","img","toLocaleUpperCase","getClasses","head","textButton","classes","b","opacity","continueButton","askName","predicate","Promise","resolve","_reject","form","namefield","textInputStyle","select","gotName","parentNode","trim","keyCode","_event","focus","personTR","renderAsRow","pred","obj","tr","td1","td2","td3","link","anchor","linkIcon","draggable","makeDraggable","subject","createNameDiv","nameDiv","createLinkDiv","linkDiv","linkDivStyle","createLinkForURI","renderAsDiv","renderAsDivStyle","createImageDiv","clickable","onClickFunction","addClickListenerToElement","wrapInATR","wrapDivInATR","refreshTree","root","refresh","i","children","attachmentList","deleteAttachment","target","updater","update","st","errorBody","_xhr","createNewRow","theTarget","opt","modify","things","sort","syncTableToArray","attachmentTable","droppedURIHandler","uris","ins","forEach","u","sym","push","droppedFileHandler","files","uploadFiles","uploadFolder","theFile","destURI","promptIcon","wf","attachmentOuter","attachmentOne","attachmentLeft","attachmentRight","paperclip","fhandler","makeDropTarget","buttonDiv","fileUploadButtonDiv","openHrefInOutlineMode","preventDefault","stopPropagation","getTarget","getAttribute","window","outlineManager","GotoSubject","panes","getOutliner","defaultAnnotationStore","hash","slash","lastIndexOf","allClassURIs","set","statementsMatching","object","rdfs","c","propertyTriage","possibleProperties","dp","op","no","nd","nu","pi","predicateIndex","termType","ps","toNT","info","linkButton","removeButton","selectorPanel","type","inverse","possible","callbackFunction","linkCallback","selectorPanelRefresh","list","style0","selected","innerHTML","refreshItem","item","setStyle","already","iconDiv","connectIcon","f","index","twoLine","widgetForClass","nav","a","event","twoLineDefault","twoLineWidgetForClass","widget","sup","findSuperClassesNT","cl","fromNT","twoLineTransaction","failed","enc","y","qu","escapeForXML","twoLineTrip","dc","cal","addStyleSheet","href","links","querySelectorAll","isAudio","file","isImage","isVideo","kind","dcCLasses","audio","video","what","typeURIs","prefix","Util","mediaTypeClass","t","input","buttonElt","click","line"],"sources":["../../src/widgets/buttons.ts"],"sourcesContent":["/*  Buttons\n*/\nimport { IndexedFormula, NamedNode, st, sym, uri, Util } from 'rdflib'\nimport { icons } from '../iconBase'\nimport * as ns from '../ns'\nimport * as style from '../style'\nimport * as debug from '../debug'\nimport { info } from '../log'\nimport { getClasses } from '../jss'\nimport { uploadFiles, makeDraggable, makeDropTarget } from './dragAndDrop'\nimport { store } from 'solid-logic'\nimport * as utils from '../utils'\nimport { errorMessageBlock } from './error'\nimport { addClickListenerToElement, createImageDiv, wrapDivInATR } from './widgetHelpers'\nimport { linkIcon, createLinkForURI } from './buttons/iconLinks'\n\n/**\n * UI Widgets such as buttons\n * @packageDocumentation\n */\n\n/* global alert */\n\nconst { iconBase } = icons\n\nconst cancelIconURI = iconBase + 'noun_1180156.svg' // black X\nconst checkIconURI = iconBase + 'noun_1180158.svg' // green checkmark; Continue\n\nexport type StatusAreaContext = {\n  statusArea?: HTMLElement\n  div?: HTMLElement\n  dom?: HTMLDocument\n}\nexport type ButtonType = 'Primary' | 'Secondary'\n\nexport type ButtonWidgetOptions = {\n  buttonColor?: ButtonType,\n  needsBorder?: boolean\n}\n\nexport type RenderAsDivOptions = {\n  image?: HTMLImageElement,\n  title?: string,\n  deleteFunction?: () => void,\n  link?: boolean,\n  noun?: string,\n  draggable?: boolean,\n  clickable?: boolean,\n  onClickFunction?: () => void,\n  wrapInATR?: boolean\n}\n\nfunction getStatusArea (context?: StatusAreaContext) {\n  let box = (context && context.statusArea) || (context && context.div) || null\n  if (box) return box\n  let dom = context && context.dom\n  if (!dom && typeof document !== 'undefined') {\n    dom = document\n  }\n  if (dom) {\n    const body = dom.getElementsByTagName('body')[0]\n    box = dom.createElement('div')\n    body.insertBefore((box as unknown as HTMLElement), body.firstElementChild)\n    if (context) {\n      context.statusArea = (box as unknown as HTMLElement)\n    }\n    return box\n  }\n  return null\n}\n\n/**\n * Display an error message block\n */\nexport function complain (context?: StatusAreaContext, err?: string) {\n  if (!err) return // only if error\n  const ele = getStatusArea(context)\n  debug.log('Complaint: ' + err)\n  if (ele) ele.appendChild(errorMessageBlock((context && context.dom) || document, err))\n  else alert(err)\n}\n\n/**\n * Remove all the children of an HTML element\n */\nexport function clearElement (ele: HTMLElement) {\n  while (ele.firstChild) {\n    ele.removeChild(ele.firstChild)\n  }\n  return ele\n}\n\n/**\n * To figure out the log URI from the full URI used to invoke the reasoner\n */\nexport function extractLogURI (fullURI) {\n  const logPos = fullURI.search(/logFile=/)\n  const rulPos = fullURI.search(/&rulesFile=/)\n  return fullURI.substring(logPos + 8, rulPos)\n}\n\n/**\n * By default, converts e.g. '2020-02-19T19:35:28.557Z' to '19:35'\n * if today is 19 Feb 2020, and to 'Feb 19' if not.\n * @@@ TODO This needs to be changed to local time\n * @param noTime Return a string like 'Feb 19' even if it's today.\n */\nexport function shortDate (str?: string, noTime?: boolean): string {\n  if (!str) return '???'\n  const month = [\n    'Jan',\n    'Feb',\n    'Mar',\n    'Apr',\n    'May',\n    'Jun',\n    'Jul',\n    'Aug',\n    'Sep',\n    'Oct',\n    'Nov',\n    'Dec'\n  ]\n  try {\n    const nowZ = new Date().toISOString()\n    // var nowZ = $rdf.term(now).value\n    // var n = now.getTimezoneOffset() // Minutes\n    if (str.slice(0, 10) === nowZ.slice(0, 10) && !noTime) {\n      return str.slice(11, 16)\n    }\n    if (str.slice(0, 4) === nowZ.slice(0, 4)) {\n      return (\n        month[parseInt(str.slice(5, 7), 10) - 1] +\n        ' ' +\n        parseInt(str.slice(8, 10), 10)\n      )\n    }\n    return str.slice(0, 10)\n  } catch (e) {\n    return 'shortdate:' + e\n  }\n}\n\n/**\n * Format a date and time\n * @param date for instance `new Date()`\n * @param format  for instance '{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\n * @returns for instance '2000-01-15T23:14:23.002'\n */\nexport function formatDateTime (date: Date, format: string): string {\n  return format\n    .split('{')\n    .map(function (s) {\n      const k = s.split('}')[0]\n      const width = { Milliseconds: 3, FullYear: 4 }\n      const d = { Month: 1 }\n      return s\n        ? ('000' + (date['get' + k]() + (d[k] || 0))).slice(-(width[k] || 2)) + s.split('}')[1]\n        : ''\n    })\n    .join('')\n}\n\n/**\n * Get a string representation of the current time\n * @returns for instance '2000-01-15T23:14:23.002'\n */\nexport function timestamp (): string {\n  return formatDateTime(\n    new Date(),\n    '{FullYear}-{Month}-{Date}T{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\n  )\n}\n\n/**\n * Get a short string representation of the current time\n * @returns for instance '23:14:23.002'\n */\nexport function shortTime (): string {\n  return formatDateTime(\n    new Date(),\n    '{Hours}:{Minutes}:{Seconds}.{Milliseconds}'\n  )\n}\n\n// ///////////////////// Handy UX widgets\n\n/**\n * Sets the best name we have and looks up a better one\n */\nexport function setName (element: HTMLElement, x: NamedNode) {\n  const kb = store\n  const findName = function (x) {\n    const name =\n      kb.any(x, ns.vcard('fn')) ||\n      kb.any(x, ns.foaf('name')) ||\n      kb.any(x, ns.vcard('organization-name'))\n    return name ? name.value : null\n  }\n  const name = x.sameTerm(ns.foaf('Agent')) ? 'Everyone' : findName(x)\n  element.textContent = name || utils.label(x)\n  if (!name && x.uri) {\n    if (!kb.fetcher) {\n      throw new Error('kb has no fetcher')\n    }\n    // Note this is only a fetch, not a lookUP of all sameAs etc\n    kb.fetcher.nowOrWhenFetched(x.doc(), undefined, function (_ok) {\n      element.textContent = findName(x) || utils.label(x) // had: (ok ? '' : '? ') +\n    })\n  }\n}\n\n/**\n * Set of suitable images\n * See also [[findImage]]\n * @param x The thing for which we want to find an image\n * @param kb The RDF store to look in\n * @returns It goes looking for triples in `kb`,\n *          `(subject: x), (predicate: see list below) (object: image-url)`\n *          to find any image linked from the thing with one of the following\n *          predicates (in order):\n *          * ns.sioc('avatar')\n *          * ns.foaf('img')\n *          * ns.vcard('logo')\n *          * ns.vcard('hasPhoto')\n *          * ns.vcard('photo')\n *          * ns.foaf('depiction')\n\n */\nexport function imagesOf (x: NamedNode | null, kb: IndexedFormula): any[] {\n  return kb\n    .each(x, ns.sioc('avatar'))\n    .concat(kb.each(x, ns.foaf('img')))\n    .concat(kb.each(x, ns.vcard('logo')))\n    .concat(kb.each(x, ns.vcard('hasPhoto')))\n    .concat(kb.each(x, ns.vcard('photo')))\n    .concat(kb.each(x, ns.foaf('depiction')))\n}\n\n/**\n * Best logo or avatar or photo etc to represent someone or some group etc\n */\nexport const iconForClass = {\n  // Potentially extendable by other apps, panes, etc\n  // Relative URIs to the iconBase\n  'solid:AppProviderClass': 'noun_144.svg', //  @@ classs name should not contain 'Class'\n  'solid:AppProvider': 'noun_15177.svg', // @@\n  'solid:Pod': 'noun_Cabinet_1434380.svg',\n  'vcard:Group': 'noun_339237.svg',\n  'vcard:Organization': 'noun_143899.svg',\n  'vcard:Individual': 'noun_15059.svg',\n  'schema:Person': 'noun_15059.svg',\n  'foaf:Person': 'noun_15059.svg',\n  'foaf:Agent': 'noun_98053.svg',\n  'acl:AuthenticatedAgent': 'noun_99101.svg',\n  'prov:SoftwareAgent': 'noun_Robot_849764.svg', // Bot\n  'vcard:AddressBook': 'noun_15695.svg',\n  'trip:Trip': 'noun_581629.svg',\n  'meeting:LongChat': 'noun_1689339.svg',\n  'meeting:Meeting': 'noun_66617.svg',\n  'meeting:Project': 'noun_1036577.svg',\n  'ui:Form': 'noun_122196.svg',\n  'rdfs:Class': 'class-rectangle.svg', // For RDF developers\n  'rdf:Property': 'property-diamond.svg',\n  'owl:Ontology': 'noun_classification_1479198.svg',\n  'wf:Tracker': 'noun_122196.svg',\n  'wf:Task': 'noun_17020_gray-tick.svg',\n  'wf:Open': 'noun_17020_sans-tick.svg',\n  'wf:Closed': 'noun_17020.svg'\n}\n\n/**\n * Returns the origin of the URI of a NamedNode\n */\nfunction tempSite (x: NamedNode) {\n  // use only while one in rdflib fails with origins 2019\n  const str = x.uri.split('#')[0]\n  const p = str.indexOf('//')\n  if (p < 0) throw new Error('This URI does not have a web site part (origin)')\n  const q = str.indexOf('/', p + 2)\n  if (q < 0) {\n    // no third slash?\n    return str.slice(0) + '/' // Add slash to a bare origin\n  } else {\n    return str.slice(0, q + 1)\n  }\n}\n\n/**\n * Find an image for this thing as a class\n */\nexport function findImageFromURI (x: NamedNode | string): string | null {\n  const iconDir = iconBase\n\n  // Special cases from URI scheme:\n  if (typeof x !== 'string' && x.uri) {\n    if (\n      x.uri.split('/').length === 4 &&\n      !x.uri.split('/')[1] &&\n      !x.uri.split('/')[3]\n    ) {\n      return iconDir + 'noun_15177.svg' // App -- this is an origin\n    }\n    // Non-HTTP URI types imply types\n    if (x.uri.startsWith('message:') || x.uri.startsWith('mid:')) {\n      // message: is apple bug-- should be mid:\n      return iconDir + 'noun_480183.svg' // envelope  noun_567486\n    }\n    if (x.uri.startsWith('mailto:')) {\n      return iconDir + 'noun_567486.svg' // mailbox - an email desitination\n    }\n    // For HTTP(s) documents, we could look at the MIME type if we know it.\n    if (x.uri.startsWith('https:') && x.uri.indexOf('#') < 0) {\n      return tempSite(x) + 'favicon.ico' // was x.site().uri + ...\n      // Todo: make the document icon a fallback for if the favicon does not exist\n      // todo: pick up a possible favicon for the web page itself from a link\n      // was: return iconDir + 'noun_681601.svg' // document - under solid assumptions\n    }\n    return null\n  }\n\n  return iconDir + 'noun_10636_grey.svg' // Grey Circle -  some thing\n}\n\n/**\n * Find something we have as explicit image data for the thing\n * See also [[imagesOf]]\n * @param thing The thing for which we want to find an image\n * @returns The URL of a globe icon if thing equals `ns.foaf('Agent')`\n *          or `ns.rdf('Resource')`. Otherwise, it goes looking for\n *          triples in `store`,\n *          `(subject: thing), (predicate: see list below) (object: image-url)`\n *          to find any image linked from the thing with one of the following\n *          predicates (in order):\n *          * ns.sioc('avatar')\n *          * ns.foaf('img')\n *          * ns.vcard('logo')\n *          * ns.vcard('hasPhoto')\n *          * ns.vcard('photo')\n *          * ns.foaf('depiction')\n */\nexport function findImage (thing: NamedNode): string {\n  const kb = store\n  const iconDir = iconBase\n  if (thing.sameTerm(ns.foaf('Agent')) || thing.sameTerm(ns.rdf('Resource'))) {\n    return iconDir + 'noun_98053.svg' // Globe\n  }\n  const image =\n    kb.any(thing, ns.sioc('avatar')) ||\n    kb.any(thing, ns.foaf('img')) ||\n    kb.any(thing, ns.vcard('logo')) ||\n    kb.any(thing, ns.vcard('hasPhoto')) ||\n    kb.any(thing, ns.vcard('photo')) ||\n    kb.any(thing, ns.foaf('depiction'))\n  return image ? (image as any).uri : null\n}\n\n/**\n * Do the best you can with the data available\n *\n * @return {Boolean} Are we happy with this icon?\n * Sets src AND STYLE of the image.\n */\nfunction trySetImage (element, thing, iconForClassMap) {\n  const kb = store\n\n  const explitImage = findImage(thing)\n  if (explitImage) {\n    element.setAttribute('src', explitImage)\n    return true\n  }\n  // This is one of the classes we know about - the class itself?\n  const typeIcon = iconForClassMap[thing.uri]\n  if (typeIcon) {\n    element.setAttribute('src', typeIcon)\n    element.style = style.classIconStyle\n    // element.style.border = '0.1em solid green;'\n    // element.style.backgroundColor = '#eeffee' // pale green\n    return true\n  }\n  const schemeIcon = findImageFromURI(thing)\n  if (schemeIcon) {\n    element.setAttribute('src', schemeIcon)\n    return true // happy with this -- don't look it up\n  }\n\n  // Do we have a generic icon for something in any class its in?\n  const types = kb.findTypeURIs(thing)\n  for (const typeURI in types) {\n    if (iconForClassMap[typeURI]) {\n      element.setAttribute('src', iconForClassMap[typeURI])\n      return false // maybe we can do better\n    }\n  }\n  element.setAttribute('src', iconBase + 'noun_10636_grey.svg') // Grey Circle -  some thing\n  return false // we can do better\n}\n\n/**\n * ToDo: Also add icons for *properties* like  home, work, email, range, domain, comment,\n */\nexport function setImage (element: HTMLElement, thing: NamedNode) { // 20191230a\n  const kb = store\n\n  const iconForClassMap = {}\n  for (const k in iconForClass) {\n    const pref = k.split(':')[0]\n    const id = k.split(':')[1]\n    const theClass = ns[pref](id)\n    iconForClassMap[theClass.uri] = uri.join(iconForClass[k], iconBase)\n  }\n\n  const happy = trySetImage(element, thing, iconForClassMap)\n  if (!happy && thing.uri) {\n    if (!kb.fetcher) {\n      throw new Error('kb has no fetcher')\n    }\n    kb.fetcher.nowOrWhenFetched(thing.doc(), undefined, (ok) => {\n      if (ok) {\n        trySetImage(element, thing, iconForClassMap)\n      }\n    })\n  }\n}\n\n// If a web page, then a favicon, with a fallback to ???\n// See, e.g., http://stackoverflow.com/questions/980855/inputting-a-default-image\nexport function faviconOrDefault (dom: HTMLDocument, x: NamedNode) {\n  const image = dom.createElement('img')\n  ;(image as any).style = style.iconStyle\n  const isOrigin = function (x) {\n    if (!x.uri) return false\n    const parts = x.uri.split('/')\n    return parts.length === 3 || (parts.length === 4 && parts[3] === '')\n  }\n  image.setAttribute(\n    'src',\n    iconBase + (isOrigin(x) ? 'noun_15177.svg' : 'noun_681601.svg') // App symbol vs document\n  )\n  if (x.uri && x.uri.startsWith('https:') && x.uri.indexOf('#') < 0) {\n    const res = dom.createElement('object') // favico with a fallback of a default image if no favicon\n    res.setAttribute('data', tempSite(x) + 'favicon.ico')\n    res.setAttribute('type', 'image/x-icon')\n    res.appendChild(image) // fallback\n    return res\n  } else {\n    setImage(image, x)\n    return image\n  }\n}\n\n/* Two-option dialog pop-up\n*/\n\nfunction renderDeleteConfirmPopup (dom, refererenceElement, prompt, deleteFunction) {\n  function removePopup () {\n    refererenceElement.parentElement.removeChild(refererenceElement)\n  }\n  function removePopupAndDoDeletion () {\n    removePopup()\n    deleteFunction()\n  }\n  const popup = dom.createElement('div')\n  popup.style = style.confirmPopupStyle\n  popup.style.position = 'absolute'\n  popup.style.top = '-1em' // try leaving original button clear\n\n  popup.style.display = 'grid'\n  popup.style.gridTemplateColumns = 'auto auto'\n  const affirm = dom.createElement('div')\n  affirm.style.gridColumn = '1/2'\n  affirm.style.gridRow = '1' // @@ sigh; TS. could pass number in fact\n  const cancel = dom.createElement('div')\n  cancel.style.gridColumn = '1/2'\n  cancel.style.gridRow = '2'\n\n  const xButton = cancelButton(dom, removePopup)\n  popup.appendChild(xButton)\n  xButton.style.gridColumn = '1'\n  xButton.style.gridRow = '2'\n\n  const cancelPrompt = popup.appendChild(dom.createElement('button'))\n  cancelPrompt.style = style.buttonStyle\n  cancelPrompt.style.gridRow = '2'\n  cancelPrompt.style.gridColumn = '2'\n  cancelPrompt.textContent = 'Cancel' // @@ I18n\n\n  const affirmIcon = button(dom, icons.iconBase + 'noun_925021.svg', 'Delete it') // trashcan\n  popup.appendChild(affirmIcon)\n  affirmIcon.style.gridRow = '1'\n  affirmIcon.style.gridColumn = '1'\n\n  const sureButtonElt = popup.appendChild(dom.createElement('button'))\n  sureButtonElt.style = style.buttonStyle\n  sureButtonElt.style.gridRow = '1'\n  sureButtonElt.style.gridColumn = '2'\n  sureButtonElt.textContent = prompt\n  popup.appendChild(sureButtonElt)\n\n  affirmIcon.addEventListener('click', removePopupAndDoDeletion)\n  sureButtonElt.addEventListener('click', removePopupAndDoDeletion)\n\n  // xButton.addEventListener('click', removePopup)\n  cancelPrompt.addEventListener('click', removePopup)\n\n  return popup\n}\n/**\n * Delete button with a check you really mean it\n * @@ Supress check if command key held down?\n */\nexport function deleteButtonWithCheck (\n  dom: HTMLDocument,\n  container: HTMLElement,\n  noun: string,\n  deleteFunction: () => any\n) {\n  function createPopup () {\n    const refererenceElement = dom.createElement('div')\n    container.insertBefore(refererenceElement, deleteButton)\n    refererenceElement.style.position = 'relative' // Needed as reference for popup\n    refererenceElement.appendChild(renderDeleteConfirmPopup(dom, refererenceElement, prompt, deleteFunction))\n  }\n  const minusIconURI = iconBase + 'noun_2188_red.svg' // white minus in red #cc0000 circle\n  const deleteButton = dom.createElement('img')\n  deleteButton.setAttribute('src', minusIconURI)\n\n  deleteButton.setAttribute('style', style.smallButtonStyle) // @@tsc - would set deleteButton.style\n  deleteButton.style.float = 'right' // Historically this has alwaus floated right\n\n  const prompt = 'Remove this ' + noun\n  deleteButton.title = prompt\n  // @@ In an ideal world, make use of hover an accessibility option\n  deleteButton.classList.add('hoverControlHide')\n\n  deleteButton.addEventListener('click', createPopup)\n\n  container.classList.add('hoverControl')\n  container.appendChild(deleteButton)\n  deleteButton.setAttribute('data-testid', 'deleteButtonWithCheck')\n  return deleteButton // or button div?  caller may change size of image\n}\n\n/**\n * Get the button style, based on options.\n * See https://design.inrupt.com/atomic-core/?cat=Atoms#Buttons\n */\nfunction getButtonStyle (options: ButtonWidgetOptions = {}) {\n  // default to primary color\n  const color: string = (options.buttonColor === 'Secondary') ? '#01c9ea' : '#7c4dff'\n  let backgroundColor: string = color\n  let fontColor: string = '#ffffff'\n  let borderColor: string = color\n  // default to primary color\n  let hoverBackgroundColor: string = (options.buttonColor === 'Secondary') ? '#37cde6' : '#9f7dff'\n  let hoverFontColor: string = fontColor\n  if (options.needsBorder) {\n    backgroundColor = '#ffffff'\n    fontColor = color\n    borderColor = color\n    hoverBackgroundColor = color\n    hoverFontColor = backgroundColor\n  }\n\n  return {\n    'background-color': `${backgroundColor}`,\n    color: `${fontColor}`,\n    'font-family': 'Raleway, Roboto, sans-serif',\n    'border-radius': '0.25em',\n    'border-color': `${borderColor}`,\n    border: '1px solid',\n    cursor: 'pointer',\n    'font-size': '.8em',\n    'text-decoration': 'none',\n    padding: '0.5em 4em',\n    transition: '0.25s all ease-in-out',\n    outline: 'none',\n    '&:hover': {\n      'background-color': `${hoverBackgroundColor}`,\n      color: `${hoverFontColor}`,\n      transition: '0.25s all ease-in-out'\n    }\n  }\n}\n\n/*  Make a button\n *\n * @param dom - the DOM document object\n * @Param iconURI - the URI of the icon to use (if any)\n * @param text - the tooltip text or possibly button contents text\n * @param handler <function> - A handler to called when button is clicked\n *\n * @returns <dDomElement> - the button\n */\nexport function button (dom: HTMLDocument, iconURI: string | undefined, text: string,\n  handler?: (_event: any) => void,\n  options: ButtonWidgetOptions = { buttonColor: 'Primary', needsBorder: false }) {\n  const button = dom.createElement('button')\n  button.setAttribute('type', 'button')\n  // button.innerHTML = text  // later, user preferences may make text preferred for some\n  if (iconURI) {\n    const img = button.appendChild(dom.createElement('img'))\n    img.setAttribute('src', iconURI)\n    img.setAttribute('style', 'width: 2em; height: 2em;') // trial and error. 2em disappears\n    img.title = text\n    button.setAttribute('style', style.buttonStyle)\n  } else {\n    button.textContent = text.toLocaleUpperCase()\n    const style = getButtonStyle(options)\n    const { classes } = getClasses(dom.head, {\n      textButton: style\n    })\n\n    button.classList.add(classes.textButton)\n  }\n  if (handler) {\n    button.addEventListener('click', handler, false)\n  }\n  return button\n}\n\n/*  Make a cancel button\n *\n * @param dom - the DOM document object\n * @param handler <function> - A handler to called when button is clicked\n *\n * @returns <dDomElement> - the button\n */\nexport function cancelButton (dom: HTMLDocument, handler: (_event?: any) => void) {\n  const b = button(dom, cancelIconURI, 'Cancel', handler)\n  if (b.firstChild) { // sigh for tsc\n    (b.firstChild as HTMLElement).style.opacity = '0.3' // Black X is too harsh: current language is grey X\n  }\n  return b\n}\n\n/*  Make a continue button\n *\n * @param dom - the DOM document object\n * @param handler <function> - A handler to called when button is clicked\n *\n * @returns <dDomElement> - the button\n */\nexport function continueButton (dom: HTMLDocument, handler: (_event: any) => void) {\n  return button(dom, checkIconURI, 'Continue', handler)\n}\n\n/* Grab a name for a new thing\n *\n * Form to get the name of a new thing before we create it\n * @params theClass  Misspelt to avoid clashing with the JavaScript keyword\n * @returns: a promise of (a name or null if cancelled)\n */\nexport function askName (\n  dom: HTMLDocument,\n  kb: IndexedFormula,\n  container: HTMLDivElement,\n  predicate?: NamedNode,\n  theClass?: NamedNode,\n  noun?: string) {\n  // eslint-disable-next-line promise/param-names\n  return new Promise(function (resolve, _reject) {\n    const form = dom.createElement('div') // form is broken as HTML behaviour can resurface on js error\n    // classLabel = utils.label(ns.vcard('Individual'))\n    predicate = predicate || ns.foaf('name') // eg 'name' in user's language\n    noun = noun || (theClass ? utils.label(theClass) : '  ') // eg 'folder' in users's language\n    const prompt = noun + ' ' + utils.label(predicate) + ': '\n    form.appendChild(dom.createElement('p')).textContent = prompt\n    const namefield = dom.createElement('input')\n    namefield.setAttribute('type', 'text')\n    namefield.setAttribute('size', '100')\n    namefield.setAttribute('maxLength', '2048') // No arbitrary limits\n    namefield.setAttribute('style', style.textInputStyle)\n    namefield.select() // focus next user input\n    form.appendChild(namefield)\n    container.appendChild(form)\n\n    // namefield.focus()\n\n    function gotName () {\n      ((form as HTMLElement).parentNode as HTMLElement).removeChild(form)\n      resolve(namefield.value.trim())\n    }\n\n    namefield.addEventListener('keyup', function (e) {\n      if (e.keyCode === 13) {\n        gotName()\n      }\n    }, false)\n\n    form.appendChild(dom.createElement('br'))\n\n    form.appendChild(cancelButton(dom, function (_event) {\n      ((form as HTMLElement).parentNode as HTMLElement).removeChild(form)\n      resolve(null)\n    }))\n\n    form.appendChild(continueButton(dom, function (_event) {\n      gotName()\n    }))\n    namefield.focus()\n  }) // Promise\n}\n\n/**\n * A TR to represent a draggable person, etc in a list\n *\n * pred is unused param at the moment\n */\nexport const personTR = renderAsRow // The legacy name is used in a lot of places\n\nexport function renderAsRow (dom: HTMLDocument, pred: NamedNode, obj: NamedNode, options: any): HTMLTableRowElement {\n  const tr = dom.createElement('tr')\n  options = options || {}\n  // tr.predObj = [pred.uri, obj.uri]   moved to acl-control\n  const td1 = tr.appendChild(dom.createElement('td'))\n  const td2 = tr.appendChild(dom.createElement('td'))\n  const td3 = tr.appendChild(dom.createElement('td'))\n\n  // const image = td1.appendChild(dom.createElement('img'))\n  const image = options.image || faviconOrDefault(dom, obj)\n\n  td1.setAttribute('style', 'vertical-align: middle; width:2.5em; padding:0.5em; height: 2.5em;')\n  td2.setAttribute('style', 'vertical-align: middle; text-align:left;')\n  td3.setAttribute('style', 'vertical-align: middle; width:2em; padding:0.5em; height: 4em;')\n  td1.appendChild(image)\n\n  if (options.title) {\n    td2.textContent = options.title\n  } else {\n    setName(td2, obj) // This is async\n  }\n\n  if (options.deleteFunction) {\n    deleteButtonWithCheck(dom, td3, options.noun || 'one', options.deleteFunction)\n  }\n  if (obj.uri) {\n    // blank nodes need not apply\n    if (options.link !== false) {\n      const anchor = td3.appendChild(linkIcon(dom, obj))\n      anchor.classList.add('HoverControlHide')\n      td3.appendChild(dom.createElement('br'))\n    }\n    if (options.draggable !== false) {\n      // default is on\n      image.setAttribute('draggable', 'false') // Stop the image being dragged instead - just the TR\n      makeDraggable(tr, obj)\n    }\n  }\n  ;(tr as any).subject = obj\n  return tr\n}\n\n/* A helper function for renderAsDiv\n*  creates the NameDiv for the person\n*  Note: could not move it to the helper file because they call exported functions\n*  from buttons\n*  @internal exporting this only for unit tests\n*/\nexport function createNameDiv (dom: HTMLDocument, div: HTMLDivElement, title: string | undefined, obj: NamedNode) {\n  const nameDiv = div.appendChild(dom.createElement('div'))\n  if (title) {\n    nameDiv.textContent = title\n  } else {\n    setName(nameDiv, obj) // This is async\n  }\n}\n/* A helper function for renderAsDiv\n*  creates the linkDiv for the person\n*  Note: could not move it to the helper file because they call exported functions\n*  from buttons\n* @internal exporting this only for unit tests\n*/\nexport function createLinkDiv (dom: HTMLDocument, div: HTMLDivElement, obj: NamedNode, options: RenderAsDivOptions) {\n  const linkDiv = div.appendChild(dom.createElement('div'))\n  linkDiv.setAttribute('style', style.linkDivStyle)\n\n  if (options.deleteFunction) {\n    deleteButtonWithCheck(dom, linkDiv, options.noun || 'one', options.deleteFunction)\n  }\n\n  if (obj.uri) {\n    // blank nodes need not apply\n    if (options.link !== false) {\n      createLinkForURI(dom, linkDiv, obj)\n    }\n\n    makeDraggable(div, obj)\n  }\n}\n/**\n * A Div to represent a draggable person, etc in a list\n * configurable to add an onClick listener\n */\nexport function renderAsDiv (dom: HTMLDocument, obj: NamedNode, options: RenderAsDivOptions): HTMLElement {\n  const div = dom.createElement('div')\n  div.setAttribute('style', style.renderAsDivStyle)\n\n  options = options || {}\n  const image = options.image || faviconOrDefault(dom, obj)\n  createImageDiv(dom, div, image)\n  createNameDiv(dom, div, options.title, obj)\n  createLinkDiv(dom, div, obj, options)\n\n  if (options.clickable && options.onClickFunction) {\n    addClickListenerToElement(div, options.onClickFunction)\n  }\n\n  // to be compatible with the SolidOS table layout\n  if (options.wrapInATR) {\n    const tr = wrapDivInATR(dom, div, obj)\n    return tr\n  }\n  return div\n}\n\n/**\n * Refresh a DOM tree recursively\n */\nexport function refreshTree (root: any): void {\n  if (root.refresh) {\n    root.refresh()\n    return\n  }\n  for (let i = 0; i < root.children.length; i++) {\n    refreshTree(root.children[i])\n  }\n}\n\n/**\n * Options argument for [[attachmentList]] function\n */\nexport type attachmentListOptions = {\n  doc?: NamedNode\n  modify?: boolean\n  promptIcon?: string\n  predicate?: NamedNode\n  uploadFolder?: NamedNode\n  noun?: string\n}\n\n/**\n * Component that displays a list of resources, for instance\n * the attachments of a message, or the various documents related\n * to a meeting.\n * Accepts dropping URLs onto it to add attachments to it.\n */\nexport function attachmentList (dom: HTMLDocument, subject: NamedNode, div: HTMLElement, options: attachmentListOptions = {}) {\n  // options = options || {}\n\n  const deleteAttachment = function (target) {\n    if (!kb.updater) {\n      throw new Error('kb has no updater')\n    }\n\n    kb.updater.update(st(subject, predicate, target, doc) as any, [], function (\n      uri,\n      ok,\n      errorBody,\n      _xhr\n    ) {\n      if (ok) {\n        refresh()\n      } else {\n        complain(undefined, 'Error deleting one: ' + errorBody)\n      }\n    })\n  }\n\n  function createNewRow (target) {\n    const theTarget = target\n    const opt: any = { noun }\n    if (modify) {\n      opt.deleteFunction = function () {\n        deleteAttachment(theTarget)\n      }\n    }\n    return personTR(dom, predicate, target, opt)\n  }\n\n  const refresh = function () {\n    const things = kb.each(subject, predicate)\n    things.sort()\n    utils.syncTableToArray(attachmentTable, things, createNewRow)\n  }\n\n  function droppedURIHandler (uris) {\n    const ins: any = []\n    uris.forEach(function (u) {\n      const target = sym(u) // Attachment needs text label to disinguish I think not icon.\n      debug.log('Dropped on attachemnt ' + u) // icon was: iconBase + 'noun_25830.svg'\n      ins.push(st(subject, predicate, target, doc))\n    })\n    if (!kb.updater) {\n      throw new Error('kb has no updater')\n    }\n\n    kb.updater.update([], ins, function (uri, ok, errorBody, _xhr) {\n      if (ok) {\n        refresh()\n      } else {\n        complain(undefined, 'Error adding one: ' + errorBody)\n      }\n    })\n  }\n\n  function droppedFileHandler (files) {\n    uploadFiles(\n      kb.fetcher,\n      files,\n      options.uploadFolder?.uri, // Files\n      options.uploadFolder?.uri, // Pictures\n      function (theFile, destURI) {\n        const ins = [st(subject, predicate, kb.sym(destURI), doc)]\n        if (!kb.updater) {\n          throw new Error('kb has no updater')\n        }\n        kb.updater.update([], ins, function (uri, ok, errorBody, _xhr) {\n          if (ok) {\n            refresh()\n          } else {\n            complain(undefined, 'Error adding link to uploaded file: ' + errorBody)\n          }\n        })\n      }\n    )\n  }\n\n  const doc = options.doc || subject.doc()\n  if (options.modify === undefined) options.modify = true\n  const modify = options.modify\n  const promptIcon: string = options.promptIcon || (iconBase + 'noun_748003.svg' as string) //    target\n  // const promptIcon = options.promptIcon || (iconBase + 'noun_25830.svg') //  paperclip\n  const predicate = options.predicate || ns.wf('attachment')\n  const noun = options.noun || 'attachment'\n\n  const kb = store\n  const attachmentOuter = div.appendChild(dom.createElement('table'))\n  attachmentOuter.setAttribute('style', 'margin-top: 1em; margin-bottom: 1em;')\n  const attachmentOne = attachmentOuter.appendChild(dom.createElement('tr'))\n  const attachmentLeft = attachmentOne.appendChild(dom.createElement('td'))\n  const attachmentRight = attachmentOne.appendChild(dom.createElement('td'))\n  const attachmentTable = attachmentRight.appendChild(dom.createElement('table'))\n  attachmentTable.appendChild(dom.createElement('tr')) // attachmentTableTop\n\n  ;(attachmentOuter as any).refresh = refresh // Participate in downstream changes\n  // ;(attachmentTable as any).refresh = refresh   <- outer should be best?\n\n  refresh()\n\n  if (modify) {\n    // const buttonStyle = 'width; 2em; height: 2em; margin: 0.5em; padding: 0.1em;'\n    const paperclip = button(dom, promptIcon, 'Drop attachments here')\n    // paperclip.style = buttonStyle // @@ needed?  default has white background\n    attachmentLeft.appendChild(paperclip)\n    const fhandler = options.uploadFolder ? droppedFileHandler : null\n    makeDropTarget(paperclip, droppedURIHandler, fhandler) // beware missing the wire of the paparclip!\n    makeDropTarget(attachmentLeft, droppedURIHandler, fhandler) // just the outer won't do it\n\n    if (options.uploadFolder) { // Addd an explicit file upload button as well\n      const buttonDiv = fileUploadButtonDiv(dom, droppedFileHandler)\n      attachmentLeft.appendChild(buttonDiv)\n      // buttonDiv.children[1].style =  buttonStyle\n    }\n  }\n  return attachmentOuter\n}\n\n// /////////////////////////////////////////////////////////////////////////////\n\n/**\n * Event Handler for links within solid apps.\n *\n * Note that native links have constraints in Firefox, they\n * don't work with local files for instance (2011)\n */\nexport function openHrefInOutlineMode (e: Event) {\n  e.preventDefault()\n  e.stopPropagation()\n  const target = utils.getTarget(e)\n  const uri = target.getAttribute('href')\n  if (!uri) return debug.log('openHrefInOutlineMode: No href found!\\n')\n  const dom = window.document\n  if ((dom as any).outlineManager) {\n    // @@ TODO Remove the use of document as a global object\n    // TODO fix dependency cycle to solid-panes by calling outlineManager\n    ;(dom as any).outlineManager.GotoSubject(store.sym(uri), true, undefined, true, undefined)\n  } else if (window && (window as any).panes && (window as any).panes.getOutliner) {\n    // @@ TODO Remove the use of window as a global object\n    ;(window as any).panes\n      .getOutliner()\n      .GotoSubject(store.sym(uri), true, undefined, true, undefined)\n  } else {\n    debug.log('ERROR: Can\\'t access outline manager in this config')\n  }\n  // dom.outlineManager.GotoSubject(store.sym(uri), true, undefined, true, undefined)\n}\n\n/**\n * Make a URI in the Tabulator.org annotation store out of the URI of the thing to be annotated.\n *\n * @@ Todo: make it a personal preference.\n */\nexport function defaultAnnotationStore (subject:NamedNode):NamedNode | undefined {\n  if (subject.uri === undefined) return undefined\n  let s = subject.uri\n  if (s.slice(0, 7) !== 'http://') return undefined\n  s = s.slice(7) // Remove\n  const hash = s.indexOf('#')\n  if (hash >= 0) s = s.slice(0, hash)\n  // Strip trailing\n  else {\n    const slash = s.lastIndexOf('/')\n    if (slash < 0) return undefined\n    s = s.slice(0, slash)\n  }\n  return store.sym('http://tabulator.org/wiki/annnotation/' + s)\n}\n\n/**\n * Retrieve all RDF class URIs from solid-ui's RDF store\n * @returns an object `ret` such that `Object.keys(ret)` is\n * the list of all class URIs.\n */\nexport function allClassURIs (): { [uri: string]: boolean } {\n  const set = {}\n  store\n    .statementsMatching(undefined, ns.rdf('type'), undefined)\n    .forEach(function (st) {\n      if (st.object.value) set[st.object.value] = true\n    })\n  store\n    .statementsMatching(undefined, ns.rdfs('subClassOf'), undefined)\n    .forEach(function (st) {\n      if (st.object.value) set[st.object.value] = true\n      if (st.subject.value) set[st.subject.value] = true\n    })\n  store\n    .each(undefined, ns.rdf('type'), ns.rdfs('Class'))\n    .forEach(function (c) {\n      if (c.value) set[c.value] = true\n    })\n  return set\n}\n\n/**\n * Figuring which properties we know about\n *\n * When the user inputs an RDF property, like for a form field\n * or when specifying the relationship between two arbitrary things,\n * then er can prompt them with properties the session knows about\n *\n * TODO: Look again by catching this somewhere. (On the kb?)\n * TODO: move to diff module? Not really a button.\n * @param {Store} kb The quadstore to be searched.\n */\n\nexport function propertyTriage (kb: IndexedFormula): any {\n  const possibleProperties: any = {}\n  // if (possibleProperties === undefined) possibleProperties = {}\n  // const kb = store\n  const dp = {}\n  const op = {}\n  let no = 0\n  let nd = 0\n  let nu = 0\n  const pi = (kb as any).predicateIndex // One entry for each pred\n  for (const p in pi) {\n    const object = pi[p][0].object\n    if (object.termType === 'Literal') {\n      dp[p] = true\n      nd++\n    } else {\n      op[p] = true\n      no++\n    }\n  } // If nothing discovered, then could be either:\n  const ps = kb.each(undefined, ns.rdf('type'), ns.rdf('Property'))\n  for (let i = 0; i < ps.length; i++) {\n    const p = ps[i].toNT()\n    if (!op[p] && !dp[p]) {\n      dp[p] = true\n      op[p] = true\n      nu++\n    }\n  }\n  possibleProperties.op = op\n  possibleProperties.dp = dp\n  info(`propertyTriage: ${no} non-lit, ${nd} literal. ${nu} unknown.`)\n  return possibleProperties\n}\n\n/**\n * General purpose widgets\n */\n\n/**\n * A button for jumping\n */\nexport function linkButton (dom: HTMLDocument, object: NamedNode): HTMLElement {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.textContent = 'Goto ' + utils.label(object)\n  b.addEventListener('click', function (_event) {\n    // b.parentNode.removeChild(b)\n    // TODO fix dependency cycle to solid-panes by calling outlineManager\n    ;(dom as any).outlineManager.GotoSubject(object, true, undefined, true, undefined)\n  }, true)\n  return b\n}\n\n/**\n * A button to remove some other element from the page\n */\nexport function removeButton (dom: HTMLDocument, element: HTMLElement) {\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  b.textContent = '✕' // MULTIPLICATION X\n  b.addEventListener('click', function (_event) {\n    ;(element as any).parentNode.removeChild(element)\n  }, true)\n  return b\n}\n\n//      Description text area\n//\n// Make a box to demand a description or display existing one\n//\n// @param dom - the document DOM for the user interface\n// @param kb - the graph which is the knowledge base we are working with\n// @param subject - a term, the subject of the statement(s) being edited.\n// @param predicate - a term, the predicate of the statement(s) being edited\n// @param store - The web document being edited\n// @param callbackFunction - takes (boolean ok, string errorBody)\n\n// /////////////////////////////////////// Random I/O widgets /////////////\n\n// ////              Column Header Buttons\n//\n//  These are for selecting different modes, sources,styles, etc.\n//\n/*\nbuttons.headerButtons = function (dom, kb, name, words) {\n    const box = dom.createElement('table')\n    var i, word, s = '<tr>'\n    box.setAttribute('style', 'width: 90%; height: 1.5em')\n    for (i=0; i<words.length; i++) {\n        s += '<td><input type=\"radio\" name=\"' + name + '\" id=\"' + words[i] + '\" value='\n    }\n    box.innerHTML = s + '</tr>'\n\n}\n*/\n// ////////////////////////////////////////////////////////////\n//\n//     selectorPanel\n//\n//  A vertical panel for selecting connections to left or right.\n//\n//   @param inverse means this is the object rather than the subject\n//\nexport function selectorPanel (\n  dom: HTMLDocument,\n  kb: IndexedFormula,\n  type: NamedNode,\n  predicate: NamedNode,\n  inverse: boolean,\n  possible: NamedNode[],\n  options: { connectIcon?: string },\n  callbackFunction: (_x: NamedNode, _e: Event, _selected: boolean) => void,\n  linkCallback: (_x: NamedNode, _e: Event, _inverse: boolean, _setStyleFunction: () => void) => void\n) {\n  return selectorPanelRefresh(\n    dom.createElement('div'),\n    dom,\n    kb,\n    type,\n    predicate,\n    inverse,\n    possible,\n    options,\n    callbackFunction,\n    linkCallback\n  )\n}\n\nexport function selectorPanelRefresh (\n  list: HTMLElement,\n  dom: HTMLDocument,\n  kb: IndexedFormula,\n  type: NamedNode,\n  predicate: NamedNode,\n  inverse: boolean,\n  possible: NamedNode[],\n  options: { connectIcon?: string },\n  callbackFunction: (_x: NamedNode, _e: Event, _selected: boolean) => void,\n  linkCallback: (_x: NamedNode, _e: Event, _inverse: boolean, _setStyleFunction: () => void) => void\n) {\n  const style0 =\n    'border: 0.1em solid #ddd; border-bottom: none; width: 95%; height: 2em; padding: 0.5em;'\n  let selected: any = null\n  list.innerHTML = ''\n\n  const refreshItem = function (box: HTMLElement, x: NamedNode) {\n    // Scope to hold item and x\n    let item: any\n    // eslint-disable-next-line prefer-const\n    let image: HTMLImageElement\n\n    const setStyle = function () {\n      const already = inverse\n        ? kb.each(undefined, predicate, x)\n        : kb.each(x, predicate)\n      iconDiv.setAttribute('class', already.length === 0 ? 'hideTillHover' : '') // See tabbedtab.css\n      image.setAttribute(\n        'src',\n        options.connectIcon || iconBase + 'noun_25830.svg'\n      )\n      image.setAttribute('title', already.length ? already.length : 'attach' as any)\n    }\n    const f = index.twoLine.widgetForClass(type)\n    // eslint-disable-next-line prefer-const\n    item = f(dom, x)\n    item.setAttribute('style', style0)\n\n    const nav = dom.createElement('div')\n    nav.setAttribute('class', 'hideTillHover') // See tabbedtab.css\n    nav.setAttribute('style', 'float:right; width:10%')\n\n    const a = dom.createElement('a')\n    a.setAttribute('href', x.uri)\n    a.setAttribute('style', 'float:right')\n    nav.appendChild(a).textContent = '>'\n    box.appendChild(nav)\n\n    const iconDiv = dom.createElement('div')\n    iconDiv.setAttribute(\n      'style',\n      (inverse ? 'float:left;' : 'float:right;') + ' width:30px;'\n    )\n    image = dom.createElement('img')\n    setStyle()\n    iconDiv.appendChild(image)\n    box.appendChild(iconDiv)\n\n    item.addEventListener('click', function (event) {\n      if (selected === item) {\n        // deselect\n        item.setAttribute('style', style0)\n        selected = null\n      } else {\n        if (selected) selected.setAttribute('style', style0)\n        item.setAttribute(\n          'style',\n          style0 + 'background-color: #ccc; color:black;'\n        )\n        selected = item\n      }\n      callbackFunction(x, event, selected === item)\n      setStyle()\n    }, false)\n\n    image.addEventListener('click', function (event) {\n      linkCallback(x, event, inverse, setStyle)\n    }, false)\n\n    box.appendChild(item)\n    return box\n  }\n\n  for (let i = 0; i < possible.length; i++) {\n    const box = dom.createElement('div')\n    list.appendChild(box)\n    refreshItem(box, possible[i])\n  }\n  return list\n}\n\n// ###########################################################################\n//\n//      Small compact views of things\n//\nexport let index: any = {}\n// ///////////////////////////////////////////////////////////////////////////\n// We need these for anything which is a subject of an attachment.\n//\n// These should be moved to type-dependeent UI code. Related panes maybe\n\nfunction twoLineDefault (dom: HTMLDocument, x: NamedNode): HTMLElement {\n  // Default\n  const box = dom.createElement('div')\n  box.textContent = utils.label(x)\n  return box\n}\n\n/**\n * Find a function that can create a widget for a given class\n * @param c The RDF class for which we want a widget generator function\n */\nfunction twoLineWidgetForClass (c: NamedNode): (_dom: HTMLDocument, _x: NamedNode) => HTMLElement {\n  let widget = index.twoLine[c.uri]\n  const kb = store\n  if (widget) return widget\n  const sup = kb.findSuperClassesNT(c)\n  for (const cl in sup) {\n    widget = index.twoLine[kb.fromNT(cl).uri]\n    if (widget) return widget\n  }\n  return index.twoLine['']\n}\n\n/**\n * Display a transaction\n * @param x Should have attributes through triples in store:\n *          * ns.qu('payee') -> a named node\n *          * ns.qu('date) -> a literal\n *          * ns.qu('amount') -> a literal\n */\nfunction twoLineTransaction (dom: HTMLDocument, x: NamedNode): HTMLElement {\n  let failed = ''\n  const enc = function (p) {\n    const y = store.any(x, ns.qu(p))\n    if (!y) failed += '@@ No value for ' + p + '! '\n    return y ? utils.escapeForXML(y.value) : '?' // @@@@\n  }\n  const box = dom.createElement('table')\n  box.innerHTML = `\n      <tr>\n      <td colspan=\"2\"> ${enc('payee')}</td>\n      < /tr>\n      < tr >\n      <td>${enc('date').slice(0, 10)}</td>\n      <td style = \"text-align: right;\">${enc('amount')}</td>\n      </tr>`\n  if (failed) {\n    box.innerHTML = `\n      <tr>\n        <td><a href=\"${utils.escapeForXML(x.uri)}\">${utils.escapeForXML(failed)}</a></td>\n      </tr>`\n  }\n  return box\n}\n\n/**\n * Display a trip\n * @param x Should have attributes through triples in store:\n *          * ns.dc('title') -> a literal\n *          * ns.cal('dtstart') -> a literal\n *          * ns.cal('dtend') -> a literal\n */\nfunction twoLineTrip (\n  dom: HTMLDocument,\n  x: NamedNode\n): HTMLElement {\n  const enc = function (p) {\n    const y = store.any(x, p)\n    return y ? utils.escapeForXML(y.value) : '?'\n  }\n  const box = dom.createElement('table')\n  box.innerHTML = `\n    <tr>\n      <td colspan=\"2\">${enc(ns.dc('title'))}</td>\n    </tr>\n    <tr style=\"color: #777\">\n      <td>${enc(ns.cal('dtstart'))}</td>\n      <td>${enc(ns.cal('dtend'))}</td>\n    </tr>`\n  return box\n}\n\n/**\n * Stick a stylesheet link the document if not already there\n */\nexport function addStyleSheet (dom: HTMLDocument, href: string): void {\n  const links = dom.querySelectorAll('link')\n  for (let i = 0; i < links.length; i++) {\n    if (\n      (links[i].getAttribute('rel') || '') === 'stylesheet' &&\n      (links[i].getAttribute('href') || '') === href\n    ) {\n      return\n    }\n  }\n  const link = dom.createElement('link')\n  link.setAttribute('rel', 'stylesheet')\n  link.setAttribute('type', 'text/css')\n  link.setAttribute('href', href)\n  dom.getElementsByTagName('head')[0].appendChild(link)\n}\n\n// Figure (or guess) whether this is an image, etc\n//\nexport function isAudio (file?: NamedNode) {\n  return isImage(file, 'audio')\n}\nexport function isVideo (file?: NamedNode) {\n  return isImage(file, 'video')\n}\n/**\n *\n */\nexport function isImage (file?: NamedNode, kind?: string): boolean {\n  const dcCLasses = {\n    audio: 'http://purl.org/dc/dcmitype/Sound',\n    image: 'http://purl.org/dc/dcmitype/Image',\n    video: 'http://purl.org/dc/dcmitype/MovingImage'\n  }\n  const what = kind || 'image'\n  // See https://github.com/linkeddata/rdflib.js/blob/e367d5088c/src/formula.ts#L554\n  //\n  const typeURIs = store.findTypeURIs(file as any)\n  // See https://github.com/linkeddata/rdflib.js/blob/d5000f/src/utils-js.js#L14\n  // e.g.'http://www.w3.org/ns/iana/media-types/audio'\n  const prefix: string = Util.mediaTypeClass(what + '/*').uri.split('*')[0]\n  for (const t in typeURIs) {\n    if (t.startsWith(prefix)) return true\n  }\n  if (dcCLasses[what] in typeURIs) return true\n  return false\n}\n\n/**\n * File upload button\n * @param dom The DOM aka document\n * @param  droppedFileHandler Same handler function as drop, takes array of file objects\n * @returns {Element} - a div with a button and a inout in it\n * The input is hidden, as it is uglky - the user clicks on the nice icons and fires the input.\n */\n// See https://developer.mozilla.org/en-US/docs/Web/API/File/Using_files_from_web_applications\nexport function fileUploadButtonDiv (\n  dom: HTMLDocument,\n  droppedFileHandler: (_files: FileList) => void\n) {\n  const div = dom.createElement('div')\n  const input = div.appendChild(dom.createElement('input'))\n  input.setAttribute('type', 'file')\n  input.setAttribute('multiple', 'true')\n  input.addEventListener(\n    'change',\n    (event: any) => {\n      debug.log('File drop event: ', event)\n      if (event.files) {\n        droppedFileHandler(event.files)\n      } else if (event.target && event.target.files) {\n        droppedFileHandler(event.target.files)\n      } else {\n        alert('Sorry no files .. internal error?')\n      }\n    },\n    false\n  )\n\n  ;(input as any).style = 'display:none'\n  const buttonElt = div.appendChild(\n    button(\n      dom,\n      iconBase + 'noun_Upload_76574_000000.svg',\n      'Upload files',\n      _event => {\n        input.click()\n      }\n    )\n  )\n  makeDropTarget(buttonElt, null, droppedFileHandler) // Can also just drop on button\n  return div\n}\n\nindex = {\n  line: { // Approx 80em\n  },\n  twoLine: { // Approx 40em * 2.4em\n    '': twoLineDefault,\n    'http://www.w3.org/2000/10/swap/pim/qif#Transaction': twoLineTransaction,\n    'http://www.w3.org/ns/pim/trip#Trip': twoLineTrip,\n    widgetForClass: twoLineWidgetForClass\n  }\n}\n"],"mappings":"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"}