{"version":3,"file":"peoplePicker.js","names":["kb","solidLogicSingleton","store","PeoplePicker","element","typeIndex","groupPickedCb","options","selectedgroup","onSelectGroup","bind","container","document","createElement","style","maxWidth","minHeight","outline","display","flexDirection","selectedGroup","Group","render","changeGroupButton","textContent","escape","addEventListener","_event","appendChild","findAddressBook","then","book","chooseExistingGroupButton","margin","GroupPicker","createNewGroupButton","createNewGroup","defaultNewGroupName","group","GroupBuilder","errorBody","errorMessageBlock","innerHTML","err","Promise","resolve","reject","fetcher","nowOrWhenFetched","ok","bookRegistration","any","ns","solid","vcard","Error","load","_xhr","indexes","groupIndex","groupContainer","rdf","sym","uri","uuid","v4","slice","name","patchPromises","doc","map","typeStatement","st","nameStatement","includesGroupStatement","toIns","equals","patch","forEach","add","all","debug","log","xhr","responseURL","loadGroups","groups","groupButton","handleClickGroup","each","getWithDefault","value","doneBuildingCb","groupChangedCb","onGroupChanged","changeType","agent","dropContainer","makeDropTarget","uris","groupNameInput","type","event","setGroupName","target","groupNameLabel","match","statement","webIdNode","object","personDiv","Person","handleRemove","copy","doneBuildingButton","webId","namedNode","rdfClass","foaf","holdsStatement","why","toDel","remove","errorMessage","updatePromises","namedGraph","oldNameStatements","newNameStatement","literal","_solidResponse","removeStatements","imgSrc","iconBase","profileImg","src","width","height","nameSpan","flexGrow","removeButton","subject","predicate","defaultValue","url","updater","update","success","dir"],"sources":["../../src/widgets/peoplePicker.js"],"sourcesContent":["/**\n *\n * People Picker Pane\n *\n * This pane offers a mechanism for selecting a set of individuals, groups, or\n * organizations to take some action on.\n *\n * Assumptions\n *   - Assumes that the user has a type index entry for vcard:AddressBook. @@ bad assuption\n *\n */\nimport escape from 'escape-html'\nimport uuid from 'uuid'\nimport * as rdf from 'rdflib'\nimport * as debug from '../debug'\n\nimport { makeDropTarget } from './dragAndDrop'\nimport { errorMessageBlock } from './error'\nimport { iconBase } from '../iconBase'\nimport * as ns from '../ns'\nimport { solidLogicSingleton } from 'solid-logic'\n\nconst kb = solidLogicSingleton.store\n\nexport class PeoplePicker {\n  constructor (element, typeIndex, groupPickedCb, options) { // @@ can't expect typeindex to be passed\n    this.options = options || {}\n    this.element = element\n    this.typeIndex = typeIndex\n    this.groupPickedCb = groupPickedCb\n    this.selectedgroup = this.options.selectedgroup // current selected group if any\n    this.onSelectGroup = this.onSelectGroup.bind(this)\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.style.maxWidth = '350px'\n    container.style.minHeight = '200px'\n    container.style.outline = '1px solid black'\n    container.style.display = 'flex'\n\n    if (this.selectedgroup) {\n      container.style.flexDirection = 'column'\n      const selectedGroup = document.createElement('div')\n      new Group(selectedGroup, this.selectedgroup).render()\n      const changeGroupButton = document.createElement('button')\n      changeGroupButton.textContent = escape('Change group')\n      changeGroupButton.addEventListener('click', _event => {\n        this.selectedgroup = null\n        this.render()\n      })\n      container.appendChild(selectedGroup)\n      container.appendChild(changeGroupButton)\n    } else {\n      this.findAddressBook(this.typeIndex)\n        .then(({ book }) => {\n          const chooseExistingGroupButton = document.createElement('button')\n          chooseExistingGroupButton.textContent = escape(\n            'Pick an existing group'\n          )\n          chooseExistingGroupButton.style.margin = 'auto'\n          chooseExistingGroupButton.addEventListener('click', _event => {\n            new GroupPicker(container, book, this.onSelectGroup).render()\n          })\n\n          const createNewGroupButton = document.createElement('button')\n          createNewGroupButton.textContent = escape('Create a new group')\n          createNewGroupButton.style.margin = 'auto'\n          createNewGroupButton.addEventListener('click', _event => {\n            this.createNewGroup(book, this.options.defaultNewGroupName)\n              .then(({ group }) => {\n                new GroupBuilder(\n                  this.element,\n                  book,\n                  group,\n                  this.onSelectGroup\n                ).render()\n              })\n              .catch(errorBody => {\n                this.element.appendChild(\n                  errorMessageBlock(\n                    document,\n                    escape(`Error creating a new group. (${errorBody})`)\n                  )\n                )\n              })\n          })\n\n          container.appendChild(chooseExistingGroupButton)\n          container.appendChild(createNewGroupButton)\n\n          this.element.innerHTML = ''\n          this.element.appendChild(container)\n        })\n        .catch(err => {\n          this.element.appendChild(\n            errorMessageBlock(\n              document,\n              escape(`Could find your groups. (${err})`)\n            )\n          )\n        })\n    }\n\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n\n  findAddressBook (typeIndex) {\n    return new Promise((resolve, reject) => {\n      kb.fetcher.nowOrWhenFetched(typeIndex, (ok, err) => {\n        if (!ok) {\n          return reject(err)\n        }\n        const bookRegistration = kb.any(\n          null,\n          ns.solid('forClass'),\n          ns.vcard('AddressBook')\n        )\n        if (!bookRegistration) {\n          return reject(\n            new Error(\n              'no address book registered in the solid type index ' + typeIndex\n            )\n          )\n        }\n        const book = kb.any(bookRegistration, ns.solid('instance'))\n        if (!book) {\n          return reject(new Error('incomplete address book registration'))\n        }\n        kb.fetcher\n          .load(book)\n          .then(function (_xhr) {\n            return resolve({ book })\n          })\n          .catch(function (err) {\n            return reject(new Error('Could not load address book ' + err))\n          })\n      })\n    })\n  }\n\n  createNewGroup (book, defaultNewGroupName) {\n    const { groupIndex, groupContainer } = indexes(book)\n    const group = rdf.sym(\n      `${groupContainer.uri}${uuid.v4().slice(0, 8)}.ttl#this`\n    )\n    const name = defaultNewGroupName || 'Untitled Group'\n\n    // NOTE that order matters here.  Unfortunately this type of update is\n    // non-atomic in that solid requires us to send two PATCHes, either of which\n    // might fail.\n    const patchPromises = [group.doc(), groupIndex].map(doc => {\n      const typeStatement = rdf.st(group, ns.rdf('type'), ns.vcard('Group'), doc)\n      const nameStatement = rdf.st(group, ns.vcard('fn'), name, group.doc(), doc)\n      const includesGroupStatement = rdf.st(\n        book,\n        ns.vcard('includesGroup'),\n        group,\n        doc\n      )\n      const toIns = doc.equals(groupIndex)\n        ? [typeStatement, nameStatement, includesGroupStatement]\n        : [typeStatement, nameStatement]\n      return patch(doc.uri, { toIns }).then(() => {\n        toIns.forEach(st => {\n          kb.add(st)\n        })\n      })\n    })\n    return Promise.all(patchPromises)\n      .then(() => ({ group }))\n      .catch(err => {\n        debug.log('Could not create new group.  PATCH failed ' + err)\n        throw new Error(\n          `Couldn't create new group.  PATCH failed for (${\n          err.xhr ? err.xhr.responseURL : ''\n          } )`\n        )\n      })\n  }\n\n  onSelectGroup (group) {\n    this.selectedgroup = group\n    this.groupPickedCb(group)\n    this.render()\n  }\n}\n\nexport class GroupPicker {\n  constructor (element, book, onSelectGroup) {\n    this.element = element\n    this.book = book\n    this.onSelectGroup = onSelectGroup\n  }\n\n  render () {\n    this.loadGroups()\n      .then(groups => {\n        // render the groups\n        const container = document.createElement('div')\n        container.style.display = 'flex'\n        container.style.flexDirection = 'column'\n        groups.forEach(group => {\n          const groupButton = document.createElement('button')\n          groupButton.addEventListener('click', this.handleClickGroup(group))\n          new Group(groupButton, group).render()\n          container.appendChild(groupButton)\n        })\n        this.element.innerHTML = ''\n        this.element.appendChild(container)\n      })\n      .catch(err => {\n        this.element.appendChild(\n          errorMessageBlock(\n            document,\n            escape(`There was an error loading your groups. (${err})`)\n          )\n        )\n      })\n    return this\n  }\n\n  loadGroups () {\n    return new Promise((resolve, reject) => {\n      const { groupIndex } = indexes(this.book)\n      kb.fetcher.nowOrWhenFetched(groupIndex, (ok, err) => {\n        if (!ok) {\n          return reject(err)\n        }\n        const groups = kb.each(this.book, ns.vcard('includesGroup'))\n        return resolve(groups)\n      })\n    })\n  }\n\n  handleClickGroup (group) {\n    return _event => {\n      this.onSelectGroup(group)\n    }\n  }\n}\n\nexport class Group {\n  constructor (element, group) {\n    this.element = element\n    this.group = group\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.textContent = escape(\n      // @@@@@ need to escape??\n      getWithDefault(this.group, ns.vcard('fn'), `[${this.group.value}]`)\n    )\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n}\n\nexport class GroupBuilder {\n  constructor (element, book, group, doneBuildingCb, groupChangedCb) {\n    this.element = element\n    this.book = book\n    this.group = group\n    this.onGroupChanged = (err, changeType, agent) => {\n      if (groupChangedCb) {\n        groupChangedCb(err, changeType, agent)\n      }\n    }\n    this.groupChangedCb = groupChangedCb\n    this.doneBuildingCb = doneBuildingCb\n  }\n\n  refresh () {\n    // TODO: implement\n  }\n\n  render () {\n    const dropContainer = document.createElement('div')\n    dropContainer.style.maxWidth = '350px'\n    dropContainer.style.minHeight = '200px'\n    dropContainer.style.outline = '1px solid black'\n    dropContainer.style.display = 'flex'\n    dropContainer.style.flexDirection = 'column'\n\n    makeDropTarget(dropContainer, uris => {\n      uris.forEach(uri => {\n        this.add(uri).catch(err => {\n          this.element.appendChild(\n            errorMessageBlock(\n              document,\n              escape(`Could not add the given WebId. (${err})`)\n            )\n          )\n        })\n      })\n    })\n\n    const groupNameInput = document.createElement('input')\n    groupNameInput.type = 'text'\n    groupNameInput.value = getWithDefault(\n      this.group,\n      ns.vcard('fn'),\n      'Untitled Group'\n    )\n    groupNameInput.addEventListener('change', event => {\n      this.setGroupName(event.target.value).catch(err => {\n        this.element.appendChild(\n          errorMessageBlock(document, `Error changing group name. (${err})`)\n        )\n      })\n    })\n    const groupNameLabel = document.createElement('label')\n    groupNameLabel.textContent = escape('Group Name:')\n    groupNameLabel.appendChild(groupNameInput)\n    dropContainer.appendChild(groupNameLabel)\n\n    if (kb.any(this.group, ns.vcard('hasMember'))) {\n      kb.match(this.group, ns.vcard('hasMember')).forEach(statement => {\n        const webIdNode = statement.object\n        const personDiv = document.createElement('div')\n        new Person(personDiv, webIdNode, this.handleRemove(webIdNode)).render()\n        dropContainer.appendChild(personDiv)\n      })\n    } else {\n      const copy = document.createElement('p')\n      copy.textContent = escape`\n        To add someone to this group, drag and drop their WebID URL onto the box.\n      `\n      dropContainer.appendChild(copy)\n    }\n\n    const doneBuildingButton = document.createElement('button')\n    doneBuildingButton.textContent = escape('Done')\n    doneBuildingButton.addEventListener('click', _event => {\n      this.doneBuildingCb(this.group)\n    })\n    dropContainer.appendChild(doneBuildingButton)\n\n    this.element.innerHTML = ''\n    this.element.appendChild(dropContainer)\n    return this\n  }\n\n  add (webId) {\n    return new Promise((resolve, reject) => {\n      kb.fetcher.nowOrWhenFetched(webId, (ok, err) => {\n        if (!ok) {\n          this.onGroupChanged(err)\n          return reject(err)\n        }\n        // make sure it's a valid person, group, or entity (for now just handle\n        // webId)\n        const webIdNode = rdf.namedNode(webId)\n        const rdfClass = kb.any(webIdNode, ns.rdf('type'))\n        if (!rdfClass || !rdfClass.equals(ns.foaf('Person'))) {\n          return reject(\n            new Error(\n              `Only people supported right now. (tried to add something of type ${rdfClass.value})`\n            )\n          )\n        }\n        return resolve(webIdNode)\n      })\n    }).then(webIdNode => {\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\n      if (kb.holdsStatement(statement)) {\n        return webIdNode\n      }\n      return patch(this.group.doc().uri, { toIns: [statement] }).then(() => {\n        statement.why = this.group.doc()\n        kb.add(statement)\n        this.onGroupChanged(null, 'added', webIdNode)\n        this.render()\n      })\n    })\n  }\n\n  handleRemove (webIdNode) {\n    return _event => {\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\n      return patch(this.group.doc().uri, { toDel: [statement] })\n        .then(() => {\n          kb.remove(statement)\n          this.onGroupChanged(null, 'removed', webIdNode)\n          this.render()\n          return true\n        })\n        .catch(err => {\n          const name = kb.any(webIdNode, ns.foaf('name'))\n          const errorMessage =\n            name && name.value\n              ? `Could not remove ${name.value}. (${err})`\n              : `Could not remove ${webIdNode.value}. (${err})`\n          throw new Error(errorMessage)\n        })\n    }\n  }\n\n  setGroupName (name) {\n    const { groupIndex } = indexes(this.book)\n    const updatePromises = [this.group.doc(), groupIndex].map(namedGraph => {\n      const oldNameStatements = kb.match(\n        this.group,\n        ns.vcard('fn'),\n        null,\n        namedGraph\n      )\n      const newNameStatement = rdf.st(\n        this.group,\n        ns.vcard('fn'),\n        rdf.literal(name)\n      )\n      return patch(namedGraph.value, {\n        toDel: oldNameStatements,\n        toIns: [newNameStatement]\n      }).then(_solidResponse => {\n        kb.removeStatements(oldNameStatements)\n        newNameStatement.why = namedGraph\n        kb.add(newNameStatement)\n      })\n    })\n    return Promise.all(updatePromises)\n  }\n}\n// @ignore exporting this only for the unit test\n// @@ TODO maybe I should move this down at end, but for\n// now I will leave it where it was\nexport class Person {\n  constructor (element, webIdNode, handleRemove) {\n    this.webIdNode = webIdNode\n    this.element = element\n    this.handleRemove = handleRemove\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.style.display = 'flex'\n\n    // TODO: take a look at UI.widgets.setName\n    const imgSrc = getWithDefault(\n      this.webIdNode,\n      ns.foaf('img'),\n      iconBase + 'noun_15059.svg'\n    )\n    const profileImg = document.createElement('img')\n    profileImg.src = escape(imgSrc)\n    profileImg.width = '50'\n    profileImg.height = '50'\n    profileImg.style.margin = '5px'\n\n    // TODO: take a look at UI.widgets.setImage\n    const name = getWithDefault(\n      this.webIdNode,\n      ns.foaf('name'),\n      `[${this.webIdNode}]`\n    )\n    const nameSpan = document.createElement('span')\n    nameSpan.innerHTML = escape(name)\n    nameSpan.style.flexGrow = '1'\n    nameSpan.style.margin = 'auto 0'\n\n    const removeButton = document.createElement('button')\n    removeButton.textContent = 'Remove'\n    removeButton.addEventListener('click', _event =>\n      this.handleRemove().catch(err => {\n        this.element.appendChild(errorMessageBlock(document, escape(`${err}`)))\n      })\n    )\n    removeButton.style.margin = '5px'\n\n    container.appendChild(profileImg)\n    container.appendChild(nameSpan)\n    container.appendChild(removeButton)\n\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n}\n\nfunction getWithDefault (subject, predicate, defaultValue) {\n  const object = kb.any(subject, predicate)\n  return object ? object.value : defaultValue\n}\n\nfunction patch (url, { toDel, toIns }) {\n  return new Promise((resolve, reject) => {\n    kb.updater.update(toDel, toIns, (uri, success, errorMessage) => {\n      if (!success) {\n        return reject(\n          new Error(`PATCH failed for resource <${uri}>: ${errorMessage}`)\n        )\n      }\n      resolve()\n    })\n  })\n  // return webClient.patch(url, toDel, toIns)\n  //   .then(solidResponse => {\n  //     const status = solidResponse.xhr.status\n  //     if (status < 200 || status >= 400) {\n  //       const err = new Error(`PATCH failed for resource <${solidResponse.url}>`)\n  //       err.solidResponse = solidResponse\n  //       throw err\n  //     }\n  //   })\n}\n\nfunction indexes (book) {\n  return {\n    // bookIndex: book,\n    groupIndex: kb.any(book, ns.vcard('groupIndex')),\n    groupContainer: kb.sym(book.dir().uri + 'Group/')\n  }\n}\n"],"mappings":"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"}