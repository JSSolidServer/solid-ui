{"version":3,"file":"peoplePicker.js","names":["kb","solidLogicSingleton","store","PeoplePicker","element","typeIndex","groupPickedCb","options","selectedgroup","onSelectGroup","bind","container","document","createElement","style","maxWidth","minHeight","outline","display","flexDirection","selectedGroup","Group","render","changeGroupButton","textContent","escape","addEventListener","_event","appendChild","findAddressBook","then","book","chooseExistingGroupButton","margin","GroupPicker","createNewGroupButton","createNewGroup","defaultNewGroupName","group","GroupBuilder","errorBody","errorMessageBlock","innerHTML","err","Promise","resolve","reject","fetcher","nowOrWhenFetched","ok","bookRegistration","any","ns","solid","vcard","Error","load","_xhr","indexes","groupIndex","groupContainer","rdf","sym","uri","uuid","v4","slice","name","patchPromises","doc","map","typeStatement","st","nameStatement","includesGroupStatement","toIns","equals","patch","forEach","add","all","debug","log","xhr","responseURL","loadGroups","groups","groupButton","handleClickGroup","each","getWithDefault","value","doneBuildingCb","groupChangedCb","onGroupChanged","changeType","agent","dropContainer","makeDropTarget","uris","groupNameInput","type","event","setGroupName","target","groupNameLabel","match","statement","webIdNode","object","personDiv","Person","handleRemove","copy","doneBuildingButton","webId","namedNode","rdfClass","foaf","holdsStatement","why","toDel","remove","errorMessage","updatePromises","namedGraph","oldNameStatements","newNameStatement","literal","_solidResponse","removeStatements","imgSrc","iconBase","profileImg","src","width","height","nameSpan","flexGrow","removeButton","subject","predicate","defaultValue","url","updater","update","success","dir"],"sources":["../../src/widgets/peoplePicker.js"],"sourcesContent":["/**\n *\n * People Picker Pane\n *\n * This pane offers a mechanism for selecting a set of individuals, groups, or\n * organizations to take some action on.\n *\n * Assumptions\n *   - Assumes that the user has a type index entry for vcard:AddressBook. @@ bad assuption\n *\n */\nimport escape from 'escape-html'\nimport uuid from 'uuid'\nimport * as rdf from 'rdflib'\nimport * as debug from '../debug'\n\nimport { makeDropTarget } from './dragAndDrop'\nimport { errorMessageBlock } from './error'\nimport { iconBase } from '../iconBase'\nimport * as ns from '../ns'\nimport { solidLogicSingleton } from 'solid-logic'\n\nconst kb = solidLogicSingleton.store\n\nexport class PeoplePicker {\n  constructor (element, typeIndex, groupPickedCb, options) { // @@ can't expect typeindex to be passed\n    this.options = options || {}\n    this.element = element\n    this.typeIndex = typeIndex\n    this.groupPickedCb = groupPickedCb\n    this.selectedgroup = this.options.selectedgroup // current selected group if any\n    this.onSelectGroup = this.onSelectGroup.bind(this)\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.style.maxWidth = '350px'\n    container.style.minHeight = '200px'\n    container.style.outline = '1px solid black'\n    container.style.display = 'flex'\n\n    if (this.selectedgroup) {\n      container.style.flexDirection = 'column'\n      const selectedGroup = document.createElement('div')\n      new Group(selectedGroup, this.selectedgroup).render()\n      const changeGroupButton = document.createElement('button')\n      changeGroupButton.textContent = escape('Change group')\n      changeGroupButton.addEventListener('click', _event => {\n        this.selectedgroup = null\n        this.render()\n      })\n      container.appendChild(selectedGroup)\n      container.appendChild(changeGroupButton)\n    } else {\n      this.findAddressBook(this.typeIndex)\n        .then(({ book }) => {\n          const chooseExistingGroupButton = document.createElement('button')\n          chooseExistingGroupButton.textContent = escape(\n            'Pick an existing group'\n          )\n          chooseExistingGroupButton.style.margin = 'auto'\n          chooseExistingGroupButton.addEventListener('click', _event => {\n            new GroupPicker(container, book, this.onSelectGroup).render()\n          })\n\n          const createNewGroupButton = document.createElement('button')\n          createNewGroupButton.textContent = escape('Create a new group')\n          createNewGroupButton.style.margin = 'auto'\n          createNewGroupButton.addEventListener('click', _event => {\n            this.createNewGroup(book, this.options.defaultNewGroupName)\n              .then(({ group }) => {\n                new GroupBuilder(\n                  this.element,\n                  book,\n                  group,\n                  this.onSelectGroup\n                ).render()\n              })\n              .catch(errorBody => {\n                this.element.appendChild(\n                  errorMessageBlock(\n                    document,\n                    escape(`Error creating a new group. (${errorBody})`)\n                  )\n                )\n              })\n          })\n\n          container.appendChild(chooseExistingGroupButton)\n          container.appendChild(createNewGroupButton)\n\n          this.element.innerHTML = ''\n          this.element.appendChild(container)\n        })\n        .catch(err => {\n          this.element.appendChild(\n            errorMessageBlock(\n              document,\n              escape(`Could find your groups. (${err})`)\n            )\n          )\n        })\n    }\n\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n\n  findAddressBook (typeIndex) {\n    return new Promise((resolve, reject) => {\n      kb.fetcher.nowOrWhenFetched(typeIndex, (ok, err) => {\n        if (!ok) {\n          return reject(err)\n        }\n        const bookRegistration = kb.any(\n          null,\n          ns.solid('forClass'),\n          ns.vcard('AddressBook')\n        )\n        if (!bookRegistration) {\n          return reject(\n            new Error(\n              'no address book registered in the solid type index ' + typeIndex\n            )\n          )\n        }\n        const book = kb.any(bookRegistration, ns.solid('instance'))\n        if (!book) {\n          return reject(new Error('incomplete address book registration'))\n        }\n        kb.fetcher\n          .load(book)\n          .then(function (_xhr) {\n            return resolve({ book })\n          })\n          .catch(function (err) {\n            return reject(new Error('Could not load address book ' + err))\n          })\n      })\n    })\n  }\n\n  createNewGroup (book, defaultNewGroupName) {\n    const { groupIndex, groupContainer } = indexes(book)\n    const group = rdf.sym(\n      `${groupContainer.uri}${uuid.v4().slice(0, 8)}.ttl#this`\n    )\n    const name = defaultNewGroupName || 'Untitled Group'\n\n    // NOTE that order matters here.  Unfortunately this type of update is\n    // non-atomic in that solid requires us to send two PATCHes, either of which\n    // might fail.\n    const patchPromises = [group.doc(), groupIndex].map(doc => {\n      const typeStatement = rdf.st(group, ns.rdf('type'), ns.vcard('Group'), doc)\n      const nameStatement = rdf.st(group, ns.vcard('fn'), name, group.doc(), doc)\n      const includesGroupStatement = rdf.st(\n        book,\n        ns.vcard('includesGroup'),\n        group,\n        doc\n      )\n      const toIns = doc.equals(groupIndex)\n        ? [typeStatement, nameStatement, includesGroupStatement]\n        : [typeStatement, nameStatement]\n      return patch(doc.uri, { toIns }).then(() => {\n        toIns.forEach(st => {\n          kb.add(st)\n        })\n      })\n    })\n    return Promise.all(patchPromises)\n      .then(() => ({ group }))\n      .catch(err => {\n        debug.log('Could not create new group.  PATCH failed ' + err)\n        throw new Error(\n          `Couldn't create new group.  PATCH failed for (${\n          err.xhr ? err.xhr.responseURL : ''\n          } )`\n        )\n      })\n  }\n\n  onSelectGroup (group) {\n    this.selectedgroup = group\n    this.groupPickedCb(group)\n    this.render()\n  }\n}\n\nexport class GroupPicker {\n  constructor (element, book, onSelectGroup) {\n    this.element = element\n    this.book = book\n    this.onSelectGroup = onSelectGroup\n  }\n\n  render () {\n    this.loadGroups()\n      .then(groups => {\n        // render the groups\n        const container = document.createElement('div')\n        container.style.display = 'flex'\n        container.style.flexDirection = 'column'\n        groups.forEach(group => {\n          const groupButton = document.createElement('button')\n          groupButton.addEventListener('click', this.handleClickGroup(group))\n          new Group(groupButton, group).render()\n          container.appendChild(groupButton)\n        })\n        this.element.innerHTML = ''\n        this.element.appendChild(container)\n      })\n      .catch(err => {\n        this.element.appendChild(\n          errorMessageBlock(\n            document,\n            escape(`There was an error loading your groups. (${err})`)\n          )\n        )\n      })\n    return this\n  }\n\n  loadGroups () {\n    return new Promise((resolve, reject) => {\n      const { groupIndex } = indexes(this.book)\n      kb.fetcher.nowOrWhenFetched(groupIndex, (ok, err) => {\n        if (!ok) {\n          return reject(err)\n        }\n        const groups = kb.each(this.book, ns.vcard('includesGroup'))\n        return resolve(groups)\n      })\n    })\n  }\n\n  handleClickGroup (group) {\n    return _event => {\n      this.onSelectGroup(group)\n    }\n  }\n}\n\nexport class Group {\n  constructor (element, group) {\n    this.element = element\n    this.group = group\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.textContent = escape(\n      // @@@@@ need to escape??\n      getWithDefault(this.group, ns.vcard('fn'), `[${this.group.value}]`)\n    )\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n}\n\nexport class GroupBuilder {\n  constructor (element, book, group, doneBuildingCb, groupChangedCb) {\n    this.element = element\n    this.book = book\n    this.group = group\n    this.onGroupChanged = (err, changeType, agent) => {\n      if (groupChangedCb) {\n        groupChangedCb(err, changeType, agent)\n      }\n    }\n    this.groupChangedCb = groupChangedCb\n    this.doneBuildingCb = doneBuildingCb\n  }\n\n  refresh () {\n    // TODO: implement\n  }\n\n  render () {\n    const dropContainer = document.createElement('div')\n    dropContainer.style.maxWidth = '350px'\n    dropContainer.style.minHeight = '200px'\n    dropContainer.style.outline = '1px solid black'\n    dropContainer.style.display = 'flex'\n    dropContainer.style.flexDirection = 'column'\n\n    makeDropTarget(dropContainer, uris => {\n      uris.forEach(uri => {\n        this.add(uri).catch(err => {\n          this.element.appendChild(\n            errorMessageBlock(\n              document,\n              escape(`Could not add the given WebId. (${err})`)\n            )\n          )\n        })\n      })\n    })\n\n    const groupNameInput = document.createElement('input')\n    groupNameInput.type = 'text'\n    groupNameInput.value = getWithDefault(\n      this.group,\n      ns.vcard('fn'),\n      'Untitled Group'\n    )\n    groupNameInput.addEventListener('change', event => {\n      this.setGroupName(event.target.value).catch(err => {\n        this.element.appendChild(\n          errorMessageBlock(document, `Error changing group name. (${err})`)\n        )\n      })\n    })\n    const groupNameLabel = document.createElement('label')\n    groupNameLabel.textContent = escape('Group Name:')\n    groupNameLabel.appendChild(groupNameInput)\n    dropContainer.appendChild(groupNameLabel)\n\n    if (kb.any(this.group, ns.vcard('hasMember'))) {\n      kb.match(this.group, ns.vcard('hasMember')).forEach(statement => {\n        const webIdNode = statement.object\n        const personDiv = document.createElement('div')\n        new Person(personDiv, webIdNode, this.handleRemove(webIdNode)).render()\n        dropContainer.appendChild(personDiv)\n      })\n    } else {\n      const copy = document.createElement('p')\n      copy.textContent = escape`\n        To add someone to this group, drag and drop their WebID URL onto the box.\n      `\n      dropContainer.appendChild(copy)\n    }\n\n    const doneBuildingButton = document.createElement('button')\n    doneBuildingButton.textContent = escape('Done')\n    doneBuildingButton.addEventListener('click', _event => {\n      this.doneBuildingCb(this.group)\n    })\n    dropContainer.appendChild(doneBuildingButton)\n\n    this.element.innerHTML = ''\n    this.element.appendChild(dropContainer)\n    return this\n  }\n\n  add (webId) {\n    return new Promise((resolve, reject) => {\n      kb.fetcher.nowOrWhenFetched(webId, (ok, err) => {\n        if (!ok) {\n          this.onGroupChanged(err)\n          return reject(err)\n        }\n        // make sure it's a valid person, group, or entity (for now just handle\n        // webId)\n        const webIdNode = rdf.namedNode(webId)\n        const rdfClass = kb.any(webIdNode, ns.rdf('type'))\n        if (!rdfClass || !rdfClass.equals(ns.foaf('Person'))) {\n          return reject(\n            new Error(\n              `Only people supported right now. (tried to add something of type ${rdfClass.value})`\n            )\n          )\n        }\n        return resolve(webIdNode)\n      })\n    }).then(webIdNode => {\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\n      if (kb.holdsStatement(statement)) {\n        return webIdNode\n      }\n      return patch(this.group.doc().uri, { toIns: [statement] }).then(() => {\n        statement.why = this.group.doc()\n        kb.add(statement)\n        this.onGroupChanged(null, 'added', webIdNode)\n        this.render()\n      })\n    })\n  }\n\n  handleRemove (webIdNode) {\n    return _event => {\n      const statement = rdf.st(this.group, ns.vcard('hasMember'), webIdNode)\n      return patch(this.group.doc().uri, { toDel: [statement] })\n        .then(() => {\n          kb.remove(statement)\n          this.onGroupChanged(null, 'removed', webIdNode)\n          this.render()\n          return true\n        })\n        .catch(err => {\n          const name = kb.any(webIdNode, ns.foaf('name'))\n          const errorMessage =\n            name && name.value\n              ? `Could not remove ${name.value}. (${err})`\n              : `Could not remove ${webIdNode.value}. (${err})`\n          throw new Error(errorMessage)\n        })\n    }\n  }\n\n  setGroupName (name) {\n    const { groupIndex } = indexes(this.book)\n    const updatePromises = [this.group.doc(), groupIndex].map(namedGraph => {\n      const oldNameStatements = kb.match(\n        this.group,\n        ns.vcard('fn'),\n        null,\n        namedGraph\n      )\n      const newNameStatement = rdf.st(\n        this.group,\n        ns.vcard('fn'),\n        rdf.literal(name)\n      )\n      return patch(namedGraph.value, {\n        toDel: oldNameStatements,\n        toIns: [newNameStatement]\n      }).then(_solidResponse => {\n        kb.removeStatements(oldNameStatements)\n        newNameStatement.why = namedGraph\n        kb.add(newNameStatement)\n      })\n    })\n    return Promise.all(updatePromises)\n  }\n}\n// @ignore exporting this only for the unit test\n// @@ TODO maybe I should move this down at end, but for\n// now I will leave it where it was\nexport class Person {\n  constructor (element, webIdNode, handleRemove) {\n    this.webIdNode = webIdNode\n    this.element = element\n    this.handleRemove = handleRemove\n  }\n\n  render () {\n    const container = document.createElement('div')\n    container.style.display = 'flex'\n\n    // TODO: take a look at UI.widgets.setName\n    const imgSrc = getWithDefault(\n      this.webIdNode,\n      ns.foaf('img'),\n      iconBase + 'noun_15059.svg'\n    )\n    const profileImg = document.createElement('img')\n    profileImg.src = escape(imgSrc)\n    profileImg.width = '50'\n    profileImg.height = '50'\n    profileImg.style.margin = '5px'\n\n    // TODO: take a look at UI.widgets.setImage\n    const name = getWithDefault(\n      this.webIdNode,\n      ns.foaf('name'),\n      `[${this.webIdNode}]`\n    )\n    const nameSpan = document.createElement('span')\n    nameSpan.innerHTML = escape(name)\n    nameSpan.style.flexGrow = '1'\n    nameSpan.style.margin = 'auto 0'\n\n    const removeButton = document.createElement('button')\n    removeButton.textContent = 'Remove'\n    removeButton.addEventListener('click', _event =>\n      this.handleRemove().catch(err => {\n        this.element.appendChild(errorMessageBlock(document, escape(`${err}`)))\n      })\n    )\n    removeButton.style.margin = '5px'\n\n    container.appendChild(profileImg)\n    container.appendChild(nameSpan)\n    container.appendChild(removeButton)\n\n    this.element.innerHTML = ''\n    this.element.appendChild(container)\n    return this\n  }\n}\n\nfunction getWithDefault (subject, predicate, defaultValue) {\n  const object = kb.any(subject, predicate)\n  return object ? object.value : defaultValue\n}\n\nfunction patch (url, { toDel, toIns }) {\n  return new Promise((resolve, reject) => {\n    kb.updater.update(toDel, toIns, (uri, success, errorMessage) => {\n      if (!success) {\n        return reject(\n          new Error(`PATCH failed for resource <${uri}>: ${errorMessage}`)\n        )\n      }\n      resolve()\n    })\n  })\n  // return webClient.patch(url, toDel, toIns)\n  //   .then(solidResponse => {\n  //     const status = solidResponse.xhr.status\n  //     if (status < 200 || status >= 400) {\n  //       const err = new Error(`PATCH failed for resource <${solidResponse.url}>`)\n  //       err.solidResponse = solidResponse\n  //       throw err\n  //     }\n  //   })\n}\n\nfunction indexes (book) {\n  return {\n    // bookIndex: book,\n    groupIndex: kb.any(book, ns.vcard('groupIndex')),\n    groupContainer: kb.sym(book.dir().uri + 'Group/')\n  }\n}\n"],"mappings":"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"}