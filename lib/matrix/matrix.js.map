{"version":3,"file":"matrix.js","names":["kb","solidLogicSingleton","store","matrixForQuery","dom","query","vx","vy","vvalue","options","whenDone","matrix","createElement","header","corner","appendChild","setAttribute","lastHeader","columns","rows","setCell","cell","x","y","value","firstChild","removeChild","style","textAlign","cellFunction","textContent","utils","label","old","rowFor","y1","toNT","tr","termType","fetcher","nowOrWhenFetched","uri","split","undefined","ok","_body","_response","i","length","$rdf","fromNT","dataValueNT","ele","nextSibling","yDecreasing","insertBefore","columnNumberFor","x1","xNT","col","xDecreasing","slice","concat","push","row","td","t","j","markOldCells","children","clearOldCells","colsUsed","rowsUsed","set_y","k","set_x","newcolumns","refresh","addCellFromBindings","bindings","toString","colNo"],"sources":["../../src/matrix/matrix.ts"],"sourcesContent":["//      Build a 2D matrix of values\n//\n//  dom      AKA document\n//  query    a Query object of rdflib.js with a valid pattern\n//  vx       A variable object, the one to be used for the X variable (horiz)\n//  vy       A variable object, the one to be used for the Y variable (vertical)\n//  vvalue       A variable object, the one to be used for the cell value\n//  returns  A DOM element with the matrix in it, which has a .refresh() function.\n//\n// Options:\n//     cellFunction(td, x, y, value)  fill the TD element of a single cell\n//     xDecreasing  set true for x axis to be in decreasing order.\n//     yDecreasing  set true for y axis to be in decreasing order.\n//     set_x        array of X values to be define initial rows (order irrelevant)\n//     set_y        array of Y values to be define initial columns\n//\n// Features:\n//   Header row at top (x axis) and left (y-axis) generated automatically.\n//   Extra rows and columns are inserted as needed to hold new data points\n//   matrix.refresh() will re-run the query and adjust the display\n\nimport * as utils from '../utils'\nimport * as $rdf from 'rdflib'\nimport { MatrixOptions } from './types'\nimport { solidLogicSingleton } from 'solid-logic'\n\nconst kb = solidLogicSingleton.store\n\nexport function matrixForQuery (\n  dom: HTMLDocument,\n  query: $rdf.Query,\n  vx: $rdf.Variable,\n  vy: $rdf.Variable,\n  vvalue: $rdf.Variable,\n  options: MatrixOptions,\n  whenDone: () => void\n) {\n  // @@ TODO Remove need to cast to any\n  const matrix: any = dom.createElement('table')\n  const header = dom.createElement('tr')\n  const corner = header.appendChild(dom.createElement('td'))\n  corner.setAttribute('class', 'MatrixCorner')\n  matrix.appendChild(header) // just one for now\n  matrix.lastHeader = header // Element before data\n  let columns: any[] = [] // Vector\n  const rows: any[] = [] // Associative array\n\n  const setCell = function (cell, x, y, value) {\n    while (cell.firstChild) {\n      // Empty any previous\n      cell.removeChild(cell.firstChild)\n    }\n    cell.setAttribute('style', '')\n    cell.style.textAlign = 'center'\n\n    if (options.cellFunction) {\n      options.cellFunction(cell, x, y, value)\n    } else {\n      cell.textContent = utils.label(value)\n      cell.setAttribute('style', 'padding: 0.3em')\n    }\n    delete cell.old\n  }\n\n  const rowFor = function (y1) {\n    const y = y1.toNT()\n    if (rows[y]) return rows[y]\n    // @@ TODO Remove need for casting to any\n    const tr: any = dom.createElement('tr')\n    const header = tr.appendChild(dom.createElement('td'))\n    header.setAttribute('style', 'padding: 0.3em;')\n    header.textContent = utils.label(y1) // first approximation\n    if (y1.termType === 'NamedNode') {\n      kb.fetcher!.nowOrWhenFetched(y1.uri.split('#')[0], undefined, function (\n        ok,\n        _body,\n        _response\n      ) {\n        if (ok) header.textContent = utils.label(y1)\n      })\n    }\n    for (let i = 0; i < columns.length; i++) {\n      setCell(\n        tr.appendChild(dom.createElement('td')),\n        $rdf.fromNT(columns[i]),\n        y1,\n        null\n      )\n    }\n    tr.dataValueNT = y\n    rows[y] = tr\n    for (let ele = matrix.lastHeader.nextSibling; ele; ele = ele.nextSibling) {\n      // skip header\n      if (\n        (y > ele.dataValueNT && options && options.yDecreasing) ||\n        (y < ele.dataValueNT && !(options && options.yDecreasing))\n      ) {\n        return matrix.insertBefore(tr, ele) // return the tr\n      }\n    }\n    return matrix.appendChild(tr) // return the tr\n  }\n\n  const columnNumberFor = function (x1): number {\n    const xNT: any = x1.toNT() // xNT is a NT string\n    let col: any = null\n    // These are data columns (not headings)\n    for (let i = 0; i < columns.length; i++) {\n      if (columns[i] === xNT) {\n        return i\n      }\n\n      if (\n        (xNT > columns[i] && options.xDecreasing) ||\n        (xNT < columns[i] && !options.xDecreasing)\n      ) {\n        columns = columns\n          .slice(0, i)\n          .concat([xNT])\n          .concat(columns.slice(i))\n        col = i\n        break\n      }\n    }\n\n    if (col === null) {\n      col = columns.length\n      columns.push(xNT)\n    }\n\n    // col is the number of the new column, starting from 0\n    for (let row = matrix.firstChild; row; row = row.nextSibling) {\n      // For every row header or not\n      const y = row.dataValueNT\n      const td = dom.createElement('td') // Add a new cell\n      td.style.textAlign = 'center'\n      if (row === matrix.firstChild) {\n        td.textContent = utils.label(x1)\n      } else {\n        setCell(td, x1, $rdf.fromNT(y), null)\n      }\n      if (col === columns.length - 1) {\n        row.appendChild(td)\n      } else {\n        let t = row.firstChild\n        for (let j = 0; j < col + 1; j++) {\n          // Skip header col too\n          t = t.nextSibling\n        }\n        row.insertBefore(td, t)\n      }\n    }\n    return col\n  }\n\n  const markOldCells = function () {\n    for (let i = 1; i < matrix.children.length; i++) {\n      const row = matrix.children[i]\n      for (let j = 1; j < row.children.length; j++) {\n        row.children[j].old = true\n      }\n    }\n  }\n\n  const clearOldCells = function () {\n    let row, cell\n    const colsUsed: any[] = []\n    const rowsUsed: any[] = []\n\n    if (options.set_y) {\n      // Knows y values create rows\n      for (let k = 0; k < options.set_y.length; k++) {\n        rowsUsed[options.set_y[k]] = true\n      }\n    }\n    if (options.set_x) {\n      for (let k = 0; k < options.set_x.length; k++) {\n        colsUsed[columnNumberFor(options.set_x[k]) + 1] = true\n      }\n    }\n\n    for (let i = 1; i < matrix.children.length; i++) {\n      row = matrix.children[i]\n      for (let j = 1; j < row.children.length; j++) {\n        cell = row.children[j]\n        if (cell.old) {\n          const y = $rdf.fromNT(row.dataValueNT)\n          const x = $rdf.fromNT(columns[j - 1])\n          setCell(cell, x, y, null)\n        } else {\n          rowsUsed[row.dataValueNT] = true\n          colsUsed[j] = true\n        }\n      }\n    }\n\n    for (let i = 0; i < matrix.children.length; i++) {\n      row = matrix.children[i]\n      if (i > 0 && !rowsUsed[row.dataValueNT]) {\n        delete rows[row.dataValueNT]\n        matrix.removeChild(row)\n      } else {\n        for (let j = row.children.length - 1; j > 0; j--) {\n          // backwards\n          const cell = row.children[j]\n          if (!colsUsed[j]) {\n            row.removeChild(cell)\n          }\n        }\n      }\n    }\n    const newcolumns: any[] = []\n    for (let j = 0; j < columns.length; j++) {\n      if (colsUsed[j + 1]) {\n        newcolumns.push(columns[j])\n      }\n    }\n    columns = newcolumns\n  }\n\n  matrix.refresh = function () {\n    markOldCells()\n    kb.query(query, addCellFromBindings, undefined, clearOldCells)\n  }\n\n  const addCellFromBindings = function (bindings) {\n    const x = bindings[vx.toString()]\n    const y = bindings[vy.toString()]\n    const value = bindings[(vvalue.toString())]\n    const row = rowFor(y)\n    const colNo = columnNumberFor(x)\n    const cell = row.children[colNo + 1] // number of Y axis headings\n    setCell(cell, x, y, value)\n  }\n\n  if (options.set_y) {\n    // Knows y values create rows\n    for (let k = 0; k < options.set_y.length; k++) {\n      rowFor(options.set_y[k])\n    }\n  }\n  if (options.set_x) {\n    for (let k = 0; k < options.set_x.length; k++) {\n      columnNumberFor(options.set_x[k])\n    }\n  }\n\n  kb.query(query, addCellFromBindings, undefined, whenDone) // Populate the matrix\n  return matrix\n}\n"],"mappings":"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"}