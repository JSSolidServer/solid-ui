{"version":3,"file":"participation.js","names":["debug","_interopRequireWildcard","require","_rdflib","ns","_widgets","_utils","_pad","_solidLogic","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","step","next","_e2","minLen","_arrayLikeToArray","toString","slice","constructor","name","from","test","arr","len","arr2","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","result","NewTarget","Reflect","construct","arguments","apply","_possibleConstructorReturn2","sham","Proxy","Boolean","valueOf","ParticipationTableElement","_HTMLTableElement","_inherits2","_super","_this","_classCallCheck2","_len","args","_key","concat","_defineProperty2","_assertThisInitialized2","_createClass2","_wrapNativeSuper2","HTMLTableElement","store","solidLogicSingleton","renderPartipants","dom","table","unused1","subject","unused2","options","setAttribute","newRowForParticpation","parp","person","any","wf","tr","createElement","textContent","bg","anyValue","ui","block","personTR","appendChild","td","insertBefore","firstChild","syncTable","parps","each","map","log","cal","sort","participations","p","syncTableToArray","refresh","participationObject","padDoc","me","Promise","resolve","reject","Error","filter","pn","holds","candidates","_iterator","_step","participation","date","push","warn","newThing","ins","st","Date","lightColorHash","updater","update","uri","ok","errorMessage","recordParticipation","refreshable","authn","currentUser","editable","manageParticipation","container","_participation","errorMessageBlock"],"sources":["../src/participation.ts"],"sourcesContent":["/* Manage a UI for the particpation of a person in any thing\n*/\n\n// import { currentUser } from './authn/authn'\nimport * as debug from './debug'\nimport { LiveStore, NamedNode, st, UpdateManager } from 'rdflib'\nimport * as ns from './ns'\nimport { personTR, newThing, errorMessageBlock } from './widgets'\nimport { syncTableToArray } from './utils'\nimport { lightColorHash } from './pad'\nimport { log } from './debug'\nimport { solidLogicSingleton, authn } from 'solid-logic'\n\ntype ParticipationOptions = {\n  deleteFunction?: () => {}\n  link?: string\n  draggable?: boolean\n}\n\nclass ParticipationTableElement extends HTMLTableElement {\n  refresh?: () => void\n}\nconst store = solidLogicSingleton.store as LiveStore\n\n/**  Manage participation in this session\n*\n*  @param {Document} dom - the web page loaded into the browser\n*  @param {HTMLTableElement} table - the table element\n*  @param {NamedNode} unused1/document - the document to render (this argument is no longer used, but left in for backwards compatibility)\n*  @param {NamedNode} subject - the thing in which the participation is happening\n*  @param {NamedNode} unused2/me - user that is logged into the pod (this argument is no longer used, but left in for backwards compatibility)\n*  @param {ParticipationOptions} options - the options that can be passed in are deleteFunction, link, and draggable these are used by the personTR button\n*/\nexport function renderPartipants (dom: HTMLDocument, table: ParticipationTableElement, unused1: NamedNode, subject: NamedNode, unused2: NamedNode, options: ParticipationOptions) {\n  table.setAttribute('style', 'margin: 0.8em;')\n\n  const newRowForParticpation = function (parp) {\n    const person = store.any(parp, ns.wf('participant'))\n\n    let tr\n    if (!person) {\n      tr = dom.createElement('tr')\n      tr.textContent = '???' // Don't crash - invalid part'n entry\n      return tr\n    }\n    const bg = store.anyValue(parp, ns.ui('backgroundColor')) || 'white'\n\n    const block = dom.createElement('div')\n    block.setAttribute(\n      'style',\n      'height: 1.5em; width: 1.5em; margin: 0.3em; border 0.01em solid #888; background-color: ' +\n      bg\n    )\n    tr = personTR(dom, null, person, options)\n    table.appendChild(tr)\n    const td = dom.createElement('td')\n    td.setAttribute('style', 'vertical-align: middle;')\n    td.appendChild(block)\n    tr.insertBefore(td, tr.firstChild)\n    return tr\n  }\n\n  const syncTable = function () {\n    const parps = store.each(subject, ns.wf('participation')).map(function (parp) {\n      log('in participants')\n      return [store.anyValue(parp as any, ns.cal('dtstart')) || '9999-12-31', parp]\n    })\n    parps.sort() // List in order of joining\n    const participations = parps.map(function (p) {\n      return p[1]\n    })\n    syncTableToArray(table, participations, newRowForParticpation)\n  }\n  table.refresh = syncTable\n  syncTable()\n  return table\n}\n\n/** Record, or find old, Particpation object\n *\n * A particpaption object is a place to record things specifically about\n * subject and the user, such as preferences, start of membership, etc\n * @param {NamedNode} subject - the thing in which the participation is happening\n * @param {NamedNode} document -  where to record the data\n * @param {NamedNode} me - the logged in user\n *\n */\nexport function participationObject (subject: NamedNode, padDoc: NamedNode, me: NamedNode) {\n  return new Promise(function (resolve, reject) {\n    if (!me) {\n      throw new Error('No user id')\n    }\n\n    const parps = store.each(subject, ns.wf('participation')).filter(function (pn) {\n      return store.holds(pn, ns.wf('participant'), me)\n    })\n    if (parps.length > 1) { // This can happen. https://github.com/solidos/chat-pane/issues/71\n      const candidates: (string | NamedNode) [][] = []\n      for (const participation of parps) {\n        const date = store.anyValue(participation as NamedNode, ns.cal('dtstart'))\n        if (date) {\n          candidates.push([date, participation as NamedNode])\n        }\n      }\n      candidates.sort() // Pick the earliest\n      // @@ Possibly, for extra credit, delete the others, if we have write access\n      debug.warn('Multiple particpation objects, picking earliest, in ' + padDoc)\n      resolve(candidates[0][1])\n      // throw new Error('Multiple records of your participation')\n    }\n    if (parps.length) {\n      // If I am not already recorded\n      resolve(parps[0]) // returns the particpation object\n    } else {\n      const participation = newThing(padDoc)\n      const ins = [\n        st(subject, ns.wf('participation'), participation, padDoc),\n\n        st(participation, ns.wf('participant'), me, padDoc),\n        st(participation, ns.cal('dtstart'), new Date() as any, padDoc),\n        st(\n          participation,\n          ns.ui('backgroundColor'),\n          lightColorHash(me) as any,\n          padDoc\n        )\n      ];\n      (store.updater as UpdateManager).update([], ins, function (uri: string | null | undefined, ok: boolean, errorMessage?: string) {\n        if (!ok) {\n          reject(new Error('Error recording your partipation: ' + errorMessage))\n        } else {\n          resolve(participation)\n        }\n      })\n      resolve(participation)\n    }\n  })\n}\n\n/** Record my participation and display participants\n *\n * @param {NamedNode} subject - the thing in which participation is happening\n * @param {NamedNode} padDoc - the document into which the particpation should be recorded\n * @param {DOMNode} refreshable - a DOM element whose refresh() is to be called if the change works\n *\n */\nexport function recordParticipation (subject: NamedNode, padDoc: NamedNode, refreshable: any) {\n  const me = authn.currentUser()\n  if (!me) return // Not logged in\n\n  const parps = store.each(subject, ns.wf('participation')).filter(function (pn) {\n    return store.holds(pn, ns.wf('participant'), me)\n  })\n  if (parps.length > 1) {\n    throw new Error('Multiple records of your participation')\n  }\n  if (parps.length) {\n    // If I am not already recorded\n    return parps[0] // returns the particpation object\n  } else {\n    if (!(store.updater as UpdateManager).editable(padDoc)) {\n      debug.log('Not recording participation, as no write acesss as ' + me + ' to ' + padDoc)\n      return null\n    }\n    const participation = newThing(padDoc)\n    const ins = [\n      st(subject, ns.wf('participation'), participation, padDoc),\n\n      st(participation, ns.wf('participant'), me, padDoc),\n      st(participation, ns.cal('dtstart'), new Date() as any, padDoc),\n      st(\n        participation,\n        ns.ui('backgroundColor'),\n        lightColorHash(me) as any,\n        padDoc\n      )\n    ];\n    (store.updater as UpdateManager).update([], ins, function (uri: string | null | undefined, ok: boolean, errorMessage?: string) {\n      if (!ok) {\n        throw new Error('Error recording your partipation: ' + errorMessage)\n      }\n      if (refreshable && refreshable.refresh) {\n        refreshable.refresh()\n      }\n      // UI.pad.renderPartipants(dom, table, padDoc, subject, me, options)\n    })\n    return participation\n  }\n}\n\n/**  Record my participation and display participants\n*\n*   @param {Document} dom  - the web page loaded into the browser\n*   @param {HTMLDivElement} container - the container element where the participants should be displayed\n*   @param {NamedNode} document - the document into which the particpation should be shown\n*   @param {NamedNode} subject - the thing in which participation is happening\n*   @param {NamedNode} me - the logged in user\n*   @param {ParticipationOptions} options - the options that can be passed in are deleteFunction, link, and draggable these are used by the personTR button\n*\n*/\nexport function manageParticipation (\n  dom: Document,\n  container: HTMLDivElement,\n  padDoc: NamedNode,\n  subject: NamedNode,\n  me: NamedNode,\n  options: ParticipationOptions\n) {\n  const table = dom.createElement('table')\n  container.appendChild(table)\n  renderPartipants(dom, table, padDoc, subject, me, options)\n  let _participation\n  try {\n    _participation = recordParticipation(subject, padDoc, table)\n  } catch (e) {\n    container.appendChild(\n      errorMessageBlock(\n        dom,\n        'Error recording your partipation: ' + e\n      )\n    ) // Clean up?\n  }\n  return table\n}\n"],"mappings":"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"}