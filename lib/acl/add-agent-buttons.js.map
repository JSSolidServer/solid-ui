{"version":3,"file":"add-agent-buttons.js","names":["AddAgentButtons","groupList","rootElement","controller","dom","createElement","barElement","innerHTML","appendChild","renderAddButton","widgets","button","icons","iconBase","toggleBar","renderBar","isExpanded","renderPersonButton","renderGroupButton","renderPublicButton","renderAuthenticatedAgentButton","renderBotButton","renderAppsButton","Array","from","children","filter","element","forEach","removeChild","iconForClass","event","renderSimplifiedBar","target","renderNameForm","ns","vcard","then","name","addPerson","renderCleanup","error","renderStatus","addGroup","type","noun","askName","store","addAgent","foaf","uri","renderTemporaryStatus","acl","schema","addBot","eventContext","div","existingApps","renderAppsTable","renderAppsView","newApp","getOriginFromName","Promise","race","origin","addNewURI","trustedApplications","context","session","paneRegistry","byName","trustedApplicationsElement","render","classList","add","classes","trustedAppController","cancelButton","trustedAppCancelButton","insertBefore","firstChild","ensureLoadedProfile","trustedApps","each","me","trustedOrigins","flatMap","app","textContent","length","resolve","reject","appsTable","trustedAppAddApplicationsTable","any","Error","value","thingTR","personTR","innerTable","innerRow","innerLeftColumn","innerMiddleColumn","utils","label","subject","innerRightColumn","continueButton","domainNameRegexp","match","debug","log","agentUri"],"sources":["../../src/acl/add-agent-buttons.ts"],"sourcesContent":["/**\n * Contains the [[AddAgentButtons]] class\n * @packageDocumentation\n */\n\nimport { NamedNode, Store } from 'rdflib'\nimport { AuthenticationContext } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile } from '../login/login'\nimport * as ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { AccessGroups } from './access-groups'\n\n/**\n * Renders the Sharing pane's \"+\" button and the menus behind it,\n * see https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md#add\n */\nexport class AddAgentButtons {\n  private readonly rootElement: HTMLElement\n  private readonly barElement: HTMLElement\n  private isExpanded: boolean = false\n\n  constructor (private groupList: AccessGroups) {\n    this.rootElement = groupList.controller.dom.createElement('div')\n    this.barElement = groupList.controller.dom.createElement('div')\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    this.rootElement.appendChild(this.renderAddButton())\n    this.rootElement.appendChild(this.barElement)\n    return this.rootElement\n  }\n\n  private renderAddButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_34653_green.svg`,\n      'Add ...',\n      () => {\n        this.toggleBar()\n        this.renderBar()\n      }\n    )\n  }\n\n  private renderBar (): void {\n    this.barElement.innerHTML = ''\n    if (!this.isExpanded) {\n      return\n    }\n    this.barElement.appendChild(this.renderPersonButton())\n    this.barElement.appendChild(this.renderGroupButton())\n    this.barElement.appendChild(this.renderPublicButton())\n    this.barElement.appendChild(this.renderAuthenticatedAgentButton())\n    this.barElement.appendChild(this.renderBotButton())\n    this.barElement.appendChild(this.renderAppsButton())\n  }\n\n  private renderSimplifiedBar (button: EventTarget | null) {\n    Array.from(this.barElement.children)\n      .filter(element => element !== button)\n      .forEach(element => this.barElement.removeChild(element))\n  }\n\n  private renderPersonButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Individual'],\n      'Add Person',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Individual'), 'person')\n          .then(name => this.addPerson(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderGroupButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Group'],\n      'Add Group',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Group'), 'group')\n          .then(name => this.addGroup(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderNameForm (type: NamedNode, noun: string): Promise<string | undefined> {\n    return widgets.askName(\n      this.groupList.controller.dom,\n      this.groupList.store,\n      this.barElement,\n      ns.vcard('URI'),\n      type,\n      noun\n    )\n  }\n\n  private renderPublicButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['foaf:Agent'],\n      'Add Everyone',\n      () => this.addAgent(ns.foaf('Agent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding the general public to those who can read. Drag the globe to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderAuthenticatedAgentButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_99101.svg`,\n      'Anyone logged In',\n      () => this.addAgent(ns.acl('AuthenticatedAgent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderBotButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + 'noun_Robot_849764.svg',\n      'A Software Agent (bot)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.schema('Application'), 'bot')\n          .then(name => this.addBot(name))\n          .then(() => this.renderCleanup())\n      })\n  }\n\n  private renderAppsButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_15177.svg`,\n      'A Web App (origin)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        const eventContext = {\n          div: this.barElement,\n          dom: this.groupList.controller.dom\n        }\n        const existingApps = this.renderAppsTable(eventContext)\n          .catch(error => this.groupList.controller.renderStatus(error))\n        this.renderAppsView()\n        const newApp = this.renderNameForm(ns.schema('WebApplication'), 'webapp domain')\n          .then(name => this.getOriginFromName(name))\n        Promise.race([\n          existingApps,\n          newApp\n        ])\n          .then(origin => {\n            if (origin) {\n              this.groupList.addNewURI(origin)\n            }\n          })\n          .then(() => this.renderCleanup())\n      }\n    )\n  }\n\n  private renderAppsView (): void {\n    const trustedApplications = this.groupList.controller.context.session.paneRegistry.byName('trustedApplications')\n    if (trustedApplications) {\n      const trustedApplicationsElement = trustedApplications.render(null, this.groupList.controller.context)\n      trustedApplicationsElement.classList.add(this.groupList.controller.classes.trustedAppController)\n\n      const cancelButton = widgets.cancelButton(this.groupList.controller.dom, () => this.renderCleanup())\n      cancelButton.classList.add(this.groupList.controller.classes.trustedAppCancelButton)\n      trustedApplicationsElement.insertBefore(cancelButton, trustedApplicationsElement.firstChild)\n\n      this.barElement.appendChild(trustedApplicationsElement)\n    }\n  }\n\n  private async renderAppsTable (eventContext: AuthenticationContext): Promise<string> {\n    await ensureLoadedProfile(eventContext)\n    const trustedApps = (this.groupList.store as Store).each(eventContext.me, ns.acl('trustedApp')) as Array<NamedNode> // @@ TODO fix as\n    const trustedOrigins = trustedApps.flatMap(app => (this.groupList.store as Store).each(app, ns.acl('origin'))) // @@ TODO fix as\n\n    this.barElement.appendChild(this.groupList.controller.dom.createElement('p')).textContent = `You have ${trustedOrigins.length} selected web apps.`\n    return new Promise((resolve, reject) => {\n      const appsTable = this.barElement.appendChild(this.groupList.controller.dom.createElement('table'))\n      appsTable.classList.add(this.groupList.controller.classes.trustedAppAddApplicationsTable)\n      trustedApps.forEach(app => {\n        const origin = (this.groupList.store as Store).any(app, ns.acl('origin')) // @@ TODO fix as\n        if (!origin) {\n          reject(new Error(`Unable to pick app: ${app.value}`))\n        }\n        const thingTR = widgets.personTR(this.groupList.controller.dom, ns.acl('origin'), origin, {})\n        const innerTable = this.groupList.controller.dom.createElement('table')\n        const innerRow = innerTable.appendChild(this.groupList.controller.dom.createElement('tr'))\n\n        const innerLeftColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerLeftColumn.appendChild(thingTR)\n\n        const innerMiddleColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerMiddleColumn.textContent = `Give access to ${this.groupList.controller.noun} ${utils.label(this.groupList.controller.subject)}?`\n\n        const innerRightColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerRightColumn.appendChild(widgets.continueButton(this.groupList.controller.dom, () => resolve(origin!.value)))\n\n        appsTable.appendChild(innerTable)\n      })\n    })\n  }\n\n  private renderCleanup (): void {\n    this.renderBar()\n    this.groupList.render()\n  }\n\n  private async addPerson (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a person and has an owner who agrees they own it\n    debug.log(`Adding to ACL person: ${name}`)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addGroup (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a group and has an owner who agrees they own it\n    debug.log('Adding to ACL group: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addAgent (agentUri: string): Promise<void> {\n    await this.groupList.addNewURI(agentUri)\n    this.toggleBar()\n  }\n\n  private async addBot (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a bot and has an owner who agrees they own it\n    debug.log('Adding to ACL bot: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async getOriginFromName (name?: string): Promise<string | void> {\n    if (!name) return Promise.resolve() // user cancelled\n    const domainNameRegexp = /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i\n    // https://www.oreilly.com/library/view/regular-expressions-cookbook/9781449327453/ch08s15.html\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a domain name'))\n    }\n    const origin = 'https://' + name\n    debug.log('Adding to ACL origin: ' + origin)\n    this.toggleBar()\n    return origin\n  }\n\n  private toggleBar (): void {\n    this.isExpanded = !this.isExpanded\n  }\n}\n"],"mappings":"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"}