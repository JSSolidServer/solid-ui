{"version":3,"file":"add-agent-buttons.js","names":["AddAgentButtons","groupList","rootElement","controller","dom","createElement","barElement","innerHTML","appendChild","renderAddButton","widgets","button","icons","iconBase","toggleBar","renderBar","isExpanded","renderPersonButton","renderGroupButton","renderPublicButton","renderAuthenticatedAgentButton","renderBotButton","renderAppsButton","Array","from","children","filter","element","forEach","removeChild","iconForClass","event","renderSimplifiedBar","target","renderNameForm","ns","vcard","then","name","addPerson","renderCleanup","error","renderStatus","addGroup","type","noun","askName","store","addAgent","foaf","uri","renderTemporaryStatus","acl","schema","addBot","eventContext","div","existingApps","renderAppsTable","renderAppsView","newApp","getOriginFromName","Promise","race","origin","addNewURI","trustedApplications","context","session","paneRegistry","byName","trustedApplicationsElement","render","classList","add","classes","trustedAppController","cancelButton","trustedAppCancelButton","insertBefore","firstChild","ensureLoadedProfile","trustedApps","each","me","trustedOrigins","flatMap","app","textContent","length","resolve","reject","appsTable","trustedAppAddApplicationsTable","any","Error","value","thingTR","personTR","innerTable","innerRow","innerLeftColumn","innerMiddleColumn","utils","label","subject","innerRightColumn","continueButton","domainNameRegexp","match","debug","log","agentUri"],"sources":["../../src/acl/add-agent-buttons.ts"],"sourcesContent":["/**\n * Contains the [[AddAgentButtons]] class\n * @packageDocumentation\n */\n\nimport { NamedNode, Store } from 'rdflib'\nimport { AuthenticationContext } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile } from '../login/login'\nimport * as ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { AccessGroups } from './access-groups'\n\n/**\n * Renders the Sharing pane's \"+\" button and the menus behind it,\n * see https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md#add\n */\nexport class AddAgentButtons {\n  private readonly rootElement: HTMLElement\n  private readonly barElement: HTMLElement\n  private isExpanded: boolean = false\n\n  constructor (private groupList: AccessGroups) {\n    this.rootElement = groupList.controller.dom.createElement('div')\n    this.barElement = groupList.controller.dom.createElement('div')\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    this.rootElement.appendChild(this.renderAddButton())\n    this.rootElement.appendChild(this.barElement)\n    return this.rootElement\n  }\n\n  private renderAddButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_34653_green.svg`,\n      'Add ...',\n      () => {\n        this.toggleBar()\n        this.renderBar()\n      }\n    )\n  }\n\n  private renderBar (): void {\n    this.barElement.innerHTML = ''\n    if (!this.isExpanded) {\n      return\n    }\n    this.barElement.appendChild(this.renderPersonButton())\n    this.barElement.appendChild(this.renderGroupButton())\n    this.barElement.appendChild(this.renderPublicButton())\n    this.barElement.appendChild(this.renderAuthenticatedAgentButton())\n    this.barElement.appendChild(this.renderBotButton())\n    this.barElement.appendChild(this.renderAppsButton())\n  }\n\n  private renderSimplifiedBar (button: EventTarget | null) {\n    Array.from(this.barElement.children)\n      .filter(element => element !== button)\n      .forEach(element => this.barElement.removeChild(element))\n  }\n\n  private renderPersonButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Individual'],\n      'Add Person',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Individual'), 'person')\n          .then(name => this.addPerson(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderGroupButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Group'],\n      'Add Group',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Group'), 'group')\n          .then(name => this.addGroup(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderNameForm (type: NamedNode, noun: string): Promise<string | undefined> {\n    return widgets.askName(\n      this.groupList.controller.dom,\n      this.groupList.store,\n      this.barElement,\n      ns.vcard('URI'),\n      type,\n      noun\n    )\n  }\n\n  private renderPublicButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['foaf:Agent'],\n      'Add Everyone',\n      () => this.addAgent(ns.foaf('Agent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding the general public to those who can read. Drag the globe to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderAuthenticatedAgentButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_99101.svg`,\n      'Anyone logged In',\n      () => this.addAgent(ns.acl('AuthenticatedAgent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderBotButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + 'noun_Robot_849764.svg',\n      'A Software Agent (bot)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.schema('Application'), 'bot')\n          .then(name => this.addBot(name))\n          .then(() => this.renderCleanup())\n      })\n  }\n\n  private renderAppsButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_15177.svg`,\n      'A Web App (origin)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        const eventContext = {\n          div: this.barElement,\n          dom: this.groupList.controller.dom\n        }\n        const existingApps = this.renderAppsTable(eventContext)\n          .catch(error => this.groupList.controller.renderStatus(error))\n        this.renderAppsView()\n        const newApp = this.renderNameForm(ns.schema('WebApplication'), 'webapp domain')\n          .then(name => this.getOriginFromName(name))\n        Promise.race([\n          existingApps,\n          newApp\n        ])\n          .then(origin => {\n            if (origin) {\n              this.groupList.addNewURI(origin)\n            }\n          })\n          .then(() => this.renderCleanup())\n      }\n    )\n  }\n\n  private renderAppsView (): void {\n    const trustedApplications = this.groupList.controller.context.session.paneRegistry.byName('trustedApplications')\n    if (trustedApplications) {\n      const trustedApplicationsElement = trustedApplications.render(null, this.groupList.controller.context)\n      trustedApplicationsElement.classList.add(this.groupList.controller.classes.trustedAppController)\n\n      const cancelButton = widgets.cancelButton(this.groupList.controller.dom, () => this.renderCleanup())\n      cancelButton.classList.add(this.groupList.controller.classes.trustedAppCancelButton)\n      trustedApplicationsElement.insertBefore(cancelButton, trustedApplicationsElement.firstChild)\n\n      this.barElement.appendChild(trustedApplicationsElement)\n    }\n  }\n\n  private async renderAppsTable (eventContext: AuthenticationContext): Promise<string> {\n    await ensureLoadedProfile(eventContext)\n    const trustedApps = (this.groupList.store as Store).each(eventContext.me, ns.acl('trustedApp')) as Array<NamedNode> // @@ TODO fix as\n    const trustedOrigins = trustedApps.flatMap(app => (this.groupList.store as Store).each(app, ns.acl('origin'))) // @@ TODO fix as\n\n    this.barElement.appendChild(this.groupList.controller.dom.createElement('p')).textContent = `You have ${trustedOrigins.length} selected web apps.`\n    return new Promise((resolve, reject) => {\n      const appsTable = this.barElement.appendChild(this.groupList.controller.dom.createElement('table'))\n      appsTable.classList.add(this.groupList.controller.classes.trustedAppAddApplicationsTable)\n      trustedApps.forEach(app => {\n        const origin = (this.groupList.store as Store).any(app, ns.acl('origin')) // @@ TODO fix as\n        if (!origin) {\n          reject(new Error(`Unable to pick app: ${app.value}`))\n        }\n        const thingTR = widgets.personTR(this.groupList.controller.dom, ns.acl('origin'), origin, {})\n        const innerTable = this.groupList.controller.dom.createElement('table')\n        const innerRow = innerTable.appendChild(this.groupList.controller.dom.createElement('tr'))\n\n        const innerLeftColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerLeftColumn.appendChild(thingTR)\n\n        const innerMiddleColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerMiddleColumn.textContent = `Give access to ${this.groupList.controller.noun} ${utils.label(this.groupList.controller.subject)}?`\n\n        const innerRightColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerRightColumn.appendChild(widgets.continueButton(this.groupList.controller.dom, () => resolve(origin!.value)))\n\n        appsTable.appendChild(innerTable)\n      })\n    })\n  }\n\n  private renderCleanup (): void {\n    this.renderBar()\n    this.groupList.render()\n  }\n\n  private async addPerson (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a person and has an owner who agrees they own it\n    debug.log(`Adding to ACL person: ${name}`)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addGroup (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a group and has an owner who agrees they own it\n    debug.log('Adding to ACL group: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addAgent (agentUri: string): Promise<void> {\n    await this.groupList.addNewURI(agentUri)\n    this.toggleBar()\n  }\n\n  private async addBot (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a bot and has an owner who agrees they own it\n    debug.log('Adding to ACL bot: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async getOriginFromName (name?: string): Promise<string | void> {\n    if (!name) return Promise.resolve() // user cancelled\n    const domainNameRegexp = /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i\n    // https://www.oreilly.com/library/view/regular-expressions-cookbook/9781449327453/ch08s15.html\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a domain name'))\n    }\n    const origin = 'https://' + name\n    debug.log('Adding to ACL origin: ' + origin)\n    this.toggleBar()\n    return origin\n  }\n\n  private toggleBar (): void {\n    this.isExpanded = !this.isExpanded\n  }\n}\n"],"mappings":"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"}