{"version":3,"file":"add-agent-buttons.js","names":["debug","_interopRequireWildcard","require","_iconBase","_login","ns","utils","widgets","style","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","AddAgentButtons","groupList","_classCallCheck2","_defineProperty2","rootElement","controller","dom","createElement","barElement","_createClass2","value","render","innerHTML","appendChild","renderAddButton","_this","button","concat","icons","iconBase","toggleBar","renderBar","isExpanded","renderPersonButton","renderGroupButton","renderPublicButton","renderAuthenticatedAgentButton","renderBotButton","renderAppsButton","renderSimplifiedBar","_this2","Array","from","children","filter","element","forEach","removeChild","_this3","iconForClass","event","target","renderNameForm","vcard","then","name","addPerson","renderCleanup","error","renderStatus","_this4","addGroup","type","noun","askName","store","_this5","addAgent","foaf","uri","renderTemporaryStatus","_this6","acl","_this7","schema","addBot","_this8","eventContext","div","existingApps","renderAppsTable","renderAppsView","newApp","getOriginFromName","Promise","race","origin","addNewURI","_this9","trustedApplications","context","session","paneRegistry","byName","trustedApplicationsElement","setAttribute","trustedAppController","cancelButton","trustedAppCancelButton","insertBefore","firstChild","_renderAppsTable","_asyncToGenerator2","_regenerator","mark","_callee","_this10","trustedApps","trustedOrigins","wrap","_callee$","_context","prev","next","ensureLoadedProfile","each","me","flatMap","app","textContent","length","abrupt","resolve","reject","appsTable","trustedAppAddApplicationsTable","any","Error","thingTR","personTR","innerTable","innerRow","innerLeftColumn","innerMiddleColumn","label","subject","innerRightColumn","continueButton","stop","_x","apply","arguments","_addPerson","_callee2","domainNameRegexp","_callee2$","_context2","match","log","_x2","_addGroup","_callee3","_callee3$","_context3","_x3","_addAgent","_callee4","agentUri","_callee4$","_context4","_x4","_addBot","_callee5","_callee5$","_context5","_x5","_getOriginFromName","_callee6","_callee6$","_context6","_x6","exports"],"sources":["../../src/acl/add-agent-buttons.ts"],"sourcesContent":["/**\n * Contains the [[AddAgentButtons]] class\n * @packageDocumentation\n */\n\nimport { NamedNode, Store } from 'rdflib'\nimport { AuthenticationContext } from 'solid-logic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { ensureLoadedProfile } from '../login/login'\nimport * as ns from '../ns'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport * as style from '../style'\nimport { AccessGroups } from './access-groups'\n\n/**\n * Renders the Sharing pane's \"+\" button and the menus behind it,\n * see https://github.com/solidos/userguide/blob/main/views/sharing/userguide.md#add\n */\nexport class AddAgentButtons {\n  private readonly rootElement: HTMLElement\n  private readonly barElement: HTMLElement\n  private isExpanded: boolean = false\n\n  constructor (private groupList: AccessGroups) {\n    this.rootElement = groupList.controller.dom.createElement('div')\n    this.barElement = groupList.controller.dom.createElement('div')\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    this.rootElement.appendChild(this.renderAddButton())\n    this.rootElement.appendChild(this.barElement)\n    return this.rootElement\n  }\n\n  private renderAddButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_34653_green.svg`,\n      'Add ...',\n      () => {\n        this.toggleBar()\n        this.renderBar()\n      }\n    )\n  }\n\n  private renderBar (): void {\n    this.barElement.innerHTML = ''\n    if (!this.isExpanded) {\n      return\n    }\n    this.barElement.appendChild(this.renderPersonButton())\n    this.barElement.appendChild(this.renderGroupButton())\n    this.barElement.appendChild(this.renderPublicButton())\n    this.barElement.appendChild(this.renderAuthenticatedAgentButton())\n    this.barElement.appendChild(this.renderBotButton())\n    this.barElement.appendChild(this.renderAppsButton())\n  }\n\n  private renderSimplifiedBar (button: EventTarget | null) {\n    Array.from(this.barElement.children)\n      .filter(element => element !== button)\n      .forEach(element => this.barElement.removeChild(element))\n  }\n\n  private renderPersonButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Individual'],\n      'Add Person',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Individual'), 'person')\n          .then(name => this.addPerson(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderGroupButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['vcard:Group'],\n      'Add Group',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.vcard('Group'), 'group')\n          .then(name => this.addGroup(name))\n          .then(() => this.renderCleanup())\n          .catch(error => this.groupList.controller.renderStatus(error))\n      }\n    )\n  }\n\n  private renderNameForm (type: NamedNode, noun: string): Promise<string | undefined> {\n    return widgets.askName(\n      this.groupList.controller.dom,\n      this.groupList.store,\n      this.barElement,\n      ns.vcard('URI'),\n      type,\n      noun\n    )\n  }\n\n  private renderPublicButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + widgets.iconForClass['foaf:Agent'],\n      'Add Everyone',\n      () => this.addAgent(ns.foaf('Agent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding the general public to those who can read. Drag the globe to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderAuthenticatedAgentButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_99101.svg`,\n      'Anyone logged In',\n      () => this.addAgent(ns.acl('AuthenticatedAgent').uri)\n        .then(() => this.groupList.controller.renderTemporaryStatus('Adding anyone logged in to those who can read. Drag the ID icon to a different level to give them more access.'))\n        .then(() => this.renderCleanup()))\n  }\n\n  private renderBotButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      icons.iconBase + 'noun_Robot_849764.svg',\n      'A Software Agent (bot)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        this.renderNameForm(ns.schema('Application'), 'bot')\n          .then(name => this.addBot(name))\n          .then(() => this.renderCleanup())\n      })\n  }\n\n  private renderAppsButton (): HTMLElement {\n    return widgets.button(\n      this.groupList.controller.dom,\n      `${icons.iconBase}noun_15177.svg`,\n      'A Web App (origin)',\n      event => {\n        this.renderSimplifiedBar(event.target)\n        const eventContext = {\n          div: this.barElement,\n          dom: this.groupList.controller.dom\n        }\n        const existingApps = this.renderAppsTable(eventContext)\n          .catch(error => this.groupList.controller.renderStatus(error))\n        this.renderAppsView()\n        const newApp = this.renderNameForm(ns.schema('WebApplication'), 'webapp domain')\n          .then(name => this.getOriginFromName(name))\n        Promise.race([\n          existingApps,\n          newApp\n        ])\n          .then(origin => {\n            if (origin) {\n              this.groupList.addNewURI(origin)\n            }\n          })\n          .then(() => this.renderCleanup())\n      }\n    )\n  }\n\n  private renderAppsView (): void {\n    const trustedApplications = this.groupList.controller.context.session.paneRegistry.byName('trustedApplications')\n    if (trustedApplications) {\n      const trustedApplicationsElement = trustedApplications.render(null, this.groupList.controller.context)\n      trustedApplicationsElement.setAttribute('style', style.trustedAppController)\n\n      const cancelButton = widgets.cancelButton(this.groupList.controller.dom, () => this.renderCleanup())\n      cancelButton.setAttribute('style', style.trustedAppCancelButton)\n      trustedApplicationsElement.insertBefore(cancelButton, trustedApplicationsElement.firstChild)\n\n      this.barElement.appendChild(trustedApplicationsElement)\n    }\n  }\n\n  private async renderAppsTable (eventContext: AuthenticationContext): Promise<string> {\n    await ensureLoadedProfile(eventContext)\n    const trustedApps = (this.groupList.store as Store).each(eventContext.me, ns.acl('trustedApp')) as Array<NamedNode> // @@ TODO fix as\n    const trustedOrigins = trustedApps.flatMap(app => (this.groupList.store as Store).each(app, ns.acl('origin'))) // @@ TODO fix as\n\n    this.barElement.appendChild(this.groupList.controller.dom.createElement('p')).textContent = `You have ${trustedOrigins.length} selected web apps.`\n    return new Promise((resolve, reject) => {\n      const appsTable = this.barElement.appendChild(this.groupList.controller.dom.createElement('table'))\n      appsTable.setAttribute('style', style.trustedAppAddApplicationsTable)\n      trustedApps.forEach(app => {\n        const origin = (this.groupList.store as Store).any(app, ns.acl('origin')) // @@ TODO fix as\n        if (!origin) {\n          reject(new Error(`Unable to pick app: ${app.value}`))\n        }\n        const thingTR = widgets.personTR(this.groupList.controller.dom, ns.acl('origin'), origin, {})\n        const innerTable = this.groupList.controller.dom.createElement('table')\n        const innerRow = innerTable.appendChild(this.groupList.controller.dom.createElement('tr'))\n\n        const innerLeftColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerLeftColumn.appendChild(thingTR)\n\n        const innerMiddleColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerMiddleColumn.textContent = `Give access to ${this.groupList.controller.noun} ${utils.label(this.groupList.controller.subject)}?`\n\n        const innerRightColumn = innerRow.appendChild(this.groupList.controller.dom.createElement('td'))\n        innerRightColumn.appendChild(widgets.continueButton(this.groupList.controller.dom, () => resolve(origin!.value)))\n\n        appsTable.appendChild(innerTable)\n      })\n    })\n  }\n\n  private renderCleanup (): void {\n    this.renderBar()\n    this.groupList.render()\n  }\n\n  private async addPerson (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a person and has an owner who agrees they own it\n    debug.log(`Adding to ACL person: ${name}`)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addGroup (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a group and has an owner who agrees they own it\n    debug.log('Adding to ACL group: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async addAgent (agentUri: string): Promise<void> {\n    await this.groupList.addNewURI(agentUri)\n    this.toggleBar()\n  }\n\n  private async addBot (name?: string): Promise<void> {\n    if (!name) return this.toggleBar() // user cancelled\n    const domainNameRegexp = /^https?:/i\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a http URI'))\n    }\n    // @@ check it actually is a bot and has an owner who agrees they own it\n    debug.log('Adding to ACL bot: ' + name)\n    await this.groupList.addNewURI(name)\n    this.toggleBar()\n  }\n\n  private async getOriginFromName (name?: string): Promise<string | void> {\n    if (!name) return Promise.resolve() // user cancelled\n    const domainNameRegexp = /^([a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}$/i\n    // https://www.oreilly.com/library/view/regular-expressions-cookbook/9781449327453/ch08s15.html\n    if (!name.match(domainNameRegexp)) {\n      // @@ enforce in user input live like a form element\n      return Promise.reject(new Error('Not a domain name'))\n    }\n    const origin = 'https://' + name\n    debug.log('Adding to ACL origin: ' + origin)\n    this.toggleBar()\n    return origin\n  }\n\n  private toggleBar (): void {\n    this.isExpanded = !this.isExpanded\n  }\n}\n"],"mappings":"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"}