{"version":3,"file":"access-controller.js","names":["_acl","require","_rdflib","_accessGroups","_aclControl","utils","_interopRequireWildcard","debug","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","AccessController","subject","noun","context","statusElement","classes","targetIsProtected","targetDoc","targetACLDoc","defaultHolder","defaultACLDoc","prospectiveDefaultHolder","store","dom","_classCallCheck2","_defineProperty2","rootElement","createElement","classList","add","aclGroupContent","isContainer","uri","slice","isUsingDefaults","aclDefaultStore","adoptACLDefault","mainCombo","AccessGroups","defaults","defaultsCombo","defaultsDiffer","sameACL","aclMap","_createClass2","value","render","innerHTML","renderStatus","concat","defaultHolderLink","appendChild","href","innerText","shortNameForFolder","renderRemoveDefaultsController","isEditable","renderAddDefaultsController","renderAddAclsController","renderRemoveAclsController","_this","useDefaultButton","label","bigButton","addEventListener","removeAcls","then","error","_this2","addAclButton","addAcls","_this3","containerElement","defaultsController","noticeElement","defaultsControllerNotice","button","addDefaults","_this4","removeDefaults","renderTemporaryStatus","message","_this5","aclControlBoxStatusRevealed","temporaryStatusInit","setTimeout","temporaryStatusEnd","toggle","_addAcls","_asyncToGenerator2","_regenerator","mark","_callee","_this6","aclGraph","_message","wrap","_callee$","_context","prev","next","abrupt","Promise","reject","statements","forEach","st","predicate","object","fetcher","putBack","resolve","t0","stop","apply","arguments","_addDefaults","_callee2","_callee2$","_context2","_removeAcls","_callee3","_callee3$","_context3","getProspectiveHolder","sent","warn","t1","_removeDefaults","_callee4","fallbackCombo","_callee4$","_context4","save","_this7","newAClGraph","graph","makeACLGraphbyCombo","byCombo","fetch","_fetch","updater","UpdateManager","put","statementsMatching","undefined","ok","Error","unload","requested","log","exports"],"sources":["../../src/acl/access-controller.ts"],"sourcesContent":["/**\n * Contains the [[AccessController]] class\n * @packageDocumentation\n */\n\nimport { adoptACLDefault, getProspectiveHolder, makeACLGraphbyCombo, sameACL } from './acl'\nimport { fetcher, graph, NamedNode, UpdateManager } from 'rdflib'\nimport { AccessGroups } from './access-groups'\nimport { DataBrowserContext } from 'pane-registry'\nimport { shortNameForFolder } from './acl-control'\nimport * as utils from '../utils'\nimport * as debug from '../debug'\n\n/**\n * Rendered HTML component used in the databrowser's Sharing pane.\n */\nexport class AccessController {\n  public mainCombo: AccessGroups\n  public defaultsCombo: AccessGroups | null\n  private readonly isContainer: boolean\n  private defaultsDiffer: boolean\n  private readonly rootElement: HTMLElement\n  private isUsingDefaults: boolean\n\n  constructor (\n    public subject: NamedNode,\n    public noun: string,\n    public context: DataBrowserContext,\n    private statusElement: HTMLElement,\n    public classes: Record<string, string>,\n    public targetIsProtected: boolean,\n    private targetDoc: NamedNode,\n    private targetACLDoc: NamedNode,\n    private defaultHolder: NamedNode | null,\n    private defaultACLDoc: NamedNode | null,\n    private prospectiveDefaultHolder: NamedNode | undefined,\n    public store,\n    public dom\n  ) {\n    this.rootElement = dom.createElement('div')\n    this.rootElement.classList.add(classes.aclGroupContent)\n    this.isContainer = targetDoc.uri.slice(-1) === '/' // Give default for all directories\n    if (defaultHolder && defaultACLDoc) {\n      this.isUsingDefaults = true\n      const aclDefaultStore = adoptACLDefault(this.targetDoc, targetACLDoc, defaultHolder, defaultACLDoc)\n      this.mainCombo = new AccessGroups(targetDoc, targetACLDoc, this, aclDefaultStore, { defaults: this.isContainer })\n      this.defaultsCombo = null\n      this.defaultsDiffer = false\n    } else {\n      this.isUsingDefaults = false\n      this.mainCombo = new AccessGroups(targetDoc, targetACLDoc, this, store)\n      this.defaultsCombo = new AccessGroups(targetDoc, targetACLDoc, this, store, { defaults: this.isContainer })\n      this.defaultsDiffer = !sameACL(this.mainCombo.aclMap, this.defaultsCombo.aclMap)\n    }\n  }\n\n  public get isEditable (): boolean {\n    return !this.isUsingDefaults\n  }\n\n  public render (): HTMLElement {\n    this.rootElement.innerHTML = ''\n    if (this.isUsingDefaults) {\n      this.renderStatus(`The sharing for this ${this.noun} is the default for folder `)\n      if (this.defaultHolder) {\n        const defaultHolderLink = this.statusElement.appendChild(this.dom.createElement('a'))\n        defaultHolderLink.href = this.defaultHolder.uri\n        defaultHolderLink.innerText = shortNameForFolder(this.defaultHolder)\n      }\n    } else if (!this.defaultsDiffer && this.isContainer) {\n      this.renderStatus('This is also the default for things in this folder.')\n    } else {\n      this.renderStatus('')\n    }\n    this.rootElement.appendChild(this.mainCombo.render())\n    if (this.defaultsCombo && this.defaultsDiffer) {\n      this.rootElement.appendChild(this.renderRemoveDefaultsController())\n      this.rootElement.appendChild(this.defaultsCombo.render())\n    } else if (this.isEditable && this.isContainer) {\n      this.rootElement.appendChild(this.renderAddDefaultsController())\n    }\n    if (!this.targetIsProtected && this.isUsingDefaults) {\n      this.rootElement.appendChild(this.renderAddAclsController())\n    } else if (!this.targetIsProtected) {\n      this.rootElement.appendChild(this.renderRemoveAclsController())\n    }\n    return this.rootElement\n  }\n\n  private renderRemoveAclsController (): HTMLElement {\n    const useDefaultButton = this.dom.createElement('button')\n    useDefaultButton.innerText = `Remove custom sharing settings for this ${this.noun} -- just use default${this.prospectiveDefaultHolder ? ` for ${utils.label(this.prospectiveDefaultHolder)}` : ''}`\n    useDefaultButton.classList.add(this.classes.bigButton)\n    useDefaultButton.addEventListener('click', () => this.removeAcls()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return useDefaultButton\n  }\n\n  private renderAddAclsController (): HTMLElement {\n    const addAclButton = this.dom.createElement('button')\n    addAclButton.innerText = `Set specific sharing for this ${this.noun}`\n    addAclButton.classList.add(this.classes.bigButton)\n    addAclButton.addEventListener('click', () => this.addAcls()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return addAclButton\n  }\n\n  private renderAddDefaultsController (): HTMLElement {\n    const containerElement = this.dom.createElement('div')\n    containerElement.classList.add(this.classes.defaultsController)\n\n    const noticeElement = containerElement.appendChild(this.dom.createElement('div'))\n    noticeElement.innerText = 'Sharing for things within the folder currently tracks sharing for the folder.'\n    noticeElement.classList.add(this.classes.defaultsControllerNotice)\n\n    const button = containerElement.appendChild(this.dom.createElement('button'))\n    button.innerText = 'Set the sharing of folder contents separately from the sharing for the folder'\n    button.classList.add(this.classes.bigButton)\n    button.addEventListener('click', () => this.addDefaults()\n      .then(() => this.render()))\n    return containerElement\n  }\n\n  private renderRemoveDefaultsController (): HTMLElement {\n    const containerElement = this.dom.createElement('div')\n    containerElement.classList.add(this.classes.defaultsController)\n\n    const noticeElement = containerElement.appendChild(this.dom.createElement('div'))\n    noticeElement.innerText = 'Access to things within this folder:'\n    noticeElement.classList.add(this.classes.defaultsControllerNotice)\n\n    const button = containerElement.appendChild(this.dom.createElement('button'))\n    button.innerText = 'Set default for folder contents to just track the sharing for the folder'\n    button.classList.add(this.classes.bigButton)\n    button.addEventListener('click', () => this.removeDefaults()\n      .then(() => this.render())\n      .catch(error => this.renderStatus(error)))\n    return containerElement\n  }\n\n  public renderTemporaryStatus (message: string): void {\n    // @@ TODO Introduce better system for error notification to user https://github.com/solidos/mashlib/issues/87\n    this.statusElement.classList.add(this.classes.aclControlBoxStatusRevealed)\n    this.statusElement.innerText = message\n    this.statusElement.classList.add(this.classes.temporaryStatusInit)\n    setTimeout(() => {\n      this.statusElement.classList.add(this.classes.temporaryStatusEnd)\n    })\n    setTimeout(() => {\n      this.statusElement.innerText = ''\n    }, 5000)\n  }\n\n  public renderStatus (message: string): void {\n    // @@ TODO Introduce better system for error notification to user https://github.com/solidos/mashlib/issues/87\n    this.statusElement.classList.toggle(this.classes.aclControlBoxStatusRevealed, !!message)\n    this.statusElement.innerText = message\n  }\n\n  private async addAcls (): Promise<void> {\n    if (!this.defaultHolder || !this.defaultACLDoc) {\n      const message = 'Unable to find defaults to copy'\n      debug.error(message)\n      return Promise.reject(message)\n    }\n    const aclGraph = adoptACLDefault(this.targetDoc, this.targetACLDoc, this.defaultHolder, this.defaultACLDoc)\n    aclGraph.statements.forEach(st => this.store.add(st.subject, st.predicate, st.object, this.targetACLDoc))\n    try {\n      await this.store.fetcher.putBack(this.targetACLDoc)\n      this.isUsingDefaults = false\n      return Promise.resolve()\n    } catch (error) {\n      const message = ` Error writing back access control file! ${error}`\n      debug.error(message)\n      return Promise.reject(message)\n    }\n  }\n\n  private async addDefaults (): Promise<void> {\n    this.defaultsCombo = new AccessGroups(this.targetDoc, this.targetACLDoc, this, this.store, { defaults: true })\n    this.defaultsDiffer = true\n  }\n\n  private async removeAcls (): Promise<void> {\n    try {\n      await this.store.fetcher.delete(this.targetACLDoc.uri, {})\n      this.isUsingDefaults = true\n      try {\n        this.prospectiveDefaultHolder = await getProspectiveHolder(this.targetDoc.uri)\n      } catch (error) {\n        // No need to show this error in status, but good to warn about it in console\n        debug.warn(error)\n      }\n    } catch (error) {\n      const message = `Error deleting access control file: ${this.targetACLDoc}: ${error}`\n      debug.error(message)\n      return Promise.reject(message)\n    }\n  }\n\n  private async removeDefaults (): Promise<void> {\n    const fallbackCombo = this.defaultsCombo\n    try {\n      this.defaultsCombo = null\n      this.defaultsDiffer = false\n      await this.save()\n    } catch (error) {\n      this.defaultsCombo = fallbackCombo\n      this.defaultsDiffer = true\n      debug.error(error)\n      return Promise.reject(error)\n    }\n  }\n\n  public save (): Promise<void> {\n    // build graph\n    const newAClGraph = graph()\n    if (!this.isContainer) {\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true)\n    } else if (this.defaultsCombo && this.defaultsDiffer) {\n      // Pair of controls\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true)\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.defaultsCombo.byCombo, this.targetACLDoc, false, true)\n    } else {\n      // Linked controls\n      makeACLGraphbyCombo(newAClGraph, this.targetDoc, this.mainCombo.byCombo, this.targetACLDoc, true, true)\n    }\n\n    // add authenticated fetcher\n    newAClGraph.fetcher = fetcher(newAClGraph, { fetch: this.store.fetcher._fetch })\n    const updater = newAClGraph.updater || new UpdateManager(newAClGraph)\n\n    // save ACL resource\n    return new Promise((resolve, reject) => {\n      updater.put(\n        this.targetACLDoc,\n        newAClGraph.statementsMatching(undefined, undefined, undefined, this.targetACLDoc),\n        'text/turtle',\n        (uri, ok, message) => {\n          if (!ok) {\n            return reject(new Error(`ACL file save failed: ${message}`))\n          }\n          this.store.fetcher.unload(this.targetACLDoc)\n          this.store.add(newAClGraph.statements)\n          this.store.fetcher.requested[this.targetACLDoc.uri] = 'done' // missing: save headers\n          this.mainCombo.store = this.store\n          if (this.defaultsCombo) {\n            this.defaultsCombo.store = this.store\n          }\n          this.defaultsDiffer = !!this.defaultsCombo && !sameACL(this.mainCombo.aclMap, this.defaultsCombo.aclMap)\n          debug.log('ACL modification: success!')\n          resolve()\n        }\n      )\n    })\n  }\n}\n"],"mappings":"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"}