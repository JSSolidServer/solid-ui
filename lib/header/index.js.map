{"version":3,"file":"index.js","names":["DEFAULT_HELP_MENU_ICON","icons","iconBase","DEFAUL_SOLID_ICON_URL","initHeader","store","userMenuList","options","header","document","getElementById","pod","getPod","rebuildHeader","authSession","onLogout","onLogin","user","authn","currentUser","innerHTML","createBanner","appendChild","podLink","createElement","href","uri","addStyleClassToElement","image","src","logo","createUserMenu","createLoginSignUpButtons","userMenu","banner","leftSideOfHeader","helpMenuList","helpMenu","createHelpMenu","helpMenuItems","forEach","menuItem","menuItemType","url","createUserMenuItem","createUserMenuLink","label","target","createUserMenuButton","onclick","setAttribute","helpMenuContainer","helpMenuTrigger","type","helpMenuIcon","helpIcon","throttledMenuToggle","throttle","event","toggleMenu","addEventListener","timer","setTimeout","clearTimeout","profileLoginButtonPre","loginStatusBox","onClick","button","innerText","link","fetcher","load","loggedInMenuList","loggedInMenu","loggedInMenuTrigger","profileImg","getProfileImg","loggedInMenuContainer","child","menuProfileItem","profileUrl","widgets","findImage","emptyProfile","profileImage","style","backgroundImage","trigger","menu","isExpanded","getAttribute","expand","close","toString"],"sources":["../../src/header/index.ts"],"sourcesContent":["/* global EventListenerOrEventListenerObject */\n/*\n    This file was copied from mashlib/src/global/header.ts file. It is modified to\n    work in solid-ui by adjusting where imported functions are found.\n */\nimport { IndexedFormula, NamedNode } from 'rdflib'\nimport { icons } from '../index'\nimport { authn, authSession } from 'solid-logic'\nimport { loginStatusBox } from '../login/login'\n// import { loginStatusBox, authSession, currentUser } from '../authn/authn'\nimport * as widgets from '../widgets'\nimport { emptyProfile } from './empty-profile'\nimport { addStyleClassToElement, getPod, throttle } from '../utils/headerFooterHelpers'\n\n/**\n * menu icons\n*/\nconst DEFAULT_HELP_MENU_ICON = icons.iconBase + 'noun_help.svg'\nconst DEFAUL_SOLID_ICON_URL = 'https://solidproject.org/assets/img/solid-emblem.svg'\n\nexport type MenuItemLink = {\n  label: string,\n  url: string,\n  target?: string\n}\n\nexport type MenuItemButton = {\n  label: string,\n  onclick: () => void\n}\n\nexport type MenuItems = MenuItemLink | MenuItemButton\n\n/*\n  HeaderOptions allow for customizing the logo and menu list.  If a logo is not provided the default\n  is solid. Menulist will always show a link to logout and to the users profile.\n  */\nexport type HeaderOptions = {\n  logo?: string,\n  helpIcon?: string,\n  helpMenuList?: MenuItems[]\n}\n\n/**\n * Initialize header component, the header object returned depends on whether the user is authenticated.\n * @param store the data store\n * @param userMenuList a list of menu items when the user is logged in\n * @param options allow the header to be customized with a personalized logo, help icon and a help menu list of links or buttons.\n * @returns a header for an authenticated user with menu items given or a login screen\n */\nexport async function initHeader (store: IndexedFormula, userMenuList: MenuItems[], options?: HeaderOptions) {\n  const header = document.getElementById('PageHeader')\n  if (!header) {\n    return\n  }\n\n  const pod = getPod()\n  rebuildHeader(header, store, pod, userMenuList, options)()\n  authSession.onLogout(rebuildHeader(header, store, pod, userMenuList, options))\n  authSession.onLogin(rebuildHeader(header, store, pod, userMenuList, options))\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function rebuildHeader (header: HTMLElement, store: IndexedFormula, pod: NamedNode, userMenuList: MenuItems[], options?: HeaderOptions) {\n  return async () => {\n    const user = authn.currentUser()\n    header.innerHTML = ''\n    header.appendChild(await createBanner(store, pod, user, userMenuList, options))\n  }\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function createBanner (store: IndexedFormula, pod: NamedNode, user: NamedNode | null, userMenuList: MenuItems[], options?: HeaderOptions): Promise<HTMLElement> {\n  const podLink = document.createElement('a')\n  podLink.href = pod.uri\n  addStyleClassToElement(podLink, ['header-banner__link'])\n  const image = document.createElement('img')\n  if (options) {\n    image.src = options.logo ? options.logo : DEFAUL_SOLID_ICON_URL\n  }\n  addStyleClassToElement(image, ['header-banner__icon'])\n  podLink.appendChild(image)\n\n  const userMenu = user\n    ? await createUserMenu(store, user, userMenuList)\n    : createLoginSignUpButtons()\n\n  const banner = document.createElement('div')\n  addStyleClassToElement(banner, ['header-banner'])\n  banner.appendChild(podLink)\n\n  const leftSideOfHeader = document.createElement('div')\n  addStyleClassToElement(leftSideOfHeader, ['header-banner__right-menu'])\n  leftSideOfHeader.appendChild(userMenu)\n\n  if (options && options.helpMenuList) {\n    const helpMenu = createHelpMenu(options, options.helpMenuList)\n    leftSideOfHeader.appendChild(helpMenu as HTMLDivElement)\n  }\n\n  banner.appendChild(leftSideOfHeader)\n\n  return banner\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createHelpMenu (options: HeaderOptions, helpMenuItems: MenuItems[]) {\n  if (!helpMenuItems) return\n  const helpMenuList = document.createElement('ul')\n  addStyleClassToElement(helpMenuList, ['header-user-menu__list'])\n  helpMenuItems.forEach(function (menuItem) {\n    const menuItemType: string = (menuItem as MenuItemLink).url ? 'url' : 'onclick'\n    if (menuItemType === 'url') {\n      helpMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label, (menuItem as MenuItemLink).url, (menuItem as MenuItemLink).target)))\n    } else {\n      helpMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label, (menuItem as MenuItemButton).onclick)))\n    }\n  })\n\n  const helpMenu = document.createElement('nav')\n\n  addStyleClassToElement(helpMenu, ['header-user-menu__navigation-menu'])\n  helpMenu.setAttribute('aria-hidden', 'true')\n  helpMenu.appendChild(helpMenuList)\n\n  const helpMenuContainer = document.createElement('div')\n  addStyleClassToElement(helpMenuContainer, ['header-banner__user-menu'])\n  addStyleClassToElement(helpMenuContainer, ['header-user-menu'])\n  helpMenuContainer.appendChild(helpMenu)\n\n  const helpMenuTrigger = document.createElement('button')\n  addStyleClassToElement(helpMenuTrigger, ['header-user-menu__trigger'])\n  helpMenuTrigger.type = 'button'\n\n  const helpMenuIcon = document.createElement('img')\n  helpMenuIcon.src = (options && options.helpIcon) ? options.helpIcon : icons.iconBase + DEFAULT_HELP_MENU_ICON\n  addStyleClassToElement(helpMenuIcon, ['header-banner__help-icon'])\n  helpMenuContainer.appendChild(helpMenuTrigger)\n  helpMenuTrigger.appendChild(helpMenuIcon)\n\n  const throttledMenuToggle = throttle((event: Event) => toggleMenu(event, helpMenuTrigger, helpMenu), 50)\n  helpMenuTrigger.addEventListener('click', throttledMenuToggle)\n  let timer = setTimeout(() => null, 0)\n  helpMenuContainer.addEventListener('mouseover', event => {\n    clearTimeout(timer)\n    throttledMenuToggle(event)\n  })\n  helpMenuContainer.addEventListener('mouseout', event => {\n    timer = setTimeout(() => throttledMenuToggle(event), 200)\n  })\n\n  return helpMenuContainer\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createLoginSignUpButtons () {\n  const profileLoginButtonPre = document.createElement('div')\n  addStyleClassToElement(profileLoginButtonPre, ['header-banner__login'])\n  profileLoginButtonPre.appendChild(loginStatusBox(document, null, {}))\n  return profileLoginButtonPre\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuButton (label: string, onClick: EventListenerOrEventListenerObject): HTMLElement {\n  const button = document.createElement('button')\n  addStyleClassToElement(button, ['header-user-menu__button'])\n  button.addEventListener('click', onClick)\n  button.innerText = label\n  return button\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuLink (label: string, href: string, target?: string): HTMLElement {\n  const link = document.createElement('a')\n  addStyleClassToElement(link, ['header-user-menu__link'])\n  link.href = href\n  link.innerText = label\n  if (target) link.target = target\n  return link\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function createUserMenu (store: IndexedFormula, user: NamedNode, userMenuList: MenuItems[]): Promise<HTMLElement> {\n  const fetcher = (<any>store).fetcher\n  if (fetcher) {\n    // Making sure that Profile is loaded before building menu\n    await fetcher.load(user)\n  }\n\n  const loggedInMenuList = document.createElement('ul')\n  addStyleClassToElement(loggedInMenuList, ['header-user-menu__list'])\n  if (userMenuList) {\n    userMenuList.forEach(function (menuItem) {\n      const menuItemType: string = (menuItem as MenuItemLink).url ? 'url' : 'onclick'\n      if (menuItemType === 'url') {\n        loggedInMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label, (menuItem as MenuItemLink).url, (menuItem as MenuItemLink).target)))\n      } else {\n        loggedInMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label, (menuItem as MenuItemButton).onclick)))\n      }\n    })\n  }\n  const loggedInMenu = document.createElement('nav')\n\n  addStyleClassToElement(loggedInMenu, ['header-user-menu__navigation-menu'])\n  loggedInMenu.setAttribute('aria-hidden', 'true')\n  loggedInMenu.appendChild(loggedInMenuList)\n\n  const loggedInMenuTrigger = document.createElement('button')\n  addStyleClassToElement(loggedInMenuTrigger, ['header-user-menu__trigger'])\n  loggedInMenuTrigger.type = 'button'\n  const profileImg = getProfileImg(store, user)\n  if (typeof profileImg === 'string') {\n    loggedInMenuTrigger.innerHTML = profileImg\n  } else {\n    loggedInMenuTrigger.appendChild(profileImg)\n  }\n\n  const loggedInMenuContainer = document.createElement('div')\n  addStyleClassToElement(loggedInMenuContainer, ['header-banner__user-menu'])\n  addStyleClassToElement(loggedInMenuContainer, ['header-user-menu'])\n  loggedInMenuContainer.appendChild(loggedInMenuTrigger)\n  loggedInMenuContainer.appendChild(loggedInMenu)\n\n  const throttledMenuToggle = throttle((event: Event) => toggleMenu(event, loggedInMenuTrigger, loggedInMenu), 50)\n  loggedInMenuTrigger.addEventListener('click', throttledMenuToggle)\n  let timer = setTimeout(() => null, 0)\n  loggedInMenuContainer.addEventListener('mouseover', event => {\n    clearTimeout(timer)\n    throttledMenuToggle(event)\n  })\n  loggedInMenuContainer.addEventListener('mouseout', event => {\n    timer = setTimeout(() => throttledMenuToggle(event), 200)\n  })\n\n  return loggedInMenuContainer\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuItem (child: HTMLElement): HTMLElement {\n  const menuProfileItem = document.createElement('li')\n  addStyleClassToElement(menuProfileItem, ['header-user-menu__list-item'])\n  menuProfileItem.appendChild(child)\n  return menuProfileItem\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getProfileImg (store: IndexedFormula, user: NamedNode): string | HTMLElement {\n  let profileUrl = null\n  try {\n    profileUrl = widgets.findImage(user)\n    if (!profileUrl) {\n      return emptyProfile\n    }\n  } catch {\n    return emptyProfile\n  }\n\n  const profileImage = document.createElement('div')\n  addStyleClassToElement(profileImage, ['header-user-menu__photo'])\n  profileImage.style.backgroundImage = `url(${profileUrl})`\n  return profileImage\n}\n\n/**\n * @internal\n */\nfunction toggleMenu (event: Event, trigger: HTMLButtonElement, menu: HTMLElement): void {\n  const isExpanded = trigger.getAttribute('aria-expanded') === 'true'\n  const expand = event.type === 'mouseover'\n  const close = event.type === 'mouseout'\n  if ((isExpanded && expand) || (!isExpanded && close)) {\n    return\n  }\n  trigger.setAttribute('aria-expanded', (!isExpanded).toString())\n  menu.setAttribute('aria-hidden', isExpanded.toString())\n}\n"],"mappings":"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"}