{"version":3,"sources":["../../src/header/index.ts"],"names":["initHeader","store","options","header","document","getElementById","pod","rebuildHeader","authSession","onLogout","onLogin","user","innerHTML","createBanner","appendChild","podLink","createElement","href","uri","image","src","logo","createUserMenu","createLoginSignUpButtons","menu","banner","profileLoginButtonPre","createUserMenuButton","label","onClick","button","addEventListener","innerText","createUserMenuLink","link","fetcher","load","loggedInMenuList","createUserMenuItem","menuList","forEach","menuItem","menuItemType","url","logout","loggedInMenu","setAttribute","loggedInMenuTrigger","type","profileImg","getProfileImg","loggedInMenuContainer","throttledMenuToggle","event","toggleMenu","timer","setTimeout","clearTimeout","child","menuProfileItem","profileUrl","widgets","findImage","emptyProfile","profileImage","style","backgroundImage","trigger","isExpanded","getAttribute","expand","close","toString"],"mappings":"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","sourcesContent":["/* global EventListenerOrEventListenerObject */\n/*\n    This file was copied from mashlib/src/global/header.ts file. It is modified to\n    work in solid-ui by adjusting where imported functions are found.\n */\nimport { IndexedFormula, NamedNode } from 'rdflib'\nimport { loginStatusBox, authSession, currentUser } from '../authn/authn'\nimport * as widgets from '../widgets'\nimport { emptyProfile } from './empty-profile'\nimport { addStyleClassToElement, getPod, throttle } from './headerHelpers'\n\nexport type MenuItemLink = {\n  label: string,\n  url: string\n}\n\nexport type MenuItemButton = {\n  label: string,\n  onclick: () => {}\n}\n\nexport type MenuItems = MenuItemLink | MenuItemButton\n\n/*\nHeaderOptions allow for customizing the logo and menu list.  If a logo is not provided the default\n    is solid. Menulist will always show a link to logout and to the users profile.\n */\nexport type HeaderOptions = {\n  logo?: string,\n  menuList?: MenuItems[]\n}\n\n/**\n * Initialize header component, the header object returned depends on whether the user is authenticated.\n * @param store the data store\n * @param options allow the header to be customized with a personalized logo and a menu list of links or buttons.\n * @returns a header for an authenticated user with menu items given or a login screen\n */\nexport async function initHeader (store: IndexedFormula, options?: HeaderOptions) {\n  const header = document.getElementById('PageHeader')\n  if (!header) {\n    return\n  }\n\n  const pod = getPod()\n  rebuildHeader(header, store, pod, options)()\n  authSession.onLogout(rebuildHeader(header, store, pod, options))\n  authSession.onLogin(rebuildHeader(header, store, pod, options))\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function rebuildHeader (header: HTMLElement, store: IndexedFormula, pod: NamedNode, options?: HeaderOptions) {\n  return async () => {\n    const user = currentUser()\n    header.innerHTML = ''\n    header.appendChild(await createBanner(store, pod, user, options))\n  }\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function createBanner (store: IndexedFormula, pod: NamedNode, user: NamedNode | null, options?: HeaderOptions): Promise<HTMLElement> {\n  const podLink = document.createElement('a')\n  podLink.href = pod.uri\n  addStyleClassToElement(podLink, ['header-banner__link'])\n  const image = document.createElement('img')\n  if (options) {\n    image.src = options.logo ? options.logo : 'https://solidproject.org/assets/img/solid-emblem.svg'\n  }\n  addStyleClassToElement(image, ['header-banner__icon'])\n  podLink.appendChild(image)\n\n  const menu = user\n    ? await createUserMenu(store, user, options)\n    : createLoginSignUpButtons()\n\n  const banner = document.createElement('div')\n  addStyleClassToElement(banner, ['header-banner'])\n  banner.appendChild(podLink)\n  banner.appendChild(menu)\n\n  return banner\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createLoginSignUpButtons () {\n  const profileLoginButtonPre = document.createElement('div')\n  addStyleClassToElement(profileLoginButtonPre, ['header-banner__login'])\n  profileLoginButtonPre.appendChild(loginStatusBox(document, null, {}))\n  return profileLoginButtonPre\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuButton (label: string, onClick: EventListenerOrEventListenerObject): HTMLElement {\n  const button = document.createElement('button')\n  addStyleClassToElement(button, ['header-user-menu__button'])\n  button.addEventListener('click', onClick)\n  button.innerText = label\n  return button\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuLink (label: string, href: string): HTMLElement {\n  const link = document.createElement('a')\n  addStyleClassToElement(link, ['header-user-menu__link'])\n  link.href = href\n  link.innerText = label\n  return link\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function createUserMenu (store: IndexedFormula, user: NamedNode, options?: HeaderOptions): Promise<HTMLElement> {\n  const fetcher = (<any>store).fetcher\n  if (fetcher) {\n    // Making sure that Profile is loaded before building menu\n    await fetcher.load(user)\n  }\n  const loggedInMenuList = document.createElement('ul')\n  addStyleClassToElement(loggedInMenuList, ['header-user-menu__list'])\n  loggedInMenuList.appendChild(createUserMenuItem(createUserMenuLink('Show your profile', user.uri)))\n  if (options) {\n    if (options.menuList) {\n      options.menuList.forEach(function (menuItem) {\n        const menuItemType: string = (menuItem as MenuItemLink).url ? 'url' : 'onclick'\n        if (menuItemType === 'url') {\n          loggedInMenuList.appendChild(createUserMenuItem(createUserMenuLink(menuItem.label, menuItem[menuItemType])))\n        } else {\n          loggedInMenuList.appendChild(createUserMenuItem(createUserMenuButton(menuItem.label, menuItem[menuItemType])))\n        }\n      })\n    }\n  }\n\n  loggedInMenuList.appendChild(createUserMenuItem(createUserMenuButton('Log out', () => authSession.logout())))\n\n  const loggedInMenu = document.createElement('nav')\n\n  addStyleClassToElement(loggedInMenu, ['header-user-menu__navigation-menu'])\n  loggedInMenu.setAttribute('aria-hidden', 'true')\n  loggedInMenu.appendChild(loggedInMenuList)\n\n  const loggedInMenuTrigger = document.createElement('button')\n  addStyleClassToElement(loggedInMenuTrigger, ['header-user-menu__trigger'])\n  loggedInMenuTrigger.type = 'button'\n  const profileImg = getProfileImg(store, user)\n  if (typeof profileImg === 'string') {\n    loggedInMenuTrigger.innerHTML = profileImg\n  } else {\n    loggedInMenuTrigger.appendChild(profileImg)\n  }\n\n  const loggedInMenuContainer = document.createElement('div')\n  addStyleClassToElement(loggedInMenuContainer, ['header-banner__user-menu'])\n  addStyleClassToElement(loggedInMenuContainer, ['header-user-menu'])\n  loggedInMenuContainer.appendChild(loggedInMenuTrigger)\n  loggedInMenuContainer.appendChild(loggedInMenu)\n\n  const throttledMenuToggle = throttle((event: Event) => toggleMenu(event, loggedInMenuTrigger, loggedInMenu), 50)\n  loggedInMenuTrigger.addEventListener('click', throttledMenuToggle)\n  let timer = setTimeout(() => null, 0)\n  loggedInMenuContainer.addEventListener('mouseover', event => {\n    clearTimeout(timer)\n    throttledMenuToggle(event)\n  })\n  loggedInMenuContainer.addEventListener('mouseout', event => {\n    timer = setTimeout(() => throttledMenuToggle(event), 200)\n  })\n\n  return loggedInMenuContainer\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function createUserMenuItem (child: HTMLElement): HTMLElement {\n  const menuProfileItem = document.createElement('li')\n  addStyleClassToElement(menuProfileItem, ['header-user-menu__list-item'])\n  menuProfileItem.appendChild(child)\n  return menuProfileItem\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getProfileImg (store: IndexedFormula, user: NamedNode): string | HTMLElement {\n  const profileUrl = null\n  try {\n    const profileUrl = widgets.findImage(user)\n    if (!profileUrl) {\n      return emptyProfile\n    }\n  } catch {\n    return emptyProfile\n  }\n\n  const profileImage = document.createElement('div')\n  addStyleClassToElement(profileImage, ['header-user-menu__photo'])\n  profileImage.style.backgroundImage = `url(\"${profileUrl}\")`\n  return profileImage\n}\n\n/**\n * @internal\n */\nfunction toggleMenu (event: Event, trigger: HTMLButtonElement, menu: HTMLElement): void {\n  const isExpanded = trigger.getAttribute('aria-expanded') === 'true'\n  const expand = event.type === 'mouseover'\n  const close = event.type === 'mouseout'\n  if ((isExpanded && expand) || (!isExpanded && close)) {\n    return\n  }\n  trigger.setAttribute('aria-expanded', (!isExpanded).toString())\n  menu.setAttribute('aria-hidden', isExpanded.toString())\n}\n"],"file":"index.js"}