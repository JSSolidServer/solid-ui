{"version":3,"sources":["../src/media-capture.js"],"names":["$rdf","require","media","module","exports","UI","icons","ns","pad","rdf","store","utils","widgets","cameraIcon","iconBase","retakeIcon","canvasWidth","canvasHeight","controlStyle","contentType","cameraCaptureControl","dom","getImageDoc","doneCallback","div","createElement","destination","imageBlob","player","canvas","table","appendChild","mainTR","main","setAttribute","buttons","cancelButton","addEventListener","_event","stopVideo","retakeButton","button","retake","style","visibility","shutterButton","grabCanvas","sendButton","continueButton","saveBlob","displayPlayer","navigator","mediaDevices","Error","getUserMedia","constraints","then","stream","srcObject","video","removeChild","context","getContext","drawImage","width","height","parentNode","toBlob","blob","msg","type","size","debug","log","reviewImage","getVideoTracks","forEach","track","stop","fetcher","webOperation","uri","data","_resp","err","alert","cameraButton","but","control","restoreButton","imageDoc","cameraOLD","_gotBlob","takeSnapshot","img","ctx","offsetWidth","offsetHeight","document","src","toDataURL","window","URL","createObjectURL","error","name"],"mappings":"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","sourcesContent":["/// /////////////////////////////////////////////\n//\n//   Media input widget\n//\n//\n// Workflow:\n// The HTML5 functionality (on mobille) is to prompt for either\n// a realtime camera capture , OR a selection from images already ont the device\n// (eg camera roll).\n//\n// The solid alternative is to either take a phtoto\n// or access cemra roll (etc) OR to access solid cloud storage of favorite photo almbums.\n// (Especially latest taken ones)\n//\n/* global alert */\nimport * as debug from './debug'\n\n/** @module mediaCapture */\n\nvar $rdf = require('rdflib')\nvar media = (module.exports = {})\n\nvar UI = {\n  icons: require('./iconBase'),\n  ns: require('./ns'),\n  pad: require('./pad'),\n  media: media,\n  rdf: $rdf,\n  store: require('./store'),\n  utils: require('./utils'),\n  widgets: require('./widgets')\n}\n\n// const cameraIcon = require('./noun_Camera_1618446_000000') // load it in JS\nconst cameraIcon = UI.icons.iconBase + 'noun_Camera_1618446_000000.svg' // Get it from github\nconst retakeIcon = UI.icons.iconBase + 'noun_479395.svg' // Get it from github\n\nconst canvasWidth = '640'\nconst canvasHeight = '480'\n\nconst controlStyle = `border-radius: 0.5em; margin: 0.8em; width: ${canvasWidth}; height:${canvasHeight};`\n// const controlStyle = 'border-radius: 0.5em; margin: 0.8em; width: 320; height:240;'\nconst contentType = 'image/png'\n\n/** A control to capture a picture using camera\n * @param {Docuemnt} dom - The Document object\n * @param {IndexedForumla} store - The quadstore to store data in\n * @param {NamedNode} getImageDoc() - NN of the image file to be created\n * @param {function} doneCallback - Called when a picture has been taken\n */\nmodule.exports.cameraCaptureControl = function cameraCaptureControl (\n  dom,\n  store,\n  getImageDoc,\n  doneCallback\n) {\n  const div = dom.createElement('div')\n  var destination, imageBlob, player, canvas\n\n  const table = div.appendChild(dom.createElement('table'))\n  const mainTR = table.appendChild(dom.createElement('tr'))\n  const main = mainTR.appendChild(dom.createElement('td'))\n  main.setAttribute('colspan', '4')\n\n  const buttons = table.appendChild(dom.createElement('tr'))\n\n  buttons\n    .appendChild(dom.createElement('td')) // Cancel button\n    .appendChild(UI.widgets.cancelButton(dom))\n    .addEventListener('click', _event => {\n      stopVideo()\n      doneCallback(null)\n    })\n\n  const retakeButton = buttons\n    .appendChild(dom.createElement('td')) // Retake button\n    .appendChild(UI.widgets.button(dom, retakeIcon, 'Retake'))\n  retakeButton.addEventListener('click', _event => {\n    retake()\n  })\n  retakeButton.style.visibility = 'collapse' // Hide for now\n\n  const shutterButton = buttons\n    .appendChild(dom.createElement('td')) // Trigger capture button\n    .appendChild(\n      UI.widgets.button(dom, UI.icons.iconBase + 'noun_10636.svg', 'Snap')\n    )\n  shutterButton.addEventListener('click', grabCanvas)\n  shutterButton.style.visibility = 'collapse' // Hide for now\n\n  const sendButton = buttons\n    .appendChild(dom.createElement('td')) // Confirm and save button\n    .appendChild(UI.widgets.continueButton(dom)) // @@ or send icon??\n  sendButton.addEventListener('click', _event => {\n    saveBlob(imageBlob, destination)\n  })\n  sendButton.style.visibility = 'collapse' // Hide for now\n\n  function displayPlayer () {\n    player = main.appendChild(dom.createElement('video'))\n    player.setAttribute('controls', '1')\n    player.setAttribute('autoplay', '1')\n    player.setAttribute('style', controlStyle)\n    if (!navigator.mediaDevices) {\n      throw new Error('navigator.mediaDevices not available')\n    }\n    navigator.mediaDevices.getUserMedia(constraints).then(stream => {\n      player.srcObject = stream\n      shutterButton.style.visibility = 'visible' // Enable\n      sendButton.style.visibility = 'collapse'\n      retakeButton.style.visibility = 'collapse'\n    })\n  }\n\n  const constraints = {\n    video: true\n  }\n\n  function retake () {\n    main.removeChild(canvas)\n    displayPlayer() // Make new one as old one is stuck black\n  }\n\n  function grabCanvas () {\n    // Draw the video frame to the canvas.\n    canvas = dom.createElement('canvas')\n    canvas.setAttribute('width', canvasWidth)\n    canvas.setAttribute('height', canvasHeight)\n    canvas.setAttribute('style', controlStyle)\n    main.appendChild(canvas)\n\n    const context = canvas.getContext('2d')\n    context.drawImage(player, 0, 0, canvas.width, canvas.height)\n\n    player.parentNode.removeChild(player)\n\n    canvas.toBlob(blob => {\n      const msg = `got blob type ${blob.type} size ${blob.size}`\n      debug.log(msg)\n      destination = getImageDoc()\n      imageBlob = blob // save for review\n      reviewImage()\n      // alert(msg)\n    }, contentType) // toBlob\n  }\n\n  function reviewImage () {\n    sendButton.style.visibility = 'visible'\n    retakeButton.style.visibility = 'visible'\n    shutterButton.style.visibility = 'collapse' // Hide for now\n  }\n\n  function stopVideo () {\n    if (player && player.srcObject) {\n      player.srcObject.getVideoTracks().forEach(track => track.stop())\n    }\n  }\n  function saveBlob (blob, destination) {\n    const contentType = blob.type\n    // if (!confirm('Save picture to ' + destination + ' ?')) return\n    debug.log(\n      'Putting ' + blob.size + ' bytes of ' + contentType + ' to ' + destination\n    )\n    store.fetcher\n      .webOperation('PUT', destination.uri, {\n        data: blob,\n        contentType: contentType\n      })\n      .then(\n        _resp => {\n          debug.log('ok saved ' + destination)\n          stopVideo()\n          doneCallback(destination)\n        },\n        err => {\n          stopVideo()\n          alert(err)\n        }\n      )\n  }\n\n  // Attach the video stream to the video element and autoplay.\n  displayPlayer()\n  return div\n}\n\n/** A button to capture a picture using camera\n * @param {Docuemnt} dom - The Document object\n * @param {IndexedForumla} store - The quadstore to store data in\n * @param {fuunction} getImageDoc - returns NN of the image file to be created\n * @param {function<Node>} doneCallback - called with the image taken\n * @returns {DomElement} - A div element with the buton in it\n *\n * This expacts the buttton to a large control when it is pressed\n */\n\nmodule.exports.cameraButton = function cameraButton (\n  dom,\n  store,\n  getImageDoc,\n  doneCallback\n) {\n  const div = dom.createElement('div')\n  const but = UI.widgets.button(dom, cameraIcon, 'Take picture')\n  var control\n  function restoreButton (imageDoc) {\n    div.removeChild(control)\n    div.appendChild(but)\n    doneCallback(imageDoc)\n  }\n  div.appendChild(but)\n  but.addEventListener('click', _event => {\n    div.removeChild(but)\n    control = UI.media.cameraCaptureControl(\n      dom,\n      store,\n      getImageDoc,\n      restoreButton\n    )\n    div.appendChild(control)\n  })\n  return div\n}\n\n/// /////////////////////////////////////// OLD BROKEN\n\n//  Put up a video stream and take a picture\n//  In: context.div, dom\n\nUI.media.cameraOLD = function (context, _gotBlob) {\n  function takeSnapshot () {\n    var dom = context.dom\n    var img = dom.createElement('img')\n    var ctx\n    var width = video.offsetWidth\n    var height = video.offsetHeight\n\n    var canvas = context.canvas || document.createElement('canvas')\n    canvas.width = width\n    canvas.height = height\n\n    ctx = canvas.getContext('2d')\n    ctx.drawImage(video, 0, 0, width, height)\n\n    img.src = canvas.toDataURL(contentType) // @@@\n    context.div.appendChild(img)\n  }\n\n  var video = context.dom.createElement('video')\n  context.div.appendChild(video)\n  // https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n  // https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob\n  navigator.mediaDevices\n    .getUserMedia({ video: true })\n    .then(function (stream) {\n      video.src = window.URL.createObjectURL(stream)\n      video.addEventListener('click', takeSnapshot)\n    })\n    .catch(function (error) {\n      alert('Could not access the camera. Error: ' + error.name)\n    })\n  return video\n}\n"],"file":"media-capture.js"}