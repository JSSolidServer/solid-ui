{"version":3,"sources":["../../src/utils/headerFooterHelpers.ts"],"names":["getStyle","styleClass","type","footerStyleMap","headerStyleMap","addStyleClassToElement","element","styleClasses","forEach","style","document","head","classes","classList","add","getPod","location","origin","site","getPodOwner","pod","store","any","ns","ldp","fetcher","webOperation","uri","initFetchOptions","headers","accept","response","containerTurtle","responseText","console","error","holds","rdf","space","warn","podOwner","solid","load","doc","guess","getName","user","anyValue","vcard","foaf","throttle","func","wait","options","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout"],"mappings":"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","sourcesContent":["/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, LiveStore, NamedNode, parse, sym } from 'rdflib'\nimport { ns } from '..'\nimport { styleMap as headerStyleMap } from '../header/styleMap'\nimport { styleMap as footerStyleMap } from '../footer/styleMap'\nimport { getClasses } from '../jss'\n\n/* @ts-ignore  no-console */\ntype ThrottleOptions = {\n    leading?: boolean;\n    throttling?: boolean;\n    trailing?: boolean;\n}\n/**\n * @internal\n */\nfunction getStyle (styleClass, type?) {\n  if (type && type === 'footer') {\n    return footerStyleMap[styleClass]\n  } else {\n    return headerStyleMap[styleClass]\n  }\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function addStyleClassToElement (element: any, styleClasses: string[], type?: string) {\n  styleClasses.forEach((styleClass) => {\n    const style = getStyle(styleClass, type)\n    const { classes } = getClasses(document.head, { [styleClass]: style })\n    element.classList.add(classes[styleClass])\n  })\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n */\nexport async function getPodOwner (pod: NamedNode, store: LiveStore): Promise<NamedNode | null> {\n  // This is a massive guess.  In future\n  // const podOwner = sym(`${pod.uri}profile/card#me`)\n/* eslint-disable no-console */\n  try {\n    // load turtle Container representation\n    if (!store.any(pod, null, ns.ldp('Container'), pod)) {\n      const response = await store.fetcher.webOperation('GET', pod.uri, store.fetcher.initFetchOptions(pod.uri, { headers: { accept: 'text/turtle' } }))\n      const containerTurtle = response.responseText\n      parse(containerTurtle as string, store, pod.uri, 'text/turtle')\n    }\n  } catch (err) {\n    console.error('Error loading pod ' + pod + ': ' + err)\n    return null\n  }\n  if (!store.holds(pod, ns.rdf('type'), ns.space('Storage'), pod)) {\n    console.warn('Pod  ' + pod + ' does not declare itself as a space:Storage')\n    return null\n  }\n  const podOwner = store.any(pod, ns.solid('owner'), null, pod) ||\n        store.any(null, ns.space('storage'), pod, pod)\n  if (podOwner) {\n    try {\n      await store.fetcher.load((podOwner as NamedNode).doc())\n    } catch (err) {\n      console.warn('Unable to load profile of pod owner ' + podOwner)\n      return null\n    }\n    if (!store.holds(podOwner, ns.space('storage'), pod, (podOwner as NamedNode).doc())) {\n      console.warn(`Pod owner ${podOwner} does NOT list pod ${pod} as their storage`)\n    }\n    return podOwner as NamedNode// Success!\n  } else { // pod owner not declared in pod\n    // @@ TODO: This is given the structure that NSS provides\n    // This is a massive guess.  For old pods which don't have owner link\n    const guess = sym(`${pod.uri}profile/card#me`)\n    try {\n      // @ts-ignore  LiveStore always has fetcher\n      await store.fetcher.load(guess)\n    } catch (err) {\n      console.error('Ooops. Guessed wrong pod owner webid {$guess} : can\\'t load it.')\n      return null\n    }\n    if (store.holds(guess, ns.space('storage'), pod, guess.doc())) {\n      console.warn('Using guessed pod owner webid but it links back.')\n      return guess\n    }\n    return null\n  }\n  /* eslint-enable no-console */\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n"],"file":"headerFooterHelpers.js"}