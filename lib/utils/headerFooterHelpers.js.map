{"version":3,"file":"headerFooterHelpers.js","names":["getStyle","styleClass","type","footerStyleMap","headerStyleMap","addStyleClassToElement","element","styleClasses","forEach","style","getClasses","document","head","classes","classList","add","getPod","sym","location","origin","site","getPodOwner","pod","store","any","ns","ldp","fetcher","webOperation","uri","initFetchOptions","headers","accept","response","containerTurtle","responseText","parse","console","error","holds","rdf","space","warn","podOwner","solid","load","doc","guess","getName","user","anyValue","vcard","foaf","throttle","func","wait","options","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout"],"sources":["../../src/utils/headerFooterHelpers.ts"],"sourcesContent":["/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, LiveStore, NamedNode, parse, sym } from 'rdflib'\nimport { ns } from '..'\nimport { styleMap as headerStyleMap } from '../header/styleMap'\nimport { styleMap as footerStyleMap } from '../footer/styleMap'\nimport { getClasses } from '../jss'\n\n/* @ts-ignore  no-console */\ntype ThrottleOptions = {\n    leading?: boolean;\n    throttling?: boolean;\n    trailing?: boolean;\n}\n/**\n * @internal\n */\nfunction getStyle (styleClass, type?) {\n  if (type && type === 'footer') {\n    return footerStyleMap[styleClass]\n  } else {\n    return headerStyleMap[styleClass]\n  }\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function addStyleClassToElement (element: any, styleClasses: string[], type?: string) {\n  styleClasses.forEach((styleClass) => {\n    const style = getStyle(styleClass, type)\n    const { classes } = getClasses(document.head, { [styleClass]: style })\n    element.classList.add(classes[styleClass])\n  })\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n */\nexport async function getPodOwner (pod: NamedNode, store: LiveStore): Promise<NamedNode | null> {\n  // This is a massive guess.  In future\n  // const podOwner = sym(`${pod.uri}profile/card#me`)\n/* eslint-disable no-console */\n  try {\n    // load turtle Container representation\n    if (!store.any(pod, null, ns.ldp('Container'), pod)) {\n      const response = await store.fetcher.webOperation('GET', pod.uri, store.fetcher.initFetchOptions(pod.uri, { headers: { accept: 'text/turtle' } }))\n      const containerTurtle = response.responseText\n      parse(containerTurtle as string, store, pod.uri, 'text/turtle')\n    }\n  } catch (err) {\n    console.error('Error loading pod ' + pod + ': ' + err)\n    return null\n  }\n  if (!store.holds(pod, ns.rdf('type'), ns.space('Storage'), pod)) {\n    console.warn('Pod  ' + pod + ' does not declare itself as a space:Storage')\n    return null\n  }\n  const podOwner = store.any(pod, ns.solid('owner'), null, pod) ||\n        store.any(null, ns.space('storage'), pod, pod)\n  if (podOwner) {\n    try {\n      await store.fetcher.load((podOwner as NamedNode).doc())\n    } catch (err) {\n      console.warn('Unable to load profile of pod owner ' + podOwner)\n      return null\n    }\n    if (!store.holds(podOwner, ns.space('storage'), pod, (podOwner as NamedNode).doc())) {\n      console.warn(`Pod owner ${podOwner} does NOT list pod ${pod} as their storage`)\n    }\n    return podOwner as NamedNode// Success!\n  } else { // pod owner not declared in pod\n    // @@ TODO: This is given the structure that NSS provides\n    // This is a massive guess.  For old pods which don't have owner link\n    const guess = sym(`${pod.uri}profile/card#me`)\n    try {\n      // @ts-ignore  LiveStore always has fetcher\n      await store.fetcher.load(guess)\n    } catch (err) {\n      console.error('Ooops. Guessed wrong pod owner webid {$guess} : can\\'t load it.')\n      return null\n    }\n    if (store.holds(guess, ns.space('storage'), pod, guess.doc())) {\n      console.warn('Using guessed pod owner webid but it links back.')\n      return guess\n    }\n    return null\n  }\n  /* eslint-enable no-console */\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n"],"mappings":"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"}