{"version":3,"file":"headerFooterHelpers.js","names":["getStyle","styleClass","type","footerStyleMap","headerStyleMap","addStyleClassToElement","element","styleClasses","forEach","style","getClasses","document","head","classes","classList","add","getPod","sym","location","origin","site","getPodOwner","pod","store","any","ns","ldp","fetcher","webOperation","uri","initFetchOptions","headers","accept","response","containerTurtle","responseText","parse","console","error","holds","rdf","space","warn","podOwner","solid","load","doc","guess","getName","user","anyValue","vcard","foaf","throttle","func","wait","options","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout"],"sources":["../../src/utils/headerFooterHelpers.ts"],"sourcesContent":["/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, LiveStore, NamedNode, parse, sym } from 'rdflib'\nimport { ns } from '..'\nimport { styleMap as headerStyleMap } from '../header/styleMap'\nimport { styleMap as footerStyleMap } from '../footer/styleMap'\nimport { getClasses } from '../jss'\n\n/* @ts-ignore  no-console */\ntype ThrottleOptions = {\n    leading?: boolean;\n    throttling?: boolean;\n    trailing?: boolean;\n}\n/**\n * @internal\n */\nfunction getStyle (styleClass, type?) {\n  if (type && type === 'footer') {\n    return footerStyleMap[styleClass]\n  } else {\n    return headerStyleMap[styleClass]\n  }\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function addStyleClassToElement (element: any, styleClasses: string[], type?: string) {\n  styleClasses.forEach((styleClass) => {\n    const style = getStyle(styleClass, type)\n    const { classes } = getClasses(document.head, { [styleClass]: style })\n    element.classList.add(classes[styleClass])\n  })\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n */\nexport async function getPodOwner (pod: NamedNode, store: LiveStore): Promise<NamedNode | null> {\n  // This is a massive guess.  In future\n  // const podOwner = sym(`${pod.uri}profile/card#me`)\n/* eslint-disable no-console */\n  try {\n    // load turtle Container representation\n    if (!store.any(pod, null, ns.ldp('Container'), pod)) {\n      const response = await store.fetcher.webOperation('GET', pod.uri, store.fetcher.initFetchOptions(pod.uri, { headers: { accept: 'text/turtle' } }))\n      const containerTurtle = response.responseText\n      parse(containerTurtle as string, store, pod.uri, 'text/turtle')\n    }\n  } catch (err) {\n    console.error('Error loading pod ' + pod + ': ' + err)\n    return null\n  }\n  if (!store.holds(pod, ns.rdf('type'), ns.space('Storage'), pod)) {\n    console.warn('Pod  ' + pod + ' does not declare itself as a space:Storage')\n    return null\n  }\n  const podOwner = store.any(pod, ns.solid('owner'), null, pod) ||\n        store.any(null, ns.space('storage'), pod, pod)\n  if (podOwner) {\n    try {\n      await store.fetcher.load((podOwner as NamedNode).doc())\n    } catch (err) {\n      console.warn('Unable to load profile of pod owner ' + podOwner)\n      return null\n    }\n    if (!store.holds(podOwner, ns.space('storage'), pod, (podOwner as NamedNode).doc())) {\n      console.warn(`Pod owner ${podOwner} does NOT list pod ${pod} as their storage`)\n    }\n    return podOwner as NamedNode// Success!\n  } else { // pod owner not declared in pod\n    // @@ TODO: This is given the structure that NSS provides\n    // This is a massive guess.  For old pods which don't have owner link\n    const guess = sym(`${pod.uri}profile/card#me`)\n    try {\n      // @ts-ignore  LiveStore always has fetcher\n      await store.fetcher.load(guess)\n    } catch (err) {\n      console.error('Ooops. Guessed wrong pod owner webid {$guess} : can\\'t load it.')\n      return null\n    }\n    if (store.holds(guess, ns.space('storage'), pod, guess.doc())) {\n      console.warn('Using guessed pod owner webid but it links back.')\n      return guess\n    }\n    return null\n  }\n  /* eslint-enable no-console */\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n"],"mappings":"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"}