{"version":3,"sources":["../../src/utils/headerFooterHelpers.ts"],"names":["getStyle","styleClass","type","footerStyleMap","headerStyleMap","addStyleClassToElement","element","styleClasses","forEach","style","document","head","classes","classList","add","getPod","location","origin","site","getPodOwner","pod","store","podOwner","uri","fetcher","load","doc","Error","storageIsListedInPodOwnersProfile","holds","ns","space","getName","user","anyValue","vcard","foaf","throttle","func","wait","options","context","args","result","timeout","previous","later","leading","Date","now","apply","remaining","arguments","clearTimeout","trailing","setTimeout"],"mappings":"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","sourcesContent":["/*\n    Copied from mashlib/src/global/metadata.ts\n */\nimport { IndexedFormula, NamedNode, sym } from 'rdflib'\nimport { ns } from '..'\nimport { styleMap as headerStyleMap } from '../header/styleMap'\nimport { styleMap as footerStyleMap } from '../footer/styleMap'\nimport { getClasses } from '../jss'\n\ntype ThrottleOptions = {\n    leading?: boolean;\n    throttling?: boolean;\n    trailing?: boolean;\n}\n/**\n * @internal\n */\nfunction getStyle (styleClass, type?) {\n  if (type && type === 'footer') {\n    return footerStyleMap[styleClass]\n  } else {\n    return headerStyleMap[styleClass]\n  }\n}\n\n/**\n * @ignore exporting this only for the unit test\n */\nexport function addStyleClassToElement (element: any, styleClasses: string[], type?: string) {\n  styleClasses.forEach((styleClass) => {\n    const style = getStyle(styleClass, type)\n    const { classes } = getClasses(document.head, { [styleClass]: style })\n    element.classList.add(classes[styleClass])\n  })\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getPod (): NamedNode {\n  // @@ TODO: This is given that mashlib runs on NSS - might need to change when we want it to run on other Pod servers\n  return sym(document.location.origin).site()\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport async function getPodOwner (pod: NamedNode, store: IndexedFormula): Promise<NamedNode | null> {\n  // @@ TODO: This is given the structure that NSS provides - might need to change for other Pod servers\n  const podOwner = sym(`${pod.uri}profile/card#me`)\n\n  try {\n    if (store.fetcher) {\n      await store.fetcher.load(podOwner.doc())\n    } else {\n      throw new Error('There was a problem loading the Fetcher')\n    }\n    // @@ TODO: check back links to storage\n  } catch (err) {\n    throw new Error('Did NOT find pod owners profile at ' + podOwner)\n  }\n  if (podOwner) {\n    const storageIsListedInPodOwnersProfile = store.holds(podOwner, ns.space('storage'), pod, podOwner.doc())\n    if (!storageIsListedInPodOwnersProfile) {\n      throw new Error(`** Pod owner ${podOwner} does NOT list pod ${pod} as storage`)\n    }\n  }\n  return podOwner\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function getName (store: IndexedFormula, user: NamedNode): string {\n  return store.anyValue(user, ns.vcard('fn'), null, user.doc()) ||\n    store.anyValue(user, ns.foaf('name'), null, user.doc()) ||\n    user.uri\n}\n/**\n * @ignore exporting this only for the unit test\n */\nexport function throttle (func: Function, wait: number, options: ThrottleOptions = {}): (...args: any[]) => any {\n  let context: any,\n    args: any,\n    result: any\n  let timeout: any = null\n  let previous = 0\n  const later = function () {\n    previous = !options.leading ? 0 : Date.now()\n    timeout = null\n    result = func.apply(context, args)\n    if (!timeout) context = args = null\n  }\n  return function () {\n    const now = Date.now()\n    if (!previous && !options.leading) previous = now\n    const remaining = wait - (now - previous)\n    // @ts-ignore\n    context = this\n    args = arguments\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout)\n        timeout = null\n      }\n      previous = now\n      result = func.apply(context, args)\n      if (!timeout) context = args = null\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining)\n    }\n    return result\n  }\n}\n"],"file":"headerFooterHelpers.js"}