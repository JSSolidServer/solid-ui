{"version":3,"file":"label.js","names":["UI","log","ns","rdf","label","thing","initialCap","doCap","slice","toUpperCase","cleanUp","result","i","length","toLowerCase","getWellKnownLabel","value","termType","elements","s","uri","toString","split","map","decodeURIComponent","join","e","hex","indexOf","String","fromCharCode","parseInt","hash","slash","lastIndexOf","suffix","store","any","ui","link","vcard","foaf","dct","dc","rss","contact","sym","cal","as","schema","rdfs"],"sources":["../../src/utils/label.ts"],"sourcesContent":["import * as log from '../log'\nimport { store } from 'solid-logic'\nimport * as ns from '../ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n\nconst UI = { log, ns, rdf }\n\n// This ubiquitous function returns the best label for a thing\n//\n// The hacks in this code make a major difference to the usability\nexport function label (thing, initialCap = false): string {\n  function doCap (label: string) {\n    if (initialCap) {\n      return label.slice(0, 1).toUpperCase() + label.slice(1)\n    }\n    return label\n  }\n  function cleanUp (label: string) {\n    let result = ''\n    if (label.slice(-1) === '/') label = label.slice(0, -1) // chop trailing slash\n    for (let i = 0; i < label.length; i++) {\n      if (label[i] === '_' || label[i] === '-') {\n        result += ' '\n        continue\n      }\n      result += label[i]\n      if (\n        i + 1 < label.length &&\n        label[i].toUpperCase() !== label[i] &&\n        label[i + 1].toLowerCase() !== label[i + 1]\n      ) {\n        result += ' '\n      }\n    }\n    if (result.slice(0, 4) === 'has ') result = result.slice(4)\n    return doCap(result)\n  }\n\n  const label = getWellKnownLabel(thing)\n\n  if (label) {\n    return doCap(label.value)\n  }\n\n  // Default to label just generated from the URI\n\n  if (thing.termType === 'BlankNode') {\n    return '...'\n  }\n  if (thing.termType === 'Collection') {\n    return '(' + thing.elements.length + ')'\n  }\n  let s = thing.uri\n  if (typeof s === 'undefined') return thing.toString() // can't be a symbol\n  // s = decodeURI(s) // This can crash is random valid @ signs are presentation\n  // The idea was to clean up eg URIs encoded in query strings\n  // Also encoded character in what was filenames like @ [] {}\n  try {\n    s = s\n      .split('/')\n      .map(decodeURIComponent)\n      .join('/') // If it is properly encoded\n  } catch (e) {\n    // try individual decoding of ASCII code points\n    for (let i = s.length - 3; i > 0; i--) {\n      const hex = '0123456789abcefABCDEF' // The while upacks multiple layers of encoding\n      while (\n        s[i] === '%' &&\n        hex.indexOf(s[i + 1]) >= 0 &&\n        hex.indexOf(s[i + 2]) >= 0\n      ) {\n        s =\n          s.slice(0, i) +\n          String.fromCharCode(parseInt(s.slice(i + 1, i + 3), 16)) +\n          s.slice(i + 3)\n      }\n    }\n  }\n\n  s = slice(s, '/profile/card#me')\n  s = slice(s, '#this')\n  s = slice(s, '#me')\n\n  const hash = s.indexOf('#')\n  if (hash >= 0) return cleanUp(s.slice(hash + 1))\n\n  // Eh? Why not do this? e.g. dc:title needs it only trim URIs, not rdfs:labels\n  const slash = s.lastIndexOf('/', s.length - 2) // (len-2) excludes trailing slash\n  if (slash >= 0 && slash < thing.uri.length) return cleanUp(s.slice(slash + 1))\n\n  return doCap(decodeURIComponent(thing.uri))\n}\n\nfunction slice (s: string, suffix: string) {\n  const length = suffix.length * -1\n  if (s.slice(length) === suffix) {\n    return s.slice(0, length)\n  }\n  return s\n}\n\n// Hard coded known label predicates\n//  @@ TBD: Add subproperties of rdfs:label\nfunction getWellKnownLabel (thing) {\n  return store.any(thing, UI.ns.ui('label')) || // Prioritize ui:label\n      store.any(thing, UI.ns.link('message')) ||\n      store.any(thing, UI.ns.vcard('fn')) ||\n      store.any(thing, UI.ns.foaf('name')) ||\n      store.any(thing, UI.ns.dct('title')) ||\n      store.any(thing, UI.ns.dc('title')) ||\n      store.any(thing, UI.ns.rss('title')) ||\n      store.any(thing, UI.ns.contact('fullName')) ||\n      store.any(thing, store.sym('http://www.w3.org/2001/04/roadmap/org#name')) ||\n      store.any(thing, UI.ns.cal('summary')) ||\n      store.any(thing, UI.ns.foaf('nick')) ||\n      store.any(thing, UI.ns.as('name')) ||\n      store.any(thing, UI.ns.schema('name')) ||\n      store.any(thing, UI.ns.rdfs('label')) ||\n      store.any(thing, store.sym('http://www.w3.org/2004/02/skos/core#prefLabel'))\n}\n"],"mappings":"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"}