{"version":3,"file":"label.js","names":["UI","log","ns","rdf","label","thing","initialCap","doCap","slice","toUpperCase","cleanUp","result","i","length","toLowerCase","getWellKnownLabel","value","termType","elements","s","uri","toString","split","map","decodeURIComponent","join","e","hex","indexOf","String","fromCharCode","parseInt","hash","slash","lastIndexOf","suffix","store","any","ui","link","vcard","foaf","dct","dc","rss","contact","sym","cal","as","schema","rdfs"],"sources":["../../src/utils/label.ts"],"sourcesContent":["import * as log from '../log'\nimport { store } from 'solid-logic'\nimport * as ns from '../ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n\nconst UI = { log, ns, rdf }\n\n// This ubiquitous function returns the best label for a thing\n//\n// The hacks in this code make a major difference to the usability\nexport function label (thing, initialCap = false): string {\n  function doCap (label: string) {\n    if (initialCap) {\n      return label.slice(0, 1).toUpperCase() + label.slice(1)\n    }\n    return label\n  }\n  function cleanUp (label: string) {\n    let result = ''\n    if (label.slice(-1) === '/') label = label.slice(0, -1) // chop trailing slash\n    for (let i = 0; i < label.length; i++) {\n      if (label[i] === '_' || label[i] === '-') {\n        result += ' '\n        continue\n      }\n      result += label[i]\n      if (\n        i + 1 < label.length &&\n        label[i].toUpperCase() !== label[i] &&\n        label[i + 1].toLowerCase() !== label[i + 1]\n      ) {\n        result += ' '\n      }\n    }\n    if (result.slice(0, 4) === 'has ') result = result.slice(4)\n    return doCap(result)\n  }\n\n  const label = getWellKnownLabel(thing)\n\n  if (label) {\n    return doCap(label.value)\n  }\n\n  // Default to label just generated from the URI\n\n  if (thing.termType === 'BlankNode') {\n    return '...'\n  }\n  if (thing.termType === 'Collection') {\n    return '(' + thing.elements.length + ')'\n  }\n  let s = thing.uri\n  if (typeof s === 'undefined') return thing.toString() // can't be a symbol\n  // s = decodeURI(s) // This can crash is random valid @ signs are presentation\n  // The idea was to clean up eg URIs encoded in query strings\n  // Also encoded character in what was filenames like @ [] {}\n  try {\n    s = s\n      .split('/')\n      .map(decodeURIComponent)\n      .join('/') // If it is properly encoded\n  } catch (e) {\n    // try individual decoding of ASCII code points\n    for (let i = s.length - 3; i > 0; i--) {\n      const hex = '0123456789abcefABCDEF' // The while upacks multiple layers of encoding\n      while (\n        s[i] === '%' &&\n        hex.indexOf(s[i + 1]) >= 0 &&\n        hex.indexOf(s[i + 2]) >= 0\n      ) {\n        s =\n          s.slice(0, i) +\n          String.fromCharCode(parseInt(s.slice(i + 1, i + 3), 16)) +\n          s.slice(i + 3)\n      }\n    }\n  }\n\n  s = slice(s, '/profile/card#me')\n  s = slice(s, '#this')\n  s = slice(s, '#me')\n\n  const hash = s.indexOf('#')\n  if (hash >= 0) return cleanUp(s.slice(hash + 1))\n\n  // Eh? Why not do this? e.g. dc:title needs it only trim URIs, not rdfs:labels\n  const slash = s.lastIndexOf('/', s.length - 2) // (len-2) excludes trailing slash\n  if (slash >= 0 && slash < thing.uri.length) return cleanUp(s.slice(slash + 1))\n\n  return doCap(decodeURIComponent(thing.uri))\n}\n\nfunction slice (s: string, suffix: string) {\n  const length = suffix.length * -1\n  if (s.slice(length) === suffix) {\n    return s.slice(0, length)\n  }\n  return s\n}\n\n// Hard coded known label predicates\n//  @@ TBD: Add subproperties of rdfs:label\nfunction getWellKnownLabel (thing) {\n  return store.any(thing, UI.ns.ui('label')) || // Prioritize ui:label\n      store.any(thing, UI.ns.link('message')) ||\n      store.any(thing, UI.ns.vcard('fn')) ||\n      store.any(thing, UI.ns.foaf('name')) ||\n      store.any(thing, UI.ns.dct('title')) ||\n      store.any(thing, UI.ns.dc('title')) ||\n      store.any(thing, UI.ns.rss('title')) ||\n      store.any(thing, UI.ns.contact('fullName')) ||\n      store.any(thing, store.sym('http://www.w3.org/2001/04/roadmap/org#name')) ||\n      store.any(thing, UI.ns.cal('summary')) ||\n      store.any(thing, UI.ns.foaf('nick')) ||\n      store.any(thing, UI.ns.as('name')) ||\n      store.any(thing, UI.ns.schema('name')) ||\n      store.any(thing, UI.ns.rdfs('label')) ||\n      store.any(thing, store.sym('http://www.w3.org/2004/02/skos/core#prefLabel'))\n}\n"],"mappings":"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"}