{"version":3,"file":"label.js","names":["log","_interopRequireWildcard","require","_solidLogic","ns","rdf","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","UI","label","thing","initialCap","arguments","length","undefined","doCap","slice","toUpperCase","cleanUp","result","i","toLowerCase","getWellKnownLabel","value","termType","elements","s","uri","toString","split","map","decodeURIComponent","join","e","hex","indexOf","String","fromCharCode","parseInt","hash","slash","lastIndexOf","suffix","store","any","ui","link","vcard","foaf","dct","dc","rss","contact","sym","cal","as","schema","rdfs"],"sources":["../../src/utils/label.ts"],"sourcesContent":["import * as log from '../log'\nimport { store } from 'solid-logic'\nimport * as ns from '../ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n\nconst UI = { log, ns, rdf }\n\n// This ubiquitous function returns the best label for a thing\n//\n// The hacks in this code make a major difference to the usability\nexport function label (thing, initialCap = false): string {\n  function doCap (label: string) {\n    if (initialCap) {\n      return label.slice(0, 1).toUpperCase() + label.slice(1)\n    }\n    return label\n  }\n  function cleanUp (label: string) {\n    let result = ''\n    if (label.slice(-1) === '/') label = label.slice(0, -1) // chop trailing slash\n    for (let i = 0; i < label.length; i++) {\n      if (label[i] === '_' || label[i] === '-') {\n        result += ' '\n        continue\n      }\n      result += label[i]\n      if (\n        i + 1 < label.length &&\n        label[i].toUpperCase() !== label[i] &&\n        label[i + 1].toLowerCase() !== label[i + 1]\n      ) {\n        result += ' '\n      }\n    }\n    if (result.slice(0, 4) === 'has ') result = result.slice(4)\n    return doCap(result)\n  }\n\n  const label = getWellKnownLabel(thing)\n\n  if (label) {\n    return doCap(label.value)\n  }\n\n  // Default to label just generated from the URI\n\n  if (thing.termType === 'BlankNode') {\n    return '...'\n  }\n  if (thing.termType === 'Collection') {\n    return '(' + thing.elements.length + ')'\n  }\n  let s = thing.uri\n  if (typeof s === 'undefined') return thing.toString() // can't be a symbol\n  // s = decodeURI(s) // This can crash is random valid @ signs are presentation\n  // The idea was to clean up eg URIs encoded in query strings\n  // Also encoded character in what was filenames like @ [] {}\n  try {\n    s = s\n      .split('/')\n      .map(decodeURIComponent)\n      .join('/') // If it is properly encoded\n  } catch (e) {\n    // try individual decoding of ASCII code points\n    for (let i = s.length - 3; i > 0; i--) {\n      const hex = '0123456789abcefABCDEF' // The while upacks multiple layers of encoding\n      while (\n        s[i] === '%' &&\n        hex.indexOf(s[i + 1]) >= 0 &&\n        hex.indexOf(s[i + 2]) >= 0\n      ) {\n        s =\n          s.slice(0, i) +\n          String.fromCharCode(parseInt(s.slice(i + 1, i + 3), 16)) +\n          s.slice(i + 3)\n      }\n    }\n  }\n\n  s = slice(s, '/profile/card#me')\n  s = slice(s, '#this')\n  s = slice(s, '#me')\n\n  const hash = s.indexOf('#')\n  if (hash >= 0) return cleanUp(s.slice(hash + 1))\n\n  // Eh? Why not do this? e.g. dc:title needs it only trim URIs, not rdfs:labels\n  const slash = s.lastIndexOf('/', s.length - 2) // (len-2) excludes trailing slash\n  if (slash >= 0 && slash < thing.uri.length) return cleanUp(s.slice(slash + 1))\n\n  return doCap(decodeURIComponent(thing.uri))\n}\n\nfunction slice (s: string, suffix: string) {\n  const length = suffix.length * -1\n  if (s.slice(length) === suffix) {\n    return s.slice(0, length)\n  }\n  return s\n}\n\n// Hard coded known label predicates\n//  @@ TBD: Add subproperties of rdfs:label\nfunction getWellKnownLabel (thing) {\n  return store.any(thing, UI.ns.ui('label')) || // Prioritize ui:label\n      store.any(thing, UI.ns.link('message')) ||\n      store.any(thing, UI.ns.vcard('fn')) ||\n      store.any(thing, UI.ns.foaf('name')) ||\n      store.any(thing, UI.ns.dct('title')) ||\n      store.any(thing, UI.ns.dc('title')) ||\n      store.any(thing, UI.ns.rss('title')) ||\n      store.any(thing, UI.ns.contact('fullName')) ||\n      store.any(thing, store.sym('http://www.w3.org/2001/04/roadmap/org#name')) ||\n      store.any(thing, UI.ns.cal('summary')) ||\n      store.any(thing, UI.ns.foaf('nick')) ||\n      store.any(thing, UI.ns.as('name')) ||\n      store.any(thing, UI.ns.schema('name')) ||\n      store.any(thing, UI.ns.rdfs('label')) ||\n      store.any(thing, store.sym('http://www.w3.org/2004/02/skos/core#prefLabel'))\n}\n"],"mappings":"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"}