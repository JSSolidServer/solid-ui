{"version":3,"file":"login.js","names":["store","solidLogicSingleton","profile","loadPreferences","loadProfile","typeIndex","getScopedAppInstances","getRegistrations","loadAllTypeIndexes","getScopedAppsFromIndex","deleteTypeIndexRegistration","ensureLoggedIn","context","me","authn","currentUser","saveUser","Promise","resolve","checkUser","then","webId","debug","log","div","dom","box","loginStatusBox","webIdUri","appendChild","ensureLoadedPreferences","complain","message","statusArea","widgets","errorMessageBlock","preferencesFile","ensureLoadedProfile","progressDisplay","parentNode","removeChild","UnauthorizedError","m2","alert","CrossOriginForbiddenError","window","location","origin","preferencesFileError","SameOriginForbiddenError","warn","NotEditableError","WebOperationError","FetchError","status","Error","publicProfile","logInContext","findAppInstances","theClass","isPublic","items","filter","item","scope","label","instances","map","instance","scopeLabel","mine","sameTerm","agent","name","utils","registrationControl","registrationStatements","renderScopeCheckbox","statements","index","noun","buildCheckboxForm","form","registrations","reg","length","newThing","st","ns","solid","createElement","innerHTML","scopes","msg","textContent","setAttribute","tbody","children","BlankNode","row","renderScopeHeadingRow","backgroundColor","cell","style","backgoundColor","header","textAlign","registrationList","options","table","firstChild","headingRow","type","display","personTR","deleteFunction","paddingLeft","getDefaultSignInButtonStyle","signInOrSignUpBox","setUserCallback","signInButtonStyle","buttonStyle","magicClassName","signInPopUpButton","authSession","onLogin","webIdURI","uri","divs","getElementsByClassName","i","parent","e","addEventListener","offline","offlineTestID","renderSignInPopup","signupButton","_event","signupMgr","Signup","signup","issuerPopup","body","issuerPopupBox","issuerPopupBoxTopMenu","issuerPopupBoxLabel","innerText","issuerPopupBoxCloseButton","remove","loginToIssuer","issuerUri","preLoginRedirectHash","URL","href","hash","localStorage","setItem","login","redirectUrl","oidcIssuer","issuerTextContainer","issuerTextInputContainer","issuerTextLabel","issuerTextInput","value","getItem","issuerTextGoButton","issuerButtonContainer","issuerBottonLabel","getSuggestedIssuers","forEach","issuerInfo","issuerButton","listener","setIt","newidURI","refresh","logoutButtonHandler","oldMe","logout","err","logoutButton","logoutLabel","nick","any","foaf","signOutButton","sessionInfo","info","isLoggedIn","sym","clearElement","trackSession","onLogout","issuer","wellKnownUri","pathname","fetch","toString","wellKnownResult","json","openidConfiguration","end_session_endpoint","credentials","reload","selectWorkspace","appDetails","callbackWS","appPathSegment","say","s","background","figureOutBase","ws","newBaseNode","space","newBaseString","split","slice","now","Date","getTime","displayOptions","makeNewWorkspace","padding","encodeURI","askName","newBase","newWs","newData","updater","update","id","w","each","undefined","storages","concat","ldp","file","includes","toLowerCase","p","commentStyle","baseField","textInputStyle","size","autocomplete","button","replace","x","holds","rdf","col1","col2","col3","tr","comment","cellStyle","deselectedStyle","anyValue","ui","reduce","a","b","charCodeAt","bgcolor","target","rdfs","disabled","trLast","newAppInstance","callback","gotWS","base","getUserRoles","doc","filterAvailablePanes","panes","userRoles","pane","isMatchingAudience","audience","isMatch","audienceRole","find","role","equals"],"sources":["../../src/login/login.ts"],"sourcesContent":["/* eslint-disable camelcase */\n/**\n * Signing in, signing up, profile and preferences reloading\n * Type index management\n *\n * Many functions in this module take a context object which\n * holds various RDF symbols, add to it, and return a promise of it.\n *\n * * `me`                RDF symbol for the user's WebID\n * * `publicProfile`     The user's public profile, iff loaded\n * * `preferencesFile`   The user's personal preference file, iff loaded\n * * `index.public`      The user's public type index file\n * * `index.private`     The user's private type index file\n *\n * Not RDF symbols:\n * * `noun`            A string in english for the type of thing -- like \"address book\"\n * * `instance`        An array of nodes which are existing instances\n * * `containers`      An array of nodes of containers of instances\n * * `div`             A DOM element where UI can be displayed\n * * `statusArea`      A DOM element (opt) progress stuff can be displayed, or error messages\n * *\n * * Vocabulary:  \"load\" loads a file if it exists;\n * *  'Ensure\" CREATES the file if it does not exist (if it can) and then loads it.\n * @packageDocumentation\n */\nimport { PaneDefinition } from 'pane-registry'\nimport { BlankNode, NamedNode, st } from 'rdflib'\n// eslint-disable-next-line camelcase\nimport { Quad_Object } from 'rdflib/lib/tf-types'\nimport {\n  AppDetails,\n  AuthenticationContext,\n  authn,\n  authSession,\n  CrossOriginForbiddenError,\n  FetchError,\n  getSuggestedIssuers,\n  NotEditableError,\n  offlineTestID,\n  SameOriginForbiddenError,\n  solidLogicSingleton,\n  UnauthorizedError,\n  WebOperationError\n} from 'solid-logic'\nimport * as debug from '../debug'\nimport { alert } from '../log'\nimport * as ns from '../ns.js'\nimport { Signup } from '../signup/signup.js'\nimport { buttonStyle, commentStyle, textInputStyle } from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\n\nconst store = solidLogicSingleton.store\n\nconst {\n  loadPreferences,\n  loadProfile\n} = solidLogicSingleton.profile\n\nconst {\n  getScopedAppInstances,\n  getRegistrations,\n  loadAllTypeIndexes,\n  getScopedAppsFromIndex,\n  deleteTypeIndexRegistration\n} = solidLogicSingleton.typeIndex\n\n/**\n * Resolves with the logged in user's WebID\n *\n * @param context\n */\n// used to be logIn\nexport function ensureLoggedIn (context: AuthenticationContext): Promise<AuthenticationContext> {\n  const me = authn.currentUser()\n  if (me) {\n    authn.saveUser(me, context)\n    return Promise.resolve(context)\n  }\n\n  return new Promise((resolve) => {\n    authn.checkUser().then((webId) => {\n      // Already logged in?\n      if (webId) {\n        debug.log(`logIn: Already logged in as ${webId}`)\n        return resolve(context)\n      }\n      if (!context.div || !context.dom) {\n        return resolve(context)\n      }\n      const box = loginStatusBox(context.dom, (webIdUri) => {\n        authn.saveUser(webIdUri, context)\n        resolve(context) // always pass growing context\n      })\n      context.div.appendChild(box)\n    })\n  })\n}\n\n/**\n * Loads preference file\n * Do this after having done log in and load profile\n *\n * @private\n *\n * @param context\n */\n// used to be logInLoadPreferences\nexport async function ensureLoadedPreferences (\n  context: AuthenticationContext\n): Promise<AuthenticationContext> {\n  if (context.preferencesFile) return Promise.resolve(context) // already done\n\n  const statusArea = context.statusArea || context.div || null\n  let progressDisplay\n  function complain (message) {\n    message = `ensureLoadedPreferences: ${message}`\n    if (statusArea) {\n      // statusArea.innerHTML = ''\n      statusArea.appendChild(widgets.errorMessageBlock(context.dom, message))\n    }\n    debug.log(message)\n    // reject(new Error(message))\n  }\n  try {\n    context = await ensureLoadedProfile(context)\n\n    // console.log('back in Solid UI after logInLoadProfile', context)\n    const preferencesFile = await loadPreferences(context.me as NamedNode)\n    if (progressDisplay) {\n      progressDisplay.parentNode.removeChild(progressDisplay)\n    }\n    context.preferencesFile = preferencesFile\n  } catch (err) {\n    let m2: string\n    if (err instanceof UnauthorizedError) {\n      m2 =\n        'Ooops - you are not authenticated (properly logged in) to for me to read your preference file.  Try loggin out and logging in?'\n      alert(m2)\n    } else if (err instanceof CrossOriginForbiddenError) {\n      m2 = `Unauthorized: Assuming preference file blocked for origin ${window.location.origin}`\n      context.preferencesFileError = m2\n      return context\n    } else if (err instanceof SameOriginForbiddenError) {\n      m2 =\n        'You are not authorized to read your preference file. This may be because you are using an untrusted web app.'\n      debug.warn(m2)\n      return context\n    } else if (err instanceof NotEditableError) {\n      m2 =\n        'You are not authorized to edit your preference file. This may be because you are using an untrusted web app.'\n      debug.warn(m2)\n      return context\n    } else if (err instanceof WebOperationError) {\n      m2 =\n        'You are not authorized to edit your preference file. This may be because you are using an untrusted web app.'\n      debug.warn(m2)\n    } else if (err instanceof FetchError) {\n      m2 = `Strange: Error ${err.status} trying to read your preference file.${err.message}`\n      alert(m2)\n    } else {\n      throw new Error(`(via loadPrefs) ${err}`)\n    }\n  }\n  return context\n}\n\n/**\n * Logs the user in and loads their WebID profile document into the store\n *\n * @param context\n *\n * @returns Resolves with the context after login / fetch\n */\n// used to be logInLoadProfile\nexport async function ensureLoadedProfile (\n  context: AuthenticationContext\n): Promise<AuthenticationContext> {\n  if (context.publicProfile) {\n    return context\n  } // already done\n  try {\n    const logInContext = await ensureLoggedIn(context)\n    if (!logInContext.me) {\n      throw new Error('Could not log in')\n    }\n    context.publicProfile = await loadProfile(logInContext.me)\n  } catch (err) {\n    if (context.div && context.dom) {\n      context.div.appendChild(widgets.errorMessageBlock(context.dom, err.message))\n    }\n    throw new Error(`Can't log in: ${err}`)\n  }\n  return context\n}\n\n/**\n  * Returns promise of context with arrays of symbols\n  *\n  * leaving the `isPublic` param undefined will bring in community index things, too\n  */\nexport async function findAppInstances (\n  context: AuthenticationContext,\n  theClass: NamedNode,\n  isPublic?: boolean\n): Promise<AuthenticationContext> {\n  let items = context.me ? await getScopedAppInstances(theClass, context.me) : []\n  if (isPublic === true) { // old API - not recommended!\n    items = items.filter(item => item.scope.label === 'public')\n  } else if (isPublic === false) {\n    items = items.filter(item => item.scope.label === 'private')\n  }\n  context.instances = items.map(item => item.instance)\n  return context\n}\n\nexport function scopeLabel (context, scope) {\n  const mine = context.me && context.me.sameTerm(scope.agent)\n  const name = mine ? '' : utils.label(scope.agent) + ' '\n  return `${name}${scope.label}`\n}\n/**\n * UI to control registration of instance\n */\nexport async function registrationControl (\n  context: AuthenticationContext,\n  instance,\n  theClass\n): Promise<AuthenticationContext | void> {\n  function registrationStatements (index) {\n    const registrations = getRegistrations(instance, theClass)\n    const reg = registrations.length ? registrations[0] : widgets.newThing(index)\n    return [\n      st(reg, ns.solid('instance'), instance, index),\n      st(reg, ns.solid('forClass'), theClass, index)\n    ]\n  }\n\n  function renderScopeCheckbox (scope) {\n    const statements = registrationStatements(scope.index)\n    const name = scopeLabel(context, scope)\n    const label = `${name} link to this ${context.noun}`\n    return widgets.buildCheckboxForm(\n      context.dom,\n      solidLogicSingleton.store,\n      label,\n      null,\n      statements,\n      form,\n      scope.index\n    )\n  }\n  /// / body of registrationControl\n  const dom = context.dom\n  if (!dom || !context.div) {\n    throw new Error('registrationControl: need dom and div')\n  }\n  const box = dom.createElement('div')\n  context.div.appendChild(box)\n  context.me = authn.currentUser() // @@\n  const me = context.me\n  if (!me) {\n    box.innerHTML = '<p style=\"margin:2em;\">(Log in to save a link to this)</p>'\n    return context\n  }\n\n  let scopes // @@ const\n  try {\n    scopes = await loadAllTypeIndexes(me)\n  } catch (e) {\n    let msg\n    if (context.div && context.preferencesFileError) {\n      msg = '(Lists of stuff not available)'\n      context.div.appendChild(dom.createElement('p')).textContent = msg\n    } else if (context.div) {\n      msg = `registrationControl: Type indexes not available: ${e}`\n      context.div.appendChild(widgets.errorMessageBlock(context.dom, e))\n    }\n    debug.log(msg)\n    return context\n  }\n\n  box.innerHTML = '<table><tbody></tbody></table>' // tbody will be inserted anyway\n  box.setAttribute('style', 'font-size: 120%; text-align: right; padding: 1em; border: solid gray 0.05em;')\n  const tbody = box.children[0].children[0]\n  const form = new BlankNode() // @@ say for now\n\n  for (const scope of scopes) {\n    const row = tbody.appendChild(dom.createElement('tr'))\n    row.appendChild(renderScopeCheckbox(scope)) // @@ index\n  }\n  return context\n}\n\nexport function renderScopeHeadingRow (context, store, scope) {\n  const backgroundColor = { private: '#fee', public: '#efe' }\n  const { dom } = context\n  const name = scopeLabel(context, scope)\n  const row = dom.createElement('tr')\n  const cell = row.appendChild(dom.createElement('td'))\n  cell.setAttribute('colspan', '3')\n  cell.style.backgoundColor = backgroundColor[scope.label] || 'white'\n  const header = cell.appendChild(dom.createElement('h3'))\n  header.textContent = name + ' links'\n  header.style.textAlign = 'left'\n  return row\n}\n/**\n  * UI to List at all registered things\n  */\nexport async function registrationList (context: AuthenticationContext, options: {\n  private?: boolean\n  public?: boolean\n  type?: NamedNode\n}): Promise<AuthenticationContext> {\n  const dom = context.dom as HTMLDocument\n  const div = context.div as HTMLElement\n\n  const box = dom.createElement('div')\n  div.appendChild(box)\n  context.me = authn.currentUser() // @@\n  if (!context.me) {\n    box.innerHTML = '<p style=\"margin:2em;\">(Log in list your stuff)</p>'\n    return context\n  }\n\n  const scopes = await loadAllTypeIndexes(context.me) // includes community indexes\n\n  // console.log('@@ registrationList ', scopes)\n  box.innerHTML = '<table><tbody></tbody></table>' // tbody will be inserted anyway\n  box.setAttribute('style', 'font-size: 120%; text-align: right; padding: 1em; border: solid #eee 0.5em;')\n  const table = box.firstChild as HTMLElement\n  const tbody = table.firstChild as HTMLElement\n\n  for (const scope of scopes) { // need some predicate for listing/adding agents\n    const headingRow = renderScopeHeadingRow(context, store, scope)\n    tbody.appendChild(headingRow)\n    const items = await getScopedAppsFromIndex(scope, options.type || null) // any class\n    if (items.length === 0) headingRow.style.display = 'none'\n    // console.log(`registrationList: @@ instance items for class ${options.type || 'undefined' }:`, items)\n    for (const item of items) {\n      const row = widgets.personTR(dom, ns.solid('instance'), item.instance, {\n        deleteFunction: async () => {\n          await deleteTypeIndexRegistration(item)\n          tbody.removeChild(row)\n        }\n      })\n      row.children[0].style.paddingLeft = '3em'\n\n      tbody.appendChild(row)\n    }\n  }\n  return context\n} // registrationList\n\nfunction getDefaultSignInButtonStyle (): string {\n  return 'padding: 1em; border-radius:0.5em; font-size: 100%;'\n}\n\n/**\n * Bootstrapping identity\n * (Called by `loginStatusBox()`)\n *\n * @param dom\n * @param setUserCallback\n *\n * @returns\n */\nfunction signInOrSignUpBox (\n  dom: HTMLDocument,\n  setUserCallback: (user: string) => void,\n  options: {\n    buttonStyle?: string;\n  } = {}\n): HTMLElement {\n  options = options || {}\n  const signInButtonStyle = options.buttonStyle || getDefaultSignInButtonStyle()\n\n  // @@ TODO Remove the need to cast HTML element to any\n  const box: any = dom.createElement('div')\n  const magicClassName = 'SolidSignInOrSignUpBox'\n  debug.log('widgets.signInOrSignUpBox')\n  box.setUserCallback = setUserCallback\n  box.setAttribute('class', magicClassName);\n  (box as any).style = 'display:flex;' // @@ fix all typecasts like this\n\n  // Sign in button with PopUP\n  const signInPopUpButton = dom.createElement('input') // multi\n  box.appendChild(signInPopUpButton)\n  signInPopUpButton.setAttribute('type', 'button')\n  signInPopUpButton.setAttribute('value', 'Log in')\n  signInPopUpButton.setAttribute('style', `${signInButtonStyle}background-color: #eef;`)\n\n  authSession.onLogin(() => {\n    const me = authn.currentUser()\n    // const sessionInfo = authSession.info\n    // if (sessionInfo && sessionInfo.isLoggedIn) {\n    if (me) {\n      // const webIdURI = sessionInfo.webId\n      const webIdURI = me.uri\n      // setUserCallback(webIdURI)\n      const divs = dom.getElementsByClassName(magicClassName)\n      debug.log(`Logged in, ${divs.length} panels to be serviced`)\n      // At the same time, satisfy all the other login boxes\n      for (let i = 0; i < divs.length; i++) {\n        const div: any = divs[i]\n        // @@ TODO Remove the need to manipulate HTML elements\n        if (div.setUserCallback) {\n          try {\n            div.setUserCallback(webIdURI)\n            const parent = div.parentNode\n            if (parent) {\n              parent.removeChild(div)\n            }\n          } catch (e) {\n            debug.log(`## Error satisfying login box: ${e}`)\n            div.appendChild(widgets.errorMessageBlock(dom, e))\n          }\n        }\n      }\n    }\n  })\n\n  signInPopUpButton.addEventListener(\n    'click',\n    () => {\n      const offline = offlineTestID()\n      if (offline) return setUserCallback(offline.uri)\n\n      renderSignInPopup(dom)\n    },\n    false\n  )\n\n  // Sign up button\n  const signupButton = dom.createElement('input')\n  box.appendChild(signupButton)\n  signupButton.setAttribute('type', 'button')\n  signupButton.setAttribute('value', 'Sign Up for Solid')\n  signupButton.setAttribute('style', `${signInButtonStyle}background-color: #efe;`)\n\n  signupButton.addEventListener(\n    'click',\n    function (_event) {\n      const signupMgr = new Signup()\n      signupMgr.signup().then(function (uri) {\n        debug.log('signInOrSignUpBox signed up ' + uri)\n        setUserCallback(uri)\n      })\n    },\n    false\n  )\n  return box\n}\n\nexport function renderSignInPopup (dom: HTMLDocument) {\n  /**\n   * Issuer Menu\n   */\n  const issuerPopup = dom.createElement('div')\n  issuerPopup.setAttribute(\n    'style',\n    'position: fixed; top: 0; left: 0; right: 0; bottom: 0; display: flex; justify-content: center; align-items: center;'\n  )\n  dom.body.appendChild(issuerPopup)\n  const issuerPopupBox = dom.createElement('div')\n  issuerPopupBox.setAttribute(\n    'style',\n    `\n      background-color: white;\n      box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -webkit-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -moz-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      -o-box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.2);\n      border-radius: 4px;\n      min-width: 400px;\n      padding: 10px;\n      z-index : 10;\n    `\n  )\n  issuerPopup.appendChild(issuerPopupBox)\n  const issuerPopupBoxTopMenu = dom.createElement('div')\n  issuerPopupBoxTopMenu.setAttribute(\n    'style',\n    `\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      justify-content: space-between;\n    `\n  )\n  issuerPopupBox.appendChild(issuerPopupBoxTopMenu)\n  const issuerPopupBoxLabel = dom.createElement('label')\n  issuerPopupBoxLabel.setAttribute('style', 'margin-right: 5px; font-weight: 800')\n  issuerPopupBoxLabel.innerText = 'Select an identity provider'\n  const issuerPopupBoxCloseButton = dom.createElement('button')\n  issuerPopupBoxCloseButton.innerHTML =\n    '<img src=\"https://solidos.github.io/solid-ui/src/icons/noun_1180156.svg\" style=\"width: 2em; height: 2em;\" title=\"Cancel\">'\n  issuerPopupBoxCloseButton.setAttribute('style', 'background-color: transparent; border: none;')\n  issuerPopupBoxCloseButton.addEventListener('click', () => {\n    issuerPopup.remove()\n  })\n  issuerPopupBoxTopMenu.appendChild(issuerPopupBoxLabel)\n  issuerPopupBoxTopMenu.appendChild(issuerPopupBoxCloseButton)\n\n  const loginToIssuer = async (issuerUri: string) => {\n    try {\n      // Save hash\n      const preLoginRedirectHash = new URL(window.location.href).hash\n      if (preLoginRedirectHash) {\n        window.localStorage.setItem('preLoginRedirectHash', preLoginRedirectHash)\n      }\n      window.localStorage.setItem('loginIssuer', issuerUri)\n      // Login\n      await authSession.login({\n        redirectUrl: window.location.href,\n        oidcIssuer: issuerUri\n      })\n    } catch (err) {\n      alert(err.message)\n    }\n  }\n\n  /**\n   * Text-based idp selection\n   */\n  const issuerTextContainer = dom.createElement('div')\n  issuerTextContainer.setAttribute(\n    'style',\n    `\n      border-bottom: 1px solid #DDD;\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    `\n  )\n  const issuerTextInputContainer = dom.createElement('div')\n  issuerTextInputContainer.setAttribute(\n    'style',\n    `\n      display: flex;\n      flex-direction: row;\n    `\n  )\n  const issuerTextLabel = dom.createElement('label')\n  issuerTextLabel.innerText = 'Enter the URL of your identity provider:'\n  issuerTextLabel.setAttribute('style', 'color: #888')\n  const issuerTextInput = dom.createElement('input')\n  issuerTextInput.setAttribute('type', 'text')\n  issuerTextInput.setAttribute(\n    'style',\n    'margin-left: 0 !important; flex: 1; margin-right: 5px !important'\n  )\n  issuerTextInput.setAttribute('placeholder', 'https://example.com')\n  issuerTextInput.value = localStorage.getItem('loginIssuer') || ''\n  const issuerTextGoButton = dom.createElement('button')\n  issuerTextGoButton.innerText = 'Go'\n  issuerTextGoButton.setAttribute('style', 'margin-top: 12px; margin-bottom: 12px;')\n  issuerTextGoButton.addEventListener('click', () => {\n    loginToIssuer(issuerTextInput.value)\n  })\n  issuerTextContainer.appendChild(issuerTextLabel)\n  issuerTextInputContainer.appendChild(issuerTextInput)\n  issuerTextInputContainer.appendChild(issuerTextGoButton)\n  issuerTextContainer.appendChild(issuerTextInputContainer)\n  issuerPopupBox.appendChild(issuerTextContainer)\n\n  /**\n   * Button-based idp selection\n   */\n  const issuerButtonContainer = dom.createElement('div')\n  issuerButtonContainer.setAttribute(\n    'style',\n    `\n      display: flex;\n      flex-direction: column;\n      padding-top: 10px;\n    `\n  )\n  const issuerBottonLabel = dom.createElement('label')\n  issuerBottonLabel.innerText = 'Or pick an identity provider from the list below:'\n  issuerBottonLabel.setAttribute('style', 'color: #888')\n  issuerButtonContainer.appendChild(issuerBottonLabel)\n  getSuggestedIssuers().forEach((issuerInfo) => {\n    const issuerButton = dom.createElement('button')\n    issuerButton.innerText = issuerInfo.name\n    issuerButton.setAttribute('style', 'height: 38px; margin-top: 10px')\n    issuerButton.addEventListener('click', () => {\n      loginToIssuer(issuerInfo.uri)\n    })\n    issuerButtonContainer.appendChild(issuerButton)\n  })\n  issuerPopupBox.appendChild(issuerButtonContainer)\n}\n\n/**\n * Login status box\n *\n * A big sign-up/sign in box or a logout box depending on the state\n *\n * @param dom\n * @param listener\n *\n * @returns\n */\nexport function loginStatusBox (\n  dom: HTMLDocument,\n  listener: ((uri: string | null) => void) | null = null,\n  options: {\n    buttonStyle?: string;\n  } = {}\n): HTMLElement {\n  // 20190630\n  let me = offlineTestID()\n  // @@ TODO Remove the need to cast HTML element to any\n  const box: any = dom.createElement('div')\n\n  function setIt (newidURI) {\n    if (!newidURI) {\n      return\n    }\n\n    // const uri = newidURI.uri || newidURI\n    // me = sym(uri)\n    me = authn.saveUser(newidURI)\n    box.refresh()\n    if (listener) listener(me!.uri)\n  }\n\n  function logoutButtonHandler (_event) {\n    const oldMe = me\n    authSession.logout().then(\n      function () {\n        const message = `Your WebID was ${oldMe}. It has been forgotten.`\n        me = null\n        try {\n          alert(message)\n        } catch (e) {\n          window.alert(message)\n        }\n        box.refresh()\n        if (listener) listener(null)\n      },\n      (err) => {\n        alert('Fail to log out:' + err)\n      }\n    )\n  }\n\n  function logoutButton (me, options) {\n    const signInButtonStyle = options.buttonStyle || getDefaultSignInButtonStyle()\n    let logoutLabel = 'WebID logout'\n    if (me) {\n      const nick =\n        solidLogicSingleton.store.any(me, ns.foaf('nick')) ||\n        solidLogicSingleton.store.any(me, ns.foaf('name'))\n      if (nick) {\n        logoutLabel = 'Logout ' + nick.value\n      }\n    }\n    const signOutButton = dom.createElement('input')\n    // signOutButton.className = 'WebIDCancelButton'\n    signOutButton.setAttribute('type', 'button')\n    signOutButton.setAttribute('value', logoutLabel)\n    signOutButton.setAttribute('style', `${signInButtonStyle}background-color: #eee;`)\n    signOutButton.addEventListener('click', logoutButtonHandler, false)\n    return signOutButton\n  }\n\n  box.refresh = function () {\n    const sessionInfo = authSession.info\n    if (sessionInfo && sessionInfo.webId && sessionInfo.isLoggedIn) {\n      me = solidLogicSingleton.store.sym(sessionInfo.webId)\n    } else {\n      me = null\n    }\n    if ((me && box.me !== me.uri) || (!me && box.me)) {\n      widgets.clearElement(box)\n      if (me) {\n        box.appendChild(logoutButton(me, options))\n      } else {\n        box.appendChild(signInOrSignUpBox(dom, setIt, options))\n      }\n    }\n    box.me = me ? me.uri : null\n  }\n  box.refresh()\n\n  function trackSession () {\n    me = authn.currentUser()\n    box.refresh()\n  }\n  trackSession()\n\n  authSession.onLogin(trackSession)\n  authSession.onLogout(trackSession)\n  box.me = '99999' // Force refresh\n  box.refresh()\n  return box\n}\n\nauthSession.onLogout(async () => {\n  const issuer = window.localStorage.getItem('loginIssuer')\n  if (issuer) {\n    try {\n      const wellKnownUri = new URL(issuer)\n      wellKnownUri.pathname = '/.well-known/openid-configuration'\n      const wellKnownResult = await fetch(wellKnownUri.toString())\n      if (wellKnownResult.status === 200) {\n        const openidConfiguration = await wellKnownResult.json()\n        if (openidConfiguration && openidConfiguration.end_session_endpoint) {\n          await fetch(openidConfiguration.end_session_endpoint, { credentials: 'include' })\n        }\n      }\n    } catch (err) {\n      // Do nothing\n    }\n  }\n  window.location.reload()\n})\n\n/**\n * Workspace selection etc\n * See https://github.com/solidos/userguide/issues/16\n */\n\n/**\n * Returns a UI object which, if it selects a workspace,\n * will callback(workspace, newBase).\n * See https://github.com/solidos/userguide/issues/16 for more info on workspaces.\n *\n * If necessary, will get an account, preference file, etc. In sequence:\n *\n *   - If not logged in, log in.\n *   - Load preference file\n *   - Prompt user for workspaces\n *   - Allows the user to just type in a URI by hand\n *\n * Calls back with the workspace and the base URI\n *\n * @param dom\n * @param appDetails\n * @param callbackWS\n */\nexport function selectWorkspace (\n  dom: HTMLDocument,\n  appDetails: AppDetails,\n  callbackWS: (workspace: string | null, newBase: string) => void\n): HTMLElement {\n  const noun = appDetails.noun\n  const appPathSegment = appDetails.appPathSegment\n\n  const me = offlineTestID()\n  const box = dom.createElement('div')\n  const context: AuthenticationContext = { me, dom, div: box }\n\n  function say (s, background) {\n    box.appendChild(widgets.errorMessageBlock(dom, s, background))\n  }\n\n  function figureOutBase (ws) {\n    const newBaseNode: NamedNode = solidLogicSingleton.store.any(\n      ws,\n      ns.space('uriPrefix')\n    ) as NamedNode\n    let newBaseString: string\n    if (!newBaseNode) {\n      newBaseString = ws.uri.split('#')[0]\n    } else {\n      newBaseString = newBaseNode.value\n    }\n    if (newBaseString.slice(-1) !== '/') {\n      debug.log(`${appPathSegment}: No / at end of uriPrefix ${newBaseString}`) // @@ paramater?\n      newBaseString = `${newBaseString}/`\n    }\n    const now = new Date()\n    newBaseString += `${appPathSegment}/id${now.getTime()}/` // unique id\n    return newBaseString\n  }\n\n  function displayOptions (context) {\n    // console.log('displayOptions!', context)\n    async function makeNewWorkspace (_event) {\n      const row = table.appendChild(dom.createElement('tr'))\n      const cell = row.appendChild(dom.createElement('td'))\n      cell.setAttribute('colspan', '3')\n      cell.style.padding = '0.5em'\n      const newBase = encodeURI(\n        await widgets.askName(\n          dom,\n          solidLogicSingleton.store,\n          cell,\n          ns.solid('URL'),\n          ns.space('Workspace'),\n          'Workspace'\n        )\n      )\n      const newWs = widgets.newThing(context.preferencesFile)\n      const newData = [\n        st(context.me, ns.space('workspace'), newWs, context.preferencesFile),\n        // eslint-disable-next-line camelcase\n        st(\n          newWs,\n          ns.space('uriPrefix'),\n          newBase as unknown as Quad_Object,\n          context.preferencesFile\n        )\n      ]\n      if (!solidLogicSingleton.store.updater) {\n        throw new Error('store has no updater')\n      }\n      await solidLogicSingleton.store.updater.update([], newData)\n      // @@ now refresh list of workspaces\n    }\n\n    // const status = ''\n    const id = context.me\n    const preferencesFile = context.preferencesFile\n    let newBase: any = null\n\n    // A workspace specifically defined in the private preference file:\n    let w: any = solidLogicSingleton.store.each(\n      id,\n      ns.space('workspace'),\n      undefined,\n      preferencesFile\n    ) // Only trust preference file here\n\n    // A workspace in a storage in the public profile:\n    const storages = solidLogicSingleton.store.each(id, ns.space('storage')) // @@ No provenance requirement at the moment\n    if (w.length === 0 && storages) {\n      say(\n        `You don't seem to have any workspaces. You have ${storages.length} storage spaces.`,\n        'white'\n      )\n      storages\n        .map(function (s: any) {\n          w = w.concat(solidLogicSingleton.store.each(s, ns.ldp('contains')))\n          return w\n        })\n        .filter((file) => {\n          return file.id ? ['public', 'private'].includes(file.id().toLowerCase()) : ''\n        })\n    }\n\n    if (w.length === 1) {\n      say(`Workspace used: ${w[0].uri}`, 'white') // @@ allow user to see URI\n      newBase = figureOutBase(w[0])\n      // callbackWS(w[0], newBase)\n      // } else if (w.length === 0) {\n    }\n\n    // Prompt for ws selection or creation\n    // say( w.length + \" workspaces for \" + id + \"Choose one.\");\n    const table = dom.createElement('table')\n    table.setAttribute('style', 'border-collapse:separate; border-spacing: 0.5em;')\n\n    // const popup = window.open(undefined, '_blank', { height: 300, width:400 }, false)\n    box.appendChild(table)\n\n    //  Add a field for directly adding the URI yourself\n\n    // const hr = box.appendChild(dom.createElement('hr')) // @@\n    box.appendChild(dom.createElement('hr')) // @@\n\n    const p = box.appendChild(dom.createElement('p'));\n    (p as any).style = commentStyle\n    p.textContent = `Where would you like to store the data for the ${noun}?\n    Give the URL of the folder where you would like the data stored.\n    It can be anywhere in solid world - this URI is just an idea.`\n    // @@ TODO Remove the need to cast baseField to any\n    const baseField: any = box.appendChild(dom.createElement('input'))\n    baseField.setAttribute('type', 'text');\n    (baseField as any).style = textInputStyle\n    baseField.size = 80 // really a string\n    baseField.label = 'base URL'\n    baseField.autocomplete = 'on'\n    if (newBase) {\n      // set to default\n      baseField.value = newBase\n    }\n\n    context.baseField = baseField\n\n    box.appendChild(dom.createElement('br')) // @@\n\n    const button = box.appendChild(dom.createElement('button'));\n    (button as any).style = buttonStyle\n    button.textContent = `Start new ${noun} at this URI`\n    button.addEventListener('click', function (_event) {\n      let newBase = baseField.value.replace(' ', '%20') // do not re-encode in general, as % encodings may exist\n      if (newBase.slice(-1) !== '/') {\n        newBase += '/'\n      }\n      callbackWS(null, newBase)\n    })\n\n    // Now go set up the table of spaces\n\n    // const row = 0\n    w = w.filter(function (x) {\n      return !solidLogicSingleton.store.holds(\n        x,\n        ns.rdf('type'), // Ignore master workspaces\n        ns.space('MasterWorkspace')\n      )\n    })\n    let col1, col2, col3, tr, ws, style, comment\n    const cellStyle = 'height: 3em; margin: 1em; padding: 1em white; border-radius: 0.3em;'\n    const deselectedStyle = `${cellStyle}border: 0px;`\n    // const selectedStyle = cellStyle + 'border: 1px solid black;'\n    for (let i = 0; i < w.length; i++) {\n      ws = w[i]\n      tr = dom.createElement('tr')\n      if (i === 0) {\n        col1 = dom.createElement('td')\n        col1.setAttribute('rowspan', `${w.length}`)\n        col1.textContent = 'Choose a workspace for this:'\n        col1.setAttribute('style', 'vertical-align:middle;')\n        tr.appendChild(col1)\n      }\n      col2 = dom.createElement('td')\n      style = solidLogicSingleton.store.anyValue(ws, ns.ui('style'))\n      if (!style) {\n        // Otherwise make up arbitrary colour\n        const hash = function (x) {\n          return x.split('').reduce(function (a, b) {\n            a = (a << 5) - a + b.charCodeAt(0)\n            return a & a\n          }, 0)\n        }\n        const bgcolor = `#${((hash(ws.uri) & 0xffffff) | 0xc0c0c0).toString(16)}` // c0c0c0  forces pale\n        style = `color: black ; background-color: ${bgcolor};`\n      }\n      col2.setAttribute('style', deselectedStyle + style)\n      tr.target = ws.uri\n      let label = solidLogicSingleton.store.any(ws, ns.rdfs('label'))\n      if (!label) {\n        label = ws.uri.split('/').slice(-1)[0] || ws.uri.split('/').slice(-2)[0]\n      }\n      col2.textContent = label || '???'\n      tr.appendChild(col2)\n      if (i === 0) {\n        col3 = dom.createElement('td')\n        col3.setAttribute('rowspan', `${w.length}1`)\n        // col3.textContent = '@@@@@ remove';\n        col3.setAttribute('style', 'width:50%;')\n        tr.appendChild(col3)\n      }\n      table.appendChild(tr)\n\n      comment = solidLogicSingleton.store.any(ws, ns.rdfs('comment'))\n      comment = comment ? comment.value : 'Use this workspace'\n      col2.addEventListener(\n        'click',\n        function (_event) {\n          col3.textContent = comment ? comment.value : ''\n          col3.setAttribute('style', deselectedStyle + style)\n          const button = dom.createElement('button')\n          button.textContent = 'Continue'\n          // button.setAttribute('style', style);\n          const newBase = figureOutBase(ws)\n          baseField.value = newBase // show user proposed URI\n\n          button.addEventListener(\n            'click',\n            function (_event) {\n              button.disabled = true\n              callbackWS(ws, newBase)\n              button.textContent = '---->'\n            },\n            true\n          ) // capture vs bubble\n          col3.appendChild(button)\n        },\n        true\n      ) // capture vs bubble\n    }\n\n    // last line with \"Make new workspace\"\n    const trLast = dom.createElement('tr')\n    col2 = dom.createElement('td')\n    col2.setAttribute('style', cellStyle)\n    col2.textContent = '+ Make a new workspace'\n    col2.addEventListener('click', makeNewWorkspace)\n    trLast.appendChild(col2)\n    table.appendChild(trLast)\n  } // displayOptions\n\n  // console.log('kicking off async operation')\n  ensureLoadedPreferences(context) // kick off async operation\n    .then(displayOptions)\n    .catch((err) => {\n      // console.log(\"err from async op\")\n      box.appendChild(widgets.errorMessageBlock(context.dom, err))\n    })\n\n  return box // return the box element, while login proceeds\n} // selectWorkspace\n\n/**\n * Creates a new instance of an app.\n *\n * An instance of an app could be e.g. an issue tracker for a given project,\n * or a chess game, or calendar, or a health/fitness record for a person.\n *\n * Note that this use of the term 'app' refers more to entries in the user's\n * type index than to actual software applications that use the personal data\n * to which these entries point.\n *\n * @param dom\n * @param appDetails\n * @param callback\n *\n * @returns A div with a button in it for making a new app instance\n */\nexport function newAppInstance (\n  dom: HTMLDocument,\n  appDetails: AppDetails,\n  callback: (workspace: string | null, newBase: string) => void\n): HTMLElement {\n  const gotWS = function (ws, base) {\n    // log.debug(\"newAppInstance: Selected workspace = \" + (ws? ws.uri : 'none'))\n    callback(ws, base)\n  }\n  const div = dom.createElement('div')\n  const b = dom.createElement('button')\n  b.setAttribute('type', 'button')\n  div.appendChild(b)\n  b.innerHTML = `Make new ${appDetails.noun}`\n  b.addEventListener(\n    'click',\n    (_event) => {\n      div.appendChild(selectWorkspace(dom, appDetails, gotWS))\n    },\n    false\n  )\n  div.appendChild(b)\n  return div\n}\n/**\n * Retrieves whether the currently logged in user is a power user\n * and/or a developer\n */\nexport async function getUserRoles (): Promise<Array<NamedNode>> {\n  try {\n    const { me, preferencesFile, preferencesFileError } = await ensureLoadedPreferences({})\n    if (!preferencesFile || preferencesFileError) {\n      throw new Error(preferencesFileError)\n    }\n    return solidLogicSingleton.store.each(\n      me,\n      ns.rdf('type'),\n      null,\n      preferencesFile.doc()\n    ) as NamedNode[]\n  } catch (error) {\n    debug.warn('Unable to fetch your preferences - this was the error: ', error)\n  }\n  return []\n}\n\n/**\n * Filters which panes should be available, based on the result of [[getUserRoles]]\n */\nexport async function filterAvailablePanes (\n  panes: Array<PaneDefinition>\n): Promise<Array<PaneDefinition>> {\n  const userRoles = await getUserRoles()\n  return panes.filter((pane) => isMatchingAudience(pane, userRoles))\n}\n\nfunction isMatchingAudience (pane: PaneDefinition, userRoles: Array<NamedNode>): boolean {\n  const audience = pane.audience || []\n  return audience.reduce(\n    (isMatch, audienceRole) => isMatch && !!userRoles.find((role) => role.equals(audienceRole)),\n    true as boolean\n  )\n}\n"],"mappings":"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"}