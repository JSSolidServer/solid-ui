{"version":3,"file":"folders.js","names":["debug","_interopRequireWildcard","require","_iconBase","_solidLogic","ns","rdf","style","widgets","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","UI","icons","deleteRecursive","kb","folder","Promise","resolve","_reject","fetcher","load","then","promises","each","ldp","map","file","holds","log","confirm","Error","webOperation","uri","push","all","_res","forAllFiles","action","deleteFolder","store","dom","solidLogicSingleton","docuent","document","div","createElement","table","appendChild","mainTR","p","textContent","concat","buttonsTR","buttonsTD1","buttonsTD3","cancel","cancelButton","addEventListener","_event","parentNode","removeChild","doit","button","iconBase","deleteThem","count","msg"],"sources":["../src/folders.js"],"sourcesContent":["/**      UI To Delete Folder and content\n *\n */\n/* global confirm */\n\nimport * as debug from './debug'\nimport { icons } from './iconBase'\nimport { solidLogicSingleton } from 'solid-logic'\nimport * as ns from './ns'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\nimport * as style from './style'\nimport * as widgets from './widgets'\n\nconst UI = { icons, ns, rdf, style, widgets }\n\nexport function deleteRecursive (kb, folder) {\n  // eslint-disable-next-line promise/param-names\n  return new Promise(function (resolve, _reject) {\n    kb.fetcher.load(folder).then(function () {\n      const promises = kb.each(folder, ns.ldp('contains')).map(file => {\n        if (kb.holds(file, ns.rdf('type'), ns.ldp('BasicContainer'))) {\n          return deleteRecursive(kb, file)\n        } else {\n          debug.log('deleteRecirsive file: ' + file)\n          if (!confirm(' Really DELETE File ' + file)) {\n            throw new Error('User aborted delete file')\n          }\n          return kb.fetcher.webOperation('DELETE', file.uri)\n        }\n      })\n      debug.log('deleteRecirsive folder: ' + folder)\n      if (!confirm(' Really DELETE folder ' + folder)) {\n        throw new Error('User aborted delete file')\n      }\n      promises.push(kb.fetcher.webOperation('DELETE', folder.uri))\n      Promise.all(promises).then(_res => {\n        resolve()\n      })\n    })\n  })\n}\n\n/** Iterate over files depth first\n *\n * @param folder - The folder whose contents we iterate over\n * @param store - The quadstore\n * @param action - returns a promise.  All the promises must be resolved\n */\nfunction forAllFiles (folder, kb, action) {\n  // eslint-disable-next-line promise/param-names\n  return new Promise(function (resolve, _reject) {\n    kb.fetcher.load(folder).then(function () {\n      const promises = kb.each(folder, ns.ldp('contains')).map(file => {\n        if (kb.holds(file, ns.rdf('type'), ns.ldp('BasicContainer'))) {\n          return forAllFiles(file, kb, action)\n        } else {\n          return action(file)\n        }\n      })\n      promises.push(action(folder))\n      Promise.all(promises).then(_res => {\n        resolve()\n      })\n    })\n  })\n}\n\n/** Delete Folder and contents\n *\n * @param {NamedNode} folder - The LDP container to be deleted\n * @param {DOMElement} containingElement - Where to put the user interface\n * @param {IndexedForumula} store - Quadstore (optional)\n * @param {Document} dom - The browser 'document' gloabl or equivalent (or iuse global)\n * @returns {DOMElement} - The control which has eben inserted in the\n */\n/* global document */\nexport function deleteFolder (folder, store, dom) {\n  store = store || solidLogicSingleton.store\n  if (typeof docuent !== 'undefined') {\n    dom = dom || document\n  }\n  const div = dom.createElement('div')\n  const table = div.appendChild(dom.createElement('table'))\n  const mainTR = table.appendChild(dom.createElement('tr'))\n  mainTR.appendChild(dom.createElement('td')) // mainTD\n\n  const p = mainTR.appendChild(dom.createElement('p'))\n  p.textContent = `Are you sure you want to delete the folder ${folder}? This cannot be undone.`\n  const buttonsTR = table.appendChild(dom.createElement('tr'))\n  const buttonsTD1 = buttonsTR.appendChild(dom.createElement('td'))\n  buttonsTR.appendChild(dom.createElement('td')) // buttonsTD2\n  const buttonsTD3 = buttonsTR.appendChild(dom.createElement('td'))\n\n  const cancel = buttonsTD1.appendChild(UI.widgets.cancelButton(dom))\n  cancel.addEventListener(\n    'click',\n    function (_event) {\n      div.parentNode.removeChild(div)\n    },\n    false\n  )\n\n  const doit = buttonsTD3.appendChild(\n    UI.widgets.button(dom, UI.icons.iconBase + 'noun_925021.svg', 'Yes, delete')\n  )\n  doit.addEventListener(\n    'click',\n    function (_event) {\n      deleteThem(folder).then(() => {\n        debug.log('All deleted.')\n      })\n    },\n    false\n  )\n\n  function deleteThem (folder) {\n    return forAllFiles(folder, file =>\n      store.fetcher.webOperation('DELETE', file.uri)\n    )\n  }\n  let count = 0\n  forAllFiles(folder, store, () => {\n    count += 1\n  }) // Count files\n    .then(() => {\n      const msg = ' Files to delete: ' + count\n      debug.log(msg)\n      p.textContent += msg\n    })\n\n  return div\n}\n"],"mappings":"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"}