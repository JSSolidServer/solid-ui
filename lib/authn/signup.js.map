{"version":3,"sources":["../../src/authn/signup.js"],"names":["defaultConfig","require","Signup","config","prototype","listen","promise","Promise","resolve","reject","eventMethod","window","addEventListener","eventListener","messageEvent","e","u","data","slice","user","length","signup","signupUrl","signupEndpoint","width","signupWindowWidth","height","signupWindowHeight","leftPosition","screen","topPosition","windowTitle","windowUrl","encodeURIComponent","location","origin","windowSpecs","open","self","then","webid","module","exports"],"mappings":";;AAAA,IAAIA,aAAa,GAAGC,OAAO,CAAC,kBAAD,CAA3B;AAEA;;;;;AAKA;;;;;;AAIA,SAASC,MAAT,CAAiBC,MAAjB,EAAyB;AACvB,OAAKA,MAAL,GAAcA,MAAM,IAAIH,aAAxB;AACD;AAED;;;;;;;AAKAE,MAAM,CAACE,SAAP,CAAiBC,MAAjB,GAA0B,SAASA,MAAT,GAAmB;AAC3C,MAAIC,OAAO,GAAG,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACnD,QAAIC,WAAW,GAAGC,MAAM,CAACC,gBAAP,GACd,kBADc,GAEd,aAFJ;AAGA,QAAIC,aAAa,GAAGF,MAAM,CAACD,WAAD,CAA1B;AACA,QAAII,YAAY,GAAGJ,WAAW,KAAK,aAAhB,GACf,WADe,GAEf,SAFJ;AAGAG,IAAAA,aAAa,CAACC,YAAD,EAAe,UAAUC,CAAV,EAAa;AACvC,UAAIC,CAAC,GAAGD,CAAC,CAACE,IAAV;;AACA,UAAID,CAAC,CAACE,KAAF,CAAQ,CAAR,EAAW,CAAX,MAAkB,OAAtB,EAA+B;AAC7B,YAAIC,IAAI,GAAGH,CAAC,CAACE,KAAF,CAAQ,CAAR,EAAWF,CAAC,CAACI,MAAb,CAAX;;AACA,YAAID,IAAI,IAAIA,IAAI,CAACC,MAAL,GAAc,CAAtB,IAA2BD,IAAI,CAACD,KAAL,CAAW,CAAX,EAAc,CAAd,MAAqB,MAApD,EAA4D;AAC1D,iBAAOV,OAAO,CAACW,IAAD,CAAd;AACD,SAFD,MAEO;AACL,iBAAOV,MAAM,CAACU,IAAD,CAAb;AACD;AACF;AACF,KAVY,EAUV,IAVU,CAAb;AAWD,GAnBa,CAAd;AAoBA,SAAOb,OAAP;AACD,CAtBD;AAwBA;;;;;;;;;;AAQAJ,MAAM,CAACE,SAAP,CAAiBiB,MAAjB,GAA0B,SAASA,MAAT,CAAiBC,SAAjB,EAA4B;AACpDA,EAAAA,SAAS,GAAGA,SAAS,IAAI,KAAKnB,MAAL,CAAYoB,cAArC;AACA,MAAIC,KAAK,GAAG,KAAKrB,MAAL,CAAYsB,iBAAxB;AACA,MAAIC,MAAM,GAAG,KAAKvB,MAAL,CAAYwB,kBAAzB,CAHoD,CAIpD;;AACA,MAAIC,YAAY,GAAIjB,MAAM,CAACkB,MAAP,CAAcL,KAAd,GAAsB,CAAvB,IAA8BA,KAAK,GAAG,CAAT,GAAc,EAA3C,CAAnB,CALoD,CAMpD;;AACA,MAAIM,WAAW,GAAInB,MAAM,CAACkB,MAAP,CAAcH,MAAd,GAAuB,CAAxB,IAA+BA,MAAM,GAAG,CAAV,GAAe,EAA7C,CAAlB;AACA,MAAIK,WAAW,GAAG,cAAlB;AACA,MAAIC,SAAS,GAAGV,SAAS,GAAG,UAAZ,GACdW,kBAAkB,CAACtB,MAAM,CAACuB,QAAP,CAAgBC,MAAjB,CADpB;AAEA,MAAIC,WAAW,GAAG,uCAAuCZ,KAAvC,GAA+C,UAA/C,GAChBE,MADgB,GACP,QADO,GACIE,YADJ,GACmB,OADnB,GAC6BE,WAD/C;AAEAnB,EAAAA,MAAM,CAAC0B,IAAP,CAAYL,SAAZ,EAAuBD,WAAvB,EAAoCK,WAApC;AACA,MAAIE,IAAI,GAAG,IAAX;AACA,SAAO,IAAI/B,OAAJ,CAAY,UAAUC,OAAV,EAAmB;AACpC8B,IAAAA,IAAI,CAACjC,MAAL,GACGkC,IADH,CACQ,UAAUC,KAAV,EAAiB;AACrB,aAAOhC,OAAO,CAACgC,KAAD,CAAd;AACD,KAHH;AAID,GALM,CAAP;AAMD,CArBD;;AAuBAC,MAAM,CAACC,OAAP,GAAiBxC,MAAjB","sourcesContent":["var defaultConfig = require('./config-default')\n\n/**\n * Provides functionality for signing up with a Solid provider\n * @module signup\n */\n\n/**\n * Creates a Signup UI manager\n * @class\n */\nfunction Signup (config) {\n  this.config = config || defaultConfig\n}\n\n/**\n * Sets up an event listener to monitor login messages from child window/iframe\n * @method listen\n * @return {Promise<String>} Event listener promise, resolves to user's WebID\n */\nSignup.prototype.listen = function listen () {\n  var promise = new Promise(function (resolve, reject) {\n    var eventMethod = window.addEventListener\n      ? 'addEventListener'\n      : 'attachEvent'\n    var eventListener = window[eventMethod]\n    var messageEvent = eventMethod === 'attachEvent'\n      ? 'onmessage'\n      : 'message'\n    eventListener(messageEvent, function (e) {\n      var u = e.data\n      if (u.slice(0, 5) === 'User:') {\n        var user = u.slice(5, u.length)\n        if (user && user.length > 0 && user.slice(0, 4) === 'http') {\n          return resolve(user)\n        } else {\n          return reject(user)\n        }\n      }\n    }, true)\n  })\n  return promise\n}\n\n/**\n * Opens a signup popup window, sets up `listen()`.\n * @method signup\n * @static\n * @param signupUrl {String} Location of a Solid server for user signup.\n * @return {Promise<String>} Returns a listener promise, resolves with signed\n *   up user's WebID.\n */\nSignup.prototype.signup = function signup (signupUrl) {\n  signupUrl = signupUrl || this.config.signupEndpoint\n  var width = this.config.signupWindowWidth\n  var height = this.config.signupWindowHeight\n  // set borders\n  var leftPosition = (window.screen.width / 2) - ((width / 2) + 10)\n  // set title and status bars\n  var topPosition = (window.screen.height / 2) - ((height / 2) + 50)\n  var windowTitle = 'Solid signup'\n  var windowUrl = signupUrl + '?origin=' +\n    encodeURIComponent(window.location.origin)\n  var windowSpecs = 'resizable,scrollbars,status,width=' + width + ',height=' +\n    height + ',left=' + leftPosition + ',top=' + topPosition\n  window.open(windowUrl, windowTitle, windowSpecs)\n  var self = this\n  return new Promise(function (resolve) {\n    self.listen()\n      .then(function (webid) {\n        return resolve(webid)\n      })\n  })\n}\n\nmodule.exports = Signup\n"],"file":"signup.js"}