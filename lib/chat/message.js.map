{"version":3,"file":"message.js","names":["dom","window","document","messageBodyStyle","style","label","utils","elementForImageURI","imageUri","options","img","createElement","height","inlineImageHeightEms","trim","setAttribute","anchor","appendChild","widgets","makeDraggable","$rdf","sym","text","term","a","uri","addEventListener","openHrefInOutlineMode","textContent","nick","person","s","store","any","ns","foaf","value","creatorAndDate","td1","creator","date","message","nickAnchor","fetcher","nowOrWhenFetched","doc","undefined","_ok","_body","creatorAndDateHorizontal","dateBit","fontSize","marginLeft","renderMessageRow","channelObject","fresh","userContext","colorizeByAuthor","dct","latestVersion","mostRecentVersion","content","sioc","originalMessage","originalVersion","edited","sameTerm","sortDate","the","messageRow","AJAR_date","AJAR_subject","authorDateOnLeft","setImage","shortDate","bothDates","td2","isURI","test","para","isImage","expandImagesInline","anc","href","bgcolor","pad","lightColorHash","getBgColor","strip","sentimentStripLinked","children","length","td3","toolsButton","button","icons","iconBase","_event","toolTR","parentNode","removeChild","toolsTR","tools","messageToolbar","nextSibling","parentElement","insertBefore","toolsTD","switchToEditor","messageTable","editRow","renderMessageEditor","originalRow","visibility","revertEditing","messageEditor","handleFieldInput","sendMessage","field","fromMainField","sendComplete","_text2","insertMessageIntoTable","oldRow","debug","warn","backgroundColor","disabled","scrollIntoView","newestFirst","focus","select","updateMessage","statusArea","errorMessageBlock","droppedFileHandler","files","base","chatDocument","dir","uploadFiles","theFile","destURI","droppedURIHandler","uris","turnOnInput","getImageDoc","imageDoc","Date","now","tookPicture","menuButton","menuHandler","buttonStyle","rhs","me","authn","currentUser","menuOptions","div","newBase","event","chatChannel","lhs","middle","innerHTML","rows","anyValue","e","code","shiftKey","shiftEnterSendsMessage","makeDropTarget","sendButton","sendIcon","cancelButton","dateFolder","leafDocumentFromDate","media","cameraButton","recordParticipation","channel","context","ensureLoggedIn","then","Object","assign","findBookmarkDocument","_context"],"sources":["../../src/chat/message.js"],"sourcesContent":["/**  UI code for individual messages: display them, edit them\n *\n * @packageDocumentation\n */\n\n/* global $rdf */\nimport { insertMessageIntoTable } from './infinite'\nimport { messageToolbar, sentimentStripLinked } from './messageTools'\nimport { findBookmarkDocument } from './bookmarks'\nimport { mostRecentVersion, originalVersion } from './chatLogic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { store, authn } from 'solid-logic'\nimport { ensureLoggedIn } from '../login/login'\nimport { media } from '../media/index'\nimport * as ns from '../ns'\nimport * as pad from '../pad'\nimport * as style from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\n\nconst dom = window.document\nconst messageBodyStyle = style.messageBodyStyle\n\nconst label = utils.label\n\n/**\n * HTML component for an image\n */\nexport function elementForImageURI (imageUri, options) {\n  const img = dom.createElement('img')\n  let height = '10'\n  if (options.inlineImageHeightEms) {\n    height = ('' + options.inlineImageHeightEms).trim()\n  }\n  img.setAttribute(\n    'style',\n    'max-height: ' + height + 'em; border-radius: 1em; margin: 0.7em;'\n  )\n  // widgets.makeDropTarget(img, handleURIsDroppedOnMugshot, droppedFileHandler)\n  if (imageUri) img.setAttribute('src', imageUri)\n  const anchor = dom.createElement('a')\n  anchor.setAttribute('href', imageUri)\n  anchor.setAttribute('target', 'images')\n  anchor.appendChild(img)\n  widgets.makeDraggable(img, $rdf.sym(imageUri))\n  return anchor\n}\n\nconst anchor = function (text, term) {\n  // If there is no link return an element anyway\n  const a = dom.createElement('a')\n  if (term && term.uri) {\n    a.setAttribute('href', term.uri)\n    a.addEventListener('click', widgets.openHrefInOutlineMode, true)\n    a.setAttribute('style', 'color: #3B5998; text-decoration: none; ') // font-weight: bold\n  }\n  a.textContent = text\n  return a\n}\n\nfunction nick (person) {\n  const s = store.any(person, ns.foaf('nick'))\n  if (s) return '' + s.value\n  return '' + label(person)\n}\n\n/**\n * Displays creator and date for a chat message\n * inside the `td1` element\n */\nexport function creatorAndDate (td1, creator, date, message) {\n  const nickAnchor = td1.appendChild(anchor(nick(creator), creator))\n  if (creator.uri) {\n    store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n      _ok,\n      _body\n    ) {\n      nickAnchor.textContent = nick(creator)\n    })\n  }\n  td1.appendChild(dom.createElement('br'))\n  td1.appendChild(anchor(date, message))\n}\n\n/**\n * Horizontally displays creator and date for a chat message\n * inside the `td1` element\n */\nexport function creatorAndDateHorizontal (td1, creator, date, message) {\n  const nickAnchor = td1.appendChild(anchor(label(creator), creator))\n  if (creator.uri) {\n    store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n      _ok,\n      _body\n    ) {\n      nickAnchor.textContent = nick(creator)\n    })\n  }\n  const dateBit = td1.appendChild(anchor(date, message))\n  dateBit.style.fontSize = '80%'\n  dateBit.style.marginLeft = '1em'\n  td1.appendChild(dom.createElement('br'))\n}\n\n/**\n * Renders a chat message, read-only mode\n */\nexport function renderMessageRow (channelObject, message, fresh, options, userContext) {\n  const colorizeByAuthor =\n    options.colorizeByAuthor === '1' || options.colorizeByAuthor === true\n\n  const creator = store.any(message, ns.foaf('maker'))\n  const date = store.any(message, ns.dct('created'))\n  const latestVersion = mostRecentVersion(message)\n  const content = store.any(latestVersion, ns.sioc('content'))\n\n  const originalMessage = originalVersion(message)\n  const edited = !message.sameTerm(originalMessage)\n\n  const sortDate = store.the(originalMessage, ns.dct('created'), null, originalMessage.doc()) // In message\n\n  const messageRow = dom.createElement('tr')\n  messageRow.AJAR_date = sortDate.value\n  messageRow.AJAR_subject = message\n\n  const td1 = dom.createElement('td')\n  messageRow.appendChild(td1)\n  if (!options.authorDateOnLeft) {\n    const img = dom.createElement('img')\n    img.setAttribute(\n      'style',\n      'max-height: 2.5em; max-width: 2.5em; border-radius: 0.5em; margin: auto;'\n    )\n    widgets.setImage(img, creator)\n    td1.appendChild(img)\n  } else {\n    creatorAndDate(td1, creator, widgets.shortDate(sortDate.value), message)\n  }\n  let bothDates = widgets.shortDate(sortDate.value)\n  if (edited) {\n    bothDates += ' ... ' + widgets.shortDate(date.value)\n  }\n\n  // Render the content ot the message itself\n  const td2 = messageRow.appendChild(dom.createElement('td'))\n\n  if (!options.authorDateOnLeft) {\n    creatorAndDateHorizontal(\n      td2,\n      creator,\n      bothDates, // widgets.shortDate(dateString)\n      message\n    )\n  }\n  const text = content.value.trim()\n  const isURI = /^https?:\\/[^ <>]*$/i.test(text)\n  let para = null\n  if (isURI) {\n    const isImage = /\\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(text) // @@ Should use content-type not URI\n    if (isImage && options.expandImagesInline) {\n      const img = elementForImageURI(text, options)\n      td2.appendChild(img)\n    } else {\n      // Link but not Image\n      const anc = td2.appendChild(dom.createElement('a'))\n      para = anc.appendChild(dom.createElement('p'))\n      anc.href = text\n      para.textContent = text\n      td2.appendChild(anc)\n    }\n  } else {\n    // text\n    para = dom.createElement('p')\n    td2.appendChild(para)\n    para.textContent = text\n  }\n  if (para) {\n    const bgcolor = colorizeByAuthor\n      ? pad.lightColorHash(creator)\n      : getBgColor(fresh)\n    para.setAttribute(\n      'style',\n      messageBodyStyle + 'background-color: ' + bgcolor + ';'\n    )\n  }\n\n  function getBgColor (fresh) {\n    return fresh ? '#e8ffe8' : 'white'\n  }\n\n  // Sentiment strip\n  const strip = sentimentStripLinked(message, message.doc())\n  if (strip.children.length) {\n    td2.appendChild(dom.createElement('br'))\n    td2.appendChild(strip)\n  }\n\n  // Message tool bar button\n  const td3 = dom.createElement('td')\n  messageRow.appendChild(td3)\n  const toolsButton = widgets.button(\n    dom,\n    icons.iconBase + 'noun_243787.svg',\n    '...'\n  )\n  td3.appendChild(toolsButton)\n  toolsButton.addEventListener('click', function (_event) {\n    if (messageRow.toolTR) {\n      // already got a toolbar? Toogle\n      messageRow.parentNode.removeChild(messageRow.toolTR)\n      delete messageRow.toolTR\n      return\n    }\n    const toolsTR = dom.createElement('tr')\n    const tools = messageToolbar(message, messageRow, userContext, channelObject)\n    tools.style =\n      'border: 0.05em solid #888; border-radius: 0 0 0.7em 0.7em;  border-top: 0; height:3.5em; background-color: #fff;' // @@ fix\n    if (messageRow.nextSibling) {\n      messageRow.parentElement.insertBefore(toolsTR, messageRow.nextSibling)\n    } else {\n      messageRow.parentElement.appendChild(toolsTR)\n    }\n    messageRow.toolTR = toolsTR\n    toolsTR.appendChild(dom.createElement('td')) // left\n    const toolsTD = toolsTR.appendChild(dom.createElement('td'))\n    toolsTR.appendChild(dom.createElement('td')) // right\n    toolsTD.appendChild(tools)\n  })\n  return messageRow\n}\n\nexport function switchToEditor (messageRow, message, channelObject, userContext) {\n  const messageTable = messageRow.parentNode\n  const editRow = renderMessageEditor(channelObject, messageTable, userContext,\n    channelObject.options, mostRecentVersion(message))\n  messageTable.insertBefore(editRow, messageRow)\n  editRow.originalRow = messageRow\n  messageRow.style.visibility = 'hidden' // Hide the original message. unhide if user cancels edit\n}\n/*       Control for a new message -- or editing an old message ***************\n *\n */\nexport function renderMessageEditor (channelObject, messageTable, userContext, options, originalMessage) {\n  function revertEditing (messageEditor) {\n    messageEditor.originalRow.style.visibility = 'visible' // restore read-only version\n    messageEditor.parentNode.removeChild(messageEditor)\n  }\n\n  async function handleFieldInput (_event) {\n    await sendMessage(field.value, true)\n  }\n\n  async function sendMessage (text, fromMainField) {\n    function sendComplete (message, _text2) {\n      // const dateStamp = store.any(message, ns.dct('created'), null, message.doc())\n      // const content = $rdf.literal(text2)\n      insertMessageIntoTable(channelObject, messageTable, message, false, options, userContext) // not green\n\n      if (originalMessage) { // editing another message\n        const oldRow = messageEditor.originalRow\n        // oldRow.style.display = '' // restore read-only version, re-attack\n        if (oldRow.parentNode) {\n          oldRow.parentNode.removeChild(oldRow) // No longer needed old version\n        } else {\n          debug.warn('No parentNode on old message ' + oldRow.textContent)\n          oldRow.style.backgroundColor = '#fee'\n          oldRow.style.visibility = 'hidden' // @@ FIX THIS AND REMOVE FROM DOM INSTEAD\n        }\n        messageEditor.parentNode.removeChild(messageEditor) // no longer need editor\n      } else {\n        if (fromMainField) {\n          field.value = '' // clear from out for reuse\n          field.setAttribute('style', messageBodyStyle)\n          field.disabled = false\n          field.scrollIntoView(options.newestFirst) // allign bottom (top)\n          field.focus() // Start typing next line immediately\n          field.select()\n        }\n      }\n      // await channelObject.div.refresh() // Add new day if nec  @@ add back\n    }\n\n    // const me = authn.currentUser() // Must be logged on or wuld have got login button\n    if (fromMainField) {\n      field.setAttribute('style', messageBodyStyle + 'color: #bbb;') // pendingedit\n      field.disabled = true\n    }\n\n    let message\n    try {\n      message = await channelObject.updateMessage(text, originalMessage)\n    } catch (err) {\n      const statusArea = userContext.statusArea || messageEditor\n      statusArea.appendChild(\n        widgets.errorMessageBlock(dom, 'Error writing message: ' + err)\n      )\n      return\n    }\n    sendComplete(message, text)\n  } // sendMessage\n\n  //    DRAG AND DROP\n  function droppedFileHandler (files) {\n    const base = messageTable.chatDocument.dir().uri\n    widgets.uploadFiles(\n      store.fetcher,\n      files,\n      base + 'Files',\n      base + 'Pictures',\n      async function (theFile, destURI) {\n        // @@@@@@ Wait for each if several\n        await sendMessage(destURI)\n      }\n    )\n  }\n\n  // When a set of URIs are dropped on the field\n  const droppedURIHandler = async function (uris) {\n    for (const uri of uris) {\n      await sendMessage(uri)\n    }\n  }\n\n  // When we are actually logged on\n  function turnOnInput () {\n    function getImageDoc () {\n      imageDoc = $rdf.sym(\n        chatDocument.dir().uri + 'Image_' + Date.now() + '.png'\n      )\n      return imageDoc\n    }\n\n    async function tookPicture (imageDoc) {\n      if (imageDoc) {\n        await sendMessage(imageDoc.uri)\n      }\n    }\n\n    // Body of turnOnInput\n\n    let menuButton\n    if (options.menuHandler) {\n      const menuButton = widgets.button(\n        dom, icons.iconBase + 'noun_243787.svg', 'More')\n      menuButton.setAttribute('style', style.buttonStyle + 'float: right;')\n      // menuButton.addEventListener('click', _event => sendMessage(), false) (done in turnoninput)\n      rhs.appendChild(menuButton)\n    }\n\n    if (options.menuHandler && menuButton) {\n      const me = authn.currentUser()\n      const menuOptions = {\n        me,\n        dom,\n        div: null, // @@ was: div\n        newBase: messageTable.chatDocument.dir().uri\n      }\n      menuButton.addEventListener(\n        'click',\n        event => {\n          options.menuHandler(event, channelObject.chatChannel, menuOptions)\n        },\n        false\n      )\n    }\n\n    const me = authn.currentUser() // If already logged on\n    creatorAndDate(lhs, me, '', null)\n\n    field = dom.createElement('textarea')\n    middle.innerHTML = ''\n    middle.appendChild(field)\n    field.rows = 3\n    if (originalMessage) {\n      field.value = store.anyValue(originalMessage, ns.sioc('content'), null, originalMessage.doc())\n    }\n    // field.cols = 40\n    field.setAttribute('style', messageBodyStyle + 'background-color: #eef;')\n\n    // Trap the Enter BEFORE it is used ti make a newline\n\n    field.addEventListener(\n      'keydown',\n      async function (e) {\n        // User preference?\n        if (e.code === 'Enter') {\n        // if (e.keyCode === 13) { // deprocated https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n          if ((!e.shiftKey && !options.shiftEnterSendsMessage) || (e.shiftKey && options.shiftEnterSendsMessage)) {\n            // Shift-Enter just adds a new line\n            // (note alt-enter doesn't add newline anyway on my setup - so have to use shift.\n            await handleFieldInput(e)\n          }\n        }\n      },\n      false\n    )\n\n    widgets.makeDropTarget(field, droppedURIHandler, droppedFileHandler)\n\n    rhs.innerHTML = ''\n\n    sendButton = widgets.button(dom, sendIcon, 'Send')\n    sendButton.style.float = 'right'\n    sendButton.addEventListener('click', _event => handleFieldInput(), false)\n    rhs.appendChild(sendButton)\n\n    if (originalMessage) { // Are we editing another message?\n      const cancelButton = rhs.appendChild(widgets.cancelButton(dom))\n      cancelButton.style.float = 'left'\n      // cancelButton.firstChild.style.opacity = '0.3' // moved to buttons\n      cancelButton.addEventListener('click', _event => revertEditing(messageEditor), false)\n      rhs.appendChild(cancelButton)\n    }\n\n    const chatDocument = channelObject.dateFolder.leafDocumentFromDate(new Date())\n    let imageDoc\n\n    middle.appendChild(\n      media.cameraButton(dom, store, getImageDoc, tookPicture)\n    )\n\n    pad.recordParticipation(channelObject.channel, channelObject.channel.doc()) // participation =\n  } // turn on inpuut\n\n  // Body of renderMessageEditor\n\n  let sortDate, sendIcon\n  if (originalMessage) {\n    sortDate = store.anyValue(originalMessage, ns.dct('created'), null, originalMessage.doc())\n    // text = store.anyValue(originalMessage, ns.sioc('content'), null, originalMessage.doc())\n    sendIcon = icons.iconBase + 'noun_1180158.svg' // Green check\n    // cancelIcon = icons.iconBase + 'noun_1180156.svg' // Black cross\n  } else {\n    sendIcon = icons.iconBase + 'noun_383448.svg'\n    sortDate = '9999-01-01T00:00:00Z' // ISO format for field sort\n    // text = ''\n  }\n  const messageEditor = dom.createElement('tr')\n  const lhs = dom.createElement('td')\n  const middle = dom.createElement('td')\n  const rhs = dom.createElement('td')\n  messageEditor.appendChild(lhs)\n  messageEditor.appendChild(middle)\n  messageEditor.appendChild(rhs)\n  messageEditor.AJAR_date = sortDate\n  // messageEditor.appendChild(dom.createElement('br'))\n\n  let field, sendButton\n  const context = { div: middle, dom }\n\n  ensureLoggedIn(context).then(context => {\n    // me = context.me\n    turnOnInput()\n    Object.assign(context, userContext)\n    findBookmarkDocument(context).then(_context => {\n      // console.log('Bookmark file: ' + context.bookmarkDocument)\n    })\n  })\n\n  return messageEditor\n} // renderMessageEditor\n"],"mappings":"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"}