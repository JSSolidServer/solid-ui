{"version":3,"file":"message.js","names":["_infinite","require","_messageTools","_bookmarks","_chatLogic","debug","_interopRequireWildcard","_iconBase","_solidLogic","_login","_index","ns","pad","style","utils","widgets","_signature","_keys","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","_typeof","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","F","s","done","value","_e","f","TypeError","normalCompletion","didErr","err","step","next","_e2","minLen","_arrayLikeToArray","toString","slice","constructor","name","from","test","arr","len","arr2","dom","window","document","messageBodyStyle","label","elementForImageURI","imageUri","options","img","createElement","height","inlineImageHeightEms","trim","setAttribute","anchor","appendChild","makeDraggable","$rdf","sym","text","term","uri","addEventListener","openHrefInOutlineMode","textContent","nickname","person","store","any","foaf","creatorAndDate","td1","creator","date","message","nickAnchor","fetcher","nowOrWhenFetched","doc","undefined","_ok","_body","creatorAndDateHorizontal","dateBit","fontSize","marginLeft","renderMessageRow","channelObject","fresh","userContext","unsignedMessage","colorizeByAuthor","dct","latestVersion","mostRecentVersion","latestVersionCreator","msgId","content","sioc","signature","concat","SEC","msg","getBlankMsg","id","created","maker","warn","getPublicKey","then","publicKey","log","regex","match","verifySignature","originalMessage","originalVersion","edited","sameTerm","sortDate","the","messageRow","AJAR_date","AJAR_subject","authorDateOnLeft","setImage","shortDate","bothDates","td2","isURI","para","isImage","expandImagesInline","anc","href","bgcolor","lightColorHash","getBgColor","strip","sentimentStripLinked","children","td3","toolsButton","button","icons","iconBase","_event","toolTR","parentNode","removeChild","toolsTR","tools","messageToolbar","nextSibling","parentElement","insertBefore","toolsTD","switchToEditor","messageTable","editRow","renderMessageEditor","originalRow","visibility","revertEditing","messageEditor","handleFieldInput","_x","_handleFieldInput","apply","arguments","_asyncToGenerator2","_regenerator","mark","_callee5","wrap","_callee5$","_context6","prev","sendMessage","field","stop","_x2","_x3","_sendMessage","_callee6","fromMainField","sendComplete","statusArea","_callee6$","_context7","_sendComplete","_text2","insertMessageIntoTable","oldRow","backgroundColor","disabled","scrollIntoView","newestFirst","focus","select","updateMessage","sent","t0","errorMessageBlock","abrupt","droppedFileHandler","files","base","chatDocument","dir","uploadFiles","_ref","_callee","theFile","destURI","_callee$","_context2","_x4","_x5","droppedURIHandler","_ref2","_callee2","uris","_iterator","_step","_callee2$","_context3","finish","_x6","turnOnInput","getImageDoc","imageDoc","Date","now","tookPicture","_x7","_tookPicture","_callee4","_callee4$","_context5","menuButton","menuHandler","buttonStyle","rhs","me","authn","currentUser","menuOptions","div","newBase","event","chatChannel","lhs","middle","innerHTML","rows","anyValue","_ref3","_callee3","_callee3$","_context4","code","shiftKey","shiftEnterSendsMessage","_x8","makeDropTarget","sendButton","sendIcon","cancelButton","dateFolder","leafDocumentFromDate","media","cameraButton","recordParticipation","channel","context","ensureLoggedIn","assign","findBookmarkDocument","_context"],"sources":["../../src/chat/message.js"],"sourcesContent":["/**  UI code for individual messages: display them, edit them\n *\n * @packageDocumentation\n */\n\n/* global $rdf */\nimport { insertMessageIntoTable } from './infinite'\nimport { messageToolbar, sentimentStripLinked } from './messageTools'\nimport { findBookmarkDocument } from './bookmarks'\nimport { mostRecentVersion, originalVersion } from './chatLogic'\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\nimport { store, authn } from 'solid-logic'\nimport { ensureLoggedIn } from '../login/login'\nimport { media } from '../media/index'\nimport * as ns from '../ns'\nimport * as pad from '../pad'\nimport * as style from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { getBlankMsg, verifySignature, SEC } from './signature'\nimport { getPublicKey } from './keys'\n\nconst dom = window.document\nconst messageBodyStyle = style.messageBodyStyle\n\nconst label = utils.label\n\n/**\n * elementForImageURI\n * HTML component for an image\n * @param imageUri\n * @param options { inlineImageHeightEms }\n * @returns HTMLAnchorElement For Image\n */\nexport function elementForImageURI (imageUri, options) {\n  const img = dom.createElement('img')\n  let height = '10'\n  if (options.inlineImageHeightEms) {\n    height = ('' + options.inlineImageHeightEms).trim()\n  }\n  img.setAttribute(\n    'style',\n    'max-height: ' + height + 'em; border-radius: 1em; margin: 0.7em;'\n  )\n  // widgets.makeDropTarget(img, handleURIsDroppedOnMugshot, droppedFileHandler)\n  if (imageUri) img.setAttribute('src', imageUri)\n  const anchor = dom.createElement('a')\n  anchor.setAttribute('href', imageUri)\n  anchor.setAttribute('target', 'images')\n  anchor.appendChild(img)\n  widgets.makeDraggable(img, $rdf.sym(imageUri))\n  return anchor\n}\n\nconst anchor = function (text, term) {\n  // If there is no link return an element anyway\n  const a = dom.createElement('a')\n  if (term && term.uri) {\n    a.setAttribute('href', term.uri)\n    a.addEventListener('click', widgets.openHrefInOutlineMode, true)\n    a.setAttribute('style', 'color: #3B5998; text-decoration: none; ') // font-weight: bold\n  }\n  a.textContent = text\n  return a\n}\n\nfunction nickname (person) {\n  const s = store.any(person, ns.foaf('nick'))\n  if (s) return '' + s.value\n  return '' + label(person)\n}\n\n/**\n * creatorAndDate\n * Displays creator and date for a chat message\n * inside the `td1` element\n * @param td1\n * @param creator\n * @param date\n * @param message\n * @returns HTMLAnchorElement For Image\n */\nexport function creatorAndDate (td1, creator, date, message) {\n  const nickAnchor = td1.appendChild(anchor(nickname(creator), creator))\n  if (creator.uri) {\n    store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n      _ok,\n      _body\n    ) {\n      nickAnchor.textContent = nickname(creator)\n    })\n  }\n  td1.appendChild(dom.createElement('br'))\n  td1.appendChild(anchor(date, message))\n}\n\n/**\n * creatorAndDateHorizontal\n * Horizontally displays creator and date for a chat message\n * inside the `td1` element\n * @param td1\n * @param creator\n * @param date\n * @param message\n * @returns HTMLAnchorElement For Image\n */\nexport function creatorAndDateHorizontal (td1, creator, date, message) {\n  const nickAnchor = td1.appendChild(anchor(label(creator), creator))\n  if (creator.uri) {\n    store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n      _ok,\n      _body\n    ) {\n      nickAnchor.textContent = nickname(creator)\n    })\n  }\n  const dateBit = td1.appendChild(anchor(date, message))\n  dateBit.style.fontSize = '80%'\n  dateBit.style.marginLeft = '1em'\n  td1.appendChild(dom.createElement('br'))\n}\n\n/**\n * renderMessageRow\n * Renders a chat message, read-only mode\n * @param channelObject\n * @param message\n * @param fresh\n * @param options\n * @param userContext\n * @returns Message Row HTML Table Element\n */\nexport function renderMessageRow (channelObject, message, fresh, options, userContext) {\n  let unsignedMessage = false\n  const colorizeByAuthor =\n    options.colorizeByAuthor === '1' || options.colorizeByAuthor === true\n\n  const creator = store.any(message, ns.foaf('maker'))\n  const date = store.any(message, ns.dct('created'))\n  const latestVersion = mostRecentVersion(message)\n  const latestVersionCreator = store.any(latestVersion, ns.foaf('maker'))\n\n  // use latest content if same owner, else use original\n  const msgId = creator.uri === latestVersionCreator.uri ? latestVersion : message\n  const content = store.any(msgId, ns.sioc('content'))\n  const signature = store.any(msgId, $rdf.sym(`${SEC}proofValue`))\n\n  // set message object\n  const msg = getBlankMsg()\n  msg.id = msgId.uri\n  msg.created = store.any(msgId, ns.dct('created')).value\n  msg.content = content.value\n  msg.maker = creator.uri\n\n  // unsigned message\n  if (!signature?.value) {\n    unsignedMessage = true\n    debug.warn(msgId.uri + ' is unsigned') // TODO replace with UI (colored message ?)\n  } else { // signed message, get public key and check signature\n    getPublicKey(creator).then(publicKey => {\n      debug.log(creator.uri + '\\n' + msg.created + '\\n' + msg.id + '\\n' + publicKey)\n      if (!publicKey) {\n        // TODO try to recreate the publicKey\n        // if(me.uri === creator.uri) await getPrivateKey(creator)\n        debug.warn('message is signed but ' + creator.uri + ' is missing publicKey')\n      }\n      // check that publicKey is a valid hex string\n      const regex = /[0-9A-Fa-f]{6}/g\n      if (!publicKey?.match(regex)) debug.warn('invalid publicKey hex string\\n' + creator.uri + '\\n' + publicKey)\n      // verify signature\n      else if (signature?.value && !verifySignature(signature?.value, msg, publicKey)) debug.warn('invalid signature\\n' + msg.id)\n    })\n  }\n\n  const originalMessage = originalVersion(message)\n  const edited = !message.sameTerm(originalMessage)\n\n  const sortDate = store.the(originalMessage, ns.dct('created'), null, originalMessage.doc()) // In message\n\n  const messageRow = dom.createElement('tr')\n  if (unsignedMessage) messageRow.setAttribute('style', 'background-color: red')\n  messageRow.AJAR_date = sortDate.value\n  messageRow.AJAR_subject = message\n\n  const td1 = dom.createElement('td')\n  messageRow.appendChild(td1)\n  if (!options.authorDateOnLeft) {\n    const img = dom.createElement('img')\n    img.setAttribute(\n      'style',\n      'max-height: 2.5em; max-width: 2.5em; border-radius: 0.5em; margin: auto;'\n    )\n    widgets.setImage(img, creator)\n    td1.appendChild(img)\n  } else {\n    creatorAndDate(td1, creator, widgets.shortDate(sortDate.value), message)\n  }\n  let bothDates = widgets.shortDate(sortDate.value)\n  if (edited) {\n    bothDates += ' ... ' + widgets.shortDate(date.value)\n  }\n\n  // Render the content ot the message itself\n  const td2 = messageRow.appendChild(dom.createElement('td'))\n\n  if (!options.authorDateOnLeft) {\n    creatorAndDateHorizontal(\n      td2,\n      creator,\n      bothDates, // widgets.shortDate(dateString)\n      message\n    )\n  }\n  const text = content.value.trim()\n  const isURI = /^https?:\\/[^ <>]*$/i.test(text)\n  let para = null\n  if (isURI) {\n    const isImage = /\\.(gif|jpg|jpeg|tiff|png|svg)$/i.test(text) // @@ Should use content-type not URI\n    if (isImage && options.expandImagesInline) {\n      const img = elementForImageURI(text, options)\n      td2.appendChild(img)\n    } else {\n      // Link but not Image\n      const anc = td2.appendChild(dom.createElement('a'))\n      para = anc.appendChild(dom.createElement('p'))\n      anc.href = text\n      para.textContent = text\n      td2.appendChild(anc)\n    }\n  } else {\n    // text\n    para = dom.createElement('p')\n    td2.appendChild(para)\n    para.textContent = text\n  }\n  if (para) {\n    const bgcolor = colorizeByAuthor\n      ? pad.lightColorHash(creator)\n      : getBgColor(fresh)\n    para.setAttribute(\n      'style',\n      messageBodyStyle + 'background-color: ' + bgcolor + ';'\n    )\n  }\n\n  function getBgColor (fresh) {\n    return fresh ? '#e8ffe8' : 'white'\n  }\n\n  // Sentiment strip\n  const strip = sentimentStripLinked(message, message.doc())\n  if (strip.children.length) {\n    td2.appendChild(dom.createElement('br'))\n    td2.appendChild(strip)\n  }\n\n  // Message tool bar button\n  const td3 = dom.createElement('td')\n  messageRow.appendChild(td3)\n  const toolsButton = widgets.button(\n    dom,\n    icons.iconBase + 'noun_243787.svg',\n    '...'\n  )\n  td3.appendChild(toolsButton)\n  toolsButton.addEventListener('click', function (_event) {\n    if (messageRow.toolTR) {\n      // already got a toolbar? Toogle\n      messageRow.parentNode.removeChild(messageRow.toolTR)\n      delete messageRow.toolTR\n      return\n    }\n    const toolsTR = dom.createElement('tr')\n    const tools = messageToolbar(message, messageRow, userContext, channelObject)\n    tools.style =\n      'border: 0.05em solid #888; border-radius: 0 0 0.7em 0.7em;  border-top: 0; height:3.5em; background-color: #fff;' // @@ fix\n    if (messageRow.nextSibling) {\n      messageRow.parentElement.insertBefore(toolsTR, messageRow.nextSibling)\n    } else {\n      messageRow.parentElement.appendChild(toolsTR)\n    }\n    messageRow.toolTR = toolsTR\n    toolsTR.appendChild(dom.createElement('td')) // left\n    const toolsTD = toolsTR.appendChild(dom.createElement('td'))\n    toolsTR.appendChild(dom.createElement('td')) // right\n    toolsTD.appendChild(tools)\n  })\n  return messageRow\n} // END OF RENDERMESSAGE\n\nexport function switchToEditor (messageRow, message, channelObject, userContext) {\n  const messageTable = messageRow.parentNode\n  const editRow = renderMessageEditor(channelObject, messageTable, userContext,\n    channelObject.options, mostRecentVersion(message))\n  messageTable.insertBefore(editRow, messageRow)\n  editRow.originalRow = messageRow\n  messageRow.style.visibility = 'hidden' // Hide the original message. unhide if user cancels edit\n}\n/*       Control for a new message -- or editing an old message ***************\n *\n */\nexport function renderMessageEditor (channelObject, messageTable, userContext, options, originalMessage) {\n  function revertEditing (messageEditor) {\n    messageEditor.originalRow.style.visibility = 'visible' // restore read-only version\n    messageEditor.parentNode.removeChild(messageEditor)\n  }\n\n  async function handleFieldInput (_event) {\n    await sendMessage(field.value, true)\n  }\n\n  async function sendMessage (text, fromMainField) {\n    function sendComplete (message, _text2) {\n      insertMessageIntoTable(channelObject, messageTable, message, false, options, userContext) // not green\n\n      if (originalMessage) { // editing another message\n        const oldRow = messageEditor.originalRow\n        // oldRow.style.display = '' // restore read-only version, re-attack\n        if (oldRow.parentNode) {\n          oldRow.parentNode.removeChild(oldRow) // No longer needed old version\n        } else {\n          debug.warn('No parentNode on old message ' + oldRow.textContent)\n          oldRow.style.backgroundColor = '#fee'\n          oldRow.style.visibility = 'hidden' // @@ FIX THIS AND REMOVE FROM DOM INSTEAD\n        }\n        messageEditor.parentNode.removeChild(messageEditor) // no longer need editor\n      } else {\n        if (fromMainField) {\n          field.value = '' // clear from out for reuse\n          field.setAttribute('style', messageBodyStyle)\n          field.disabled = false\n          field.scrollIntoView(options.newestFirst) // allign bottom (top)\n          field.focus() // Start typing next line immediately\n          field.select()\n        }\n      }\n      // await channelObject.div.refresh() // Add new day if nec  @@ add back\n    }\n\n    // const me = authn.currentUser() // Must be logged on or wuld have got login button\n    if (fromMainField) {\n      field.setAttribute('style', messageBodyStyle + 'color: #bbb;') // pendingedit\n      field.disabled = true\n    }\n\n    let message\n    try {\n      message = await channelObject.updateMessage(text, originalMessage)\n    } catch (err) {\n      const statusArea = userContext.statusArea || messageEditor\n      statusArea.appendChild(\n        widgets.errorMessageBlock(dom, 'Error writing message: ' + err)\n      )\n      return\n    }\n    sendComplete(message, text)\n  } // sendMessage\n\n  //    DRAG AND DROP\n  function droppedFileHandler (files) {\n    const base = messageTable.chatDocument.dir().uri\n    widgets.uploadFiles(\n      store.fetcher,\n      files,\n      base + 'Files',\n      base + 'Pictures',\n      async function (theFile, destURI) {\n        // @@@@@@ Wait for each if several\n        await sendMessage(destURI)\n      }\n    )\n  }\n\n  // When a set of URIs are dropped on the field\n  const droppedURIHandler = async function (uris) {\n    for (const uri of uris) {\n      await sendMessage(uri)\n    }\n  }\n\n  // When we are actually logged on\n  function turnOnInput () {\n    function getImageDoc () {\n      imageDoc = $rdf.sym(\n        chatDocument.dir().uri + 'Image_' + Date.now() + '.png'\n      )\n      return imageDoc\n    }\n\n    async function tookPicture (imageDoc) {\n      if (imageDoc) {\n        await sendMessage(imageDoc.uri)\n      }\n    }\n\n    // Body of turnOnInput\n\n    let menuButton\n    if (options.menuHandler) {\n      const menuButton = widgets.button(\n        dom, icons.iconBase + 'noun_243787.svg', 'More')\n      menuButton.setAttribute('style', style.buttonStyle + 'float: right;')\n      // menuButton.addEventListener('click', _event => sendMessage(), false) (done in turnoninput)\n      rhs.appendChild(menuButton)\n    }\n\n    if (options.menuHandler && menuButton) {\n      const me = authn.currentUser()\n      const menuOptions = {\n        me,\n        dom,\n        div: null, // @@ was: div\n        newBase: messageTable.chatDocument.dir().uri\n      }\n      menuButton.addEventListener(\n        'click',\n        event => {\n          options.menuHandler(event, channelObject.chatChannel, menuOptions)\n        },\n        false\n      )\n    }\n\n    const me = authn.currentUser() // If already logged on\n    creatorAndDate(lhs, me, '', null)\n\n    field = dom.createElement('textarea')\n    middle.innerHTML = ''\n    middle.appendChild(field)\n    field.rows = 3\n    if (originalMessage) {\n      field.value = store.anyValue(originalMessage, ns.sioc('content'), null, originalMessage.doc())\n    }\n    // field.cols = 40\n    field.setAttribute('style', messageBodyStyle + 'background-color: #eef;')\n\n    // Trap the Enter BEFORE it is used ti make a newline\n\n    field.addEventListener(\n      'keydown',\n      async function (e) {\n        // User preference?\n        if (e.code === 'Enter') {\n        // if (e.keyCode === 13) { // deprocated https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/keyCode\n          if ((!e.shiftKey && !options.shiftEnterSendsMessage) || (e.shiftKey && options.shiftEnterSendsMessage)) {\n            // Shift-Enter just adds a new line\n            // (note alt-enter doesn't add newline anyway on my setup - so have to use shift.\n            await handleFieldInput(e)\n          }\n        }\n      },\n      false\n    )\n\n    widgets.makeDropTarget(field, droppedURIHandler, droppedFileHandler)\n\n    rhs.innerHTML = ''\n\n    sendButton = widgets.button(dom, sendIcon, 'Send')\n    sendButton.style.float = 'right'\n    sendButton.addEventListener('click', _event => handleFieldInput(), false)\n    rhs.appendChild(sendButton)\n\n    if (originalMessage) { // Are we editing another message?\n      const cancelButton = rhs.appendChild(widgets.cancelButton(dom))\n      cancelButton.style.float = 'left'\n      // cancelButton.firstChild.style.opacity = '0.3' // moved to buttons\n      cancelButton.addEventListener('click', _event => revertEditing(messageEditor), false)\n      rhs.appendChild(cancelButton)\n    }\n\n    const chatDocument = channelObject.dateFolder.leafDocumentFromDate(new Date())\n    let imageDoc\n\n    middle.appendChild(\n      media.cameraButton(dom, store, getImageDoc, tookPicture)\n    )\n\n    pad.recordParticipation(channelObject.channel, channelObject.channel.doc()) // participation =\n  } // turn on inpuut\n\n  // Body of renderMessageEditor\n\n  let sortDate, sendIcon\n  if (originalMessage) {\n    sortDate = store.anyValue(originalMessage, ns.dct('created'), null, originalMessage.doc())\n    // text = store.anyValue(originalMessage, ns.sioc('content'), null, originalMessage.doc())\n    sendIcon = icons.iconBase + 'noun_1180158.svg' // Green check\n    // cancelIcon = icons.iconBase + 'noun_1180156.svg' // Black cross\n  } else {\n    sendIcon = icons.iconBase + 'noun_383448.svg'\n    sortDate = '9999-01-01T00:00:00Z' // ISO format for field sort\n    // text = ''\n  }\n  const messageEditor = dom.createElement('tr')\n  const lhs = dom.createElement('td')\n  const middle = dom.createElement('td')\n  const rhs = dom.createElement('td')\n  messageEditor.appendChild(lhs)\n  messageEditor.appendChild(middle)\n  messageEditor.appendChild(rhs)\n  messageEditor.AJAR_date = sortDate\n  // messageEditor.appendChild(dom.createElement('br'))\n\n  let field, sendButton\n  const context = { div: middle, dom }\n\n  ensureLoggedIn(context).then(context => {\n    // me = context.me\n    turnOnInput()\n    Object.assign(context, userContext)\n    findBookmarkDocument(context).then(_context => {\n      // console.log('Bookmark file: ' + context.bookmarkDocument)\n    })\n  })\n\n  return messageEditor\n} // renderMessageEditor\n"],"mappings":"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"}