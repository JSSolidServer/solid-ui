{"version":3,"file":"messageTools.js","names":["dom","window","document","PENCIL_ICON","THUMBS_UP_ICON","THUMBS_DOWN_ICON","emoji","ns","schema","sentimentStrip","target","doc","latest","mostRecentVersion","actions","store","holds","value","each","sentiments","map","a","any","rdf","sort","strings","x","createTextNode","join","sentimentStripLinked","strip","createElement","refresh","innerHTML","uri","forEach","ss","theClass","agent","res","setAttribute","textContent","appendChild","messageToolbar","message","messageRow","userContext","channelObject","deleteMessage","author","foaf","me","alert","sameTerm","msg","debug","warn","area","statusArea","parentNode","widgets","errorMessageBlock","removeChild","closeToolbar","editMessage","switchToEditor","div","parentElement","deleteThingThen","updater","update","connectedStatements","authn","currentUser","deleteButtonWithCheck","button","icons","iconBase","renderBookmarksButton","then","bookmarkButton","sentimentButton","context","icon","actionClass","mutuallyExclusive","setColor","style","backgroundColor","action","utils","label","_event","newThing","insertMe","st","dirty","i","length","existingAction","refreshTree","filter","context1","cancelButton","firstChild","opacity","addEventListener"],"sources":["../../src/chat/messageTools.js"],"sourcesContent":["/**\n * Tools for doing things with a message\n * Let us be creative here.  Allow all sorts of things to\n * be done to a message - linking to new or old objects in an open way\n *\n * Ideas: Bookmark, Like, star, pin at top of chat, reply as new thread,\n * If you made it originally: edit, delete, attach\n * @packageDocumentation\n */\nimport * as debug from '../debug'\nimport { icons } from '../iconBase'\n// import { media } from '../media/index'\nimport * as ns from '../ns'\n// import * as pad from '../pad'\nimport * as rdf from 'rdflib' // pull in first avoid cross-refs\n// import * as style from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\nimport { renderBookmarksButton } from './bookmarks'\nimport { authn, store } from 'solid-logic'\n\nimport { mostRecentVersion } from './chatLogic'\nimport { switchToEditor } from './message'\n\nconst dom = window.document\n\n// THE UNUSED ICONS are here as reminders for possible future functionality\n// const BOOKMARK_ICON = 'noun_45961.svg'\n// const HEART_ICON = 'noun_130259.svg' -> Add this to my (private) favorites\n// const MENU_ICON = 'noun_897914.svg'\n// const PAPERCLIP_ICON = 'noun_25830.svg' -> add attachments to this message\n// const PIN_ICON = 'noun_562340.svg'  -> pin this message permanently in the chat UI\nconst PENCIL_ICON = 'noun_253504.svg' // edit a message\n// const SPANNER_ICON = 'noun_344563.svg' -> settings\nconst THUMBS_UP_ICON = 'noun_1384132.svg'\nconst THUMBS_DOWN_ICON = 'noun_1384135.svg'\n/**\n * Emoji in Unicode\n */\nconst emoji = {}\nemoji[ns.schema('AgreeAction')] = '👍'\nemoji[ns.schema('DisagreeAction')] = '👎'\nemoji[ns.schema('EndorseAction')] = '⭐️'\nemoji[ns.schema('LikeAction')] = '❤️'\n\n/**\n * Create strip of sentiments expressed\n */\nexport function sentimentStrip (target, doc) { // alain seems not used\n  const latest = mostRecentVersion(target)\n  const actions = store.holds(latest, ns.schema('dateDeleted').value, null, latest.doc()) ? store.each(null, ns.schema('target'), target, doc) : []\n  const sentiments = actions.map(a => store.any(a, ns.rdf('type'), null, doc))\n  sentiments.sort()\n  const strings = sentiments.map(x => emoji[x] || '')\n  return dom.createTextNode(strings.join(' '))\n}\n/**\n * Create strip of sentiments expressed, with hyperlinks\n *\n * @param target {NamedNode} - The thing about which they are expressed\n * @param doc {NamedNode} - The document in which they are expressed\n */\nexport function sentimentStripLinked (target, doc) {\n  const strip = dom.createElement('span')\n  function refresh () {\n    strip.innerHTML = ''\n    const actions = (mostRecentVersion(target).uri !== ns.schema('dateDeleted').uri) ? store.each(null, ns.schema('target'), target, doc) : []\n    const sentiments = actions.map(a => [\n      store.any(a, ns.rdf('type'), null, doc),\n      store.any(a, ns.schema('agent'), null, doc)\n    ])\n    sentiments.sort()\n    sentiments.forEach(ss => {\n      const [theClass, agent] = ss\n      let res\n      if (agent) {\n        res = dom.createElement('a')\n        res.setAttribute('href', agent.uri)\n      } else {\n        res = dom.createTextNode('')\n      }\n      res.textContent = emoji[theClass] || '*'\n      strip.appendChild(res)\n    })\n  }\n  refresh()\n  strip.refresh = refresh\n  return strip\n}\n/**\n * Creates a message toolbar component\n */\nexport function messageToolbar (message, messageRow, userContext, channelObject) {\n  async function deleteMessage () {\n    const author = store.any(message, ns.foaf('maker'))\n    if (!me) {\n      alert('You can\\'t delete the message, you are not logged in.')\n    } else if (me.sameTerm(author)) {\n      try {\n        await channelObject.deleteMessage(message)\n      } catch (err) {\n        const msg = 'Error deleting messaage ' + err\n        debug.warn(msg)\n        alert(msg)\n        const area = userContext.statusArea || messageRow.parentNode\n        area.appendChild(widgets.errorMessageBlock(dom, msg))\n      }\n      messageRow.parentNode.removeChild(messageRow)\n    } else {\n      alert('You can\\'t delete the message, you are not logged in as the author, ' + author)\n    }\n    closeToolbar()\n  }\n\n  async function editMessage (messageRow) {\n    if (me.value === store.any(message, ns.foaf('maker')).value) {\n      closeToolbar() // edit is a one-off action\n      switchToEditor(messageRow, message, channelObject, userContext)\n    }\n  }\n\n  // alain TODO allow chat owner to fully delete message + sentiments and replacing messages\n\n  const div = dom.createElement('div')\n  // is message deleted ?\n  if (mostRecentVersion(message).value === ns.schema('dateDeleted').value) return div\n  function closeToolbar () {\n    div.parentElement.parentElement.removeChild(div.parentElement) // remive the TR\n  }\n\n  async function deleteThingThen (x) {\n    await store.updater.update(store.connectedStatements(x), [])\n  }\n\n  // Things only the original author can do\n  let me = authn.currentUser() // If already logged on\n  if (me && store.holds(message, ns.foaf('maker'), me)) {\n    // button to delete the message\n    div.appendChild(widgets.deleteButtonWithCheck(dom, div, 'message', deleteMessage))\n    // button to edit the message\n    div.appendChild(widgets.button(dom, icons.iconBase + PENCIL_ICON, 'edit', () => editMessage(messageRow)))\n  } // if mine\n  // Things anyone can do if they have a bookmark list async\n  /*\n var bookmarkButton = await bookmarks.renderBookmarksButton(userContext)\n if (bookmarkButton) {\n   div.appendChild(bookmarkButton)\n }\n */\n  // Things anyone can do if they have a bookmark list\n\n  renderBookmarksButton(userContext).then(bookmarkButton => {\n    if (bookmarkButton) div.appendChild(bookmarkButton)\n  })\n\n  /**   Button to allow user to express a sentiment (like, endorse, etc) about a target\n   *\n   * @param context {Object} - Provide dom and me\n   * @param target {NamedNode} - The thing the user expresses an opnion about\n   * @param icon {uristring} - The icon to be used for the button\n   * @param actionClass {NamedNode} - The RDF class  - typically a subclass of schema:Action\n   * @param doc - {NamedNode} - the Solid document iunto which the data should be written\n   * @param mutuallyExclusive {Array<NamedNode>} - Any RDF classes of sentimentswhich are mutiually exclusive\n   */\n  function sentimentButton (\n    context,\n    target,\n    icon,\n    actionClass,\n    doc,\n    mutuallyExclusive\n  ) {\n    function setColor () {\n      button.style.backgroundColor = action ? 'yellow' : 'white'\n    }\n    const button = widgets.button(\n      dom,\n      icon,\n      utils.label(actionClass),\n      async function (_event) {\n        if (action) {\n          await deleteThingThen(action)\n          action = null\n          setColor()\n        } else {\n          // no action\n          action = widgets.newThing(doc)\n          const insertMe = [\n            rdf.st(action, ns.schema('agent'), context.me, doc),\n            rdf.st(action, ns.rdf('type'), actionClass, doc),\n            rdf.st(action, ns.schema('target'), target, doc)\n          ]\n          await store.updater.update([], insertMe)\n          setColor()\n\n          if (mutuallyExclusive) {\n            // Delete incompative sentiments\n            let dirty = false\n            for (let i = 0; i < mutuallyExclusive.length; i++) {\n              const a = existingAction(mutuallyExclusive[i])\n              if (a) {\n                await deleteThingThen(a) // but how refresh? refreshTree the parent?\n                dirty = true\n              }\n            }\n            if (dirty) {\n              // widgets.refreshTree(button.parentNode) // requires them all to be immediate siblings\n              widgets.refreshTree(messageRow) // requires them all to be immediate siblings\n            }\n          }\n        }\n      }\n    )\n    function existingAction (actionClass) {\n      const actions = store\n        .each(null, ns.schema('agent'), context.me, doc)\n        .filter(x => store.holds(x, ns.rdf('type'), actionClass, doc))\n        .filter(x => store.holds(x, ns.schema('target'), target, doc))\n      return actions.length ? actions[0] : null\n    }\n    function refresh () {\n      action = existingAction(actionClass)\n      setColor()\n    }\n    let action\n    button.refresh = refresh // If the file changes, refresh live\n    refresh()\n    return button\n  }\n\n  // THUMBS_UP_ICON\n  // https://schema.org/AgreeAction\n  me = authn.currentUser() // If already logged on\n  // debug.log('Actions 3' + mostRecentVersion(message).value + ' ' + ns.schema('dateDeleted').value + ' ' + (mostRecentVersion(message).value !== ns.schema('dateDeleted').value))\n\n  if (me && (mostRecentVersion(message).value !== ns.schema('dateDeleted').value)) {\n    const context1 = { me, dom, div }\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message, // @@ TODO use widgets.sentimentButton\n        icons.iconBase + THUMBS_UP_ICON,\n        ns.schema('AgreeAction'),\n        message.doc(),\n        [ns.schema('DisagreeAction')]\n      )\n    )\n    // Thumbs down\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message,\n        icons.iconBase + THUMBS_DOWN_ICON,\n        ns.schema('DisagreeAction'),\n        message.doc(),\n        [ns.schema('AgreeAction')]\n      )\n    )\n  }\n  // X button to remove the tool UI itself\n  const cancelButton = div.appendChild(widgets.cancelButton(dom))\n  cancelButton.style.float = 'right'\n  cancelButton.firstChild.style.opacity = '0.3'\n  cancelButton.addEventListener('click', closeToolbar)\n  return div\n}\n"],"mappings":"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"}