{"version":3,"file":"thread.js","names":["_iconBase","require","_solidLogic","_index","ns","_interopRequireWildcard","login","pad","$rdf","style","utils","widgets","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","_typeof","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","UI","icons","media","thread","dom","kb","subject","messageStore","options","store","doc","WF","Namespace","DCT","newestFirst","messageBodyStyle","div","createElement","messageTable","me","updater","anchor","text","term","a","uri","setAttribute","addEventListener","openHrefInOutlineMode","textContent","mention","message","pre","appendChild","createTextNode","announce","log","warn","error","newMessageForm","form","lhs","middle","rhs","AJAR_date","sendMessage","field","disabled","_appendMsg","appendMsg","value","dateStamp","sts","sendComplete","success","body","errorMessageBlock","bindings","literal","renderMessage","update","sendButton","turnOnInput","creatorAndDate","innerHTML","rows","e","keyCode","altKey","button","iconBase","buttonStyle","context","ensureLoggedIn","then","fieldValue","oldMsg","arguments","length","undefined","now","Date","timestamp","getTime","sym","push","Statement","mostRecentVersion","wf","msgBody","concat","nick","sioc","foaf","person","s","any","label","td1","creator","date","nickAnchor","fetcher","nowOrWhenFetched","_ok","_body","syncMessages","about","displayed","ele","ele2","firstChild","nextSibling","AJAR_subject","messages","each","stored","forEach","m","addMessage","removeChild","msg","statementsMatching","_deleteMessage","_ref","_asyncToGenerator2","_regenerator","mark","_callee","deletions","wrap","_callee$","_context","prev","next","connectedStatements","sent","ok","stop","_x","apply","fresh","content","dateString","tr","done","insertBefore","shortDate","td2","td3","delButton","_event","cancelButton","sureButton","_appendMsg2","query","Query","v","vs","x","vars","variable","pat","add","dct","doneQuery","refresh"],"sources":["../../src/chat/thread.js"],"sourcesContent":["/**\n * Contains the [[thread]] function\n * @packageDocumentation\n */\n\nimport { icons } from '../iconBase'\nimport { store } from 'solid-logic'\nimport { media } from '../media/index'\nimport * as ns from '../ns'\nimport * as login from '../login/login'\nimport * as pad from '../pad'\nimport * as $rdf from 'rdflib' // pull in first avoid cross-refs\nimport * as style from '../style'\nimport * as utils from '../utils'\nimport * as widgets from '../widgets'\n\nconst UI = { icons, ns, media, pad, style, utils, widgets }\n\n/**\n * HTML component for a chat thread\n */\nexport function thread (dom, kb, subject, messageStore, options) {\n  kb = kb || store\n  messageStore = messageStore.doc() // No hash\n  const ns = UI.ns\n  const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n  const DCT = $rdf.Namespace('http://purl.org/dc/terms/')\n\n  options = options || {}\n\n  const newestFirst = !!options.newestFirst\n\n  const messageBodyStyle =\n    'white-space: pre-wrap; width: 90%; font-size:100%; border: 0.07em solid #eee; padding: .2em 0.5em; margin: 0.1em 1em 0.1em 1em;'\n  // 'font-size: 100%; margin: 0.1em 1em 0.1em 1em;  background-color: white; white-space: pre-wrap; padding: 0.1em;'\n\n  const div = dom.createElement('div')\n  // eslint-disable-next-line prefer-const\n  let messageTable // Shared by initial build and addMessageFromBindings\n\n  let me\n\n  const updater = store.updater\n\n  const anchor = function (text, term) {\n    // If there is no link return an element anyway\n    const a = dom.createElement('a')\n    if (term && term.uri) {\n      a.setAttribute('href', term.uri)\n      a.addEventListener('click', UI.widgets.openHrefInOutlineMode, true)\n      a.setAttribute('style', 'color: #3B5998; text-decoration: none; ') // font-weight: bold\n    }\n    a.textContent = text\n    return a\n  }\n\n  const mention = function mention (message, style) {\n    const pre = dom.createElement('pre')\n    pre.setAttribute('style', style || 'color: grey')\n    div.appendChild(pre)\n    pre.appendChild(dom.createTextNode(message))\n    return pre\n  }\n\n  const announce = {\n    log: function (message) {\n      mention(message, 'color: #111;')\n    },\n    warn: function (message) {\n      mention(message, 'color: #880;')\n    },\n    error: function (message) {\n      mention(message, 'color: #800;')\n    }\n  }\n\n  /**\n   * Form for a new message\n   */\n  const newMessageForm = function () {\n    const form = dom.createElement('tr')\n    const lhs = dom.createElement('td')\n    const middle = dom.createElement('td')\n    const rhs = dom.createElement('td')\n    form.appendChild(lhs)\n    form.appendChild(middle)\n    form.appendChild(rhs)\n    form.AJAR_date = '9999-01-01T00:00:00Z' // ISO format for field sort\n\n    const sendMessage = function () {\n      // titlefield.setAttribute('class','pendingedit')\n      // titlefield.disabled = true\n      field.setAttribute('class', 'pendingedit')\n      field.disabled = true\n      const { message, dateStamp, sts } = appendMsg(field.value)\n\n      const sendComplete = function (uri, success, body) {\n        if (!success) {\n          form.appendChild(\n            UI.widgets.errorMessageBlock(dom, 'Error writing message: ' + body)\n          )\n        } else {\n          const bindings = {\n            '?msg': message,\n            '?content': store.literal(field.value),\n            '?date': dateStamp,\n            '?creator': me\n          }\n          renderMessage(bindings, false) // not green\n\n          field.value = '' // clear from out for reuse\n          field.setAttribute('class', '')\n          field.disabled = false\n        }\n      }\n      updater.update([], sts, sendComplete)\n    }\n    form.appendChild(dom.createElement('br'))\n\n    let field, sendButton\n    const turnOnInput = function () {\n      creatorAndDate(lhs, me, '', null)\n\n      field = dom.createElement('textarea')\n      middle.innerHTML = ''\n      middle.appendChild(field)\n      field.rows = 3\n      // field.cols = 40\n      field.setAttribute('style', messageBodyStyle + 'background-color: #eef;')\n\n      field.addEventListener(\n        'keyup',\n        function (e) {\n          // User preference?\n          if (e.keyCode === 13) {\n            if (!e.altKey) {\n              // Alt-Enter just adds a new line\n              sendMessage()\n            }\n          }\n        },\n        false\n      )\n\n      rhs.innerHTML = ''\n      sendButton = UI.widgets.button(\n        dom,\n        UI.icons.iconBase + 'noun_383448.svg',\n        'Send'\n      )\n      sendButton.setAttribute('style', UI.style.buttonStyle + 'float: right;')\n      sendButton.addEventListener('click', sendMessage, false)\n      rhs.appendChild(sendButton)\n    }\n\n    const context = { div: middle, dom }\n    login.ensureLoggedIn(context).then(context => {\n      me = context.me\n      turnOnInput()\n    })\n\n    return form\n  }\n\n  /* const sendMessage = function (oldMsg, options) { // alain\n    // titlefield.setAttribute('class','pendingedit')\n    // titlefield.disabled = true\n    field.setAttribute('class', 'pendingedit')\n    field.disabled = true\n    const sts = []\n    const now = new Date()\n    const timestamp = '' + now.getTime()\n    const dateStamp = $rdf.term(now)\n    // http://www.w3schools.com/jsref/jsref_obj_date.asp\n    const message = store.sym(messageStore.uri + '#' + 'Msg' + timestamp)\n\n    if (options === 'edit' || options === 'delete') {\n      sts.push(\n        new $rdf.Statement(mostRecentVersion(oldMsg), DCT('isReplacedBy'), message, messageStore)\n      )\n    } else {\n      sts.push(\n        new $rdf.Statement(subject, ns.wf('message'), message, messageStore)\n      )\n    }\n    // sts.push(new $rdf.Statement(message, ns.dc('title'), store.literal(titlefield.value), messageStore))\n    const msgBody = options !== 'delete' ? field.value : `message deleted\\nby ${nick(me)}`\n    sts.push(\n      new $rdf.Statement(\n        message,\n        ns.sioc('content'),\n        store.literal(msgBody),\n        messageStore\n      )\n    )\n    sts.push(\n      new $rdf.Statement(message, DCT('created'), dateStamp, messageStore)\n    )\n    if (me) {\n      sts.push(\n        new $rdf.Statement(message, ns.foaf('maker'), me, messageStore)\n      )\n    }\n\n    const sendComplete = function (uri, success, body) {\n      if (!success) {\n        form.appendChild(\n          UI.widgets.errorMessageBlock(dom, 'Error writing message: ' + body)\n        )\n      } else {\n        const bindings = {\n          '?msg': message,\n          '?content': store.literal(field.value),\n          '?date': dateStamp,\n          '?creator': me\n        }\n        renderMessage(bindings, false) // not green\n\n        field.value = '' // clear from out for reuse\n        field.setAttribute('class', '')\n        field.disabled = false\n      }\n    }\n    updater.update([], sts, sendComplete)\n  } */\n\n  const appendMsg = function (fieldValue, oldMsg = {}, options = '') { // alain\n    const sts = []\n    const now = new Date()\n    const timestamp = '' + now.getTime()\n    const dateStamp = $rdf.term(now)\n    // http://www.w3schools.com/jsref/jsref_obj_date.asp\n    const message = store.sym(messageStore.uri + '#' + 'Msg' + timestamp)\n\n    if (options === 'edit' || options === 'delete') {\n      sts.push(\n        new $rdf.Statement(mostRecentVersion(oldMsg), DCT('isReplacedBy'), message, messageStore)\n      )\n    } else {\n      sts.push(\n        new $rdf.Statement(subject, ns.wf('message'), message, messageStore)\n      )\n    }\n    // sts.push(new $rdf.Statement(message, ns.dc('title'), store.literal(titlefield.value), messageStore))\n    const msgBody = options !== 'delete' ? fieldValue : `message deleted\\nby ${nick(me)}`\n    sts.push(\n      new $rdf.Statement(\n        message,\n        ns.sioc('content'),\n        store.literal(msgBody),\n        messageStore\n      )\n    )\n    sts.push(\n      new $rdf.Statement(message, DCT('created'), dateStamp, messageStore)\n    )\n    if (me) {\n      sts.push(\n        new $rdf.Statement(message, ns.foaf('maker'), me, messageStore)\n      )\n    }\n    return { message, dateStamp, sts }\n  }\n\n  function nick (person) {\n    const s = store.any(person, UI.ns.foaf('nick'))\n    if (s) return '' + s.value\n    return '' + utils.label(person)\n  }\n\n  function creatorAndDate (td1, creator, date, message) {\n    const nickAnchor = td1.appendChild(anchor(nick(creator), creator))\n    if (creator.uri) {\n      store.fetcher.nowOrWhenFetched(creator.doc(), undefined, function (\n        _ok,\n        _body\n      ) {\n        nickAnchor.textContent = nick(creator)\n      })\n    }\n    td1.appendChild(dom.createElement('br'))\n    td1.appendChild(anchor(date, message))\n  }\n\n  // ///////////////////////////////////////////////////////////////////////\n\n  function syncMessages (about, messageTable) {\n    const displayed = {}\n    let ele, ele2\n    for (ele = messageTable.firstChild; ele; ele = ele.nextSibling) {\n      if (ele.AJAR_subject) {\n        displayed[ele.AJAR_subject.uri] = true\n      }\n    }\n    const messages = store.each(about, ns.wf('message'))\n    const stored = {}\n    messages.forEach(function (m) {\n      stored[m.uri] = true\n      if (!displayed[m.uri]) {\n        addMessage(m)\n      }\n    })\n\n    // eslint-disable-next-line space-in-parens\n    for (ele = messageTable.firstChild; ele; ) {\n      ele2 = ele.nextSibling\n      if (ele.AJAR_subject && !stored[ele.AJAR_subject.uri]) {\n        messageTable.removeChild(ele)\n      }\n      ele = ele2\n    }\n  }\n\n  const mostRecentVersion = function (message) {\n    let msg = message\n    // const listMsg = []\n    while (msg) {\n      // listMsg.push(msg)\n      msg = store.statementsMatching(message, DCT('isReplacedBy'))\n    }\n    return msg\n  }\n\n  const _deleteMessage = async function (message) { // alain: must delete message and all linked with isReplacedBy\n    // alain: check that me is not the author and ask for confirmation.\n    const deletions = await store.connectedStatements(message, messageStore)\n    updater.update(deletions, [], function (uri, ok, body) {\n      if (!ok) {\n        announce.error('Cant delete messages:' + body)\n      } else {\n        syncMessages(subject, messageTable)\n      }\n    })\n  }\n\n  const addMessage = function (message) {\n    const bindings = {\n      '?msg': message,\n      '?creator': store.any(message, ns.foaf('maker')),\n      '?date': store.any(message, DCT('created')),\n      '?content': store.any(message, ns.sioc('content'))\n    }\n    renderMessage(bindings, true) // fresh from elsewhere\n  }\n\n  const renderMessage = function (bindings, fresh) {\n    const creator = bindings['?creator']\n    const message = bindings['?msg']\n    const date = bindings['?date']\n    const content = bindings['?content']\n\n    const dateString = date.value\n    const tr = dom.createElement('tr')\n    tr.AJAR_date = dateString\n    tr.AJAR_subject = message\n\n    let done = false\n    for (let ele = messageTable.firstChild; ; ele = ele.nextSibling) {\n      if (!ele) {\n        // empty\n        break\n      }\n      if (\n        (dateString > ele.AJAR_date && newestFirst) ||\n        (dateString < ele.AJAR_date && !newestFirst)\n      ) {\n        messageTable.insertBefore(tr, ele)\n        done = true\n        break\n      }\n    }\n    if (!done) {\n      messageTable.appendChild(tr)\n    }\n\n    const td1 = dom.createElement('td')\n    tr.appendChild(td1)\n    creatorAndDate(td1, creator, UI.widgets.shortDate(dateString), message)\n\n    const td2 = dom.createElement('td')\n    tr.appendChild(td2)\n    const pre = dom.createElement('p')\n    pre.setAttribute(\n      'style',\n      messageBodyStyle +\n        (fresh ? 'background-color: #e8ffe8;' : 'background-color: #white;')\n    )\n    td2.appendChild(pre)\n    pre.textContent = content.value\n\n    const td3 = dom.createElement('td')\n    tr.appendChild(td3)\n\n    const delButton = dom.createElement('button')\n    td3.appendChild(delButton)\n    delButton.textContent = '-'\n\n    tr.setAttribute('class', 'hoverControl') // See tabbedtab.css (sigh global CSS)\n    delButton.setAttribute('class', 'hoverControlHide')\n    delButton.setAttribute('style', 'color: red;')\n    delButton.addEventListener(\n      'click',\n      function (_event) {\n        td3.removeChild(delButton) // Ask -- are you sure?\n        const cancelButton = dom.createElement('button')\n        cancelButton.textContent = 'cancel'\n        td3.appendChild(cancelButton).addEventListener(\n          'click',\n          function (_event) {\n            td3.removeChild(sureButton)\n            td3.removeChild(cancelButton)\n            td3.appendChild(delButton)\n          },\n          false\n        )\n        const sureButton = dom.createElement('button')\n        sureButton.textContent = 'Delete message'\n        td3.appendChild(sureButton).addEventListener(\n          'click',\n          function (_event) { // alain test for delete or edit depending on me = maker\n            td3.removeChild(sureButton)\n            td3.removeChild(cancelButton)\n            // deleteMessage(message) // alain or sendMessage(message, 'delete' or 'edit') //alain\n            if (me.value === store.any(message, ns.foaf('maker')).value) {\n              const { sts } = appendMsg() // alain\n              updater.update([], sts)\n            }\n          },\n          false\n        )\n      },\n      false\n    )\n  }\n\n  // Messages with date, author etc\n\n  messageTable = dom.createElement('table')\n  messageTable.fresh = false\n  div.appendChild(messageTable)\n  messageTable.setAttribute('style', 'width: 100%;') // fill that div!\n\n  const tr = newMessageForm()\n  if (newestFirst) {\n    messageTable.insertBefore(tr, messageTable.firstChild) // If newestFirst\n  } else {\n    messageTable.appendChild(tr) // not newestFirst\n  }\n\n  let query\n  // Do this with a live query to pull in messages from web\n  if (options.query) {\n    query = options.query\n  } else {\n    query = new $rdf.Query('Messages')\n    const v = {} // semicolon needed\n    const vs = ['msg', 'date', 'creator', 'content']\n    vs.forEach(function (x) {\n      query.vars.push((v[x] = $rdf.variable(x)))\n    })\n    query.pat.add(subject, WF('message'), v.msg)\n    query.pat.add(v.msg, ns.dct('created'), v.date)\n    query.pat.add(v.msg, ns.foaf('maker'), v.creator)\n    query.pat.add(v.msg, ns.sioc('content'), v.content)\n  }\n\n  function doneQuery () {\n    messageTable.fresh = true // any new are fresh and so will be greenish\n  }\n  store.query(query, renderMessage, undefined, doneQuery)\n  div.refresh = function () {\n    syncMessages(subject, messageTable)\n  }\n  // syncMessages(subject, messageTable) // no the query will do this async\n  return div\n}\n"],"mappings":"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"}